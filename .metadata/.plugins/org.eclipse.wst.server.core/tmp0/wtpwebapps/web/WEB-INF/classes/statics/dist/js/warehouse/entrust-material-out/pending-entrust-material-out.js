"use strict";var vm=new Vue({el:"#app",data:{isShow:!1,isEdit:!1,reload:!1,isSearchHide:!0,isTabulationHide:!0,isHide:!0,categoryType:[],goodsTypePath:"",goodsValue:"",selected:"",openTime:"",selectType:[{value:"W_REQUISITION_04",label:"受托加工送料"},{value:"W_REQUISITION_05",label:"受托加工退料"}],body:{documentNo:"",goodsNo:"",goodsTypePath:"",businessType:""},data_config:{url:contextPath+"/entrustOut/queryRequisitionList",datatype:"json",colNames:["id","goodsTypePath","custId","supplierId","源单类型","源单编号","日期","业务类型","商品类型","图片","商品编码","商品名称","计数单位","数量","计重单位","重量"],colModel:[{name:"id",width:210,align:"left",hidden:!0},{name:"goodsTypePath",width:210,align:"left",hidden:!0},{name:"custId",width:210,align:"left",hidden:!0},{name:"supplierId",width:210,align:"left",hidden:!0},{name:"sourceType",width:210,align:"left",formatter:function(e,t,i,o){return"调拨单"}},{name:"documentNo",width:210,align:"left",formatter:function(e,t,i,o){return $(document).off("click",".detail"+e).on("click",".detail"+e,function(){vm.detailClick({value:e,grid:t,rows:i,state:o})}),'<a class="detail'+e+'">'+e+"</a>"},unformat:function(e,t,i){return e.replace(/(<\/?a.*?>)/g,"")}},{name:"transferTime",width:210,align:"left",formatter:function(e,t,i,o){return new Date(e).format("yyyy-MM-dd")}},{name:"businessType",width:210,align:"left",formatter:function(e,t,i,o){return"W_REQUISITION_04"===e?"受托加工送料":"W_REQUISITION_05"===e?"受托加工退料":""}},{name:"goodsTypeName",align:"left",width:210},{name:"pictureUrl",index:"pictureUrl",width:80,align:"center",fixed:"true",formatter:function(e,t,i){guid();$(document).on("mouseout",".can",function(){vm.hideMirror(i.id)}),$(document).on("mouseenter",".select"+i.id,function(){vm.showMirror(i.id)});var o=i.pictureUrl;return o?'<div class="select'+i.id+' can">\n                                    <img height="50px" width="50px" src="'+o+'"/>\n                                    <div class="mirror"><img class="bigimg" src="'+o+'"></div>\n                                </div>':'<div class="select${rowObject.id}"></div>'}},{name:"goodsNo",align:"left",width:210},{name:"goodsName",align:"left",width:210},{name:"countingUnit",align:"left",width:210},{name:"baileeNum",align:"left",width:210},{name:"weightUnit",align:"left",width:210},{name:"totalWeight",align:"left",width:210}],rowNum:10,rowList:[10,20,30],mtype:"post",viewrecords:!0}},methods:{refresh:function(){this.clear(),this.reload=!this.reload},search:function(){this.reload=!this.reload},clear:function(){this.body={documentNo:"",goodsNo:"",goodsTypePath:"",businessType:""},this.$nextTick(function(){this.body.businessType="",this.body.goodsTypePath="",this.goodsValue=""})},loadProductType:function(){var t=this;$.ajax({type:"post",url:contextPath+"/entrustOut/queryStyleCategory?parentId=0",contentType:"application/json",dataType:"json",success:function(e){console.log(e),t.categoryType=t.initGoodCategory(e.data.cateLists)},error:function(){alert("服务器出错啦")}})},changeproductTypeName:function(e,t){console.log(e,t),this.body.goodsTypePath=t[t.length-1].value,console.log(this.body.goodsTypePath)},initGoodCategory:function(e){var n=this,s=[];return e.forEach(function(e){var t=e.customCode,i=e.name,o=e.cateLists;o&&(o=n.initGoodCategory(o)),s.push({value:t,label:i,children:o})}),s.forEach(function(e){e.children||delete e.children}),s},add:function(){if(console.log(this.selected,33431),this.selected.length<1)this.$Modal.warning({title:"提示信息",content:"请至少选择一条数据！"});else{for(var e=[],t=this.selected[0].businessType,i=this.selected[0].goodsTypePath,o=this.selected[0].custId,n=this.selected[0].supplierId,s=0;s<this.selected.length;s++){if(this.selected[s].businessType!==t)return layer.alert("业务类型不相同，不能合并"),void console.log(this.selected[s].businessType);if(this.selected[s].goodsTypePath!==i)return layer.alert("商品类型不相同，不能合并"),void console.log(this.selected[s].goodsTypePath,i);if(this.selected[s].custId&&o&&this.selected[s].custId!==o)return layer.alert("客户不相同，不能合并"),void console.log(this.selected[s].custId,o);if(this.selected[s].supplierId&&n&&this.selected[s].supplierId!==n)return layer.alert("供应商不相同，不能合并"),void console.log(this.selected[s].supplierId,n);e.push({documentNo:this.selected[s].documentNo,id:this.selected[s].id})}window.parent.activeEvent({name:"受托加工材料出库-新增",url:contextPath+"/warehouse/entrust-material-out/entrust-material-out-info.html",params:{activeType:"sourceAdd",documentNoArr:e}})}},exit:function(){window.parent.closeCurrentTab({openTime:this.openTime,exit:!0})},showMirror:function(e){$(".select"+e+" .mirror").show()},hideMirror:function(e){$(".select"+e+" .mirror").hide()},detailClick:function(e){window.parent.activeEvent({name:"调拨单-查看",url:contextPath+"/warehouse/requisition/requisition-info.html",params:{activeType:"listQuery",id:e.rows.documentNo}})}},mounted:function(){this.loadProductType(),this.openTime=window.parent.params.openTime}});