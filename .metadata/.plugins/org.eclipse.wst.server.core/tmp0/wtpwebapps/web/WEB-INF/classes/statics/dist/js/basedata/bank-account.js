"use strict";function _defineProperty(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}var currencyVm=new Vue({el:"#paraLevel",data:function(){var i=this;return{saveDisable:!0,isSearchHide:!0,showModal:!1,openTime:"",selectOrginId:[],columns:[{type:"selection",width:60,align:"center"},{title:"组织名称",key:"orgName"}],colContent:[],area:{},areaInit:{isInit:!1,province:"",city:"",county:"",detail:"",disabled:!1},isShow:!1,isLock:!1,isAdd:!1,reload:!1,selected:[],offices:[],nodeData:[],setting1:{data:{simpleData:{enable:!0,idKey:"id",pIdKey:"parentId",rootPId:-1}},callback:{onClick:this.clickEvent}},body:{order:"",code:"",status:"",name:"",headCode:""},banks:[],status:[{value:1,label:"有效"},{value:0,label:"无效"}],type:[{value:1,label:"供应商"},{value:0,label:"客户"}],add:{},data_config:{url:contextPath+"/tbankaccount/list",colNames:["编码","名称","开户支行","状态","备注","创建人","创建时间"],colModel:[{name:"code",index:"code",width:90,align:"left",formatter:function(e,t,a,n){return $(document).off("click",".detail"+e).on("click",".detail"+e,function(){i.detailClick({value:e,grid:t,rows:a,state:n})}),'<a class="detail'+e+'">'+e+"</a>"}},{name:"name",index:"",width:90,align:"left"},{name:"subBank",index:"",width:90,align:"left"},{name:"status",index:"",width:80,align:"left",formatter:function(e,t,a,n){return 1==e?"有效":"无效"}},{name:"remark",index:"",width:80,align:"left"},{name:"createName",index:"",width:80,align:"left"},{name:"createTime",index:"",width:150,align:"left",sortable:!1}]}}},methods:{hideSearch:function(){this.isSearchHide=!this.isSearchHide,$(".chevron").css("top","")},showOrgin:function(){0!=this.selected.length?this.showModal=!0:layer.alert("请选择行!")},okModel:function(){if(0!=this.selectOrginId.length){var e={ids:{},orginIds:{}};e.ids=this.selected.join(","),e.orginIds=this.selectOrginId.join(","),this.cancelModel(),console.log(e);var t=this;$.ajax({type:"POST",url:contextPath+"/tbankaccount/allot",traditional:!0,datatype:"json",data:e,success:function(e){"100100"===e.code?(layer.alert("分配成功",{icon:1}),t.selectOrginId=[]):layer.alert(e.msg,{icon:0})},error:function(e){layer.alert("服务器出错",{icon:0})}})}else layer.alert("请选择分配组织!")},cancelModel:function(){this.selectOrginId=[],this.$refs.test.selectAll(!1),this.showModal=!1},changeselect:function(e){console.log(e);for(var t=0;t<e.length;t++)this.selectOrginId.push(e[t].id)},search:function(){this.reload=!this.reload},add_click:function(){0!=$.fn.zTree.getZTreeObj("tree").getSelectedNodes().length?(this.areaInit={isInit:!0,province:"",city:"",county:"",detail:"",disabled:!1},this.add.headCode=this.body.headCode,this.isShow=!0,this.isAdd=!0):layer.alert("请先选择开户总行",{icon:0})},cancel:function(){this.saveDisable=!0,this.isShow=!1,this.isLock=!1,this.isAdd=!1,this.initAddBody(),$("#addForm").validate().resetForm(),this.areaInit={isInit:!1,province:"",city:"",county:"",detail:"",disabled:!1}},clear:function(){var e=$.fn.zTree.getZTreeObj("tree").getSelectedNodes();$.fn.zTree.getZTreeObj("tree").cancelSelectedNode(e[0]),this.body=_defineProperty({order:"",code:"",headCode:"",status:"",name:""},"code","")},copy:function(){if(1===this.selected.length){var e=this.selected[0];e&&(this.isAdd=!0,this.info(e,!1,!0))}else layer.alert("只能对单行数据操作!")},modify:function(){if(1===this.selected.length){var e=this.selected[0];e&&this.info(e,!1,!1)}else layer.alert("修改只能对单条数据进行操作",{icon:0})},save:function(){var e=contextPath+"/tbankaccount/update";""===this.add.id&&(e=contextPath+"/tbankaccount/save");if($("#addForm").valid()){if(ht.util.hasValue(this.area,"object")&&Object.assign(this.add,this.area),!this.saveDisable)return!1;this.saveDisable=!1;var t=this;$.ajax({type:"POST",url:e,contentType:"application/json",async:!0,data:JSON.stringify(this.add),dataType:"json",success:function(e){"100100"===e.code?layer.alert("保存成功",{icon:1,end:function(){t.saveDisable=!0,t.cancel(),t.reload=!t.reload}}):(t.saveDisable=!0,layer.alert(e.msg,{icon:0}))},error:function(e){t.saveDisable=!0,layer.alert("网络异常，请重试！",{icon:0})}})}},view:function(){if(1===this.selected.length){var e=this.selected[0];e&&this.info(e,!0,!1)}else layer.alert("查看只能对单条数据进行操作",{icon:0})},del:function(){if(0!=this.selected.length){var t=this;layer.confirm("当前数据有可能被引用，会影响数据准确性，确认是否删除？",{btn:["确认","取消"],btn1:function(){$.ajax({type:"POST",url:contextPath+"/tbankaccount/delete",contentType:"application/json",data:JSON.stringify(currencyVm.selected),dataType:"json",success:function(e){"100100"==e.code?(layer.alert("数据删除成功",{icon:1}),t.selected=[],t.search()):layer.alert("服务器异常，请重试！",{icon:0})},error:function(e){layer.alert("网络异常，请重试！",{icon:0})}})}})}else layer.alert("请选择行!")},detailClick:function(e){var t=e.rows.id;t&&this.info(t,!0,!1)},exit:function(){window.parent.closeCurrentTab({exit:!0,openTime:this.openTime})},clickEvent:function(e,t,a){console.log(a),this.body.headCode=a.value,this.add.headCode=a.value,this.search()},selectGroup:function(e){vm.groupId=e.id},info:function(e,a,n){e&&$.ajax({type:"POST",url:contextPath+"/tbankaccount/info/"+e,contentType:"application/json",dataType:"json",async:!1,success:function(e){if("100100"===e.code){currencyVm.add=e.data,n&&(currencyVm.add.id="",currencyVm.add.code="",currencyVm.add.name="",currencyVm.add.createTime=(new Date).Format("yyyy-MM-dd hh:mm:ss"),currencyVm.add.createName=layui.data("user").username),currencyVm.isLock=a,currencyVm.isShow=!0;var t=currencyVm.add;t.province&&(currencyVm.areaInit={isInit:!0,province:t.province||"",city:t.city||"",county:t.county,detail:t.detail,disabled:a})}else layer.alert("网络异常",{icon:0})},error:function(e){layer.alert("网络异常",{icon:0})}})},initAddBody:function(){this.add={id:"",code:"",name:"",acountNumber:"",officeCode:"",headCode:"",subBank:"",address:"",status:1,createName:layui.data("user").username,createTime:(new Date).Format("yyyy-MM-dd hh:mm:ss"),updateName:"",updateTime:"",remark:""}},initFormValidate:function(){var e={onfocusout:function(e){$(e).valid()},onkeyup:!1,rules:{code:{isChar:!0,required:!0,maxlength:30,remote:{url:contextPath+"/tbankaccount/validateCode",type:"post",dataType:"json",data:{id:function(){return currencyVm.add.id}},dataFilter:function(e,t){var a=JSON.parse(e);return"100100"===a.code?a.data:(layer.alert(a.msg),!1)}}},name:{required:!0,maxlength:30,remote:{url:contextPath+"/tbankaccount/validateCode",type:"post",dataType:"json",data:{id:function(){return currencyVm.add.id}},dataFilter:function(e,t){var a=JSON.parse(e);return"100100"===a.code?a.data:(layer.alert(a.msg),!1)}}},acountNumber:{required:!0,maxlength:50},headCode:{required:!0},subBank:{maxlength:50},remark:{maxlength:255}},messages:{code:{required:"请填写编码!",maxlength:"编码最大长度为30！",remote:"该编码已存在!"},name:{required:"请填写名称!",maxlength:"编码最大长度为30！",remote:"该名称已存在!"},acountNumber:{required:"请填写银行账号!",maxlength:"银行账号最大长度为50!"},headCode:{required:"请选择开户总行!"},subBank:{maxlength:"开户支行最大长度为50!"},remark:{maxlength:"备注最大长度为50!"}}};$("#addForm").validate(e)},initBank:function(){this.banks=getCodeList("root_base_banks"),this.$refs.my_tree.nodeData=this.banks,this.$refs.my_tree.loadData()},initOrgin:function(){var r=this;$.ajax({type:"POST",url:contextPath+"/tbankaccount/paramMap",contentType:"application/json",dataType:"json",async:!1,success:function(e){if(console.log(e),"100100"===e.code){for(var t=e.data.organList,a=e.data.organId,n=-1,i=0;i<t.length;i++)if(a==t[i].id){n=i;break}t.splice(n,1),r.colContent=t}else layer.alert("网络异常",{icon:0})},error:function(e){layer.alert("网络异常",{icon:0})}})}},mounted:function(){this.initOrgin(),this.initFormValidate(),jQuery.validator.addMethod("isChar",function(e,t){return/^([a-zA-Z0-9]+)$/.test(e)},"编码格式错误!"),this.initAddBody(),this.initBank(),this.openTime=window.parent.params.openTime}});