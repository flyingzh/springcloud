"use strict";Vue.component("edit-formula",{data:function(){return{show:this.value,dataList:[],operate:[{label:"1001 库存现金",value:1},{label:"100101 现金",value:11},{label:"100102 库存外币",value:12},{label:"1002 银行存款",value:2}],subject:"",subjectVisable:!1,reload:!0,curTable:"",currentSelectRow:"",addData:[],delDdata:[]}},methods:{editClick:function(t){console.log(t)},closeModal:function(){this.$emit("close")},selectSub:function(){this.subjectVisable=!0},subjectClose:function(){this.subjectVisable=!1},cancleRemark:function(){},delRemark:function(){},subjectDate:function(t){this.subject=t},add:function(){this._ajaxAddData(),this.addData&&0<this.addData.length&&(this.dataList.unshift(this.addData[0]),this.addData=[])},_ajaxAddData:function(){var a=this,t="./../../report/formulaAmount?accountId="+this.subject+"&tableName=利润表&valueRule=1";$.ajax({type:"POST",data:"",url:t,dataType:"json",async:!1,success:function(t){a.addData[0]=t.data},error:function(t){console.log(t)}})},save:function(){this._ajaxSaveData()},_ajaxSaveData:function(){var a=this,e=[];if(a.dataList.forEach(function(t){(!t.id||t.id<0)&&e.push(t)}),a.delData.forEach(function(t){0<t.id&&(t.status=2,e.push(t))}),e.length<=0)return alert("没有要保存的数据!"),!1;e.forEach(function(t){delete t.account,t.reportContentId=reportVue.reportContentId,t.reportContentName=reportVue.reportContentName});$.ajax({type:"POST",data:JSON.stringify(e),url:"./../../report/formulaSave",dataType:"json",contentType:"application/json;charset=utf-8",success:function(t){a.$Message.success(t.msg),a.$emit("close"),a.delData=[],a.addData=[],a.dataList=[]},error:function(t){console.log(t)}})},_ajaxList:function(){var e=this;e.addData=[],e.delData=[],e.dataList=[];var t="./../../report/formulaList?tableName=利润表&reportContentId="+reportVue.reportContentId;$.ajax({type:"POST",data:"",url:t,dataType:"json",async:!1,success:function(t){var a=t.data;e.dataList=a||[]},error:function(t){console.log(t)}})},refresh:function(){},clickTr:function(t){this.currentSelectRow=t.id,this.curTable="2"},table2ChickTr2:function(){},del:function(a){var e=this;console.log(a);var t=this.dataList.findIndex(function(t){return t.id==a.id});t<0||this.dataList.splice(t,1).forEach(function(t){e.delData.push(t)})},formatNum:function(t,a){var e=Math.pow(1e3,a);return parseInt(t*e,10)/e}},watch:{value:function(t){(this.show=t)&&this._ajaxList()}},computed:{totalAmount1:function(){var a=this,e=0;return this.dataList.forEach(function(t){e+=a.formatNum(t.amount1,1)}),(e=accounting.formatMoney(e,"",2))||0},totalAmount2:function(){var a=this,e=0;return this.dataList.forEach(function(t){e+=a.formatNum(t.amount2,1)}),(e=accounting.formatMoney(e,"",2))||0}},filters:{filterMoney:function(t){return accounting.formatMoney(t,"",2)}},props:["title","value"],template:'\n        <div>\n            <Modal\n                :title=\'title\'\n                v-model="show"\n                width="800"\n                @on-cancel=\'closeModal\'\n                :mask-closable="false">\n                <label>科目：</label>\n                <i-select v-model="subject" style="width:200px">\n                    <i-option v-for="item in operate" :value="item.value" :key="item.value">{{item.label}}</i-option>\n                </i-select>\n                <i-button @click="selectSub">选择科目</i-button>\n                <i-button @click="add">添加</i-button>\n                <div class="ht-receivableW-table mt10"> \n                    <div class="ht-wrapper-tbl">\n                        <table class="table tablediv">\n                            <thead>\n                            <tr>\n                                <td class="wt200">项目</td>\n                                <td class="wt100">运算方式</td>\n                                <td class="wt125">本年累计金额</td>\n                                <td class="wt100">本月金额</td>\n                                <td class="wt80">操作</td>\n                            </tr>\n                            </thead>\n                            <tbody >\n                            <tr lay-size="sm" v-for="(item,idx) in dataList" @click="clickTr(item)"  :class="{success: currentSelectRow === item.id}" >     \n                                <td class="wt200">{{item.account}}</td>\n                                <td class="wt100">{{item.computeType}}</td>\n                                <td class="wt125">{{item.amount1 | filterMoney}}</td>\n                                <td class="wt100">{{item.amount2 | filterMoney}}</td>\n                                <td class="wt80">\n                                    <Icon type="close-round" @click="del(item)"></Icon>\n                                </td>\n                            </tr>\n                            </tbody>\n                            <tfoot>\n                            <tr>\n                                <td class="wt200">合计</td>\n                                <td class="wt100"></td>\n                                <td class="wt125">{{totalAmount1}}</td>\n                                <td class="wt100">{{totalAmount2}}</td>\n                                <td class="wt80"></td>    \n                            </tr>\n                            </tfoot>\n                        </table>\n                    </div>\n                </div>\n                <div slot="footer">\n                    <i-button type="primary" @click="save">确定</i-button>\n                    <i-button @click="closeModal">取消</i-button>\n                </div>\n            </Modal>\n            <subject-tree v-model="subjectVisable" @close="subjectClose" @save="subjectDate"></subject-tree>\n        </div>\n    '});