"use strict";var _extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var o=arguments[t];for(var n in o)Object.prototype.hasOwnProperty.call(o,n)&&(e[n]=o[n])}return e};new Vue({el:"#more-rows-detail",data:function(){return{curDate:(new Date).format("yyyy-MM-dd"),openTime:"",initInfo:{pageType:1,pageTitle:"多栏式明细账"},isInit:!0,projectStatus:!1,subjectStatus:!0,showFilter:!1,subjectVisiable:!1,visible_filter:!1,deleteVisible:!1,deleteLoading:!0,id:"",auditStatus:"",confirmConfig:{showConfirm:!1,title:"提示",content:"这是内容",onlySure:!0,success:!0},filterBody:{currencyId:"",accountBeginYear:"",accountEndYear:"",accountBeginPeriod:"",accountEndPeriod:"",accountBeginCode:"",showDisable:!1,showDetail:!1,noShowAndHappen:!1,noShowAndHappenZero:!1,unBill:!1,projectItemClassId:"",projectItemId:""},currencyList:[],subjectList:[{name:"第一期",value:1},{name:"第二期",value:2},{name:"第三期",value:3},{name:"第四期",value:4},{name:"第五期",value:5},{name:"第六期",value:6},{name:"第七期",value:7},{name:"第八期",value:8},{name:"第九期",value:9},{name:"第十期",value:10},{name:"第十一期",value:11},{name:"第十二期",value:12}],projectList:{},projectCategoryList:[],years:[]}},methods:{handlerData:function(){var a=this;if(null!=a.filterBody.accountBeginCode&&""!=a.filterBody.accountBeginCode){var e=contextPath+"/multiColumnAccountController/multiColumnAccountDetail";$.ajax({type:"POST",url:e,contentType:"application/json;charset=utf-8",data:JSON.stringify(a.filterBody),dataType:"json",success:function(e){if(console.log(e),null!=e.data)if(a.clearTable(),$.isEmptyObject(e.data))a.$Message.error(e.msg);else{var t=e.data;t.header.colModel&&$.each(t.header.colModel,function(e,t){"voucherNumber"==t.name?t.formatter=function(e,t,o){$(document).off("click",".voucher"+o.voucherId).on("click",".voucher"+o.voucherId,function(){a.voucherDetail(o)});var n='<a class="voucher'+o.voucherId+'">'+e+"</a>";return void 0===e?"":n}:"debitMoney"==t.name?t.formatter=function(e,t,o){return a.formartMoney(e)}:"creditMoney"==t.name?t.formatter=function(e,t,o){return a.formartMoney(e)}:"balance"==t.name&&(t.formatter=function(e,t,o){return a.formartMoney(e)})}),a.reportInit(t)}else a.$Message.error(e.msg)},error:function(e){console.log("服务器出错")}})}else a.$Message.info("请先选择科目,再查询多栏账数据!")},formartMoney:function(e){return null==e||0==e?"":accounting.formatNumber(e,2,",")},voucherDetail:function(e){var t=contextPath+"/finance/voucher-lrt/index.html?voucherId="+e.voucherId+"&sobId="+e.sobId;console.log(t),window.parent.activeEvent({name:"查看凭证",url:t,params:null})},reportInit:function(e){var t=this,o=Object.assign({},_extends({pager:"#my_pager",styleUI:"Bootstrap",dataType:"local",shrinkToFit:!1,autoScroll:!0,height:$(window).height()-120},e.header,{gridComplete:function(){t.isInit&&jQuery("#my_report").jqGrid("setGroupHeaders",{useColSpanStyle:!0,groupHeaders:[{startColumnName:e.header.startTitle,numberOfColumns:e.header.colNames.length,titleText:e.header.title}]}),t.isInit=!1},loadComplete:function(e){console.log(e),e.subjectName&&$(this).jqGrid("setCaption","科目："+e.subjectName)}}));jQuery("#my_report").jqGrid(o);for(var n=e.list.length,a=0;a<n;a++)$("#my_report").jqGrid("addRowData",a+1,e.list[a])},clearTable:function(){var e=$(".jqGrid_wrapper");e.empty(),$('<table id="my_report"></table>').appendTo(e),$('<div id="my_pager"></div>').appendTo(e),this.isInit=!0},getFinanceYearPeriod:function(){var t=this;$.ajax({type:"POST",data:null,url:contextPath+"/voucherController/getFinanceYearPeriod",dataType:"json",success:function(e){console.log(e),t.years=e.data,t.filterBody.accountBeginYear=t.years[0].value,t.filterBody.accountEndYear=t.years[0].value}})},handleOpen:function(){this.visible_filter=!0},iconPopup:function(){this.subjectVisiable=!0},subjectClose:function(){this.subjectVisiable=!1},subjectDate:function(t){console.log(t);var e=t.subjectCode,o=this;$.ajax({type:"POST",data:{subjectCode:e},url:contextPath+"/multiColumnAccountController/checkAndGetProjectByCode",dataType:"json",success:function(e){console.log(e),"-1"==e.code?o.$Message.error(e.msg):(o.filterBody.accountBeginCode=t.subjectCode,1!=e.data?(o.projectCategoryList=e.data,o.filterBody.projectItemClassId=o.projectCategoryList[0].id,o.projectStatus=!0,o.subjectStatus=!1):(o.filterBody.projectItemClassId="",o.filterBody.projectItemId="",o.projectStatus=!1,o.subjectStatus=!0))}})},sure:function(e){this.visible_filter=(e&&null!=this.filterBody.accountBeginCode&&""!=this.filterBody.accountBeginCode&&this.handlerData(),!1)},getProjectList:function(){var t=this;$.ajax({type:"POST",data:null,url:contextPath+"/multiColumnAccountController/getProjectList",dataType:"json",success:function(e){console.log(e),t.projectList=e.data}})},refreshData:function(){this.handlerData()},showVoucher:function(){var e=jQuery("#my_report").jqGrid("getGridParam","selrow");if(null==e)return this.$Message.error("请选择一条明细"),!1;var t=jQuery("#my_report").getRowData(e);null!=t.voucherId&&0!=t.voucherId&&voucherDetail(t)},exitDetail:function(){window.parent.closeCurrentTab({name:"多栏账",openTime:this.openTime,exit:!0})},exportExcel:function(){var e=this.filterBody,t=contextPath+"/multiColumnAccountController/exportExcel?accountBeginYear="+e.accountBeginYear+"&accountBeginYear="+e.accountBeginYear+"&accountEndYear="+e.accountEndYear+"&accountBeginPeriod="+e.accountBeginPeriod+"&accountEndPeriod="+e.accountEndPeriod+"&accountBeginCode="+e.accountBeginCode+"&showDisable="+e.showDisable+"&showDetail="+e.showDetail+"&noShowAndHappen="+e.noShowAndHappen+"&noShowAndHappenZero="+e.noShowAndHappenZero+"&unBill="+e.unBill+"&projectItemClassId="+e.projectItemClassId+"&projectItemId="+e.projectItemId;console.log(t),window.open(t)},initMoreRows:function(){var t=this;$.ajax({type:"POST",data:null,url:contextPath+"/multiColumnAccountController/init",dataType:"json",success:function(e){"100100"==e.code?(t.currencyList=e.data.currencyList,t.filterBody.currencyId=e.data.currencyList[0].id,t.projectList=e.data.projectList):layer.alert("页面初始化失败")}})}},mounted:function(){this.openTime=window.parent.params&&window.parent.params.openTime,this.handlerData(),this.getFinanceYearPeriod(),this.initMoreRows()}});