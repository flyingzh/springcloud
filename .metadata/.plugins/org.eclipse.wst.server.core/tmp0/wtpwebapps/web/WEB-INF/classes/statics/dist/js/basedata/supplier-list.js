"use strict";function _defineProperty(e,i,t){return i in e?Object.defineProperty(e,i,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[i]=t,e}Date.prototype.Format=function(e){var i={"M+":this.getMonth()+1,"d+":this.getDate(),"h+":this.getHours(),"m+":this.getMinutes(),"s+":this.getSeconds(),"q+":Math.floor((this.getMonth()+3)/3),S:this.getMilliseconds()};for(var t in/(y+)/.test(e)&&(e=e.replace(RegExp.$1,(this.getFullYear()+"").substr(4-RegExp.$1.length))),i)new RegExp("("+t+")").test(e)&&(e=e.replace(RegExp.$1,1==RegExp.$1.length?i[t]:("00"+i[t]).substr((""+i[t]).length)));return e};var validateOptions={rules:{supplierCode:{required:!0,remote:{url:contextPath+"/supplier/validate",type:"post",dataType:"json",data:{supplierCode:function(){return $("#supplierCode").val()},id:function(){return $("#id").val()}},dataFilter:function(e,i){var t=JSON.parse(e);return"100100"===t.code||(layer.alert(t.msg),!1)}}},supplierName:{required:!0,remote:{url:contextPath+"/supplier/validate",type:"post",dataType:"json",data:{supplierName:function(){return $("#supplierName").val()},id:function(){return $("#id").val()}},dataFilter:function(e,i){var t=JSON.parse(e);return"100100"===t.code||(layer.alert(t.msg),!1)}}},siShortName:{required:!0,remote:{url:contextPath+"/supplier/validate",type:"post",dataType:"json",data:{siShortName:function(){return $("#siShortName").val()},id:function(){return $("#id").val()}},dataFilter:function(e,i){var t=JSON.parse(e);return"100100"===t.code||(layer.alert(t.msg),!1)}}},supplierLevelId:{required:!0},mainProds:{required:!0},prodType:{required:!0},supplierType:{required:!0},payWay:{required:!0},billingCurrencyId:{required:!0},billingWay:{required:!0},status:{required:!0}},messages:{supplierCode:{required:"请填写编码!",remote:"编码已存在,请确认你的输入!"},supplierName:{required:"请填写公司名称!",remote:"公司名称已存在,请确认你的输入!"},siShortName:{required:"请填写简称!",remote:"公司简称已存在,请确认你的输入!"},supplierLevelId:{required:"请选择等级分类!"},mainProds:{required:"请选择主营商品!"},prodType:{required:"请选择供应商产品类型!"},supplierType:{required:"请选择供应商所属类别!"},payWay:{required:"请选择付款方式!"},billingCurrencyId:{required:"请选择结算币种!"},billingWay:{required:"请选择结算方式!"},status:{required:"请选择有效状态!"}}},successNum=0,supplierVm=new Vue({el:"#supplier-info",data:function(){var e;return _defineProperty(e={isSearchHide:!0,isTabulationHide:!0,isHide:!0,showModal:!1,selectOrginId:[],columns:[{type:"selection",width:60,align:"center"},{title:"组织名称",key:"orgName"}],colContent:[],logUrl:"",codeEdit:!1,logConfig:{multiselect:!1,jsonReader:{root:"data.list",total:"data.totalPage",records:"data.totalCount",cell:"list"},prmNames:{page:"page",rows:"limit",order:"order"},mtype:"POST",contentType:"application/json",datatype:"json",styleUI:"Bootstrap",rownumbers:!0,multiselectWidth:50,viewrecords:!0,pager:"#changeLogPager",rowNum:10,rowList:[10,20,30,40],colNames:["变更信息","变更前","变更后","变更日期","变更人"],colModel:[{name:"changeInfo",index:"changeInfo",width:180},{name:"operationBefore",index:"operationBefore",width:180,formatter:function(e,i,t){if("信用额度"==t.changeInfo)return Math.floor(100*e)/100;if("有效状态"==t.changeInfo)return e==supplierVm.const.STATUS_YES?"有效":"无效";if("付款方式"==t.changeInfo){var r="",a=!0,n=!1,s=void 0;try{for(var l,o=supplierVm.payMethod[Symbol.iterator]();!(a=(l=o.next()).done);a=!0){var p=l.value;e===p.code&&(r=p.name)}}catch(e){n=!0,s=e}finally{try{!a&&o.return&&o.return()}finally{if(n)throw s}}return r}if("税分类"==t.changeInfo)switch(e){case"":return"";case"xgmnsr":return"小规模纳税人";case"ybnsr":return"一般纳税人";case"public_taxtype_1":return"小规模纳税人";case"public_taxtype_2":return"一般纳税人"}else if(!e)return"";return e}},{name:"operationAfter",index:"operationAfter",width:180,formatter:function(e,i,t){if("信用额度"==t.changeInfo)return Math.floor(100*e)/100;if("有效状态"==t.changeInfo)return e==supplierVm.const.STATUS_YES?"有效":"无效";if("付款方式"==t.changeInfo){var r="",a=!0,n=!1,s=void 0;try{for(var l,o=supplierVm.payMethod[Symbol.iterator]();!(a=(l=o.next()).done);a=!0){var p=l.value;e===p.code&&(r=p.name)}}catch(e){n=!0,s=e}finally{try{!a&&o.return&&o.return()}finally{if(n)throw s}}return r}if("税分类"==t.changeInfo)switch(e){case"":return"";case"xgmnsr":return"小规模纳税人";case"ybnsr":return"一般纳税人";case"public_taxtype_1":return"小规模纳税人";case"public_taxtype_2":return"一般纳税人"}return e}},{name:"operationTime",index:"operationTime",width:150,align:"center",formatter:function(e,i,t){return new Date(e).Format("yyyy-MM-dd hh:mm:ss")}},{name:"userName",index:"userName",width:80,align:"center"}]},isEdit:!1,mpisEdit:!1,stisEdit:!1,reload:!1,selected:[],regidate:"",sCode:"",sName:"",sAbb:"",sLevel:"",smPro:"",spType:"",sType:"",sPay:"",sCurrency:"",sbilling:"",isChecked:"",isSave:!0,isInfo:!1,confirmConfig:{showConfirm:!1,title:"提示",content:"这是内容",onlySure:!0,success:!0},const:{STATUS_YES:1,STATUS_NO:0,IS_DEL_YES:0,IS_DEL_NO:1,IS_DEFAULT_YES:1,IS_DEFAULT_NO:0,SUCCESS_CODE:"100100"},suppLevel:[{name:"一级",code:"1"},{name:"二级",code:"2"},{name:"三级",code:"3"},{name:"四级",code:"4"}],mainProduct:[],productType:[{name:"黄金",code:"public_prod_type_1"},{name:"铂金",code:"public_prod_type_2"},{name:"K金",code:"public_prod_type_3"},{name:"钻石",code:"public_prod_type_4"},{name:"银饰",code:"public_prod_type_5"},{name:"金镶",code:"public_prod_type_6"},{name:"3D硬金",code:"public_prod_type_7"},{name:"彩宝",code:"public_prod_type_8"},{name:"翡翠",code:"public_prod_type_9"},{name:"金石",code:"public_prod_type_10"}],suppCategory:[{name:"战略型",code:"1"},{name:"重点型",code:"2"},{name:"常规型",code:"3"},{name:"一般型",code:"4"}],area:{},openTime:"",payMethod:[{name:"预付",code:"yf"},{name:"按结算日结算",code:"ajsrjs"},{name:"到货付",code:"dhf"}],currency:[],billing:[{name:"现金",code:"public_billing_method_1"},{name:"用料",code:"public_billing_method_2"},{name:"电汇",code:"public_billing_method_3"},{name:"信汇",code:"public_billing_method_4"},{name:"商业汇票",code:"public_billing_method_5"},{name:"银行汇票",code:"public_billing_method_6"},{name:"信用证",code:"public_billing_method_7"},{name:"支票",code:"public_billing_method_8"},{name:"票据结算",code:"public_billing_method_9"}],taxType:[{name:"一般纳税人",code:"public_taxtype_1"},{name:"小规模纳税人",code:"public_taxtype_2"}],suppStatus:[{name:"有效",code:1},{name:"无效",code:0}]},"isChecked",1),_defineProperty(e,"contacts",[{name:"zhangsan",phone:"12324",email:"24124@qq.com",tel:"075513242",wechat:"3243435",isDefault:0},{name:"lisi",phone:"12324",email:"24124@qq.com",tel:"075513242",wechat:"3243435",isDefault:2},{name:"wangwu",phone:"12324",email:"24124@qq.com",tel:"075513242",wechat:"3243435",isDefault:2},{name:"zhaoliu",phone:"12324",email:"24124@qq.com",tel:"075513242",wechat:"3243435",isDefault:2}]),_defineProperty(e,"bankAccount",[{bankName:"建设银行",bankAccount:"735972397539275",holder:"李四",isDefault:2},{bankName:"农业银行",bankAccount:"735972397539275",holder:"李四",isDefault:2},{bankName:"工商银行",bankAccount:"735972397539275",holder:"李四",isDefault:2},{bankName:"中国银行",bankAccount:"735972397539275",holder:"李四",isDefault:2}]),_defineProperty(e,"uploadedFiles",[{fileName:"银行卡复印件.jpg",fileSize:"34KB",uploader:"zhangsan",uploadTime:"2018-06-01"},{fileName:"身份证复印件.jpg",fileSize:"34KB",uploader:"zhangsan",uploadTime:"2018-06-01"}]),_defineProperty(e,"mainProdArr",[]),_defineProperty(e,"suppType",[{name:"战略型",code:"1"},{name:"重点型",value:"2"},{name:"常规型",code:"3"},{name:"一般型",code:"4"}]),_defineProperty(e,"suppMainPro",[{label:"黄金加工",value:"1"},{label:"珠宝加工",value:"2"},{label:"钻石成品",value:"3"},{label:"黄金成品",value:"4"}]),_defineProperty(e,"body",{supplierName:"",supplierCode:"",contact:"",status:"",supplierLevel:"",supplierType:"",mainProd:""}),_defineProperty(e,"supplierLevel",""),_defineProperty(e,"supplierType",""),_defineProperty(e,"mainProd",""),_defineProperty(e,"prodType",""),_defineProperty(e,"supplier",{id:"",status:"1",contacts:[],sysFile:{fileId:"",fileType:3,fileDetails:[]},bankCardInfos:[],supplierProds:[]}),_defineProperty(e,"data_config",{url:contextPath+"/supplier/list",colNames:["操作","供应商编码","供应商名称","类型","等级","主营商品","地址","默认联系人","默认联系方式","免息天数","日利率","有效状态","最后修改人","最后修改时间"],colModel:[{name:"id",index:"supplierId",width:55,formatter:function(e,i,t,r){return $(document).off("click",".edit"+e).on("click",".edit"+e,function(){}),'<button class="edit'+e+'">编辑</button>'},hidden:!0},{name:"supplierCode",index:"supplierCode",width:130,formatter:function(e,i,t,r){return $(document).off("click",".detail"+e).on("click",".detail"+e,function(){supplierVm.selected=[t.id],supplierVm.view()}),'<a class="detail'+e+'">'+e+"</a>"}},{name:"supplierName",index:"supplierName",width:200},{name:"supplierType",index:"supplierType",align:"left",width:80,formatter:function(e,i,t){switch(e){case 1:return"战略型";case 2:return"重点型";case 3:return"常规型";case 4:return"一般型";default:return""}}},{name:"name",index:"name",width:100},{name:"mainProd",index:"mainProd",width:250},{name:"concreteAddress",index:"concreteAddress",width:300},{name:"defaultContact",index:"defaultContact",width:100,sortable:!1},{name:"phone",index:"phone",width:100,align:"left"},{name:"freeInterestDay",index:"freeInterestDay",width:100,align:"right"},{name:"daliyRatio",index:"daliyRatio",width:100,align:"right"},{name:"status",index:"status",width:100,align:"left",formatter:function(e,i,t){return e==supplierVm.const.STATUS_YES?"有效":e==supplierVm.const.STATUS_NO?"无效":""}},{name:"updateName",index:"updateName",width:100},{name:"updateTime",index:"updateTime",width:200,align:"center",formatter:function(e,i,t){return new Date(e).Format("yyyy-MM-dd hh:mm:ss")}}],postData:{},shrinkToFit:!1}),_defineProperty(e,"option",[{label:"aaaa",value:"bbbb"}]),_defineProperty(e,"areaInit",{isInit:!1,province:"",city:"",county:"",detail:"",disabled:!1}),_defineProperty(e,"showUpload",!1),e},created:function(){this.loadSupplierLevels(),this.loadCurrency(),this.loadMainProducts(),this.loadDictDataBilling("base_billing_method"),this.loadDictDataPayMethod("base_pay_method"),this.loadDictDataTaxType("base_tax_type"),this.loadSupplierProductType(),this.initOrgin()},methods:{validate:function(){var e=!0,i=[];return this.supplier.supplierName||(e=!1,i.push("供应商名称为空!<br/>")),this.supplier.supplierCode||(e=!1,i.push("供应商编码为空!<br/>")),this.supplier.siShortName||(e=!1,i.push("供应商简称为空!<br/>")),this.supplier.supplierLevelId||(e=!1,i.push("供应商等级为空!<br/>")),this.supplier.prodType||(e=!1,i.push("供应商产品类型为空!<br/>")),this.supplier.supplierType||(e=!1,i.push("供应商类型为空!<br/>")),this.supplier.payWay||(e=!1,i.push("付款方式为空!<br/>")),this.supplier.billingCurrencyId||(e=!1,i.push("结算币种为空!<br/>")),this.supplier.billingWay||(e=!1,i.push("结算方式为空!<br/>")),!e&&0<i.length&&layer.alert(i.join("")),e},handleSuccess:function(e,i){e.code==supplierVm.const.SUCCESS_CODE?supplierVm.addAttachment(i,e.data[0]):layer.alert("上传失败")},handleFormatError:function(e){this.$Notice.warning({title:"文件格式异常!",desc:"File format of "+e.name+" is incorrect, please select jpg or png."})},handleMaxSize:function(e){this.$Notice.warning({title:"文件大小超出限制!",desc:"【"+e.name+"】的大小超过2M"})},handleBeforeUpload:function(e){},modalOk:function(){this.showUpload=!1},modalCancel:function(){},initOrgin:function(){var n=this;$.ajax({type:"POST",url:contextPath+"/supplier/paramMap",contentType:"application/json",dataType:"json",async:!1,success:function(e){if("100100"===e.code){for(var i=e.data.organList,t=e.data.organId,r=-1,a=0;a<i.length;a++)if(t==i[a].id){r=a;break}i.splice(r,1),n.colContent=i}else layer.alert("网络异常",{icon:0})},error:function(e){layer.alert("网络异常",{icon:0})}})},hideSearch:function(){this.isHide=!this.isHide,this.isSearchHide=!this.isSearchHide,$(".chevron").css("top","")},hidTabulation:function(){this.isHide=!this.isHide,this.isTabulationHide=!this.isTabulationHide,this.isTabulationHide?$(".chevron").css("top",""):$(".chevron").css("top","84%")},showOrgin:function(){0!=this.selected.length?this.showModal=!0:layer.alert("请选择行!")},okModel:function(){if(0!=this.selectOrginId.length){var e={ids:{},orginIds:{}};e.ids=this.selected.join(","),e.organIds=this.selectOrginId.join(","),this.cancelModel();var i=this;$.ajax({type:"POST",url:contextPath+"/supplier/allot",traditional:!0,datatype:"json",data:e,success:function(e){"100100"===e.code?(layer.alert("分配成功",{icon:1}),i.selectOrginId=[]):layer.alert(e.msg,{icon:0})},error:function(e){layer.alert("服务器出错",{icon:0})}})}else layer.alert("请选择分配组织!")},cancelModel:function(){this.selectOrginId=[],this.$refs.test.selectAll(!1),this.showModal=!1},changeselect:function(e){for(var i=0;i<e.length;i++)this.selectOrginId.push(e[i].id)},search:function(){this.body.supplierLevel=""==this.supplierLevel?null:this.supplierLevel.join(","),this.body.supplierType=""==this.supplierType?null:this.supplierType.join(","),this.body.mainProd=""==this.mainProd?null:this.mainProd.join(","),this.reload=!this.reload},clear:function(){this.$refs.mainProd.selectMore=[],this.$refs.supplierLevel.selectMore=[],this.$refs.supplierType.selectMore=[],this.body={supplierName:"",supplierCode:"",contact:"",status:"",supplierLevel:"",supplierType:"",mainProd:""},this.supplierLevel="",this.supplierType="",this.mainProd="",this.reload=!this.reload},reload:function(){},loadSupplierLevels:function(){$.ajax({url:contextPath+"/tclientlevel/listForApply?apply=1",dataType:"json",method:"post",data:{},success:function(e){supplierVm.suppLevel=[],e.code===supplierVm.const.SUCCESS_CODE&&0<e.data.length&&(supplierVm.suppLevel=e.data)},error:function(e){console.log(e)}})},loadCurrency:function(){$.ajax({url:contextPath+"/currency/queryAll",dataType:"json",method:"post",data:{},success:function(e){e.code===supplierVm.const.SUCCESS_CODE&&0<e.data.length&&(supplierVm.currency=e.data)},error:function(e){console.log(e)}})},loadMainProducts:function(){$.ajax({url:contextPath+"/tmainproductcategory/queryall",dataType:"json",method:"post",data:{},success:function(e){supplierVm.suppMainPro=[],supplierVm.mainProduct=[],e.code==supplierVm.const.SUCCESS_CODE&&0<e.data.length&&(supplierVm.mainProduct=e.data)},error:function(e){console.log(e)}})},loadDictDataBilling:function(e){var i=getCodeList(e),t=!0,r=!(this.billing=[]),a=void 0;try{for(var n,s=i[Symbol.iterator]();!(t=(n=s.next()).done);t=!0){var l=n.value;this.billing.push(Object.assign({},{name:l.name,code:l.value}))}}catch(e){r=!0,a=e}finally{try{!t&&s.return&&s.return()}finally{if(r)throw a}}},loadDictDataPayMethod:function(e){var i=getCodeList(e),t=!0,r=!(this.payMethod=[]),a=void 0;try{for(var n,s=i[Symbol.iterator]();!(t=(n=s.next()).done);t=!0){var l=n.value;this.payMethod.push(Object.assign({},{name:l.name,code:l.value}))}}catch(e){r=!0,a=e}finally{try{!t&&s.return&&s.return()}finally{if(r)throw a}}},loadDictDataTaxType:function(e){var i=getCodeList(e),t=!0,r=!(this.taxType=[]),a=void 0;try{for(var n,s=i[Symbol.iterator]();!(t=(n=s.next()).done);t=!0){var l=n.value;this.taxType.push(Object.assign({},{name:l.name,code:l.value}))}}catch(e){r=!0,a=e}finally{try{!t&&s.return&&s.return()}finally{if(r)throw a}}},loadSupplierProductType:function(){$.ajax({url:contextPath+"/tbasecommoditycategotyinfo/list",dataType:"json",method:"post",data:{customCode:"0."},success:function(t){t.code==supplierVm.const.SUCCESS_CODE&&0<t.data.length&&(supplierVm.productType=[],$.each(t.data,function(e,i){supplierVm.productType=t.data}))},error:function(e){console.log(e)}})},save:function(){if(""==this.prodType?this.stisEdit=!0:this.stisEdit=!1,""==this.mainProdArr?this.mpisEdit=!0:this.mpisEdit=!1,this.stisEdit||this.mpisEdit)return!1;var e=supplierVm.supplier.contacts,t=!0,r=!0,a=!0,n=!1;if(0<e.length&&$.each(e,function(e,i){(1!=i.isDel||ht.util.hasValue(i.name,"string")&&ht.util.hasValue(i.phone,"string")||(a=!1),i.isDel==supplierVm.const.IS_DEL_NO&&i.isDefault==supplierVm.const.IS_DEFAULT_YES&&(n=!0),ht.util.hasValue(i.email)&&i.isDel==supplierVm.const.IS_DEL_NO)&&(/^[a-z0-9]+([._\-]*[a-z0-9])*@([a-z0-9]+[-a-z0-9]*[a-z0-9]+.){1,63}[a-z0-9]+$/.test(i.email)||(t=!1));ht.util.hasValue(i.phone)&&i.isDel==supplierVm.const.IS_DEL_NO&&(/^0?(13[0-9]|15[012356789]|18[0236789]|14[57])[0-9]{8}$/.test(i.phone)||(r=!1))}),!t)return layer.alert("请输入正确的邮箱或邮箱格式!"),!1;if(!r)return layer.alert("请输入正确的手机或手机格式!"),!1;if(!a)return layer.alert("请补全联系人信息!"),!1;if(!n)return layer.alert("请勾选默认联系人!"),!1;if(this.supplier.prodType=this.prodType.join(","),supplierVm.supplier.supplierProds=[],$.each(this.mainProdArr,function(e,i){supplierVm.supplier.supplierProds.push(Object.assign({},{prodId:i,supplierId:null}))}),!$("form").valid()||!this.validate())return layer.alert("请填写必填项!"),!1;ht.util.hasValue(supplierVm.area,"object")&&Object.assign(supplierVm.supplier,supplierVm.area),console.log(JSON.stringify(this.supplier));var i=this.supplier.id?contextPath+"/supplier/update":contextPath+"/supplier/save";$.ajax({url:i,dataType:"json",async:!1,data:JSON.stringify(this.supplier),contentType:"application/json;charset=utf-8",method:"post",success:function(e){e.code===supplierVm.const.SUCCESS_CODE?(layer.alert(e.msg),supplierVm.supplier={contacts:[],sysFile:{fileId:"",fileType:3,fileDetails:[]},bankCardInfos:[],supplierProds:[],status:"1"},supplierVm.prodType="",supplierVm.mainProdArr=[],supplierVm.isEdit=!supplierVm.isEdit,supplierVm.body={},supplierVm.reload=!supplierVm.reload):layer.alert(e.msg)},error:function(e){console.log(e)}})},modify:function(){return this.isSave=!1,ht.util.hasValue(this.selected,"array")?1<this.selected.length?(layer.alert("最多只能选择一条记录!"),!1):($.ajax({url:contextPath+"/supplier/info",method:"post",dataType:"json",data:{supplierId:this.selected[0]},success:function(e){if(e.code==supplierVm.const.SUCCESS_CODE){if($("#id").val(e.data.id),e.data.sysFile)supplierVm.supplier=Object.assign({},e.data);else{var i=Object.assign({},{sysFile:{fileId:"",fileType:3,fileDetails:[]}});supplierVm.supplier=Object.assign({},e.data,i)}supplierVm.mainProdArr=[],$.each(e.data.supplierProds,function(e,i){supplierVm.mainProdArr.push(i.prodId)}),supplierVm.$refs.mainProdArr.selectMore=supplierVm.mainProdArr,supplierVm.prodType=supplierVm.supplier.prodType.split(",");var t=[],r=!0,a=!1,n=void 0;try{for(var s,l=supplierVm.prodType[Symbol.iterator]();!(r=(s=l.next()).done);r=!0){var o=s.value;t.push(parseInt(o))}}catch(e){a=!0,n=e}finally{try{!r&&l.return&&l.return()}finally{if(a)throw n}}supplierVm.$refs.prodType.selectMore=t,e.data.regTime&&(supplierVm.$refs.regTime.date=e.data.regTime.substr(0,10)),e.data.province?supplierVm.areaInit={isInit:!0,province:e.data.province,city:e.data.city,county:e.data.county,detail:e.data.detail,disabled:!1}:supplierVm.areaInit={isInit:!0,province:"",city:"",county:"",detail:"",disabled:!1}}},error:function(e){}}),this.codeEdit=!0,$("#tab2 li").siblings().removeClass("layui-this"),$("#tab2 li").eq(0).click(),void(this.isEdit=!0)):(layer.alert("请先选择一条记录!"),!1)},view:function(e){var i=e;if(!i){var t=this.selected;if(!ht.util.hasValue(t,"array"))return layer.alert("请先选择一条记录!"),!1;if(1<t.length)return layer.alert("最多只能选择一条记录!"),!1;i=t[0]}this.pageGridInit(i),$.ajax({url:contextPath+"/supplier/info",method:"post",dataType:"json",data:{supplierId:i},success:function(r){if(r.code==supplierVm.const.SUCCESS_CODE){if($("#id").val(r.data.id),r.data.sysFile)supplierVm.supplier=Object.assign({},r.data);else{var e=Object.assign({},{sysFile:{fileId:"",fileType:3,fileDetails:[]}});supplierVm.supplier=Object.assign({},r.data,e)}supplierVm.mainProdArr=[];var a=[];$.each(supplierVm.mainProducts,function(e,i){var t=i;$.each(r.data.supplierProds,function(e,i){t.code===i.prodId&&a.unshift(t.name)})});$("#mainProdInfo").val(a.join(","));var n=[];$.each(r.data.prodType.split(","),function(e,i){var t=i;$.each(supplierVm.productTypes,function(e,i){t==i.code&&n.unshift(i.name)})}),$("#supplierProdTypeInfo").val(n.join(",")),r.data.province?supplierVm.areaInit={isInit:!0,province:r.data.province,city:r.data.city,county:r.data.county,detail:r.data.detail,disabled:!0}:supplierVm.areaInit={isInit:!0,province:"",city:"",county:"",detail:"",disabled:!0}}},error:function(e){}}),$("#tab1 li").siblings().removeClass("layui-this"),$("#tab1 li").eq(0).click(),this.isInfo=!0,$("#supplier2 .ivu-select").addClass("ivu-select-disabled")},del:function(){var t=supplierVm.selected;if(!ht.util.hasValue(t,"array"))return layer.alert("请先选择一条记录!"),!1;layer.confirm("当前数据有可能被引用，会影响数据准确性，确认是否删除？",{btn:["确定","取消"]},function(e,i){$.ajax({url:contextPath+"/supplier/delete",method:"post",dataType:"json",data:JSON.stringify(t),contentType:"application/json;charset=utf-8",success:function(e){e.code===supplierVm.const.SUCCESS_CODE?(layer.closeAll("dialog"),layer.msg(e.msg,{icon:1,time:1e3}),supplierVm.selected=[],supplierVm.reload=!supplierVm.reload):layer.alert(e.msg)},error:function(e){console.log(e)}})})},alertMsg:function(e,i){this.confirmConfig={showConfirm:!0,title:"提示",content:e,onlySure:i,success:!0}},add:function(){supplierVm.areaInit={isInit:!1,province:"",city:"",county:"",detail:"",disabled:!1},this.isSave=!0,$("#tab2 li").siblings().removeClass("layui-this"),$("#tab2 li").eq(0).click(),this.isEdit=!0,this.codeEdit=!1,this.$refs.mainProdArr.selectMore=[],this.$refs.prodType.selectMore=[],this.$refs.regTime.date="",$("#id").val(null)},exitTab:function(){this.$refs.upload.clearFiles(),$("#tab2").siblings().removeClass("layui-this"),$("#tab2").eq(0).click(),supplierVm.supplier={contacts:[],sysFile:{fileId:"",fileType:3,fileDetails:[]},bankCardInfos:[],supplierProds:[],status:"1"},this.isEdit=!1,$("form").validate().resetForm()},addContacts:function(){supplierVm.supplier.contacts.push({name:"",phone:"",landline:"",wechat:"",isDefault:"0",email:"",isDel:"1"})},clickContacts:function(t){$.each(supplierVm.supplier.contacts,function(e,i){i.isDefault=t==e?supplierVm.const.IS_DEFAULT_YES:supplierVm.const.IS_DEFAULT_NO})},clickAccount:function(t){$.each(supplierVm.supplier.bankCardInfos,function(e,i){i.isDefault=t==e?supplierVm.const.IS_DEFAULT_YES:supplierVm.const.IS_DEFAULT_NO})},addBankAccount:function(){var e={name:"",holder:"",isDefault:supplierVm.const.IS_DEFAULT_NO,account:"",isDel:supplierVm.const.IS_DEL_NO};supplierVm.supplier.bankCardInfos.push(e)},delContact:function(t,r){layer.confirm("是否要删除这条信息!",{btn:["确定","取消"]},function(e,i){t.name&&t.phone&&t.wechat&&t.email&&t.landline?t.isDel="0":supplierVm.supplier.contacts.splice(r,1),layer.closeAll("dialog"),layer.msg("删除成功!",{icon:1,time:1e3})})},delAccount:function(t,r){layer.confirm("是否要删除这条信息!",{btn:["确定","取消"]},function(e,i){t.account&&t.holder&&t.name?t.isDel="0":supplierVm.supplier.bankCardInfos.splice(r,1),layer.closeAll("dialog"),layer.msg("删除成功!",{icon:1,time:1e3})})},delFile:function(e){layer.confirm("是否要删除这条信息!",{btn:["确定","取消"]},function(){e.del=!0,layer.closeAll("dialog")})},addAttachment:function(e,i){var t={fdName:e.name,fdSize:(e.size/1024).toFixed(2)+"kb",uploadTime:i.uploadTime,uploadUser:i.uploadUser,fdUrl:i.fdUrl,fdType:3,del:!1};supplierVm.supplier.sysFile.fileDetails.push(t)},download:function(i){if(!i.fdUrl)return layer.alert("文件地址为空!请先上传文件!"),!1;var t=[];Object.keys(i).forEach(function(e){return t.push(e+"="+i[e])});var e=contextPath+"/supplier/download?"+t.join("&");location.href=encodeURI(e)},uploadfile:function(){this.showUpload=!0},goBack:function(){this.isInfo=!1,this.supplier={contacts:[],bankCardInfos:[],supplierProds:[],status:"1",sysFile:{fileId:"",fileType:3,fileDetails:[]}}},confirmSure:function(){console.log("点击了sure"),this.confirmConfig.showConfirm=!1},confirmCancel:function(){console.log("点击了取消"),this.confirmConfig.showConfirm=!1},pageGridInit:function(e){this.logUrl=contextPath+"supplierlog/list?nd="+(new Date).getTime()+"&supplierId="+e},exit:function(){window.parent.closeCurrentTab({exit:!0,openTime:this.openTime})},copy:function(){return this.isSave=!1,ht.util.hasValue(this.selected,"array")?1<this.selected.length?(layer.alert("最多只能选择一条记录!"),!1):($.ajax({url:contextPath+"/supplier/info",method:"post",dataType:"json",async:!1,data:{supplierId:this.selected[0]},success:function(e){if(e.code==supplierVm.const.SUCCESS_CODE){if($("#id").val(e.data.id),e.data.sysFile)supplierVm.supplier=Object.assign({},e.data);else{var i=Object.assign({},{sysFile:{fileId:"",fileType:3,fileDetails:[]}});supplierVm.supplier=Object.assign({},e.data,i)}supplierVm.supplier.id=null,supplierVm.supplier.supplierCode="",supplierVm.supplier.siShortName="",supplierVm.supplier.supplierName="",supplierVm.mainProdArr=[],$.each(e.data.supplierProds,function(e,i){supplierVm.mainProdArr.push(i.prodId)}),supplierVm.$refs.mainProdArr.selectMore=supplierVm.mainProdArr,supplierVm.prodType=supplierVm.supplier.prodType.split(",");var t=[],r=!0,a=!1,n=void 0;try{for(var s,l=supplierVm.prodType[Symbol.iterator]();!(r=(s=l.next()).done);r=!0){var o=s.value;t.push(parseInt(o))}}catch(e){a=!0,n=e}finally{try{!r&&l.return&&l.return()}finally{if(a)throw n}}supplierVm.$refs.prodType.selectMore=t,e.data.regTime&&(supplierVm.$refs.regTime.date=e.data.regTime.substr(0,10)),console.log(e.data.province,e.data.city,e.data.county,e.data.detail),e.data.province?supplierVm.areaInit={isInit:!0,province:e.data.province,city:e.data.city,county:e.data.county,detail:e.data.detail,disabled:!1}:supplierVm.areaInit={isInit:!0,province:"",city:"",county:"",detail:"",disabled:!1}}},error:function(e){}}),this.codeEdit=!1,void(this.isEdit=!0)):(layer.alert("请先选择一条记录!"),!1)}},computed:{mainProducts:function(){var l=this,o=[];return console.log(this.mainProduct),this.mainProduct.map(function(e){if(1==e.status&&1==e.isDel&&o.push(Object.assign({},{code:e.id,name:e.name})),l.mainProdArr&&0<l.mainProdArr.length){var i=!0,t=!1,r=void 0;try{for(var a,n=l.mainProdArr[Symbol.iterator]();!(i=(a=n.next()).done);i=!0){var s=a.value;e.id==s.prodId&&o.push(Object.assign({},{code:e.id,name:e.name}))}}catch(e){t=!0,r=e}finally{try{!i&&n.return&&n.return()}finally{if(t)throw r}}}}),o},productTypes:function(){var l=this,o=[];return l.productType.map(function(e){if(1==e.isDel&&o.push(Object.assign({},{code:e.id,name:e.name})),l.supplier.prodType){var i=!0,t=!1,r=void 0;try{for(var a,n=l.supplier.prodType.split(",")[Symbol.iterator]();!(i=(a=n.next()).done);i=!0){var s=a.value;e.id==s&&o.push(Object.assign({},{code:e.id,name:e.name}))}}catch(e){t=!0,r=e}finally{try{!i&&n.return&&n.return()}finally{if(t)throw r}}}}),o}},watch:function(){},mounted:function(){$.validator.addMethod("pattern",function(e,i,t){return!!t.test(e)}),$.validator.addMethod("isPositiveInteger",function(e,i){return this.optional(i)||/^([0-9]*[1-9][0-9]*)$/.test(e)},"请输入正整数"),$.validator.addMethod("isDecimal",function(e,i){return this.optional(i)||/^(\d{1,2}(\.\d{1,2})?|100)$/.test(e)},"0-100之间的数据，支持2位小数!"),$.validator.addMethod("onlyDecimal",function(e,i){return this.optional(i)||/(([0]\.\d{1,2}|[1-9][0-9]*\.\d{1,2}))$/.test(e)},"只能填写小数,不能超过2位小数!"),$.validator.addMethod("isBlank",function(e,i){return this.optional(i)||/^\s+$/.test(e)},"请输入正确的值，禁止全部空格!"),$("form").validate(validateOptions),this.openTime=window.parent.params.openTime}});