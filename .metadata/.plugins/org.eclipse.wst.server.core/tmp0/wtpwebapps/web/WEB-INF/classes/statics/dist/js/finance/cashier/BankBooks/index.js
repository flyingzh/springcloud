"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},vm=new Vue({el:"#bank-book-test",data:function(){var a=this;return{baseData:{standardCurrencyId:"",subjectName:"",bankAccountNumber:"",currencyName:"",periodDate:""},voucherFilter:{voucherWordId:0,abnormalDataProcessing:"1",subjectMergerDebit:!1,subjectMergerLender:!1},editData:{id:"",sobId:"",subjectId:"",currencyId:"",datetime:"",operatetime:"",periodDate:"",serialNumber:"",debitAmountFor:"",debitAmountForRate:"",creditAmountFor:"",creditAmountForRate:"",creditAmount:"",remark:"",relativeSubjectId:"",relativeSubjectCode:"",relativeSubjectName:"",relativeSubjectValue:"",direction:"",exchangeRate:1,accountYear:"",accountPeriod:"",handleId:"",handleName:"",isProject:"",isCarryOver:"1",dataSource:"2",summary:"",bankAccount:"",isTick:"",voucherId:""},addData:{id:"",sobId:"",subjectId:"",currencyId:"",datetime:"",operatetime:"",periodDate:"",serialNumber:"",debitAmountFor:"",debitAmountForRate:"",creditAmountFor:"",creditAmountForRate:"",creditAmount:"",remark:"",relativeSubjectId:"",relativeSubjectCode:"",relativeSubjectName:"",relativeSubjectValue:"",direction:"",exchangeRate:"",handleId:"",handleName:"",isProject:"",isCarryOver:"1",dataSource:"2",summary:"",bankAccount:"",isTick:"",voucherId:""},openData:{sobId:0,subjectId:"",currencyId:"",startYear:"",endYear:"",startPeriod:"",endPeriod:"",startDate:"",endDate:"",voucherGroupId:"",startVoucherGroupNumber:"",endVoucherGroupNumber:"",explains:"",relateSubjectId:"",handleId:"",prepareId:"",showInitBalance:!0,showDetailRecord:!0,showDaySum:!0,showPeriodSum:!0,showYearSum:!0,showTotalSum:!0,type:"1",subjectName:"",currencyName:"",bankAccountNumber:"",openCurrencyList:[],openMakerList:[],openHandManList:[]},importData:{startYear:"",startPeriod:"",voucherGroupId:"",startVoucherGroupNumber:"",endVoucherGroupNumber:"",audited:"",posted:"",preparerId:"",importId:[]},clearOpenData:{voucherGroupId:"",startVoucherGroupNumber:"",endVoucherGroupNumber:"",explains:"",relateSubjectId:"",handleId:"",prepareId:""},ClearImportData:{startYear:"",startPeriod:"",voucherGroupId:"",startVoucherGroupNumber:"",endVoucherGroupNumber:"",audited:"",posted:"",preparerId:"",importId:[]},filterVisible:!1,editVisible:!1,voucherModelTxt:"",viewReportTxt:"",showVoucherVisible:!1,voucherVisible:!1,importVisible:!1,isContinue:!1,viewReportVisible:!1,base_config:{multiselect:!0,mtype:"POST",styleUI:"Bootstrap",url:contextPath+"/cnbankdepositjournalappcontroller/bankDetail",ajaxGridOptions:{contentType:"application/json;charset=utf-8"},datatype:"json",jsonReader:{root:"data.resultVOs"},height:$(window).height()-140,viewrecords:!0,rowNum:999999999,onSelectAll:function(t,e){a.handlerId(t,e,"selected")},onSelectRow:function(t,e){console.log("data---------",t,e),t&&(a.handlerId(t,e,"selected"),console.log(a.selected))},gridComplete:function(){$("table[id='grid'] tr[id='null'] input").attr("style","display:none"),$("table[id='grid'] tr[id='0'] input").attr("style","display:none"),window.top.home.loading("hide")}},colNames:[],colModel:[],printInfo:{},printModal:!1,dataList:[],tableHeaders:[],organisationList:[{label:"金大祥",value:1}],subjectList:[{accountId:95,accountCode:"1001",accountName:"库存现金"}],handManList:[],preparerList:[],voucherMakerList:[],currencyList:[],bankCurrencyList:[],voucherExpList:[],voucherDataList:[],voucherDataLists:[],voucherData:[],periodYear:[],periodList:[],auditedList:[{id:-1,name:"全部"},{id:1,name:"已审核"},{id:2,name:"未审核"}],postedList:[{id:-1,name:"全部"},{id:1,name:"已过账"},{id:2,name:"未过账"}],editTitle:"",subjectVisable:!1,subjectTpye:"",tableList:[],selected:[],selectedId:[],importSelected:[],addSubjectListOpt:[],addSubjectListOptShow:!1,subjectOpts:{},optsVal:{},remarkVisable:!1,remarklist:[],remarkType:0,openTime:""}},mounted:function(){this.initPage(),this._queryObject(),this.openTime=window.parent.params&&window.parent.params.openTime},methods:{openSubjectChange:function(t){var e=this;$.ajax({type:"post",url:contextPath+"/cnbankdepositjournalappcontroller/subjectChange",data:{subjectId:t},success:function(t){"100100"==t.code&&null!=t.data?(e.openData.openCurrencyList=t.data,e.$refs.openCurrencyIdRef.reset(),e.$nextTick(function(){0<e.openData.openCurrencyList.length&&(e.openData.currencyId=e.openData.openCurrencyList[0].currencyId)})):e.$Message.error({content:"切换银行科目异常!",duration:3,closable:!0})}})},subjectChange:function(a){var n=this;$.ajax({type:"post",url:contextPath+"/cnbankdepositjournalappcontroller/subjectChange",data:{subjectId:a},success:function(t){"100100"==t.code&&null!=t.data?(n.currencyList=t.data,n.$refs.editCurrencyIdRef.reset(),n.$nextTick(function(){n.editData.currencyId=n.currencyList[0].currencyId})):n.$Message.error({content:"切换银行科目异常!",duration:3,closable:!0})}}),$.each(n.subjectList,function(t,e){a==e.accountId&&(n.editData.bankAccount=e.bankAccount)})},currencyChange:function(a){$.each(vm.currencyList,function(t,e){a==e.currencyId?(vm.editData.debitAmountForRate=e.exchangeRate,vm.editData.creditAmountForRate=e.exchangeRate,vm.editData.exchangeRate=e.exchangeRate):(vm.editData.debitAmountForRate=1,vm.editData.creditAmountForRate=1)})},bookDateChange:function(t){if(t){var e={currentDate:new Date(t).format("yyyy-MM-dd"),currencyId:vm.editData.currencyId};$.ajax({type:"post",url:contextPath+"/cnbankdepositjournalappcontroller/getPeriodByDate",data:e,success:function(t){"100100"==t.code&&null!=t.data?(vm.editData.periodDate=t.data.year+"年"+t.data.month+"期",vm.editData.serialNumber=t.data.serialNum,vm.editData.accountYear=t.data.year,vm.editData.accountPeriod=t.data.month):layer.alert(t.msg)}})}else layer.alert("日期不能为空!")},clickDigest:function(t){this.remarkType=t,this.remarkVisable=!0},onDblclickRemarkRow:function(t){var e=this;1===e.remarkType?e.editData.summary=t.content:e.openData.explains=t.content,e.remarkVisable=!1},onRemarkModalChange:function(t){this.remarkVisable=t},onRemarkListChange:function(t){this.remarklist=t},initPage:function(){var n=this;$.ajax({type:"post",url:contextPath+"/cnbankdepositjournalappcontroller/initPage",dataType:"json",data:null,success:function(t){if("100100"!=t.code){var e="页面初始化失败";return t.hasOwnProperty("data")&&(e=t.msg),void layer.alert(e)}var a=t.data;n.organisationList=a.org,n.baseData.standardCurrencyId=a.standardCurrencyId,n.currencyList=a.currencyList,n.openData.openCurrencyList=a.currencyList,n.bankCurrencyList=a.bankCurrencyList,n.voucherExpList=a.voucherExpList,n.remarklist=a.voucherExpList,n.subjectList=a.subjectList,n.voucherDataList=a.voucherDataList,n.openData.openHandManList=a.openHandManList,n.openData.openMakerList=a.openMakerList,n.voucherDataLists=$.extend(!0,[],a.voucherDataList),n.voucherData=n.voucherDataLists.slice(1),n.periodYear=a.periodYear,n.periodList=a.monthList,n.handManList=a.projectList[3],n.preparerList=a.listFromPreparer,n.voucherMakerList=a.voucherMakerList,n.addData.cnCurrentAccountYear=a.cnCurrentAccountYear,n.addData.cnCurrentAccountPeriod=a.cnCurrentAccountPeriod,n.addData.sobId=a.org[0].value,$.isEmptyObject(a.subjectList)||0==a.subjectList.length||(n.addData.subjectId=a.subjectList[0].accountId,n.openData.subjectId=a.subjectList[0].accountId,n.openData.subjectName=a.subjectList[0].accountName,$.each(a.subjectList,function(t,e){n.addData.subjectId==e.accountId&&(n.baseData.subjectName=a.subjectList[0].accountName,n.baseData.bankAccountNumber=a.subjectList[0].bankAccount)})),$.isEmptyObject(a.currencyList)||0==a.currencyList.length||(n.addData.currencyId=a.currencyList[0].currencyId,n.editData.currencyId=a.currencyList[0].currencyId,$.each(n.currencyList,function(t,e){n.addData.currencyId==e.currencyId&&(n.addData.debitAmountForRate=e.exchangeRate,n.addData.creditAmountForRate=e.exchangeRate,n.baseData.currencyName=e.currencyName,n.openData.currencyName=e.currencyName)})),n.addData.serialNumber=a.serialNum,n.addData.datetime=a.endDate,n.addData.operatetime=a.endDate,n.addData.periodDate=a.cnCurrentAccountYear+"年"+a.cnCurrentAccountPeriod+"期",Object.assign(n.editData,n.addData),n.openData.startDate=a.startDate,n.openData.endDate=a.endDate,n.editData.datetime=a.endDate,n.editData.operatetime=a.endDate,n.openData.sobId=a.org[0].value,n.openData.currencyId=a.currencyList[0].currencyId,$.each(a.periodYear,function(t,e){e.name==a.cnCurrentAccountYear&&(n.openData.startYear=e.value,n.importData.startYear=e.value,n.openData.endYear=e.value)}),$.each(n.periodList,function(t,e){e.name==a.cnCurrentAccountPeriod&&(n.openData.startPeriod=e.name,n.importData.startPeriod=e.name,n.openData.endPeriod=e.name)}),n.importData.startDate=a.startDate,n.importData.endDate=a.endDate,n.subjectOpts=a.projectOpts,n.editData.accountYear=a.cnCurrentAccountYear,n.editData.accountPeriod=a.cnCurrentAccountPeriod,n.editData.bankAccount=a.subjectList[0].bankAccount,n.initMethod(),n.importInit()}})},initMethod:function(){var t=this.openData;2==t.type&&(console.log("查看startDate"),console.log(t.startDate),t.startDate=new Date(t.startDate).format("yyyy-MM-dd"),t.endDate=new Date(t.endDate).format("yyyy-MM-dd")),this.delTable(),this.setTableHeader()},setTableHeader:function(){console.log(this.baseData.standardCurrencyId,this.openData.currencyId),this.baseData.standardCurrencyId===this.openData.currencyId?(this.colNames=["id","业务日期","日期","当日序号","凭证字号","凭证期间","凭证审核","过账标志","摘要","对方科目","借方金额","贷方金额","余额","经手人","勾对","勾对期间","制单人","数据来源","备注","voucherId","sobId"],this.colModel=[{name:"id",width:30,hidden:!0},{name:"operateTimeStr",width:100},{name:"dateTimeStr",width:100},{name:"serialNumber",width:100,formatter:function(t,e,a){return null!=t&&0<t?t:""}},{name:"voucherGroupData",width:100},{name:"voucherPeriodData",width:100},{name:"audited",width:100,align:"center",formatter:function(t,e,a){return null!=t&&1==t?'<i class="ivu-icon ivu-icon-checkmark-round"></i>':""}},{name:"posted",width:100,align:"center",formatter:function(t,e,a){return null!=t&&1==t?'<i class="ivu-icon ivu-icon-checkmark-round"></i>':""}},{name:"summary",width:120},{name:"tbasSubjectName",width:150,formatter:function(t,e,a){return null!=t?t:""}},{name:"debitAmount",width:100,formatter:function(t,e,a,n){return null==t||0==t?"":accounting.formatNumber(t,2,",")}},{name:"creditAmount",width:100,formatter:function(t,e,a,n){return null==t||0==t?"":accounting.formatNumber(t,2,",")}},{name:"balance",width:100,formatter:function(t,e,a,n){return null==t||0==t?"":accounting.formatNumber(t,2,",")}},{name:"handleName",width:90},{name:"isTick",width:90,align:"center",formatter:function(t,e,a){return null!=t&&1<t?'<i class="ivu-icon ivu-icon-checkmark-round"></i>':""}},{name:"tickTimeStr",width:90},{name:"createName",width:90},{name:"dataSource",width:150,formatter:function(t,e,a){return 1==t?"总账引入":2==t?"手工录入":3==t?"Excel导入":""}},{name:"remark",width:90},{name:"voucherId",width:90,hidden:!0},{name:"sobId",width:90,hidden:!0}],this.tableHeaders=[]):(this.colNames=["id","业务日期","日期","当日序号","凭证字号","凭证期间","凭证审核","过账标志","摘要","对方科目","原币","本位币","原币","本位币","原币","本位币","经手人","勾对","勾对期间","制单人","数据来源","备注","voucherId","sobId"],this.colModel=[{name:"id",width:30,hidden:!0},{name:"operateTimeStr",width:100},{name:"dateTimeStr",width:100},{name:"serialNumber",width:100,formatter:function(t,e,a){return null!=t&&0<t?t:""}},{name:"voucherGroupData",width:100},{name:"voucherPeriodData",width:100},{name:"audited",width:100,align:"center",formatter:function(t,e,a){return null!=t&&1==t?'<i class="ivu-icon ivu-icon-checkmark-round"></i>':""}},{name:"posted",width:100,align:"center",formatter:function(t,e,a){return null!=t&&1==t?'<i class="ivu-icon ivu-icon-checkmark-round"></i>':""}},{name:"summary",width:120},{name:"tbasSubjectName",width:150,formatter:function(t,e,a){return null!=t?t:""}},{name:"debitAmountFor",width:100,formatter:function(t,e,a,n){return null==t||0==t?"":accounting.formatNumber(t,2,",")}},{name:"debitAmount",width:100,formatter:function(t,e,a,n){return null==t||0==t?"":accounting.formatNumber(t,2,",")}},{name:"creditAmountFor",width:100,formatter:function(t,e,a,n){return null==t||0==t?"":accounting.formatNumber(t,2,",")}},{name:"creditAmount",width:100,formatter:function(t,e,a,n){return null==t||0==t?"":accounting.formatNumber(t,2,",")}},{name:"balanceFor",width:100,formatter:function(t,e,a,n){return null==t||0==t?"":accounting.formatNumber(t,2,",")}},{name:"balance",width:100,formatter:function(t,e,a,n){return null==t||0==t?"":accounting.formatNumber(t,2,",")}},{name:"handleName",width:90},{name:"isTick",width:90,align:"center",formatter:function(t,e,a){return null!=t&&1<t?'<i class="ivu-icon ivu-icon-checkmark-round"></i>':""}},{name:"tickTimeStr",width:90},{name:"createName",width:90},{name:"dataSource",width:150,formatter:function(t,e,a){return 1==t?"总账引入":2==t?"手工录入":3==t?"Excel导入":""}},{name:"remark",width:90},{name:"voucherId",width:90,hidden:!0},{name:"sobId",width:90,hidden:!0}],this.tableHeaders=[{startColumnName:"debitAmountFor",numberOfColumns:2,titleText:"借方金额"},{startColumnName:"creditAmountFor",numberOfColumns:2,titleText:"贷方金额"},{startColumnName:"balanceFor",numberOfColumns:2,titleText:"余额"}]),this.jqGridInit(this.colNames,this.colModel,this.tableHeaders)},delTable:function(){$("#grid").empty();var t=$(".jqGrid_wrapper");t.empty(),$('<table id="grid"></table><div id="page"></div>').appendTo(t)},jqGridInit:function(t,e,n){var r=this,a=Object.assign({},this.base_config,{colNames:t,colModel:e,postData:JSON.stringify(r.openData),loadComplete:function(t){if("100100"==t.code){r.dataList=t.data.resultVOs,jQuery("#grid").jqGrid("destroyGroupHeader"),jQuery("#grid").jqGrid("setGroupHeaders",{useColSpanStyle:!0,groupHeaders:n});var e=jQuery("#grid").jqGrid("getRowData"),a=$("#grid").jqGrid("getDataIDs");e.push($("#grid").jqGrid("getRowData",a[a.length-1])),r.tableList=e,r.baseData.periodDate=t.data.queryPeriod}else layer.alert(t.msg)}});jQuery("#grid").jqGrid(a)},open:function(){this.filterVisible=!0},refresh:function(){window.top.home.loading("show"),this.openSave(),$("#list").setGridParam({postData:JSON.stringify(this.openData)}).trigger("reloadGrid"),this.selected=[],this.isContinue=!1},addFun:function(){Object.assign(this.editData,this.addData),this.editTitle="银行存款日记账 - 新增",this.editVisible=!0},editFun:function(){var a=this,t=a.selected.filter(function(t){return!!t});if(1==t.length){a.editTitle="银行存款日记账 - 编辑",a.editVisible=!0,Object.assign(a.editData,a.addData);var e=$.ajax({type:"post",url:contextPath+"/cnbankdepositjournalappcontroller/getObjectById",data:{id:t[0]},dataType:"json"}),n={},r={};e.then(function(t){if(console.log("银行日记账查看点击修改按钮返回的data: ----\x3e"),console.log(t.data),"100100"!=t.code)return layer.alert(t.msg),void(a.editVisible=!1);n=t.data.bankDepositJournalEntity,r=t.data;var e=t.data.opts;return a.optsVal=e||{},a.addSubjectListOptClose(),a.editData.subjectId=n.subjectId,$.ajax({type:"post",url:contextPath+"/cnbankdepositjournalappcontroller/subjectChange",data:{subjectId:a.editData.subjectId}})}).done(function(t){null!=t?(a.currencyList=t.data,a.editData.operatetime=n.operateTime,a.editData.sobId=n.sobId,a.editData.accountPeriod=n.accountPeriod,a.editData.remark=n.remark,a.editData.isTick=n.isTick,a.editData.isProject=n.isProject,a.editData.updateId=n.updateId,a.editData.datetime=n.datetime,a.editData.exchangeRate=n.exchangeRate,a.editData.creditAmountForRate=n.exchangeRate,a.editData.debitAmountForRate=n.exchangeRate,a.editData.voucherId=n.voucherId,a.editData.id=n.id,a.editData.currencyId=n.currencyId,a.editData.creditAmount=n.creditAmount,a.editData.creditAmountFor=n.creditAmountFor,a.editData.summary=n.summary,a.editData.serialNumber=n.serialNumber,a.editData.isCarryOver=n.isCarryOver,a.editData.handleName=n.handleName,a.editData.accountYear=n.accountYear,a.editData.debitAmount=n.debitAmount,a.editData.debitAmountFor=n.debitAmountFor,a.editData.relativeSubjectId=n.relativeSubjectId,a.editData.handleId=n.handleId,a.editData.dataSource=n.dataSource,a.editData.relativeSubjectCode=r.relativeSubjectCode,a.editData.relativeSubjectName=r.relativeSubjectName,a.addSubjectBlur()):a.editVisible=!1})}else a.$Message.warning({content:"请只选择一条数据",duration:3,closable:!0})},importFun:function(){this.importVisible=!0},creatVoucher:function(){this.voucherVisible=!0},openSave:function(){var a=this;$.each(a.openData.openCurrencyList,function(t,e){a.openData.currencyId==e.currencyId&&(a.baseData.currencyName=e.currencyName,a.openData.currencyName=e.currencyName)}),$.each(a.subjectList,function(t,e){a.openData.subjectId==e.accountId&&(a.baseData.subjectName=e.accountName,a.openData.subjectName=e.accountName,a.baseData.bankAccountNumber=e.bankAccount,a.openData.bankAccountNumber=e.bankAccount)}),this.initMethod(),this.filterVisible=!1},editSave:function(){var e=this,a=e.editData;if(console.log("data:  "),console.log(a),null==a.serialNumber||a.serialNumber<=0)e.$Message.error("当日序号不能小于1");else if(null!=a.datetime&&""!=a.datetime)if(null!=a.summary&&""!=a.summary)if(a.debitAmountFor||a.creditAmountFor){$.each(e.handManList,function(t,e){e.name==a.handleId&&(a.handleName=e.value)});var t={bankDepositJournalEntity:a,opts:e.optsVal};console.log("新增/修改时准备传回后台的参数 : "),console.log(t),$.ajax({type:"post",url:contextPath+"/cnbankdepositjournalappcontroller/saveOrUpdate",data:JSON.stringify(t),contentType:"application/json;charset=utf-8",dataType:"json",success:function(t){"100100"==t.code?(layer.alert(t.msg),e.editVisible=!1,Object.assign(e.editData,e.addData),e.refresh()):layer.alert(t.msg)}}),this.editVisible=!1}else e.$Message.error("请输入借方金额或贷方金额");else e.$Message.error("摘要不能为空");else e.$Message.error("日期不能为空")},importSave:function(){var e=this;console.log(e.importData),$.ajax({type:"post",url:contextPath+"/cnbankdepositjournalappcontroller/importBankJournal",data:JSON.stringify(e.importData),contentType:"application/json;charset=utf-8",dataType:"json",success:function(t){"100100"==t.code?(layer.alert(t.msg),this.importVisible=!1,e.initMethod()):layer.alert(t.msg)}}),this.importVisible=!1},_queryObject:function(){var e=this,t=baseURL+"generatingCredentialOption/getCredentialOption",a=new FormData;a.append("ownershipSystem",32),http.post(t,a).then(function(t){"100100"===t.code&&(e.voucherFilter=t.data)},function(t){})},voucherSave:function(){var e=this;console.log(e.voucherFilter,"===that.voucherFilter");var t=baseURL+"generatingCredentialOption/update",a=new FormData;a.append("voucherWordId",parseInt(e.voucherFilter.voucherWordId)),a.append("abnormalDataProcessing",parseInt(e.voucherFilter.abnormalDataProcessing)),a.append("subjectMergerDebit",e.voucherFilter.subjectMergerDebit),a.append("subjectMergerLender",e.voucherFilter.subjectMergerLender),a.append("ownershipSystem",32),http.post(t,a).then(function(t){"100100"===t.code&&e.cancel("voucher"),e.$Message.info({content:t.msg,duration:3})},function(t){}),this.voucherVisible=!1},selectRowAction:function(t){console.log("type",t);var n=this,e="",a=n.selected;console.log("选中的id数组为====>>",a);var r=a.filter(function(t,e,a){return"0"!=t&&"null"!=t});if(0!==r.length){if(console.log("id数组为====>>",r),"according"===t)n._ajaxAccording(r);else if("summary"===t)e=baseURL+"cnbankdepositjournalappcontroller/setPoolVoucher",$.ajax({type:"post",async:!1,url:e,data:{ids:r},success:function(t){var e="";if("100100"===t.code){if(console.log("result",t),"1"===t.data.gcoe.abnormalDataProcessing){var a={name:"查看凭证",url:rcContextPath+"/finance/voucher-lrt/index.html?key="+t.data.key+"&sys=32&type=3"};window.parent.activeEvent(a)}e=t.msg,n.refresh()}else e=t.msg;n.$Message.info({content:e,duration:3})}});else if("voucher"===t){if(console.log("that.parame",r),0===r.length)return void n.$Message.info({content:"请选择一个单据。",duration:3});for(var o=r[r.length-1],i="",c=0;c<n.tableList.length;c++)if(n.tableList[c].id==o){i=n.tableList[c];break}if(console.log("_d",i),console.log("_d",i.voucherId),""===i.voucherGroupData||void 0===_typeof(i.voucherId))return void n.$Message.info({content:"最后选取的单据暂未生成凭证。",duration:3});console.log("parame",r);var d={name:"查看凭证",url:rcContextPath+"/finance/voucher-lrt/index.html?voucherId="+i.voucherId+"&sobId="+i.sobId};window.parent.activeEvent(d)}else if("delete"===t){var s=[];console.log(r,"parame");for(c=0;c<n.tableList.length;c++)for(var u=0;u<r.length;u++)n.tableList[c].id===r[u]&&s.push(n.tableList[c].voucherId);console.log("_voucherId",s);var l=[],h=s.length;for(c=0;c<h;c++){for(u=c+1;u<h;u++)s[c]===s[u]&&(u=++c);l.push(s[c])}0===l.length&&n.$Message.info({content:"已选择的单据未生成凭证",duration:3}),console.log("_result",l),e=baseURL+"voucherController/deleteMechanismVoucherBatch",$.ajax({type:"post",async:!1,url:e,data:{sobId:1,ids:l},success:function(t){var e="";"100100"===t.code?(e=t.msg,n.refresh()):e=t.msg,n.$Message.info({content:e,duration:3})}})}}else n.$Message.info({content:"请选择至少一条单据",duration:3})},accordingAction:function(){this.showVoucher(!1),this.refresh()},showVoucher:function(t){this.showVoucherVisible=t},showViewReport:function(t){this.viewReportVisible=!this.viewReportVisible},showVoucherVisibleClose:function(){this.refresh()},_extremely:function(){},_ajaxAccording:function(a){var n=this,t=baseURL+"cnbankdepositjournalappcontroller/setGeneratingCertificate";console.log("parame",a),$.ajax({type:"post",async:!1,url:t,data:{ids:a},success:function(t){if("100100"===t.code){if("1"===t.data.gcoe.abnormalDataProcessing){var e={name:"查看凭证",url:rcContextPath+"/finance/voucher-lrt/index.html?key="+t.data.key+"&sys=32&type=3"};return window.parent.activeEvent(e),void n.refresh()}"2"===t.data.gcoe.abnormalDataProcessing?n.showVoucher(!0):"3"===t.data.gcoe.abnormalDataProcessing&&(n.showVoucher(!0),n.isContinue=!1),n.voucherModelTxt=t.data.vses.length===a.length?"生成凭证成功！":"生成凭证失败！",n.viewReportTxt=t.data.log}else n.$Message.info({content:t.msg,duration:3})}})},save:function(t){switch(t){case"open":this.openSave();break;case"edit":this.editSave();break;case"import":this.importSave();break;case"voucher":this.voucherSave()}},cancel:function(t){switch(t){case"open":this.filterVisible=!1,Object.assign(this.openData,this.clearOpenData);break;case"edit":this.editVisible=!1,Object.assign(this.editData,this.addData);break;case"import":Object.assign(this.importData,this.ClearImportData),this.importVisible=!1;break;case"voucher":this.voucherVisible=!1}},showSubjectVisable:function(t){this.subjectVisable=!0,this.subjectTpye=t},subjectClose:function(){this.subjectVisable=!1},subjectData:function(t){console.log(t,"====treeNode");var n=this;switch(n.subjectTpye){case 1:n.openData.relateSubjectId=t.id,n.openData.subjectCode=t.subjectCode,n.openData.subjectName=t.subjectName;break;case 2:n.editData.relativeSubjectId=t.id,n.editData.relativeSubjectCode=t.subjectCode,n.editData.relativeSubjectName=t.subjectName,n.editData.relativeSubjectValue=t.subjectCode+" "+t.subjectName;var e=contextPath+"/voucherController/getListBySubjectId";$.ajax({type:"POST",data:{id:n.editData.relativeSubjectId},url:e,success:function(t){if("100100"!=t.code){var e="页面初始化失败!";return t.msg&&(e=t.msg),void layer.alert(e)}if(n.addSubjectListOpt=t.data.opts,t.data.opts.length){var a={};$.each(t.data.opts,function(t,e){a[e]=""}),n.optsVal=a,n.addSubjectListOptShow=!0}},error:function(t){console.log(t)}})}this.subjectClose()},importInit:function(){var a=this;jQuery("#importGrid").jqGrid({multiselect:!0,datatype:"local",colNames:["id","科目"],colModel:[{name:"id",width:70,align:"center",sortable:!1,key:!0,hidden:!0},{name:"name",width:250,align:"left",sortable:!1}],rownumbers:!0,rowNum:999999999,styleUI:"Bootstrap",height:210,onSelectAll:function(t,e){a.handlerId(t,e,"importSelected"),a.getImportId()},onSelectRow:function(t,e){a.handlerId(t,e,"importSelected"),a.getImportId()}});for(var t=0;t<=a.importTableList.length;t++)jQuery("#importGrid").jqGrid("addRowData",t+1,a.importTableList[t])},handlerId:function(t,e,a){var n=this;if("object"===(void 0===t?"undefined":_typeof(t))&&e&&(n[a]=t.filter(function(t){if("null"!=t&&"0"!=t)return t})),"object"!==(void 0===t?"undefined":_typeof(t))||e||(n[a]=[]),"string"==typeof t)if(e){"null"!=t&&"0"!=t&&!(-1<n[a].indexOf(t.toString()))&&n[a].push(t.toString())}else{var r=n[a].indexOf(t.toString());-1<r&&n[a].splice(r,1)}},getListId:function(t,e,a){e=[],t.map(function(t){e.push(a[t-1].id)})},getImportId:function(){var e=this;this.importData.importId=[],this.importSelected.map(function(t){e.importData.importId.push(e.importTableList[t-1].id)})},openAddSubject:function(){console.log(this.addSubjectListOpt,"====this.addSubjectListOpt"),this.addSubjectListOptShow=!0},addSubjectEnterd:function(){var e=this,t=contextPath+"/cashier/getSubjectInfoByCode";$.ajax({type:"POST",data:{code:e.editData.relativeSubjectValue},url:t,success:function(t){if("100100"==t.code)if(t.data.subjectId){if(e.editData.relativeSubjectId=t.data.subjectId,e.editData.relativeSubjectCode=t.data.subjectCode,e.editData.relativeSubjectName=t.data.subjectName,e.addSubjectListOpt=t.data.opts,t.data.opts.length){var a={};$.each(t.data.opts,function(t,e){a[e]=""}),e.optsVal=a,e.addSubjectListOptShow=!0}}else layer.alert("查询无数据");else layer.alert("页面初始化失败")},error:function(t){console.log(t)}})},addSubjectListOptClose:function(){var r=this,o="";console.log(r.optsVal,"===that.optsVal"),$.each(r.optsVal,function(t,e){if(""!==e&&void 0!==e){var a=r.subjectOpts[t],n=a.list[e];o+=a.label+":"+e+"-"+n+";"}}),""!==o&&(o="/"+o),r.editData.relativeSubjectValue=r.editData.relativeSubjectCode+" "+r.editData.relativeSubjectName+o},addSubjectFocus:function(){this.editData.relativeSubjectValue=this.editData.relativeSubjectCode},addSubjectBlur:function(){var r=this;if(null==r.editData.relativeSubjectValue||""==r.editData.relativeSubjectValue)return r.editData.relativeSubjectCode="",r.editData.relativeSubjectName="",r.optsVal={},r.editData.relativeSubjectValue="",void(r.editData.relativeSubjectId="");var o="";$.each(r.optsVal,function(t,e){if(""!==e&&void 0!==e){var a=r.subjectOpts[t],n=a.list[e];o+=a.label+":"+e+"-"+n+";"}}),""!==o&&(o="/"+o),r.editData.relativeSubjectValue=r.editData.relativeSubjectCode+" "+r.editData.relativeSubjectName+o},addhandManBlur:function(t){console.log("查看query"),console.log(t);null!=t&&""!=t||(this.editData.handleId="")},selectOpt:function(){},exportExcel:function(){var t=vm.openData,e=vm.baseData,a=contextPath+"/cnbankdepositjournalappcontroller/exportExcel?sobId="+t.sobId+"&subjectId="+t.subjectId+"&currencyId="+t.currencyId+"&startYear="+t.startYear+"&endYear="+t.endYear+"&startPeriod="+t.startPeriod+"&endPeriod="+t.endPeriod+"&startDate="+t.startDate+"&endDate="+t.endDate+"&voucherGroupId="+t.voucherGroupId+"&startVoucherGroupNumber="+t.startVoucherGroupNumber+"&endVoucherGroupNumber="+t.endVoucherGroupNumber+"&explains="+t.explains+"&relateSubjectId="+t.relateSubjectId+"&handleId="+t.handleId+"&prepareId="+t.prepareId+"&showInitBalance="+t.showInitBalance+"&showDetailRecord="+t.showDetailRecord+"&showDetailRecord="+t.showDetailRecord+"&showDaySum="+t.showDaySum+"&showPeriodSum="+t.showPeriodSum+"&showYearSum="+t.showYearSum+"&showTotalSum="+t.showTotalSum+"&type="+t.type+"&subjectName="+t.subjectName+"&currencyName="+t.currencyName+"&bankAccountNumber="+e.bankAccountNumber;window.open(a)},print:function(){var e=this;if(e.dataList&&e.dataList.length)if(console.log("点击打印,查看that.dataList: "),console.log(e.dataList),$.each(e.dataList,function(t,e){e.isTick=2==e.isTick?"√":"",e.audited=1==e.audited?"√":"",e.posted=1==e.posted?"√":"","1"==e.dataSource?e.dataSource="总账引入":"2"==e.dataSource?e.dataSource="手工录入":"3"==e.dataSource?e.dataSource="Excel导入":e.dataSource=""}),e.openData.currencyId===e.baseData.standardCurrencyId){var t={title:"银行存款日记账",template:1,titleInfo:[{name:"科目",val:e.baseData.subjectName},{name:"账号",val:e.baseData.bankAccountNumber},{name:"币别",val:e.baseData.currencyName},{name:"期间",val:e.baseData.periodDate}],colNames:[{name:"业务日期",col:"operateTimeStr"},{name:"日期",col:"dateTimeStr"},{name:"当日序号",col:"serialNumber"},{name:"凭证字号",col:"voucherGroupData"},{name:"凭证期间  ",col:"voucherPeriodData"},{name:"凭证审核",col:"audited"},{name:"过账标志",col:"posted"},{name:"摘要",col:"summary"},{name:"对方科目",col:"tbasSubjectName"},{name:"借方金额",col:"debitAmount",formatNub:!0},{name:"贷方金额",col:"creditAmount",formatNub:!0},{name:"余额",col:"balance",formatNub:!0},{name:"经手人",col:"handleName"},{name:"勾对",col:"isTick"},{name:"勾对期间",col:"tickTimeStr"},{name:"制单人",col:"createName"},{name:"数据来源",col:"dataSource"},{name:"备注",col:"remark"}],styleCss:"",colMaxLenght:9,data:e.dataList};e.printInfo=t,e.printModalShow(!0)}else{var a=e.dataList,n="";'\n                    <tr class=\'thCs\'>\n                        <th rowspan="2" style="width: 6%">业务日期</th>\n                        <th rowspan="2" style="width: 12%">日期</th>\n                        <th rowspan="2" style="width: 12%">当日序号</th>\n                        <th rowspan="2" style="width: 12%">凭证字号</th>\n                        <th rowspan="2" style="width: 12%">凭证期间</th>\n                        <th rowspan="2" style="width: 12%">凭证审核</th>\n                        <th rowspan="2" style="width: 12%">过账标志</th>\n                        <th rowspan="2" style="width: 12%">摘要</th>\n                        <th rowspan="2" style="width: 12%">对方科目</th>\n                        <th colspan="2" style="width: 12%">借方金额</th>\n                        <th colspan="2" style="width: 12%">贷方金额</th>\n                        <th colspan="2" style="width: 12%">余额</th>\n                        <th rowspan="2" style="width: 6%">经手人</th>\n                        <th rowspan="2" style="width: 6%">勾对</th>\n                        <th rowspan="2" style="width: 6%">勾对时间</th>\n                        <th rowspan="2" style="width: 6%">制单人</th>\n                        <th rowspan="2" style="width: 6%">数据来源</th>\n                        <th rowspan="2" style="width: 6%">备注</th>\n                    </tr>\n                     <tr class=\'thCs\'>\n                        <th style="width: 6%">原币</th>\n                        <th style="width: 6%">本位币</th>\n                        <th style="width: 6%">原币</th>\n                        <th style="width: 6%">本位币</th>\n                        <th style="width: 6%">原币</th>\n                        <th style="width: 6%">本位币</th>\n                    </tr>\n                ',a.forEach(function(t){n+="\n                        <tr>\n                            <td>"+e._nullData(t.operateTimeStr)+"</td>\n                            <td>"+e._nullData(t.dateTimeStr)+"</td>\n                            <td>"+e._nullData(t.serialNumber)+"</td>\n                            <td>"+e._nullData(t.voucherGroupData)+"</td>\n                            <td>"+e._nullData(t.voucherPeriodData)+"</td>\n                            <td>"+e._nullData(t.audited)+"</td>\n                            <td>"+e._nullData(t.posted)+"</td>\n                            <td>"+e._nullData(t.summary)+"</td>\n                            <td>"+e._nullData(t.tbasSubjectName)+"</td>\n                            \n                            <td>"+e.formartMoney(t.debitAmountFor)+"</td>\n                            <td>"+e.formartMoney(t.debitAmount)+"</td>\n                            <td>"+e.formartMoney(t.creditAmountFor)+"</td>\n                            <td>"+e.formartMoney(t.creditAmount)+"</td>\n                            <td>"+e.formartMoney(t.balanceFor)+"</td>\n                            <td>"+e.formartMoney(t.balance)+"</td>\n                            <td>"+e._nullData(t.handleName)+"</td>\n                            <td>"+e._nullData(t.isTick)+"</td>\n                            <td>"+e._nullData(t.tickTimeStr)+"</td>\n                            <td>"+e._nullData(t.createName)+"</td>\n                            <td>"+e._nullData(t.dataSource)+"</td>\n                            <td>"+e._nullData(t.remark)+"</td>\n                        </tr>\n                    "});var r={title:"银行存款日记账",template:12,titleInfo:[{name:"科目",val:e.baseData.subjectName},{name:"账号",val:e.baseData.bankAccountNumber},{name:"币别",val:e.baseData.currencyName},{name:"期间",val:e.baseData.periodDate}],data:[],colMaxLenght:10,tbodyInfo:{theadTX:'\n                    <tr class=\'thCs\'>\n                        <th rowspan="2" style="width: 6%">业务日期</th>\n                        <th rowspan="2" style="width: 12%">日期</th>\n                        <th rowspan="2" style="width: 12%">当日序号</th>\n                        <th rowspan="2" style="width: 12%">凭证字号</th>\n                        <th rowspan="2" style="width: 12%">凭证期间</th>\n                        <th rowspan="2" style="width: 12%">凭证审核</th>\n                        <th rowspan="2" style="width: 12%">过账标志</th>\n                        <th rowspan="2" style="width: 12%">摘要</th>\n                        <th rowspan="2" style="width: 12%">对方科目</th>\n                        <th colspan="2" style="width: 12%">借方金额</th>\n                        <th colspan="2" style="width: 12%">贷方金额</th>\n                        <th colspan="2" style="width: 12%">余额</th>\n                        <th rowspan="2" style="width: 6%">经手人</th>\n                        <th rowspan="2" style="width: 6%">勾对</th>\n                        <th rowspan="2" style="width: 6%">勾对时间</th>\n                        <th rowspan="2" style="width: 6%">制单人</th>\n                        <th rowspan="2" style="width: 6%">数据来源</th>\n                        <th rowspan="2" style="width: 6%">备注</th>\n                    </tr>\n                     <tr class=\'thCs\'>\n                        <th style="width: 6%">原币</th>\n                        <th style="width: 6%">本位币</th>\n                        <th style="width: 6%">原币</th>\n                        <th style="width: 6%">本位币</th>\n                        <th style="width: 6%">原币</th>\n                        <th style="width: 6%">本位币</th>\n                    </tr>\n                ',tbodyTX:n,tfootTX:""}};htPrint(r)}else e.$Message.error({content:"无打印数据!",duration:3})},_nullData:function(t){return t||""},formartMoney:function(t){return null==t||0==t?"":accounting.formatNumber(t,2,",")},printModalShow:function(t){this.printModal=t},exit:function(){window.parent.closeCurrentTab({name:"付款单",openTime:this.openTime,exit:!0})},deleteBDJ:function(){var e=this,t=e.selected;null!=t&&0!=t.length?$.ajax({type:"post",url:contextPath+"/cnbankdepositjournalappcontroller/deleteBDJ",data:{ids:e.selected},success:function(t){"100100"==t.code?(layer.alert(t.msg),e.refresh()):layer.alert(t.msg)}}):e.$Message.error("请选择一条数据!")}},computed:{importTableList:function(){var a=[];return this.bankCurrencyList.forEach(function(t){var e={id:t.accountId+"-"+t.currencyId,name:t.accountName+" - "+t.currencyName};a.push(e)}),a},addSubjectDisabled:function(){return 0===this.addSubjectListOpt.length}},watch:{"editData.debitAmountFor":function(t,e){vm.editData.debitAmount=(vm.editData.debitAmountFor*vm.editData.debitAmountForRate).toFixed(2)},"editData.creditAmountFor":function(t,e){vm.editData.creditAmount=(vm.editData.creditAmountFor*vm.editData.creditAmountForRate).toFixed(2)},"editData.debitAmountForRate":function(t,e){vm.editData.debitAmount=(vm.editData.debitAmountFor*vm.editData.debitAmountForRate).toFixed(2)},"editData.creditAmountForRate":function(t,e){vm.editData.creditAmount=(vm.editData.creditAmountFor*vm.editData.creditAmountForRate).toFixed(2)}}});