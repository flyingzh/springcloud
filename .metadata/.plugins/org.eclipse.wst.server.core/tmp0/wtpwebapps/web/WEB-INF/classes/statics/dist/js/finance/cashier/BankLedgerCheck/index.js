"use strict";new Vue({el:"#cash-book",data:function(){return{formData:{bankName:"",bankAccount:"",fullSubjectName:"",currencyName:"",period:"",subjectId:"",currencyId:"",date:"",dateStr:"",type:"1",year:"",year2:"",month:"",openTime:""},organisationList:[],filterVisible:!0,base_config:{mtype:"POST",styleUI:"Bootstrap",url:contextPath+"/app/bankAccount/bankReconciliation",colNames:["id","项目","出纳管理系统","总账系统","差额"],colModel:[{name:"id",width:30,hidden:!0},{name:"name",width:200},{name:"bank",width:200,align:"right"},{name:"ifnance",width:200,align:"right"},{name:"difference",width:200,align:"right"}],datatype:"json",jsonReader:{root:"data",cell:"list",repeatitems:!1},height:$(window).height()-140,viewrecords:!0},subjectList:[],currencyList:[],yearList:[],monthList:[],printModal:!1,printInfo:{},dataList:[]}},created:function(){this.openTime=window.parent.params&&window.parent.params.openTime,this.initData()},mounted:function(){this.jqGridInit()},methods:{initData:function(){var n=this;$.ajax({type:"post",async:!1,url:contextPath+"/app/bankAccount/initData",data:{isCash:1},success:function(t){if(null!=t.data){n.organisationList=t.data.orgList,n.formData.sobId=t.data.sobId,n.subjectList=t.data.subject.data,0<n.subjectList.length&&(n.formData.subjectId=n.subjectList[0].accountId,n.getCnCurrencyList(n.formData.subjectId)),n.yearList=t.data.systemProfile.yearList,n.monthList=t.data.systemProfile.monthList;var a=t.data.systemProfile.currentYear,e=t.data.systemProfile.currentMonth;n.formData.year=a,n.formData.year2=a,n.formData.month=e,n.formData.dateStr=n.getDefaultDay(a,e)}}})},getDefaultDay:function(t,a){var e=new Date(t,a,1),n=new Date(e.getTime()-864e5);return n.getFullYear()+"-"+(Number(n.getMonth())+1)+"-01"},getCnCurrencyList:function(t){var a=this;$.ajax({type:"post",async:!1,url:contextPath+"/cashierBalanceController/app/initCnCurrency",data:{accountId:t,isCash:1,status:0},success:function(t){a.currencyList=t.data,0<a.currencyList.length&&(a.formData.currencyId=a.currencyList[0].currencyId)}})},jqGridInit:function(){var a=this;jQuery("#grid").jqGrid({mtype:"POST",styleUI:"Bootstrap",url:contextPath+"/app/bankAccount/bankReconciliation",colNames:["id","项目","出纳管理系统","总账系统","差额"],colModel:[{name:"id",width:30,hidden:!0},{name:"name",width:200},{name:"bank",width:200,align:"right"},{name:"ifnance",width:200,align:"right"},{name:"difference",width:200,align:"right"}],datatype:"json",jsonReader:{root:"data",cell:"list",repeatitems:!1},height:$(window).height()-140,viewrecords:!0,loadComplete:function(t){a.dataList=t.data||[]}})},open:function(){this.filterVisible=!0},operateDate:function(t){return new Date(t).format("yyyy-MM-dd")},refresh:function(){$("#grid").jqGrid("setGridParam",{postData:this.formData}).trigger("reloadGrid")},save:function(){var t;if(this.filterVisible=!1,0<(t=this.subjectList.length))for(var a=0;a<t;a++)if(this.subjectList[a].accountId==this.formData.subjectId){var e=this.subjectList[a];this.formData.bankName=e.bankName,this.formData.bankAccount=e.bankAccount,this.formData.fullSubjectName=e.accountCode+" "+e.accountName;break}if(0<(t=this.currencyList.length))for(a=0;a<t;a++)if(this.currencyList[a].currencyId==this.formData.currencyId){e=this.currencyList[a];this.formData.currencyName=e.currencyName;break}var n=this.formData.type;"1"==n&&(this.formData.period=this.formData.year+"年"+this.formData.month+"期",this.formData.date=this.formData.year+"-"+this.formData.month),"2"==n&&(console.log(this.formData.dateStr),this.formData.period=this.operateDate(this.formData.dateStr),this.formData.date=this.operateDate(this.formData.dateStr)),"3"==n&&(this.formData.period=this.formData.year2+"年",this.formData.date=this.formData.year2),this.refresh()},cancel:function(){this.filterVisible=!1},exitPrevent:function(){window.parent.closeCurrentTab({name:"银行存款与总账对账",openTime:this.openTime,exit:!0})},exportExcel:function(){var t=this.formData;window.open(contextPath+"/app/bankAccount/exportExcel?fullSubjectName="+t.fullSubjectName+"&bankName="+t.bankName+"&bankAccount="+t.bankAccount+"&currencyName="+t.currencyName+"&period="+t.period)},print:function(){var t=this;if(t.dataList&&t.dataList.length){var a={title:"银行存款与总账对账",template:1,titleInfo:[{name:"科目",val:t.formData.fullSubjectName},{name:"银行",val:t.formData.bankName},{name:"账号",val:t.formData.bankAccount},{name:"币别",val:t.formData.currencyName},{name:"期间",val:t.formData.period}],colNames:[{name:"项目",col:"name"},{name:"出纳管理系统",col:"bank"},{name:"总账系统",col:"ifnance"},{name:"差额",col:"difference"}],styleCss:"",colMaxLenght:4,data:t.dataList,totalRow:!1};t.printInfo=a,t.printModalShow(!0)}else t.$Message.info({content:"无打印数据",duration:3})},printModalShow:function(t){this.printModal=t}},computed:{currencyName:function(){var a=this,t=this.currencyList.find(function(t){return t.value===a.formData.currencyId});if(t)return t.label}}});