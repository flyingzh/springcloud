"use strict";var vm=new Vue({el:"#app",data:{openTime:"",isShow:!1,isEdit:!1,reload:!1,isSearchHide:!0,modalTrigger:!1,id:"",modalType:"",documentStatus:"",documentNo:"",stepList:[],isTabulationHide:!0,isHide:!0,selected:[],documentStatusArr:[{value:1,name:"暂存"},{value:2,name:"待审核"},{value:3,name:"审核中"},{value:4,name:"审核完成"},{value:5,name:"驳回"}],selectBusinessType:[{value:"S_OUT_STOCK",label:"销售送货"},{value:"P_APPLY_DELIVER",label:"采购送料"},{value:"P_RETURN_STOCK",label:"采购退库"},{value:"W_CMATERIAL_OUT_01",label:"受托加工送料"},{value:"W_CMATERIAL_OUT_02",label:"受托加工退料"},{value:"6",label:"维修送货"},{value:"7",label:"旧料处理送货"},{value:"P_CREDENTIAL_OUT",label:"证书制作"}],body:{supplierId:"",custId:"",businessType:""},supplierList:[],customerList:[],data_config:{url:contextPath+"/logisticsdispatching/list",datatype:"json",colNames:["id","日期","单据编号","单据状态","业务类型","客户","供应商","物流方式","物流费用","寄送人"],colModel:[{name:"id",hidden:!0,width:210,align:"left"},{name:"documentTime",width:210,align:"left",formatter:function(t,e,n,i){return new Date(t).format("yyyy-MM-dd")}},{name:"documentNo",width:210,align:"left",formatter:function(t,e,n,i){return $(document).off("click",".detail"+t).on("click",".detail"+t,function(t){t.preventDefault(),vm.documentCodeClick(n.documentNo)}),'<a class="detail'+t+'">'+t+"</a>"},unformat:function(t,e,n){return t.replace(/(<\/?a.*?>)/g,"")}},{name:"documentStatus",width:210,align:"left",formatter:function(t,e,n,i){return vm.formatterDocumentStatus(t)},unformat:function(t,e,n){return vm.unformatDocumentStatus(t)}},{name:"businessType",width:210,align:"left",formatter:function(t,e,n,i){return vm.formatterbusinessType(t)},unformat:function(t,e,n){return vm.unformatbusinessType(t)}},{name:"custCode",align:"left",width:210},{name:"supplierCode",align:"left",width:210},{name:"logisticsMode",align:";left",width:210,formatter:function(t,e,n,i){switch(t){case"wlfs_zt":return"自提";case"wlfs_shsm":return"送货上门";case"wlfs_js":return"寄送";case"":return""}}},{name:"logisticsCost",align:";left",width:210},{name:"sendSomeone",align:";left",width:210}],rowNum:5,rowList:[10,20,30],mtype:"post",viewrecords:!0}},methods:{documentCodeClick:function(t){window.parent.activeEvent({name:"查看物流申请单",url:contextPath+"/warehouse/logistics-dispatch/logistics-dispatch-info.html",params:{data:t,type:"query"}})},approval:function(){var t=this,e=this.selected;if(1<e.length)this.$Modal.warning({title:"提示信息",content:"只能选择一条数据！"});else if(e.length<1)this.$Modal.warning({title:"提示信息",content:"请至少选择一条数据！"});else if(2===e[0].documentStatus||3===e[0].documentStatus||5===e[0].documentStatus)t.id=e[0].id,t.documentStatus=e[0].documentStatus,t.documentNo=e[0].documentNo,t.modalType="approve",t.modalTrigger=!t.modalTrigger;else{if(1===e[0].documentStatus)return void this.$Modal.warning({title:"提示信息",content:"请提交单据！"});if(4===e[0].documentStatus)return void this.$Modal.warning({title:"提示信息",content:"该单已审核,不能重复审核！"})}},reject:function(){var t=this,e=this.selected;1<e.length?this.$Modal.warning({title:"提示信息",content:"请至少选择一条数据！"}):e.length<1?this.$Modal.warning({title:"提示信息",content:"请至少选择一条数据！"}):2===e[0].documentStatus||3===e[0].documentStatus||5===e[0].documentStatus?(t.id=e[0].id,t.documentStatus=e[0].documentStatus,t.documentNo=e[0].documentNo,t.modalType="reject",t.modalTrigger=!t.modalTrigger):t.$Modal.warning({title:"提示信息",content:"该单状态不能驳回！"})},approvalOrRejectCallBack:function(t){if("100100"!=t.result.code)return this.$Modal.warning({content:"审核异常!",title:"警告"}),!1;this.reloadAgain()},autoApproveOrReject:function(t){var e=this;$.ajax({url:contextPath+"/logisticsdispatching/submitapproval?submitType=1",method:"post",contentType:"application/json;charset=utf-8",data:JSON.stringify({receiptsId:e.documentNo,approvalResult:"reject"==e.modalType?1:0}),success:function(t){"100100"===t.code?e.reloadAgain():e.$Modal.warning({content:t.msg})}}),this.reloadAgain()},reloadAgain:function(){this.clear(),this.reload=!this.reload},unformatbusinessType:function(t){return t?this.selectBusinessType.length<1?t:this.selectBusinessType[this.selectBusinessType.map(function(t){return t.name}).indexOf(t)]?this.selectBusinessType[this.selectBusinessType.map(function(t){return t.name}).indexOf(t)].value:t:""},formatterbusinessType:function(t){return t?this.selectBusinessType.length<1?t:this.selectBusinessType[this.selectBusinessType.map(function(t){return t.value}).indexOf(t)]?this.selectBusinessType[this.selectBusinessType.map(function(t){return t.value}).indexOf(t)].label:t:""},unformatDocumentStatus:function(t){return t?this.documentStatusArr.length<1?t:this.documentStatusArr[this.documentStatusArr.map(function(t){return t.name}).indexOf(t)]?this.documentStatusArr[this.documentStatusArr.map(function(t){return t.name}).indexOf(t)].value:t:""},formatterDocumentStatus:function(t){return t?this.documentStatusArr.length<1?t:this.documentStatusArr[this.documentStatusArr.map(function(t){return t.value}).indexOf(t)]?this.documentStatusArr[this.documentStatusArr.map(function(t){return t.value}).indexOf(t)].name:t:""},add:function(){window.parent.activeEvent({name:"新增物流配送单",url:contextPath+"/warehouse/logistics-dispatch/logistics-dispatch-info.html",params:{openTime:this.openTime}})},update:function(){var t=this.selected;1<t.length?this.$Modal.warning({title:"提示信息",content:"只能选择一条数据！"}):t.length<1?this.$Modal.warning({title:"提示信息",content:"请选择一条数据！"}):window.parent.activeEvent({name:"修改物流配送单",url:contextPath+"/warehouse/logistics-dispatch/logistics-dispatch-info.html",params:{data:t[0].id,type:"update"}})},updateStatus:function(t,e){var n=this;$.ajax({type:"post",url:contextPath+"/logisticsdispatching/updateDocumentStatus",data:JSON.stringify({id:t,documentStatus:e}),contentType:"application/json",dataType:"json",success:function(t){n.reloadAgain()}})},submit:function(){var e=this,n=e.selected;return 1<n.length?(e.$Modal.warning({title:"提示信息",content:"只能选择一条数据！"}),$("#myTable").jqGrid("resetSelection"),void(n=[])):n.length<1?(e.$Modal.warning({title:"提示信息",content:"请至少选择一条数据！"}),$("#myTable").jqGrid("resetSelection"),void(n=[])):1!=n[0].documentStatus?(e.$Modal.warning({title:"提示信息",content:"单据状态不为暂存不能提交！"}),$("#myTable").jqGrid("resetSelection"),void(n=[])):void $.ajax({url:contextPath+"/logisticsdispatching/submit",type:"POST",data:JSON.stringify(n[0]),contentType:"application/json;charset=utf-8",dataType:"json",success:function(t){"100100"===t.code?(e.$Modal.success({title:"提示信息",content:"提交成功！"}),n=[],e.reloadAgain()):"1001011014"===t.code&&(e.$Modal.success({title:"提示信息",content:t.msg}),n=[],e.reloadAgain()),"001001"===t.code&&(e.$Modal.success({title:"提示信息",content:"请将数据完善后再提交！"}),e.reloadAgain())}})},del:function(){var e=this,n=e.selected,i=[],s=[];if(n.length<1)return e.$Modal.warning({title:"提示信息",content:"请至少选择一条数据！"}),$("#myTable").jqGrid("resetSelection"),void(n=[]);if(1!==n.length||1==n[0].documentStatus)if(n.forEach(function(t){1!=t.documentStatus&&s.push(t.documentNo)}),0<s.length){a="",s.forEach(function(t){a+=t+"<br/>"});e.$Modal.warning({title:"提示信息",content:s.map(function(t){return"单据"+t})+"已启用审批流不能删除！！"})}else{var a;n.forEach(function(t){i.push(t.id)}),$.ajax({url:contextPath+"/logisticsdispatching/delete",type:"POST",data:JSON.stringify(i),contentType:"application/json;charset=utf-8",dataType:"json",success:function(t){"100100"===t.code&&(e.$Modal.success({title:"提示信息",content:"删除成功！"}),n=[],e.reloadAgain())}})}else e.$Modal.warning({title:"提示信息",content:"单据"+n[0].documentNo+"已启用审批流不能删除！！"})},clear:function(){var t=this;this.body.custId&&(this.$refs.cust.reset(),this.$nextTick(function(){t.body.custId=""})),this.body.supplierId&&(this.$refs.supplier.reset(),this.$nextTick(function(){t.body.supplierId=""})),this.body.businessType&&(this.$refs.businessType.reset(),this.$nextTick(function(){t.body.businessType=""})),this.selected=[]},search:function(){this.reload=!this.reload},exit:function(){window.parent.closeCurrentTab({name:"物流配送单-列表",openTime:this.openTime,exit:!0})},getCustomers:function(){var e=this;$.ajax({type:"post",url:contextPath+"/rawapplication/queryAllCustomer",dataType:"json",success:function(t){e.customerList=t.data}})},getSppliers:function(){var e=this;$.ajax({type:"post",url:contextPath+"/rawapplication/getSuppliers",dataType:"json",success:function(t){e.supplierList=t.data}})}},mounted:function(){this.openTime=window.parent.params.openTime,this.getCustomers(),this.getSppliers()}});