"use strict";function _defineProperty(e,t,o){return t in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}var purchaseOrderList=new Vue({el:"#purchaseOrderList",data:function(){var e,i=this;return{openTime:"",isSearchHide:!0,isTabulationHide:!0,isShow:!1,isHide:!0,isEdit:!1,reload:!1,selected:[],suppliers:[],categoryType:[],empList:[],documentStatusList:[],commodityCategoty:[],dateArr:"",employees:[],body:{goodsTypeName:"",supplierId:"",supplierName:"",orderStatus:"",salesmanName:"",salesmanId:"",orderNo:"",businessTypeId:"",startTime:"",endTime:""},data_config:{url:contextPath+"/tpurchaseorder/list",colNames:["单据编号","id","日期","业务类型","供应商","单据状态","商品类型","采购员","采购重量","采购数量"],colModel:[{name:"orderNo",index:"orderNo",width:240,align:"left",formatter:function(e,t,o,n){return $(document).off("click",".detail"+e).on("click",".detail"+e,function(){i.testOrderDetailClick({value:e,grid:t,rows:o,state:n})}),'<a class="detail'+e+'">'+e+"</a>"},unformat:function(e,t,o){return e.replace(/(<\/?a.*?>)/g,"")}},{name:"id",hidden:!0},(e={name:"purchaseDate",index:"purchaseDate",width:180,align:"center"},_defineProperty(e,"align","left"),_defineProperty(e,"formatter",function(e,t,o,n){return new Date(e).format("yyyy-MM-dd")}),e),{name:"businessTypeId",index:"businessTypeId",align:"left",width:180,formatter:function(e,t,o,n){return"P_ORDER_01"===e?"标准采购":"P_ORDER_02"===e?"受托加工采购":""}},{name:"supplierName",index:"supplierName",align:"left",width:180},{name:"orderStatus",index:"orderStatus",align:"left",width:180,formatter:function(e,t,o,n){return 1===e?"暂存":2===e?"待审核":3===e?"审核中":4===e?"已审核":5===e?"驳回":void 0}},{name:"goodsTypeName",index:"goodsTypeName",align:"left",width:180},{name:"salesmanName",index:"salesmanName",align:"left",width:180},{name:"purchaseWeight",index:"purchaseWeight",width:180,align:"left"},{name:"purchaseCount",index:"purchaseCount",align:"left",width:180}]}}},methods:{changeDate:function(e){this.body.startTime=e[0].replace(/\//g,"-")+" 00:00:00",this.body.endTime=e[1].replace(/\//g,"-")+" 23:59:59"},loadSuppliers:function(){var t=this;$.ajax({type:"post",url:contextPath+"/tpurchasecollectgoods/findSupplierByOrgId",dataType:"json",success:function(e){t.suppliers=e.data},error:function(){console.log("服务器出错啦")}})},search:function(){console.log(this.body),0<this.commodityCategoty.length?this.body.goodsTypeName=this.commodityCategoty[this.commodityCategoty.length-1]:this.body.goodsTypeName="",this.reload=!this.reload},testOrderDetailClick:function(e){console.log(e);var t=e.rows.orderNo,o=e.rows;t&&this.queryOrderByOrderNo(t,!0,o)},queryOrderByOrderNo:function(e,t,o){window.parent.activeEvent({name:"查看采购订单",url:contextPath+"/purchase/purchase-order/purchase-order.html",params:{docCode:e,type:"query",basicInfo:o}})},clear:function(){this.$refs.supplier.reset(),this.$refs.saleName.reset(),this.body.goodsTypeName="",this.body.supplierId="",this.body.orderStatus="",this.body.salesmanName="",this.body.orderNo="",this.body.businessTypeId="",this.body.startTime="",this.body.endTime="",this.dateArr=[],this.commodityCategoty=[],console.log(this.body)},loadData:function(){var t=this;$.ajax({type:"post",url:contextPath+"/tpurchasecollectgoods/data",dataType:"json",success:function(e){t.employees=e.data.employees},error:function(){console.log("服务器出错啦")}})},refresh:function(){this.clear(),this.reload=!this.reload},add:function(){window.parent.activeEvent({name:"新增采购订单",url:contextPath+"/purchase/purchase-order/purchase-order.html",params:{type:"add"}})},del:function(){var e=this,t=this;console.log(this.selected);for(var o=this.selected,n=[],i=0;i<o.length;i++)n.push(o[i].id);if(console.log(n),this.selected.length<1)this.$Modal.warning({title:"提示信息",content:"请先选择至少一条数据！"});else if(1<=this.selected.length){for(i=0;i<o.length;i++)if(1!==o[i].orderStatus)return void this.$Modal.warning({title:"提示信息",content:"单据编号为"+o[i].orderNo+"的单据不是暂存状态，不能删除！"});this.$Modal.confirm({title:"提示信息",content:"是否删除信息？",onOk:function(){console.log(JSON.stringify(e.selected)),$.ajax({url:contextPath+"/tpurchaseorder/deleteOrder",method:"post",dataType:"json",data:JSON.stringify(n),contentType:"application/json;charset=utf-8",success:function(e){"100100"===e.code?(setTimeout(function(){t.$Modal.success({content:"删除成功！"})},300),t.refresh()):setTimeout(function(){t.$Modal.warning({content:"删除失败，请稍后再试！"})},300)},error:function(e){console.log(e)}})}})}},modify:function(){if(this.selected.length<1)this.$Modal.warning({title:"提示信息",content:"请先选择至少一笔数据！"});else if(1<this.selected.length)this.$Modal.warning({title:"提示信息",content:"只能选择一笔数据进行修改！"});else{var e=this.selected;1===e[0].orderStatus?window.parent.activeEvent({name:"修改采购订单",url:contextPath+"/purchase/purchase-order/purchase-order.html",params:{basicInfo:e[0],type:"update"}}):this.$Modal.warning({title:"提示信息",content:"只有暂存状态下才能修改数据，请重新选择！"})}},cancel:function(){window.parent.closeCurrentTab({exit:!0,openTime:this.openTime})},loadProductType:function(){var t=this;$.ajax({type:"post",url:contextPath+"/documentController/getCategory?parentId=0",contentType:"application/json",dataType:"json",success:function(e){t.categoryType=t.initGoodCategory(e.data.cateLists)},error:function(e){console.log("服务器出错")}})},initGoodCategory:function(e){var i=this,a=[];return e.forEach(function(e){var t=e.name,o=e.name,n=e.cateLists;n&&(n=i.initGoodCategory(n)),a.push({value:t,label:o,children:n})}),a.forEach(function(e){e.children||delete e.children}),a}},created:function(){this.loadProductType(),this.loadSuppliers(),this.loadData()},watch:{"body.businessTypeId":function(e){void 0===e&&(this.body.businessTypeId="")},"body.orderStatus":function(e){void 0===e&&(this.body.orderStatus="")},"body.salesmanName":function(e){void 0===e&&(this.body.salesmanName="")},"body.supplierId":function(e){void 0===e&&(this.body.supplierId="")}},mounted:function(){this.openTime=window.parent.params.openTime}});