"use strict";function _defineProperty(t,e,s){return e in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}var assistAttrVM=new Vue({el:"#assist-attr-info",data:function(){var i=this;return{body:{code:"",name:""},assistAttr:{code:"",name:"",status:1,rangeUse:"",tBaseAssistAttrValuess:[]},openTime:"",selectedRange:[],selected:[],isShow:!1,reload:!1,isEdit:!1,isUpdate:!1,isSave:!0,isCheckedAll:!1,isSearchHide:!0,range:[{value:"attr_ranges_gold",label:"金料"},{value:"attr_ranges_stone",label:"石料"},{value:"attr_ranges_part",label:"配件"},{value:"attr_ranges_other",label:"其它"}],status:[{value:1,label:"有效"},{value:0,label:"无效"}],data_config:{url:contextPath+"/tBaseAssistAttr/list/base",colNames:["编码","属性名称","是否有效","创建人","创建时间","最后修改人","最后修改时间"],colModel:[{name:"code",index:"code",width:180,align:"left",formatter:function(t,e,s,a){return $(document).off("click",".detail"+t).on("click",".detail"+t,function(){i.detailClick({value:t,grid:e,rows:s,state:a})}),'<a class="detail'+t+'">'+t+"</a>"}},{name:"name",index:"name",width:180,align:"left"},{name:"status",index:"status",width:180,align:"left",sortable:!1,formatter:function(t){return 1==t?"有效":"无效"}},{name:"createName",index:"createName",align:"left",width:180},{name:"createTime",index:"createTime",align:"left",width:180},{name:"updateName",index:"createName",align:"left",width:180},{name:"updateTime",index:"name",align:"left",width:180}]}}},methods:{hideSearch:function(){this.isSearchHide=!this.isSearchHide,$(".chevron").css("top","")},checkValues:function(){var s=!0,a=(this.assistAttr.tBaseAssistAttrValuess,/^([a-zA-Z0-9]+)$/);return this.assistAttr.tBaseAssistAttrValuess.forEach(function(t,e){return t.code&&a.test(t.code)?t.value?void 0:(layer.alert("属性值第"+(e+1)+"行值名称不合法",{icon:0}),void(s=!1)):(layer.alert("属性值第"+(e+1)+"行值代码不合法",{icon:0}),void(s=!1))}),s},clickOne:function(t){var e=this.assistAttr.tBaseAssistAttrValuess[t];e.isCheck?e.isCheck=!1:e.isCheck=!0,this.checkIsAllSelected()},checkAllValues:function(){this.isCheckedAll?this.assistAttr.tBaseAssistAttrValuess.forEach(function(t,e){t.isCheck=!1}):this.assistAttr.tBaseAssistAttrValuess.forEach(function(t,e){t.isCheck=!0})},checkIsAllSelected:function(){var s=!0,t=this.assistAttr.tBaseAssistAttrValuess;t.length?t.forEach(function(t,e){t.isCheck||(s=!1)}):s=!1,this.isCheckedAll=s},clickEvent:function(t,e,s){var a=this.$ztree.getSelectedNodes();void 0===s.children&&(this.tmpSubject=a[0].name)},search:function(){this.reload=!this.reload},addContacts:function(){this.isEdit||this.checkValues()&&(this.assistAttr.tBaseAssistAttrValuess.push({isCheck:!1,value:"",code:""}),this.checkIsAllSelected())},delContacts:function(){if(!this.isEdit){var s=[];assistAttrVM.assistAttr.tBaseAssistAttrValuess.forEach(function(t,e){null!=t.isCheck&&0!=t.isCheck||s.push(t)}),assistAttrVM.assistAttr.tBaseAssistAttrValuess=s,this.checkIsAllSelected()}},clear:function(){this.body={code:"",name:""}},add:function(){this.isShow=!0},copy:function(){if(1===this.selected.length){var t=this.selected[0];t&&this.queryById(t,!1,!0)}else layer.alert("只能对单行数据操作!")},update:function(t,e){var s;assistAttrVM.selectedRange&&(e.rangeUse=assistAttrVM.selectedRange.join(",")),$.ajax((_defineProperty(s={type:"POST",url:t,data:e,contentType:"application/json"},"data",JSON.stringify(e)),_defineProperty(s,"dataType","json"),_defineProperty(s,"success",function(t){"100100"===t.code?layer.alert("操作成功",{icon:1,end:function(){assistAttrVM.cancel(),assistAttrVM.reload=!assistAttrVM.reload}}):layer.alert(t.msg,{icon:0}),assistAttrVM.isSave=!0}),_defineProperty(s,"error",function(t){assistAttrVM.isSave=!0,layer.alert("服务器异常，请重试！",{icon:0})}),s))},del:function(){0!=this.selected.length?layer.confirm("当前数据有可能被引用，会影响数据准确性，确认是否删除？",{btn:["确认","取消"],btn1:function(){$.ajax({type:"POST",url:contextPath+"/tBaseAssistAttr/delete",contentType:"application/json",data:JSON.stringify(assistAttrVM.selected),dataType:"json",success:function(t){"100100"===t.code?(layer.alert(t.data,{icon:1}),assistAttrVM.selected=[],assistAttrVM.reload=!assistAttrVM.reload):layer.alert(t.msg,{icon:0})},error:function(t){layer.alert("数据删除失败",{icon:0})}})}}):layer.alert("请选择行!")},modify:function(){if(1===this.selected.length){var t=this.selected[0];t&&this.queryById(t,!1,!1)}else layer.alert("只能对单行数据操作!")},exit:function(){window.parent.closeCurrentTab({exit:!0,openTime:this.openTime})},queryById:function(t,s,a){$.ajax({type:"POST",url:contextPath+"/tBaseAssistAttr/info/"+t,dataType:"json",success:function(t){if("100100"===t.code){var e=t.data;a?(assistAttrVM.assistAttr.rangeUse=e.rangeUse,assistAttrVM.assistAttr.status=e.status):(assistAttrVM.assistAttr=e,assistAttrVM.isUpdate=!0),assistAttrVM.assistAttr.rangeUse&&(assistAttrVM.selectedRange=assistAttrVM.assistAttr.rangeUse.split(",")),assistAttrVM.isEdit=s,assistAttrVM.isShow=!0}},error:function(t){console.log("服务器出错")}})},save:function(){if($("#attr_form").valid()){var t=this.assistAttr;if(t.tBaseAssistAttrValuess.length<1)layer.alert("请至少添加一条属性值!");else if(this.checkValues()){this.isSave=!1;var e=contextPath+"/tBaseAssistAttr/save";t.id&&(e=contextPath+"/tBaseAssistAttr/update"),this.update(e,t)}}},detailClick:function(t){var e=t.rows.id;e&&this.queryById(e,!0)},cancel:function(){this.assistAttr={code:"",name:"",status:1,rangeUse:"",tBaseAssistAttrValuess:[]},this.selectedRange=[],this.isUpdate=!1,this.isShow=!1,this.isEdit=!1,this.isCheckedAll=!1,$("#attr_form").validate().resetForm()},initFormValidate:function(){var t={onfocusout:function(t){$(t).valid()},onkeyup:!1,rules:{code:{isChar:!0,required:!0,remote:{url:contextPath+"/tBaseAssistAttr/checkCode",type:"post",dataType:"json",data:{id:function(){return null==assistAttrVM.assistAttr.id?"":assistAttrVM.assistAttr.id}},dataFilter:function(t){return"100100"===JSON.parse(t).code}}},name:{required:!0,remote:{url:contextPath+"/tBaseAssistAttr/checkName",type:"post",dataType:"json",data:{id:function(){return null==assistAttrVM.assistAttr.id?"":assistAttrVM.assistAttr.id}},dataFilter:function(t){return"100100"===JSON.parse(t).code}}},rangeUse:{required:!0}},messages:{code:{isChar:"请正确输入编码!",required:"请填写名称!",remote:"该属性编码已存在!"},name:{required:"请填写名称!",remote:"该属性已存在!"},rangeUse:{required:"请选择使用范围!"}},errorPlacement:function(t,e){if(e.is(":radio")||e.is(":checkbox")){e.attr("name");t.appendTo(e.parent().parent())}else t.insertAfter(e)}};$("#attr_form").validate(t)}},mounted:function(){var e=this;this.initFormValidate(),jQuery.validator.addMethod("isChar",function(t,e){return/^([a-zA-Z0-9]+)$/.test(t)},"编码格式错误!"),this.assistAttr.tBaseAssistAttrValuess.forEach(function(t){e.$set(t,"isCheck",!1)}),this.openTime=window.parent.params.openTime}});