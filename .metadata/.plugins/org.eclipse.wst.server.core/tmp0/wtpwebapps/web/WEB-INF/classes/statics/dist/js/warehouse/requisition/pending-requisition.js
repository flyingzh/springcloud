"use strict";var vm=new Vue({el:"#app",data:{isShow:!1,isEdit:!1,reload:!1,isSearchHide:!0,isTabulationHide:!0,isHide:!0,categoryType:[],goodsTypePath:"",goodsValue:"",selected:"",selectType:[{value:"S_CUST_ORDER",label:"客户订单"},{value:"W_MATERIAL_USED",label:"原料领用申请单"}],selectBusinessType:[],body:{sourceType:"",documentNo:"",businessType:"",goodsTypePath:""},allTransferNum:"",data_config:{url:contextPath+"/requisition/readyList",datatype:"json",colNames:["goodsId","源单类型","源单编号","业务类型","质检状态","商品类型","图片","商品编码","商品名称","计数单位","数量","待调拨数量","检验合格数量","特殊放行数量","已调拨数量"],colModel:[{name:"goodsId",width:210,align:"left",hidden:!0},{name:"sourceType",width:210,align:"left",formatter:function(e,t,o,s){return"S_CUST_ORDER"===e?"客户订单":"W_MATERIAL_USED"===e?"原料领用申请单":void 0}},{name:"documentNo",width:210,align:"left",formatter:function(e,t,o,s){return $(document).off("click",".detail"+e).on("click",".detail"+e,function(){vm.detailClick({value:e,grid:t,rows:o,state:s})}),'<a class="detail'+e+'">'+e+"</a>"}},{name:"businessType",width:210,align:"left",formatter:function(e,t,o,s){return"S_CUST_ORDER_01"===e?"销售出仓":"S_CUST_ORDER_02"===e?"受托加工销售":"W_MATERIAL_USED_01"===e?"采购送料":"W_MATERIAL_USED_02"===e?"采购料结":"W_MATERIAL_USED_03"===e?"受托加工送料":"W_MATERIAL_USED_04"===e?"受托加工退料":void 0}},{name:"transferCheckStatus",width:210,align:"left",formatter:function(e,t,o,s){return"放行"}},{name:"goodsTypeName",align:"left",width:210},{name:"pictureUrl",align:"left",width:210,formatter:function(e,t,o){console.log(o);var s=guid();$(document).on("mouseout",".can",function(){vm.hideMirror(s)}),$(document).on("mouseenter",".select"+s,function(){vm.showMirror(s)});var i=o.pictureUrl;return console.log(i),i?'<div class="select'+s+' can">\n                                    <img height="50px" width="50px" src="'+i+'"/>\n                                    <div class="mirror"><img class="bigimg" src="'+i+'"></div>\n                                </div>':'<div class="select'+s+' can">\n                                    <img height="50px" width="50px" src="http://218.17.157.182:8082/web/images/no_pic.png"/>\n                                    <div class="mirror"><img class="bigimg" src="http://218.17.157.182:8082/web/images/no_pic.png"></div>\n                                </div>'}},{name:"goodsCode",align:";left",width:210,formatter:function(e,t,o,s){return $(document).off("click",".detail"+e).on("click",".detail"+e,function(){vm.gooidsId({value:e,grid:t,rows:o,state:s})}),'<a class="detail'+e+'">'+e+"</a>"}},{name:"goodsName",align:";left",width:210},{name:"countingUnit",align:";left",width:210},{name:"num",align:";left",width:210},{name:"allTransferNum",align:";left",width:210,formatter:function(e,t,o){return Number(o.transferQualifiedNum)+Number(o.transferCheckReleaseNum)-Number(o.totalTransferNum)}},{name:"transferQualifiedNum",align:";left",width:210},{name:"transferCheckReleaseNum",align:";left",width:210},{name:"totalTransferNum",align:";left",width:210,formatter:function(e,t,o,s){return null==e?0:e}}],rowNum:5,rowList:[10,20,30],mtype:"post",viewrecords:!0}},methods:{gooidsId:function(e){window.parent.activeEvent({name:"商品",url:contextPath+"/base-data/commodity/commodity-info.html",params:{id:e.rows.commodityId,type:"skip"}})},detailClick:function(e){if("W_MATERIAL_USED"===e.rows.sourceType)window.parent.activeEvent({name:"查看原料领用申请单",url:contextPath+"/warehouse/raw-application/raw-application-info.html",params:{data:e.value,type:"query"}});else{var t=e.rows.documentNo;window.parent.activeEvent({name:"查询客户订单",url:contextPath+"/sale/customer-order/customer-order-add.html",params:{type:"view",saleOrderNo:t}})}},refresh:function(){this.clear(),this.reload=!this.reload},search:function(){this.reload=!this.reload},clear:function(){this.body={sourceType:"",documentNo:"",businessType:"",goodsTypePath:""},this.$nextTick(function(){this.selectBusinessType="",this.body.sourceType="",this.body.documentNo="",this.body.businessType="",this.body.goodsTypePath="",this.goodsValue=""})},showMirror:function(e){console.log(e),$(".select"+e+" .mirror").show()},hideMirror:function(e){$(".select"+e+" .mirror").hide()},loadProductType:function(){var t=this;$.ajax({type:"post",url:contextPath+"/requisition/queryStyleCategory?parentId=0",contentType:"application/json",dataType:"json",success:function(e){console.log(e),t.categoryType=t.initGoodCategory(e.data.cateLists)},error:function(){alert("服务器出错啦")}})},changeproductTypeName:function(e,t){console.log(e,t),this.body.goodsTypePath=t[t.length-1].value,console.log("changeproductTypeName---goodsTypePath",this.body.goodsTypePath)},initGoodCategory:function(e){var i=this,n=[];return e.forEach(function(e){var t=e.customCode,o=e.name,s=e.cateLists;s&&(s=i.initGoodCategory(s)),n.push({value:t,label:o,children:s})}),n.forEach(function(e){e.children||delete e.children}),n},add:function(){if(console.log("add----",this.selected),console.log("add----length",this.selected.length),this.selected.length<1)this.$Modal.warning({title:"提示信息",content:"请至少选择一条数据！"});else{for(var e=[],t=0;t<this.selected.length;t++){for(var o=this.selected.length-1;t-1<o;o--){if(this.selected[t].businessType!==this.selected[o].businessType)return layer.alert("业务类型不相同，不能合并"),void console.log(this.selected[t].businessType,this.selected[o].businessType);if(this.selected[t].goodsTypeName!==this.selected[o].goodsTypeName)return layer.alert("商品类型不相同，不能合并"),void console.log(this.selected[t].goodsTypeName,this.selected[o].goodsTypeName)}e.push({sourceNo:this.selected[t].documentNo,id:this.selected[t].goodsId,sourceType:this.selected[t].sourceType,allTransferNum:this.selected[t].transferQualifiedNum+this.selected[t].transferCheckReleaseNum})}console.log("add---documentNoArr",e),window.parent.activeEvent({name:"调拨单-新增",url:contextPath+"/warehouse/requisition/requisition-info.html",params:{activeType:"sourceAdd",documentNoArr:e}})}},exit:function(){window.parent.closeCurrentTab({openTime:this.openTime,exit:!0})},askToSelectType:function(){console.log("askToSelectType----sourceType",this.body.sourceType),this.body.sourceType||this.$Message.info("请先选择源单类型！")},setBusinessType:function(){if(console.log("setBusinessType----sourceType",this.body.sourceType),"S_CUST_ORDER"==this.body.sourceType)this.selectBusinessType=[{value:"S_CUST_ORDER_01",label:"销售出仓"},{value:"S_CUST_ORDER_02",label:"受托加工销售"}];else{if("W_MATERIAL_USED"!=this.body.sourceType)return;this.selectBusinessType=[{value:"W_MATERIAL_USED_01",label:"采购送料"},{value:"W_MATERIAL_USED_02",label:"采购料结"},{value:"W_MATERIAL_USED_03",label:"受托加工送料"},{value:"W_MATERIAL_USED_04",label:"受托加工退料"}]}}},mounted:function(){this.loadProductType(),this.openTime=window.parent.params.openTime}});