"use strict";Vue.component("product-detail",{props:{showModal:{type:String,default:function(){return!0}},dataSourceType:{type:Boolean,default:function(){return!1}},dataSource:{type:Object,default:function(){return null}},isOrderBom:{type:Boolean,default:function(){return!1}},specialAttr:{type:Object,default:function(){return{gold:[],stone:[],part:[]}}},isImport:{type:Boolean,default:function(){return!1}},isStock:{type:Boolean,default:function(){return!1}},importData:{type:Object,default:function(){return{tBaseBomEntity:{},goldParts:[],stoneParts:[],partParts:[]}}},ids:{default:function(){return{goodsId:"",commodityId:""}}},overEdit:{type:Boolean,default:function(){return!1}},orderStatus:{default:function(){return null}},goodsMainType:{default:function(){return"attr_ranges_goods"}},tBaseBomEntity:{},myAssistAttrs:{type:Object,default:function(){return{}}}},data:function(){return{productDetailAttr:{goldBoms:[],stonesBoms:[],partBoms:[],assistAttrs:[],stoneHeader:[],goldHeader:[],partHeader:[],assistAttrsHeader:[]},productDetailAttrTemp:null,typeName:{goldBoms:"金料",partBoms:"配件",stonesBoms:"石料",assistAttrs:"配件"},unitObj:{}}},methods:{goldCheckedChange:function(t,e){var o=this;this.productDetailAttr.goldBoms.map(function(t){t.checked=!1}),setTimeout(function(){o.productDetailAttr.goldBoms[e].checked=!0,o.$forceUpdate()})},getProductDetail:function(){var i=this,t=this.ids.goodsId,e=this.ids.commodityId,s={id:t,documentType:this.ids.documentType};if(!t&&!e)return i.$Modal.warning({content:"请先选择商品！"}),void this.$emit("cancel");if(this.clearProductDetailAttr(),this.isImport){if(i.overEdit){var o=JSON.parse(JSON.stringify(this.tBaseBomEntity));return Object.assign(this.productDetailAttr,{goldBoms:o.goldBoms,goldHeader:o.goldHeader||[],stonesBoms:o.stonesBoms,stoneHeader:o.stoneHeader||[],partBoms:o.partBoms,partHeader:o.partHeader||[],goodsMainType:i.goodsMainType}),void(i.productDetailAttrTemp=JSON.parse(JSON.stringify(i.productDetailAttr)))}i.tBaseBomEntity=JSON.parse(JSON.stringify(this.importData.tBaseBomEntity));var n=i.tBaseBomEntity;return Object.assign(i.productDetailAttr,{goldBoms:n.goldBoms,goldHeader:n.goldHeader||[],stonesBoms:n.stonesBoms,stoneHeader:n.stoneHeader||[],partBoms:n.partBoms,partHeader:n.partHeader||[],goodsMainType:i.goodsMainType}),i.handlerBoms("stonesBoms","stoneHeader"),i.handlerBoms("goldBoms","goldHeader"),i.handlerBoms("partBoms","partHeader"),Object.assign(i.tBaseBomEntity,{goldHeader:i.productDetailAttr.goldHeader,stoneHeader:i.productDetailAttr.stoneHeader,partHeader:i.productDetailAttr.partHeader}),i.handlerExcelImportAttrs(this.importData.goldParts,"goldBoms"),i.handlerExcelImportAttrs(this.importData.stonesParts,"stonesBoms"),i.handlerExcelImportAttrs(this.importData.partParts,"partBoms"),i.handlerExcelLoss(this.importData),i.handlerEditSpecialAttr(this.importData),i.productDetailAttrTemp=JSON.parse(JSON.stringify(i.productDetailAttr)),void i.$forceUpdate()}if(this.dataSource){var r={goldParts:this.dataSource.goldParts,stonesParts:this.dataSource.stonesParts,partParts:this.dataSource.partParts,materialParts:this.dataSource.materialParts};this.handlerLook(r)}else if(t){if(1!=this.orderStatus||this.isOrderBom||this.dataSourceType)return void $.ajax({type:"post",url:contextPath+"/tgoodsPart/getParts",dataType:"json",data:s,success:function(t){if("100100"===t.code){var e=t.data;i.handlerLook(e)}else i.$Modal.warning({content:"服务器出错"})},error:function(){i.$Modal.error({content:"服务器出错,请联系技术人员"})}});if("attr_ranges_goods"===this.goodsMainType){if(i.overEdit){var a=JSON.parse(JSON.stringify(this.tBaseBomEntity));return Object.assign(this.productDetailAttr,{goldBoms:a.goldBoms,goldHeader:a.goldHeader||[],stonesBoms:a.stonesBoms,stoneHeader:a.stoneHeader||[],partBoms:a.partBoms,partHeader:a.partHeader||[],goodsMainType:i.goodsMainType}),void(i.productDetailAttrTemp=JSON.parse(JSON.stringify(i.productDetailAttr)))}$.ajax({type:"post",url:contextPath+"/tbasecommodity/getBomOrAttr/"+e,dataType:"json",success:function(t){if("100100"===t.code){var e=t.data;if(e.tBaseBomEntity){i.tBaseBomEntity=e.tBaseBomEntity;var o=i.tBaseBomEntity;Object.assign(i.productDetailAttr,{goldBoms:o.goldBoms,goldHeader:o.goldHeader||[],stonesBoms:o.stonesBoms,stoneHeader:o.stoneHeader||[],partBoms:o.partBoms,partHeader:o.partHeader||[],goodsMainType:i.goodsMainType}),i.handlerBoms("stonesBoms","stoneHeader"),i.handlerBoms("goldBoms","goldHeader"),i.handlerBoms("partBoms","partHeader"),Object.assign(i.tBaseBomEntity,{goldHeader:i.productDetailAttr.goldHeader,stoneHeader:i.productDetailAttr.stoneHeader,partHeader:i.productDetailAttr.partHeader}),$.ajax({type:"post",url:contextPath+"/tgoodsPart/getParts",dataType:"json",data:s,success:function(t){"100100"===t.code?(i.handlerPartAttrs(t.data.goldParts,"goldBoms"),i.handlerPartAttrs(t.data.stonesParts,"stonesBoms"),i.handlerPartAttrs(t.data.partParts,"partBoms"),i.handlerLoss(t.data),i.handlerEditSpecialAttr(t.data),i.productDetailAttrTemp=JSON.parse(JSON.stringify(i.productDetailAttr)),i.$forceUpdate()):i.$Modal.warning({content:"服务器出错"})},error:function(){i.$Modal.error({content:"服务器出错,请联系技术人员"})}})}else i.$Modal.warning({content:"该商品未设置Bom，请先设置商品Bom资料！"})}else i.$Modal.warning({content:"服务器出错"})},error:function(){i.$Modal.error({content:"服务器出错,请联系技术人员"})}})}else{if(i.overEdit){var d=this.myAssistAttrs;return Object.assign(this.productDetailAttr,{assistAttrsHeader:d.assistAttrsHeader,assistAttrs:d.assistAttrs,goodsMainType:i.goodsMainType}),void(i.productDetailAttrTemp=JSON.parse(JSON.stringify(i.productDetailAttr)))}$.ajax({type:"post",url:contextPath+"/tbasecommodity/getBomOrAttr/"+e,dataType:"json",success:function(t){var e=t.data;i.assistAttrs=e.assistAttrs,Object.assign(i.productDetailAttr,{assistAttrs:e.assistAttrs}),$.ajax({type:"post",url:contextPath+"/tgoodsPart/getParts",dataType:"json",data:s,success:function(t){"100100"===t.code?(i.handlerAssist(),t.data.materialParts[0].partAttrs.map(function(e){i.productDetailAttr.assistAttrs.map(function(t){t.attr.map(function(t){e.attr===t.name&&(t.model=e.attrValue)})})}),i.productDetailAttrTemp=JSON.parse(JSON.stringify(i.productDetailAttr)),i.$forceUpdate()):i.$Modal.warning({content:"服务器出错"})},error:function(){i.$Modal.error({content:"服务器出错,请联系技术人员"})}})},error:function(){i.$Modal.error({content:"服务器出错,请联系技术人员"})}})}}else if("attr_ranges_goods"===this.goodsMainType)if(this.overEdit){var l=JSON.parse(JSON.stringify(this.tBaseBomEntity||{}));this.handlerAllBomData(l)}else $.ajax({type:"post",url:contextPath+"/tbasecommodity/getBomOrAttr/"+e,dataType:"json",data:s,success:function(t){"100100"===t.code?t.data.tBaseBomEntity?i.handlerAllBomData(t.data.tBaseBomEntity):i.$Modal.warning({content:"该商品未设置Bom，请先设置商品Bom资料！"}):i.$Modal.warning({content:"服务器出错"})},error:function(){i.$Modal.error({content:"服务器出错,请联系技术人员"})}});else this.myAssistAttrs&&this.myAssistAttrs.assistAttrs&&this.overEdit?this.handlerAllPartData(this.myAssistAttrs):$.ajax({type:"post",url:contextPath+"/tbasecommodity/getBomOrAttr/"+e,dataType:"json",success:function(t){Object.assign(i.myAssistAttrs,{assistAttrs:t.data.assistAttrs,assistAttrsHeader:[]}),i.handlerAllPartData(i.myAssistAttrs)},error:function(){i.$Modal.error({content:"服务器出错,请联系技术人员"})}})},handlerLook:function(t){var o=this,n=this;if("attr_ranges_goods"===n.goodsMainType){n.handlerDetailHeader(t.goldParts,"goldHeader"),n.handlerDetailHeader(t.stonesParts,"stoneHeader"),n.handlerDetailHeader(t.partParts,"partHeader");var r=[],a=[],d=[],l={},c={},m={};n.specialAttr.stone.map(function(t){r.push(t.code)}),n.specialAttr.gold.map(function(t){a.push(t.code)}),n.specialAttr.part.map(function(t){d.push(t.code)}),0<n.productDetailAttr.goldHeader.length?n.productDetailAttr.goldHeader.map(function(s){t.goldParts.map(function(e,o){n.productDetailAttr.goldBoms[o]||(a.map(function(t){c[t]=e[t]}),Object.assign(e,{attr:[],commodityId:e.commodityId,commodityCode:e.goodsCode,commodityName:e.name,condition:e.goldColor,weightUnitId:e.weightUnit,weightReference:e.weight,weight:n.isStock?e.weight:"",lose:e.goldLoss},l||{}),n.productDetailAttr.goldBoms.push(e));var i=!1;e.partAttrs.map(function(t){s===t.attr&&(i=!0,n.productDetailAttr.goldBoms[o].attr.push(t))}),i||n.productDetailAttr.goldBoms[o].attr.push({})})}):t.goldParts.map(function(e,t){n.productDetailAttr.goldBoms[t]||(a.map(function(t){c[t]=e[t]}),Object.assign(e,{attr:[],commodityId:e.commodityId,commodityCode:e.goodsCode,commodityName:e.name,condition:e.goldColor,weightUnitId:e.weightUnit,weightReference:e.weight,weight:n.isStock?e.weight:"",lose:e.goldLoss},l||{}),n.productDetailAttr.goldBoms.push(e))}),0<n.productDetailAttr.stoneHeader.length?n.productDetailAttr.stoneHeader.map(function(s){t.stonesParts.map(function(e,o){r.map(function(t){l[t]=e[t]}),n.productDetailAttr.stonesBoms[o]||(Object.assign(e,{attr:[],commodityId:e.commodityId,commodityCode:e.goodsCode,commodityName:e.name,weightUnitId:e.weightUnit,countUnitId:e.countingUnit,weightReference:e.weight,count:e.num,partName:e.stoneName,lose:e.stoneLoss,weight:n.isStock?e.weight:""},l||{}),n.productDetailAttr.stonesBoms.push(e));var i=!1;e.partAttrs.map(function(t){s===t.attr&&(i=!0,n.productDetailAttr.stonesBoms[o].attr.push(t))}),i||n.productDetailAttr.stonesBoms[o].attr.push({})})}):t.stonesParts.map(function(e,t){r.map(function(t){l[t]=e[t]}),n.productDetailAttr.stonesBoms[t]||(Object.assign(e,{attr:[],commodityId:e.commodityId,commodityCode:e.goodsCode,commodityName:e.name,weightUnitId:e.weightUnit,countUnitId:e.countingUnit,weightReference:e.weight,weight:n.isStock?e.weight:"",count:e.num,partName:e.stoneName,lose:e.stoneLoss},l||{}),n.productDetailAttr.stonesBoms.push(e))}),0<n.productDetailAttr.partHeader.length?n.productDetailAttr.partHeader.map(function(s){t.partParts.map(function(e,o){d.map(function(t){m[t]=e[t]}),n.productDetailAttr.partBoms[o]||(Object.assign(e,{attr:[],commodityId:e.commodityId,commodityCode:e.goodsCode,commodityName:e.name,weightUnitId:e.weightUnit,countUnitId:e.countingUnit,weightReference:e.weight,count:e.num},m||{}),n.productDetailAttr.partBoms.push(e));var i=!1;e.partAttrs.map(function(t){s===t.attr&&(i=!0,n.productDetailAttr.partBoms[o].attr.push(t))}),i||n.productDetailAttr.partBoms[o].attr.push({})})}):t.partParts.map(function(e,t){d.map(function(t){m[t]=e[t]}),n.productDetailAttr.partBoms[t]||(Object.assign(e,{attr:[],commodityId:e.commodityId,commodityCode:e.goodsCode,commodityName:e.name,weightUnitId:e.weightUnit,countUnitId:e.countingUnit,weightReference:e.weight,count:e.num},m||{}),n.productDetailAttr.partBoms.push(e))}),this.productDetailAttr.goldBoms.map(function(t,e){t.weightUnitId=o.unitObj[t.weightUnitId&&t.weightUnitId.toString()]||t.weightUnitId}),this.productDetailAttr.stonesBoms.map(function(t,e){t.weightUnitId=o.unitObj[t.weightUnitId&&t.weightUnitId.toString()]||t.weightUnitId,t.countUnitId=o.unitObj[t.countUnitId&&t.countUnitId.toString()]||t.countUnitId}),this.productDetailAttr.partBoms.map(function(t,e){t.countUnitId=o.unitObj[t.countUnitId&&t.countUnitId.toString()]||t.countUnitId})}else t.materialParts.map(function(t){t.partAttrs.map(function(t){n.productDetailAttr.assistAttrsHeader.push(t.attr),n.productDetailAttr.assistAttrs.push(t)})})},handlerDetailHeader:function(t,e){var o=this;t.map(function(t){o.productDetailAttr[e]=[],t.partAttrs.map(function(t){-1===o.productDetailAttr[e].indexOf(t.attr)&&o.productDetailAttr[e].push(t.attr)})})},handlerAllBomData:function(t){Object.assign(this.productDetailAttr,{goldBoms:t.goldBoms,goldHeader:t.goldHeader||[],stonesBoms:t.stonesBoms,stoneHeader:t.stoneHeader||[],partBoms:t.partBoms,partHeader:t.partHeader||[]}),this.overEdit||(this.handlerBoms("stonesBoms","stoneHeader"),this.handlerBoms("goldBoms","goldHeader"),this.handlerBoms("partBoms","partHeader"),this.tBaseBomEntity||(this.tBaseBomEntity={}),Object.assign(this.tBaseBomEntity,{goldHeader:this.productDetailAttr.goldHeader,stoneHeader:this.productDetailAttr.stoneHeader,partHeader:this.productDetailAttr.partHeader})),this.productDetailAttrTemp=JSON.parse(JSON.stringify(this.productDetailAttr))},handlerAllPartData:function(t){var e=JSON.parse(JSON.stringify(t));Object.assign(this.productDetailAttr,{goodsMainType:this.goodsMainType,assistAttrs:e.assistAttrs,assistAttrsHeader:e.assistAttrsHeader||[]}),this.overEdit||this.handlerAssist(),this.productDetailAttrTemp=JSON.parse(JSON.stringify(this.productDetailAttr))},handlerAssist:function(){var e=this;this.productDetailAttr.assistAttrs.map(function(t){t.attr||(t.attr=[]),e.productDetailAttr.assistAttrsHeader.push(t.name),t.attr.push({name:t.name,options:t.tBaseAssistAttrValuess,model:1===t.tBaseAssistAttrValuess.length?t.tBaseAssistAttrValuess[0].value:""})}),Object.assign(this.myAssistAttrs,{assistAttrs:this.productDetailAttr.assistAttrs,assistAttrsHeader:this.productDetailAttr.assistAttrsHeader})},handlerBoms:function(o,i){var s=this;this.productDetailAttr[o].map(function(t){t.assistAttrList.map(function(t,e){-1===s.productDetailAttr[i].indexOf(t.name)&&s.productDetailAttr[i].push(t.name)})}),this.productDetailAttr[i].map(function(r,t){s.productDetailAttr[o].map(function(t,e){t.attr||(t.attr=[]);for(var o=t.assistAttrList.length,i=!1,s=0;s<o;s++)if(r===t.assistAttrList[s].name){var n=1===t.assistAttrList[s].tBaseAssistAttrValuess.length?t.assistAttrList[s].tBaseAssistAttrValuess[0].value:"";t.attr.push({options:t.assistAttrList[s].tBaseAssistAttrValuess,name:r,model:n}),i=!0}i||t.attr.push([])})}),this.productDetailAttr[o].map(function(t,e){"partBoms"===o?t.countUnitId=t.countUnitId&&s.unitObj[t.countUnitId.toString()]:"stonesBoms"===o?(t.weightUnitId=t.weightUnitId&&s.unitObj[t.weightUnitId.toString()],t.countUnitId=t.countUnitId&&s.unitObj[t.countUnitId.toString()]):"goldBoms"===o&&(t.weightUnitId=t.weightUnitId&&s.unitObj[t.weightUnitId.toString()])})},handlerPartAttrs:function(t,s){var e=this;t.map(function(i,t){i.partAttrs.map(function(o){e.productDetailAttr[s][t]&&e.productDetailAttr[s].map(function(t,e){t.commodityCode===i.goodsCode&&(t.attr.map(function(t){o.attr===t.name&&(t.model=o.attrValue)}),"goldBoms"===s&&t.commodityCode===i.goodsCode&&(t.checked=!0))})})})},handlerExcelImportAttrs:function(e,t){var o=this.productDetailAttr[t]||[];if("partBoms"!==t)if("goldBoms"==t){if(!(Array.isArray(e)&&0<e.length))return;var i=e[0];$.each(o,function(t,e){if(e.commodityCode===i.goodsCode)return e.checked=!0,void(e.weight=i.weight)})}else if("stonesBoms"==t){if(!(Array.isArray(e)&&0<e.length))return;$.each(o,function(t,o){$.each(e,function(t,e){o.commodityCode===e.goodsCode&&(o.weight=e.weight,$.each(o.attr||[],function(t,o){$.each(e.partAttrs||[],function(t,e){e.attr===o.name&&(o.model=e.attrValue)})}))})})}},handlerLoss:function(i){var s=this;this.productDetailAttr.stonesBoms.map(function(t,e){0<i.stonesParts.length&&(t.lose=null===i.stonesParts[e].stoneLoss?t.lose:i.stonesParts[e].stoneLoss,t.weightReference=null===i.stonesParts[e].weight?t.weightReference:i.stonesParts[e].weight,t.weight=s.isStock?i.stonesParts[e].weight:"")}),this.productDetailAttr.goldBoms.map(function(t,e){if(0<i.goldParts.length){var o=i.goldParts[0].goodsCode;t.commodityCode===o&&(t.lose=null===i.goldParts[0].goldLoss?t.lose:i.goldParts[0].goldLoss,t.weightReference=null===i.goldParts[0].weight?t.weightReference:i.goldParts[0].weight,t.weight=s.isStock?i.goldParts[0].weight:"")}}),this.productDetailAttr.partBoms.map(function(t,e){0<i.partParts.length&&(t.weightReference=null===i.partParts[e].weight?t.weightReference:i.partParts[e].weight)})},handlerExcelLoss:function(i){var s=this;this.productDetailAttr.stonesBoms.map(function(e){0<i.stonesParts.length&&i.stonesParts.map(function(t){e.commodityCode===t.goodsCode&&(e.lose=null===t.stoneLoss?e.lose:t.stoneLoss,e.weightReference=null===t.weight?e.weightReference:t.weight,e.weight=s.isStock?t.weight:"")})}),this.productDetailAttr.goldBoms.map(function(t,e){if(0<i.goldParts.length){var o=i.goldParts[0].goodsCode;t.commodityCode===o&&(t.lose=null===i.goldParts[0].goldLoss?t.lose:i.goldParts[0].goldLoss,t.weightReference=null===i.goldParts[0].weight?t.weightReference:i.goldParts[0].weight,t.weight=s.isStock?i.goldParts[0].weight:"")}}),this.productDetailAttr.partBoms.map(function(t,e){0<i.partParts.length&&(t.weightReference=null===i.partParts[e].weight?t.weightReference:i.partParts[e].weight)})},handlerEditSpecialAttr:function(e){var o=this,i=[],s=[],n=[];this.specialAttr.stone.map(function(t){i.push(t.code)}),this.specialAttr.gold.map(function(t){s.push(t.code)}),this.specialAttr.part.map(function(t){n.push(t.code)}),s.map(function(i,t){o.productDetailAttr.goldBoms.map(function(o,t){0<e.goldParts.length&&e.goldParts.map(function(t,e){o.commodityCode==t.goodsCode&&(o[i]=t[i])})})}),i.map(function(i,t){o.productDetailAttr.stonesBoms.map(function(o,t){0<e.stonesParts.length&&e.stonesParts.map(function(t,e){o.commodityCode==t.goodsCode&&(o[i]=t[i])})})}),n.map(function(i,t){o.productDetailAttr.partBoms.map(function(o,t){0<e.partParts.length&&e.partParts.map(function(t,e){o.commodityCode==t.goodsCode&&(o[i]=t[i])})})})},validateOne:function(a){var d=this,o=0;return 1==this.orderStatus&&!this.dataSourceType&&!this.isOrderBom&&("goldBoms"===a&&0<this.productDetailAttr[a].length&&(this.productDetailAttr[a].map(function(t,e){t.checked&&(o+=1)}),!o)?(this.$Modal.error({content:"金料有且只能选一条"}),!0):this.productDetailAttr[a].filter(function(t){return t.attr}).some(function(n,r){if("stonesBoms"===a&&1==n.weightWay&&(Number(n.weightReference)>n.weightUpper||Number(n.weightReference)<n.weightFloor))return d.$Modal.info({content:"石料第"+(r+1)+"行重量输入有误，适用范围"+n.weightFloor+"--"+n.weightReference}),!0;if(d.isStock&&"stonesBoms"===a){if(!n.weight)return d.$Modal.info({content:"请输入石料第"+(r+1)+"行重量"}),!0;if(!n.price)return d.$Modal.info({content:"请输入石料第"+(r+1)+"行单价"}),!0;if(!n.inPrice)return d.$Modal.info({content:"请输入石料第"+(r+1)+"行进价"}),!0}if(d.isStock&&"partBoms"===a){if(!n.price)return d.$Modal.info({content:"请输入配件第"+(r+1)+"行单价"}),!0;if(!n.inPrice)return d.$Modal.info({content:"请输入配件第"+(r+1)+"行进价"}),!0}if(d.isStock&&"goldBoms"===a){if(n.checked&&!n.weight)return d.$Modal.info({content:"请输入金料第"+(r+1)+"行重量"}),!0;if(n.checked&&!n.lose)return d.$Modal.info({content:"请输入金料第"+(r+1)+"行金耗"}),!0}return n.attr.some(function(t,e){var o=r+1,i=d.typeName[a];if("goldBoms"!==a&&t.options&&!t.model||"goldBoms"===a&&n.checked&&t.options&&!t.model){var s="assistAttrs"===a?i+"的"+t.name+"必选":i+"第"+o+"行的"+t.name+"必选";return d.$Modal.info({content:s}),!0}})}))},validateAttrAndPart:function(){return"attr_ranges_goods"===this.goodsMainType?!this.validateOne("goldBoms")&&!this.validateOne("stonesBoms")&&!this.validateOne("partBoms"):!this.validateOne("assistAttrs")},modalOk:function(){if(1!=this.orderStatus||this.isOrderBom)return this.$root.productDetailModal.showModal=!1,this.showModal=!1,void this.$emit("no");this.validateAttrAndPart()&&(this.$root.productDetailModal.showModal=!1,this.$emit("ok",JSON.parse(JSON.stringify(this.productDetailAttr))))},modalCancel:function(){if(this.$emit("cancel"),1!=this.orderStatus||this.isOrderBom)return this.showModal=!1,void(this.$root.productDetailModal.showModal=!1);var t=JSON.parse(JSON.stringify(this.productDetailAttrTemp));t&&(this.tBaseBomEntity=t,this.myAssistAttrs=t,this.productDetailAttr=t),this.$forceUpdate(),this.$root.productDetailModal.showModal=!1},clearProductDetailAttr:function(){this.productDetailAttr=JSON.parse(JSON.stringify({goldBoms:[],stonesBoms:[],partBoms:[],assistAttrs:[],stoneHeader:[],goldHeader:[],partHeader:[],assistAttrsHeader:[]}))},initUnit:function(){var i=this;$.ajax({type:"post",url:contextPath+"/tbaseunit/list",contentType:"application/json",dataType:"json",async:!1,success:function(t){"100100"===t.code?t.data.map(function(t){var e=t.id.toString(),o=t.name;i.unitObj[e]=o}):layer.alert("服务器异常,请联系技术人员！",{icon:0})},error:function(t){layer.alert("网络异常,请联系技术人员！",{icon:0})}})},onlyNumber:function(t,e,o,i){if(!1!==i)return htInputNumber(t,e,o)}},created:function(){this.initUnit()},watch:{},template:'<i-form label-width="120">\n    <modal v-model="showModal" @on-cancel="modalCancel" @on-ok="modalOk" title="商品明细属性" \n    :mask-closable = "false"\n                   width="90%">\n                  <div class="productProperty"\n                    style="overflow-x: scroll; overflow-y: visible;"\n                     v-if="goodsMainType === \'attr_ranges_goods\'">\n                    <div class="ht-subtitle">\n                        <div>金料</div>\n                    </div>\n                    <table class="edit-table">\n                        <thead>\n                        <th v-if="orderStatus ==1 && !isOrderBom"></th>\n                        <th>商品编码</th>\n                        <th>商品名称</th>\n                        <th>成色</th>\n                        <th>计重单位</th>\n                        <th>重量</th>\n                        <th>金耗</th>\n                        <th v-for="item of specialAttr.gold" :key="item.code">{{item.name}}</th>\n                        <th v-for="(item, index) in productDetailAttr.goldHeader" :key="index">{{item}}</th>\n                        </thead>\n                        <tbody>\n                        <tr v-for="(item, index) in productDetailAttr.goldBoms" :key="index">\n                            <td v-if="orderStatus ==1 && !isOrderBom"><Checkbox @on-change="goldCheckedChange($event, index)" v-model="item.checked" :disabled="item.checked"></Checkbox></td>\n                            <td>{{item.commodityCode}}</td>\n                            <td>{{item.commodityName}}</td>\n                            <td>{{item.condition}}</td>\n                            <td>{{item.weightUnitId}}</td>\n                            <td>\n                                <span v-if="!isStock">{{item.weightReference}}</span>\n                                <input \n                                    class="ivu-input"\n                                    v-if="isStock" \n                                    v-model="item.weight"\n                                    @input="onlyNumber(item, \'weight\', 2)"\n                                    />\n                            </td>\n                            \n                            <td>\n                                <span v-if="!(orderStatus ==1 && !isOrderBom)">{{item.lose}}</span>\n                                <input \n                                    class="ivu-input"\n                                    v-if="orderStatus ==1 && !isOrderBom"  \n                                    v-model="item.lose"\n                                    @input="onlyNumber(item, \'lose\', 2)"\n                                    />\n                              \n                            </td>\n                            <td v-for="key of specialAttr.gold" :key="key.code">\n                                <span v-if="!key.edit">{{item[key.code]}}</span>\n                                <i-input v-if="key.edit"  v-model="item[key.code]"></i-input>\n                            </td>\n                            <td v-for="(list, i) in item.attr" :key="i" v-if="orderStatus ==1 && !dataSourceType && !isOrderBom">\n                                <i-select :disabled="!item.checked || !list.options" class="ht-width-input" v-model="list.model" transfer>\n                                    <i-option v-for="(option, y) in list.options" :value="option.value" :key="y">\n                                        {{option.value}}\n                                    </i-option>\n                                </i-select>\n                            </td>\n                            <td v-for="(list, i) in item.attr" :key="i" v-if="orderStatus !=1 || dataSourceType || isOrderBom">\n                                {{list.attrValue}}\n                            </td>\n                        </tr>\n                        </tbody>\n                    </table>\n                    <div class="ht-subtitle">\n                        <div>石料</div>\n                    </div>\n                    <table class="edit-table">\n                        <thead>\n                        \x3c!--固定项--\x3e\n                        <th>组成项</th>\n                        <th>商品编码</th>\n                        <th>商品名称</th>\n                        <th>计数单位</th>\n                        <th>数量</th>\n                        <th>计重单位</th>\n                        <th>重量</th>\n                        <th>损耗</th>\n                        <th v-for="item of specialAttr.stone" :key="item.code">{{item.name}}</th>\n                        <th v-for="(item, index) in productDetailAttr.stoneHeader" :key="index">{{item}}</th>\n                        </thead>\n                        <tbody>\n                        <tr v-for="(item, index) in productDetailAttr.stonesBoms" :key="index">\n                            <td>{{item.partName == 1 ? \'主石\': \'副石\'}}</td>\n                            <td>{{item.commodityCode}}</td>\n                            <td>{{item.commodityName}}</td>\n                            <td>{{item.countUnitId}}</td>\n                            <td>{{item.count}}</td>\n                            <td>{{item.weightUnitId}}</td>\n                            <td>\n                                <input \n                                    class="ivu-input"\n                                    v-if="!isStock && item.weightWay == 1" \n                                    v-model="item.weightReference"\n                                    :placeholder="item.weightFloor + \'--\' + item.weightUpper"\n                                    @input="onlyNumber(item, \'weightReference\', 2)"\n                                />\n                                <span v-if="!isStock && item.weightWay !=1">{{item.weightReference}}</span>\n                                <input \n                                    class="ivu-input"\n                                    v-if="isStock" \n                                    v-model="item.weight"\n                                    @input="onlyNumber(item, \'weight\', 2)"\n                                />\n                            </td>\n                            <td>\n                                <input \n                                    class="ivu-input"\n                                    v-if="orderStatus ==1 && !isOrderBom" \n                                    v-model="item.lose" \n                                    @input="onlyNumber(item, \'lose\', 2)"\n                                    />\n                                <span v-if="!(orderStatus ==1 && !isOrderBom)">{{item.lose}}</span>\n                            </td>\n                            <td v-for="key of specialAttr.stone" :key="key.code">\n                                <input \n                                    class="ivu-input"\n                                    v-if="key.edit"  \n                                    v-model="item[key.code]" \n                                    @input="onlyNumber(item, key.code, 2, key.test)"\n                                   />\n                                <span v-if="!key.edit">{{item[key.code]}}</span>\n                               \n                            </td>\n                            <td v-for="(list, i) in item.attr" :key="i" v-if="orderStatus ==1 && !dataSourceType && !isOrderBom">\n                                <i-select class="ht-width-input" :disabled="!list.options" v-model="list.model" transfer>\n                                    <i-option v-for="(option, y) in list.options" :value="option.value" :key="y">\n                                        {{option.value}}\n                                    </i-option>\n                                </i-select>\n                            </td>\n                            <td v-for="(list, i) in item.attr" :key="i" v-if="orderStatus !=1 || dataSourceType || isOrderBom">\n                                {{list.attrValue}}\n                            </td>\n                        </tr>\n                        </tbody>\n                    </table>\n                    <div class="ht-subtitle">\n                        <div>配件（其他）</div>\n                    </div>\n                    <table class="edit-table">\n                        <thead>\n                        <th>商品编码</th>\n                        <th>商品名称</th>\n                        <th>计数单位</th>\n                        <th>数量</th>\n                        <th>重量</th>\n                        <th v-for="item of specialAttr.part" :key="item.code">{{item.name}}</th>\n                        <th v-for="(item, index) in productDetailAttr.partHeader" :key="index">{{item}}</th>\n                        </thead>\n                        <tbody>\n                        <tr v-for="(item, index) in productDetailAttr.partBoms" :key="index">\n                            <td>{{item.commodityCode}}</td>\n                            <td>{{item.commodityName}}</td>\n                            <td>{{item.countUnitId}}</td>\n                            <td>{{item.count}}</td>\n                            <td>{{item.weightReference}}</td>\n                            <td v-for="key of specialAttr.part" :key="key.code">\n                                <input \n                                    class="ivu-input"\n                                    v-if="key.edit"  \n                                    v-model="item[key.code]"\n                                    @input="onlyNumber(item, key.code, 2)"\n                                    />\n                                <span v-if="!key.edit">{{item[key.code]}}</span>\n                               \n                            </td>\n                            <td v-for="(list, i) in item.attr" :key="i"  v-if="orderStatus ==1 && !dataSourceType && !isOrderBom">\n                                <i-select class="ht-width-input" :disabled="!list.options" v-model="list.model" transfer>\n                                    <i-option v-for="(option, y) in list.options" :value="option.value" :key="y">\n                                        {{option.value}}\n                                    </i-option>\n                                </i-select>\n                            </td>\n                            <td v-for="(list, i) in item.attr" :key="i" v-if="orderStatus !=1 || dataSourceType || isOrderBom">\n                                {{list.attrValue}}\n                            </td>\n                        </tr>\n                        </tbody>\n                    </table>\n                </div>\n                <div class="productProperty_material"\n                     v-if="goodsMainType !== \'attr_ranges_goods\'">\n                    <table class="edit-table">\n                        <thead>\n                        <th v-for="(item, index) in productDetailAttr.assistAttrsHeader" :key="index">{{item}}</th>\n                        </thead>\n                        <tbody>\n                        <tr v-if="orderStatus ==1 && !dataSourceType && !isOrderBom">\n                         \n                            <td v-for="(item, index) in productDetailAttr.assistAttrs" :key="index">\n                                <div style="display: inline-block; width:140px;" >\n                                    <div style="display: inline-block" v-for="(list, i) in item.attr" :key="i">\n                                        <i-select class="ht-width-input" v-model="list.model" transfer>\n                                            <i-option v-for="(option, y) in list.options" :value="option.value" :key="y">\n                                                {{option.value}}\n                                            </i-option>\n                                        </i-select>\n                                    </div>\n                                </div>\n                            </td>\n                        </tr>\n                        <tr v-if="orderStatus !=1 || dataSourceType || isOrderBom">\n                        <td v-for="(item, index) in productDetailAttr.assistAttrs" :key="index">\n                                <div style="display: inline-block;" >\n                                <div style="display: inline-block; width: 140px; height:40px;box-sizing: border-box; border: 1px solid #C9C9C9; padding: 0 6px; line-height: 40px">\n                                    {{item.attrValue}}\n                                </div>\n                            </div>\n                        </td>\n                        </tr>\n                        </tbody>\n                    </table>\n                    \n                </div>\n                <div slot="footer">\n                    <i-button type="text" size="large" @click="modalCancel">取消</i-button>\n                    <i-button type="primary" size="large" @click="modalOk">确定</i-button>\n                </div>\n            </modal>\n        </i-form>'});