"use strict";var ve=new Vue({el:"#wait-order",data:function(){return{isHideSearch:!0,isHideList:!0,openTime:"",isSearchHide:!0,reload:!1,selected:[],tabId:"tabList",body:{searchDepositNo:"",searchSaleOrderNo:"",searchCustName:"",searchPayWay:"",searchCreateTime:"",searchEndTime:"",page:"",limit:""},dateArr:"",data_user_list:{url:contextPath+"/deposit/findSaleCustOrderVoPage",colNames:["源单类型","下单日期","单据编号","业务状态","客户","客户编码","定金方式","订单金额","定金比例(%)","应收定金","已收定金"],colModel:[{name:"sourceType",index:"sourceType",width:220,align:"center",formatter:function(e,t,a,r){return"客户订单"}},{name:"createTime",index:"createTime",width:220,align:"center",formatter:function(e,t,a,r){return new Date(e).format("yyyy-MM-dd")}},{name:"orderNo",index:"orderNo",width:220,align:"center",formatter:function(e,t,a,r){return $(document).off("click",".updateDetail"+e).on("click",".updateDetail"+e,function(){ve.updateDetail({value:e,grid:t,rows:a,state:r})}),'<a class="updateDetail'+e+'">'+e+"</a>"}},{name:"businessStatus",index:"businessStatus",width:220,align:"center",formatter:function(e,t,a,r){if(10==e)return"待收定金"}},{name:"custName",index:"custName",width:220,align:"center"},{name:"custNo",index:"custNo",width:220,align:"center",hidden:!0},{name:"depositMethod",index:"depositMethod",width:220,align:"center",formatter:function(e,t,a,r){return 0===e?"预付定金":""}},{name:"totalRealSaleAmount",index:"totalRealSaleAmount",width:220,align:"center",formatter:function(e,t,a,r){if(null!=e)return e.toFixed(2);return(0).toFixed(2)}},{name:"deposit_scale",index:"deposit_scale",width:220,align:"center"},{name:"receviableDeposit",index:"receviableDeposit",width:200,align:"center",formatter:function(e,t,a,r){if(null!=e)return e.toFixed(2);return(0).toFixed(2)}},{name:"paidDeposit",index:"paidDeposit",width:200,align:"center",formatter:function(e,t,a,r){if(null!=e)return e.toFixed(2);return(0).toFixed(2)}}]}}},methods:{changeDate:function(e){this.body.searchCreateTime=""==e[0]?"":e[0].replace(/\//g,"-")+" 00:00:00",this.body.searchEndTime=""==e[1]?"":e[1].replace(/\//g,"-")+" 23:59:59"},refresh:function(){ve.reload=!ve.reload},updateDetail:function(e){var t=e.rows;console.log(t.orderNo),null!=t.orderNo&&window.parent.activeEvent({name:"客户订单",url:contextPath+"/sale/customer-order/customer-order-add.html",params:{type:"view",saleOrderNo:t.orderNo}})},search:function(){var e={postData:this.body};$("#"+this.tabId).jqGrid("setGridParam",e).trigger("reloadGrid")},produce:function(){var e=this.selected,t=[],a=!0;if(e.length<=0)ve.$Modal.info({content:"请选择客户订单"});else{for(var r=0;r<e.length;r++){var o={},n=$("#"+this.tabId).jqGrid("getRowData",e[r]);o.orderNo=n.orderNo.replace(/<.*?>+/g,""),o.custName=n.custName.replace(/<.*?>+/g,""),o.custNo=n.custNo,o.custName=n.custName,t.push(o)}console.log(t);for(var i=t[0].custNo,s=1;s<t.length;s++)if(i!=t[s].custNo){a=!1,ve.$Modal.info({content:"客户不一致"});break}if(a){var d=t[0].custNo,c=t[0].custName,l=[];t.map(function(e){l.push(e.orderNo)});var u=[];u.push(1),u.push(d),u.push(c),u.push(l);var h=[];$.ajax({type:"post",async:!0,traditional:!0,dataType:"json",data:{saleOrderNos:l},url:contextPath+"/deposit/findSaleOrderNoStatus",success:function(e){if(console.log(e),1==e.code){a=!1;for(var t=0;t<e.data.length;t++)h.push(e.data[t].custOrderNo);ve.$Modal.info({content:h+"已经生成过销售定金单,不必重复生成"})}else window.parent.activeEvent({name:"销售定金单-新增",url:contextPath+"/sale/deposit/sale-order-add.html",params:{allInfo:u,type:"query"}}),console.log(u)},error:function(e){console.log(e)}})}}},clean:function(){this.body={searchDepositNo:"",searchSaleOrderNo:"",searchCustName:"",searchPayWay:"",searchCreateTime:"",searchEndTime:""},this.dateArr=[],this.reload=!this.reload},exit:function(){window.parent.closeCurrentTab({exit:!0,openTime:this.openTime})}},mounted:function(){this.openTime=window.parent.params.openTime}});