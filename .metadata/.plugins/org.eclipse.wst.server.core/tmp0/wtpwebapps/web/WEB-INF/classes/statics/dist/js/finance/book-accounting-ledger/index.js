"use strict";var vm=new Vue({el:"#app",data:function(){return{openTime:"",formData:{currency:-1,accountingYear:0,accountingPeriod:0,accountingYearEnd:0,accountingPeriodEnd:0,auxiliaryLists:[],subject:"",accountingLevel:1,opt1:!1,opt2:!1},baseData:{standardCurrencyId:0},_presents:[],auxiliaryLists:[],currencyList:{},isFilterVisible:!1,accountingYear:[],accountingPeriod:[],accountingCode:"",accountingLevels:[],subjectVisible:!1,base_config:{scroll:"true",styleUI:"Bootstrap",url:contextPath+"/accountBalanceSheet/getSheetlist",datatype:"json",postData:{},jsonReader:{root:"data",cell:"data",repeatitems:!1},viewrecords:!0,rowNum:9999,height:$(window).height()-160,rowList:[10,20,30,40],mtype:"POST"},colNames:[],colModel:[],colunm_config:[],lodoPList:[],printInfo:{},printModal:!1}},methods:{subjectClose:function(){this.isFilterVisible=!0,this.$refs.filter.visible=!0,this.subjectVisible=!1},saveSubjectData:function(t){var e=this.formData.subject;this.formData.subject+=(""==$.trim(e)?"":",")+t.subjectCode.replace(/\./g,"")},openModalSubject:function(){this.$refs.filter.visible=!0,this.subjectVisible=!0},formatNum:function(t){return accounting.formatMoney(t)},voucherDetail:function(t,e,n){return'<a href="###'+n.id+'">'+t+"</a>"},initMethod:function(){var r=this;console.log("this.formData",this.formData,this.baseData.standardCurrencyId),this.baseData.standardCurrencyId===parseInt(this.formData.currency)||-1===parseInt(this.formData.currency)?(this.colNames=["id","日期","凭证字号","摘要","借方","贷方","方向","余额"],this.colModel=[{name:"id",width:30,hidden:!0},{name:"voucherDate",width:100,formatter:function(t,e,n){return t=t?new Date(t).format("yyyy-MM-dd"):""}},{name:"voucherGroupName",width:100,formatter:function(t,e,n,a){$(document).off("click",".mark"+e.rowId).on("click",".mark"+e.rowId,function(){r._text(e.rowId)});var o="";return e.rowId&&"null"!==e.rowId&&"0"!==e.rowId&&"-1"!==e.rowId&&(o='<a class="mark'+e.rowId+'">'+t+"</a>"),o}},{name:"explains",width:100},{name:"debit",width:100,formatter:function(t,e,n,a){return null==t||0==t?"":accounting.formatNumber(t,2,",")}},{name:"credit",width:100,formatter:function(t,e,n,a){return null==t||0==t?"":accounting.formatNumber(t,2,",")}},{name:"direction",width:100,formatter:function(t,e,n){return t=1===t?"借":2===t?"贷":"平"}},{name:"balance",width:120,formatter:function(t,e,n,a){return null==t||0==t?"":accounting.formatNumber(t,2,",")}}],this.tableHeaders=[]):(this.colNames=["id","日期","凭证字号","摘要","原币","本位币","原币","本位币","方向","原币","本位币"],this.colModel=[{name:"id",width:30,hidden:!0},{name:"voucherDate",width:100,formatter:function(t,e,n){return t=t?new Date(t).format("yyyy-MM-dd"):""}},{name:"voucherGroupName",width:100,formatter:function(t,e,n,a){$(document).off("click",".mark"+e.rowId).on("click",".mark"+e.rowId,function(){r._text(e.rowId)});var o="";return e.rowId&&"null"!==e.rowId&&"0"!==e.rowId&&"-1"!==e.rowId&&(o='<a class="mark'+e.rowId+'">'+t+"</a>"),o}},{name:"explains",width:100},{name:"debitFor",width:100,formatter:function(t,e,n,a){return null==t||0==t?"":accounting.formatNumber(t,2,",")}},{name:"debit",width:100,formatter:function(t,e,n,a){return null==t||0==t?"":accounting.formatNumber(t,2,",")}},{name:"creditFor",width:100,formatter:function(t,e,n,a){return null==t||0==t?"":accounting.formatNumber(t,2,",")}},{name:"credit",width:120,formatter:function(t,e,n,a){return null==t||0==t?"":accounting.formatNumber(t,2,",")}},{name:"direction",width:150,formatter:function(t,e,n){return t=1===t?"借":2===t?"贷":"平"}},{name:"balanceFor",width:100,formatter:function(t,e,n,a){return null==t||0==t?"":accounting.formatNumber(t,2,",")}},{name:"balance",width:100,formatter:function(t,e,n,a){return null==t||0==t?"":accounting.formatNumber(t,2,",")}}],this.tableHeaders=[{startColumnName:"debitFor",numberOfColumns:2,titleText:"借方"},{startColumnName:"creditFor",numberOfColumns:2,titleText:"贷方"},{startColumnName:"balanceFor",numberOfColumns:2,titleText:"余额"}]),this.jqGridInit(this.colNames,this.colModel,this.tableHeaders)},_fromData:function(t,e){return 1===e?t=0===t||null===t?"":t.toFixed(2):2===e&&(t=t.toFixed(2)),t},resetting:function(){this.formData.subject=""},delTable:function(){$("#my_jqGrid").empty();var t=$(".jqGrid_wrapper");t.empty(),$("<table id='my_jqGrid'></table>").appendTo(t),$("<div id='my_pager'></div>").appendTo(t)},jqGridInit:function(t,e,n){var a=this;console.log("vm.formData===>>>",a.formData,a.base_config.postData);var o=Object.assign({},this.base_config,{colNames:t,colModel:e,pager:"#my_pager",datatype:"json",postData:a.formData,loadComplete:function(t){console.log("ret====>>>",t);var e="";e=(t.code,t.msg),a.$Message.info({content:e,duration:3}),a.lodoPList=t.data||[]},gridComplete:function(){jQuery("#my_jqGrid").jqGrid("setGroupHeaders",{useColSpanStyle:!0,groupHeaders:n}),window.top.home.loading("hide")},onCellSelect:function(t,e,n,a){console.log(t,e,n,a,"===="),console.log("rowid",t,e,"null"===t,t<=0),"null"!==t?Number(t):console.log("rowid===",t,e)}});console.log("config",o),jQuery("#my_jqGrid").jqGrid(o)},submitFilter:function(){this.base_config.url="/web/accountBalanceSheet/getSheetlist",this.base_config.postData={accountingYear:vm.formData.accountingYear,accountingPeriod:vm.formData.accountingPeriod,accountingYearEnd:vm.formData.accountingYearEnd,accountingPeriodEnd:vm.formData.accountingPeriodEnd,subject:vm.formData.subject,auxiliaryLists:vm.formData.auxiliaryLists,accountingLevel:vm.formData.accountingLevel,currency:vm.formData.currency},console.log("this.base_config.postData",this.base_config.postData),this.delTable(),this.initMethod(),this.cancel()},cancel:function(){this.$refs.filter.visible=!1,this.isFilterVisible=!1},_text:function(t){var e={name:"查看凭证",url:rcContextPath+"/finance/voucher-lrt/index.html?voucherId="+t+"&sobId=1"};window.parent.activeEvent(e)},more:function(t){if("Derivation"===t){console.log("引出,导出 核算项目明细表...");var e=vm.formData;console.log("vm.formData",vm.formData);var n="";for(var a in e)n+=a+"="+e[a]+"&";n=n.slice(0,n.length-1),window.open("/web/accountBalanceSheet/exportExcel?"+n)}},refresh:function(){window.top.home.loading("show"),this.submitFilter()},YearAndPeriod:function(){$.ajax({type:"post",async:!0,data:"",url:contextPath+"/accountBalanceSheet/getAccountYearAndPeriod",dataType:"json",success:function(t){"100100"===t.code&&(console.log(t),vm.accountingPeriod=t.data.period,vm.accountingYear=t.data.year,vm._presents=t.data.presents,vm.SubjectProjectById(),vm.formData.accountingYear=vm._presents[0],vm.formData.accountingYearEnd=vm._presents[0],vm.formData.accountingPeriod=vm._presents[1],vm.formData.accountingPeriodEnd=vm._presents[1],console.log("vm.accountingYear",vm.accountingPeriod,vm.accountingYear))},error:function(t){console.log(t)}})},currency:function(){$.ajax({type:"post",async:!0,data:"",url:contextPath+"/balance/currencyList",dataType:"json",success:function(t){for(var e=t.data,n={},a=0;a<e.length;a++)n[e[a].value]=e[a].label;console.log("d.data[0].value",t.data[0].value),vm.baseData.standardCurrencyId=t.data[0].value,console.log("datas",n),vm.currencyList=n;var o=getUrlParam("currency");vm.$nextTick(function(){o&&(vm.formData.currency=parseInt(getUrlParam("currency")),vm.formData.accountingYear=parseInt(getUrlParam("accountingYear")),vm.formData.accountingPeriod=parseInt(getUrlParam("accountingPeriod")),vm.formData.accountingYearEnd=parseInt(getUrlParam("accountingYearEnd")),vm.formData.accountingPeriodEnd=parseInt(getUrlParam("accountingPeriodEnd")),vm.formData.auxiliaryLists.push(getUrlParam("auxiliaryLists")),vm.formData.subject=getUrlParam("subject"),vm.formData.accountingLevel=parseInt(getUrlParam("accountingLevel")),vm.formData.opt1=parseInt(getUrlParam("opt1")||0),vm.formData.opt2=parseInt(getUrlParam("opt2")||0)),vm.initMethod(vm.colNames,vm.colModel,vm.colunm_config,vm),console.log("获取币别    -----",vm.formData)})},error:function(t){console.log(t)}})},getList:function(){$.ajax({type:"post",async:!0,data:"",url:contextPath+"/accountBalanceSheet/getList",dataType:"json",success:function(t){if("100100"===t.code){t.data;vm.accountingLevels=t.data,console.log("vm.accountingLevels=d.data;",vm.accountingLevels),vm.YearAndPeriod(),vm.currency()}},error:function(t){console.log(t)}})},closeWindow:function(){window.parent.closeCurrentTab({name:"核算项目明细表",openTime:this.openTime,url:this.openTime,exit:!0})},SubjectProjectById:function(){console.log(vm.formData.accountingLevel,"===="),this.$refs.test.clearSingleSelect(),$.ajax({type:"post",async:!0,data:{subjectProjectId:vm.formData.accountingLevel},url:contextPath+"/accountBalanceSheet/getSubjectProject",dataType:"json",success:function(t){"100100"===t.code&&(console.log("_d",t),vm.auxiliaryLists=t.data)},error:function(t){console.log(t)}})},print:function(){var e=this;if(console.log(e.lodoPList,"=========that.lodoPList"),e.lodoPList&&e.lodoPList.length)if(e.baseData.standardCurrencyId===e.formData.currency){var t={title:"核算项目明细表",template:1,titleInfo:[],colNames:[{name:"日期",col:"documentDate"},{name:"凭证字号",col:"documentType"},{name:"摘要",col:"documentNumber"},{name:"借方",col:"customerName"},{name:"贷方",col:"summary"},{name:"方向",col:"voucherSize"},{name:"余额",col:"departmentName"}],styleCss:"",colMaxLenght:9,data:e.lodoPList};e.printInfo=t,e.printModalShow(!0)}else{var n=e.lodoPList,a="";'\n                    <tr class=\'thCs\'>\n                        <th rowspan="2" style="width: 6%">日期</th>\n                        <th rowspan="2" style="width: 6%">凭证字号</th>\n                        <th rowspan="2" style="width: 6%">摘要</th>\n                        <th colspan="2" style="width: 12%">借方</th>\n                        <th colspan="2" style="width: 12%">贷方</th>\n                        <th rowspan="2" style="width: 6%">方向</th>\n                        <th colspan="2" style="width: 12%">余额</th>\n                    </tr>\n                    <tr class=\'thCs\'>\n                        <th style="width: 6%">原币</th>\n                        <th style="width: 6%">本位币</th>\n                        <th style="width: 6%">原币</th>\n                        <th style="width: 6%">本位币</th>\n                        <th style="width: 6%">原币</th>\n                        <th style="width: 6%">本位币</th>\n                    </tr>\n                ',n.forEach(function(t){a+="\n                        <tr>\n                            <td>"+e._nullData(t.voucherDate)+"</td>\n                            <td>"+e._nullData(t.voucherGroupName)+"</td>\n                            <td>"+e._nullData(t.explains)+"</td>\n                            <td>"+e._nullData(t.debit)+"</td>\n                            <td>"+e._nullData(t.debitFor)+"</td>\n                            <td>"+e._nullData(t.credit)+"</td>\n                            <td>"+e._nullData(t.creditFor)+"</td>\n                            <td>"+e._direction(t.direction)+"</td>\n                            <td>"+e._nullData(t.balance)+"</td>  \n                            <td>"+e._nullData(t.balanceFor)+"</td>\n                        </tr>\n                    "}),console.log("form",this.form),htPrint({title:"核算项目明细表",template:12,titleInfo:[],data:[],colMaxLenght:10,tbodyInfo:{theadTX:'\n                    <tr class=\'thCs\'>\n                        <th rowspan="2" style="width: 6%">日期</th>\n                        <th rowspan="2" style="width: 6%">凭证字号</th>\n                        <th rowspan="2" style="width: 6%">摘要</th>\n                        <th colspan="2" style="width: 12%">借方</th>\n                        <th colspan="2" style="width: 12%">贷方</th>\n                        <th rowspan="2" style="width: 6%">方向</th>\n                        <th colspan="2" style="width: 12%">余额</th>\n                    </tr>\n                    <tr class=\'thCs\'>\n                        <th style="width: 6%">原币</th>\n                        <th style="width: 6%">本位币</th>\n                        <th style="width: 6%">原币</th>\n                        <th style="width: 6%">本位币</th>\n                        <th style="width: 6%">原币</th>\n                        <th style="width: 6%">本位币</th>\n                    </tr>\n                ',tbodyTX:a,tfootTX:""}})}else e.$Message.info({content:"无打印数据",duration:3})},printModalShow:function(t){this.printModal=t},_nullData:function(t){return t||""},_direction:function(t){return 0===t?"平":1===t?"借":"贷"}},mounted:function(){this.getList(),this.openTime=window.parent.params&&window.parent.params.openTime}});