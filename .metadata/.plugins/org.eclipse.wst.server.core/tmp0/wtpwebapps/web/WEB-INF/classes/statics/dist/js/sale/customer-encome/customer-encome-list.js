"use strict";var custList=new Vue({el:"#cust-list",data:function(){return{stockPriceNo:"",status:"",modalTrigger:!1,modalType:"",stepList:[],approvalTableData:[],dateArr:"",isHideSearch:!0,isHideList:!0,reload:!1,isTabulationHide:!0,selected:[],myTable:"myTable",body:{custPayOrderNo:"",custName:"",businessType:"",saleMenName:"",remark:""},businessTypeList:[{value:"1",label:"预付款"},{value:"2",label:"锁价"}],data_user_list:{url:contextPath+"/saleCustPayOrder/listPage",colNames:["日期","单据编号","单据状态","客户","关联客户订单","来款性质","来款金额","业务员","备注"],colModel:[{name:"createTime",index:"createTime",width:200,align:"center",formatter:function(e,t,a,s){return new Date(e).format("yyyy-MM-dd")}},{name:"custPayOrderNo",index:"custPayOrderNo",width:200,align:"center",formatter:function(e,t,a,s){return $(document).off("click",".updateDetail"+e).on("click",".updateDetail"+e,function(){custList.updateDetail({value:e,grid:t,rows:a,state:s})}),'<a class="updateDetail'+e+'">'+e+"</a>"}},{name:"status",index:"status",width:200,align:"center",formatter:function(e,t,a,s){return 1==e?(console.log(1),"暂存"):2==e?(console.log(1),"待审核"):3==e?(console.log(1),"审核中"):4==e?(console.log(1),"已审核"):5==e?"驳回":void 0}},{name:"custName",index:"custName",width:200,align:"center"},{name:"saleOrderNo",index:"saleOrderNo",width:200,align:"center"},{name:"businessType",index:"businessType",width:200,align:"center",formatter:function(e,t,a,s){return 1==e?"预付款":2==e?"锁价":""}},{name:"payAmount",index:"payAmount",width:200,align:"center"},{name:"saleMenName",index:"saleMenName",width:200,align:"center"},{name:"remark",index:"remark",width:200,align:"center"}]}}},methods:{approval:function(){if(1===this.selected.length){this.stockPriceNo=this.selected[0].custPayOrderNo,this.status=this.selected[0].status,console.log(this.stockPriceNo,this.status);var e=this;e.modalType="approve",e.modalTrigger=!e.modalTrigger}else this.$Modal.info({title:"提示",okText:"确定",content:"只能对单条数据操作!"})},reject:function(){if(1===this.selected.length){this.stockPriceNo=this.selected[0].custPayOrderNo,this.status=this.selected[0].status;var e=this;e.modalType="reject",e.modalTrigger=!e.modalTrigger}else this.$Modal.info({title:"提示",okText:"确定",content:"只能对单条数据操作!"})},approvalOrRejectCallBack:function(e){var t=this;if("100515"==e.result.code){var a=t.selected[0].id;"approve"==t.modalType&&t.ajaxUpdateDocStatusById(a,4),"reject"==t.modalType&&t.ajaxUpdateDocStatusById(a,1)}t.refresh()},ajaxUpdateDocStatusById:function(e,t){var a=this;$.ajax({url:contextPath+"/tSaleStockPrice/save",method:"POST",dataType:"json",contentType:"application/json;charset=utf-8",data:JSON.stringify({id:e,status:t}),success:function(e){"100100"==e.code&&(a.status=t)}})},refresh:function(){this.body={custPayOrderNo:"",custName:"",businessType:"",saleMenName:"",searchCreateTime:"",searchEndTime:"",remark:""},this.dateArr="",this.selected=[],this.reload=!this.reload},search:function(){this.reload=!this.reload},clean:function(){this.refresh()},updateDetail:function(e){var t=e.rows.id;window.parent.activeEvent({name:"客户来款-查看",url:contextPath+"/sale/customer-encome/customer-encome-add.html",params:{allInfo:t,type:"query"}})},del:function(){var t=this,a=!0;if(this.selected.length<1)this.$Modal.info({content:"请选择数据"});else if(this.selected.map(function(e){1!=e.status&&(t.$Modal.info({content:"非暂存状态无法删除"}),a=!1)}),a){console.log(this.selected);for(var e=new Array,s=0;s<this.selected.length;s++)e[s]=this.selected[s].id;$.ajax({type:"post",async:!0,traditional:!0,data:{ids:e},url:contextPath+"/saleCustPayOrder/delete",success:function(e){"100100"==e.code?custList.$Modal.info({content:"删除成功"}):custList.$Modal.info({content:"删除失败！"}),custList.reload=!custList.reload},error:function(e){console.log(e)}})}},add:function(){window.parent.activeEvent({name:"客户来款单-新增",url:contextPath+"/sale/customer-encome/customer-encome-add.html",params:{allInfo:null,type:"add"}})},modifyOrSubmit:function(a){var s=this,n=!0;this.selected.length<1?this.$Modal.info({content:"请选择数据"}):1<this.selected.length?this.$Modal.info({content:"请选择一条数据"}):(this.selected.map(function(e){var t;1!=e.status&&(0==a?t="非暂存状态无法修改":1==a&&(t="非暂存状态无法提交"),s.$Modal.info({content:t}),n=!1)}),n&&(0==a&&window.parent.activeEvent({name:"客户来款单-修改",url:contextPath+"/sale/customer-encome/customer-encome-add.html",params:{allInfo:this.selected[0].id,type:"modify"}}),1==a&&$.ajax({type:"post",async:!0,traditional:!0,data:{id:this.selected[0].id},url:contextPath+"/saleCustPayOrder/listSubmit",success:function(e){console.log(e),"100100"==e.code?custList.$Modal.info({content:"提交成功"}):"-1"==e.code&&(null!=e.data.OrderDate&&custList.$Modal.warning({title:"提示信息",content:"下单日期未选择！"}),null!=e.data.BusinessType&&custList.$Modal.warning({title:"提示信息",content:e.data.BusinessType}),null!=e.data.CustName&&custList.$Modal.warning({title:"提示信息",content:e.data.CustName}),null!=e.data.GoldColor&&custList.$Modal.warning({title:"提示信息",content:e.data.GoldColor}),null!=e.data.PayAmount&&custList.$Modal.warning({title:"提示信息",content:e.data.PayAmount})),custList.reload=!custList.reload},error:function(e){console.log(e)}})))},exit:function(){},changeDate:function(e){this.body.searchCreateTime=""==e[0]?"":e[0].replace(/\//g,"-")+" 00:00:00",this.body.searchEndTime=""==e[1]?"":e[1].replace(/\//g,"-")+" 23:59:59"}}});