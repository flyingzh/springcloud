"use strict";var balance=new Vue({el:"#balanceSheet",data:function(){var a=this;return{dateTime:[],currDateTime:"",clickedRow:{},clickedCol:"",clickedIndex:0,objDataList:{},objFormula:{},detailVisible:!1,detailTitle:"",columnsDataList:[{title:"资产",key:"assetField",width:210,align:"left",render:function(t,e){return 1!=e.row.assetIsCompute?t("div",{props:{type:"text",size:"small"}},""+e.row.assetField):t("div",[t("Button",{props:{type:"text",size:"small"},on:{click:function(){a.clickedRow=e.row,a.clickedIndex=e.index,a.editMark(e,"assetField")}}},""+e.row.assetField)])}},{title:"行次",key:"assetLineNum",width:70,align:"center"},{title:"期末数",key:"assetAmount1",width:120,align:"center",render:function(t,e){if(e.row.assetAmount1)return t("div",[t("Button",{props:{type:"text",size:"small"},on:{click:function(){a.editMark(e,"assetAmount1")}}},e.row.assetAmount1)])}},{title:"年初数",key:"assetAmount2",width:120,align:"center",render:function(t,e){if(e.row.assetAmount2)return t("div",[t("Button",{props:{type:"text",size:"small"},on:{click:function(){a.editMark(e,"assetAmount2")}}},e.row.assetAmount2)])}},{title:"负债和所有者（或股东）权益",key:"debtField",width:220,align:"left",render:function(t,e){return e.row.debtField?1!=e.row.debtIsCompute?t("div",{props:{type:"text",size:"small"}},""+e.row.debtField):t("div",[t("Button",{props:{type:"text",size:"small"},on:{click:function(){a.clickedRow=e.row,a.clickedIndex=e.index,a.editMark(e,"debtField")}}},""+e.row.debtField)]):void 0}},{title:"行次",key:"debtLineNum",width:70,align:"center"},{title:"期末数",key:"debtAmount1",width:120,align:"center",render:function(t,e){if(e.row.debtAmount1)return t("div",[t("Button",{props:{type:"text",size:"small"},on:{click:function(){a.editMark(e,"debtAmount1")}}},e.row.debtAmount1)])}},{title:"年初数",key:"debtAmount2",width:120,align:"center",render:function(t,e){if(e.row.debtAmount2)return t("div",[t("Button",{props:{type:"text",size:"small"},on:{click:function(){a.editMark(e,"debtAmount2")}}},e.row.debtAmount2)])}}],dataList:[],dataListStatus:!1,editTitle:"",editId:"",editName:"",editAyp:"",editVisable:!1}},filters:{},created:function(){this._ajaxDateTime()},watch:{dataList:{handler:function(){},deep:!0}},methods:{exportExcel:function(){var t=this.currDateTime;window.frames.exportIframe.location.href=rcContextPath+"/balanceSheet/exportExcel?accountYearPeriod="+t},_trialBalance:function(){var t=this;if($.isEmptyObject(t.dataList))return!1;var e=t.dataList.find(function(t){return 91===t.assetId}),a=t.dataList.find(function(t){return 124===t.debtId}),i=e.assetAmount1,n=e.assetAmount2,o=a.debtAmount1,s=a.debtAmount2;i==o&&n==s||t.$Message.info({content:"资产负债表不平，请检查账务处理、报表项目公式设置",duration:3})},_ajaxDateTime:function(){var e=this,t=rcContextPath+"/report/accountPeriodList";$.ajax({type:"post",async:!0,data:"",url:t,dataType:"json",success:function(t){e.dateTime=t.data,t.data&&t.data.length&&(e.currDateTime=e.dateTime[0].value),e.$nextTick(function(){e._ajaxGetFormData()})},error:function(t){console.log(t)}})},dateChange:function(){this._ajaxGetFormData()},editClose:function(){this.editVisable=!1},_ajaxGetFormData:function(){var e=this,t=e.currDateTime.split("_"),a=rcContextPath+"/report/balanceSheet?accountYear="+t[0]+"&accountPeriod="+t[1];$.ajax({type:"post",async:!0,data:"",url:a,dataType:"json",success:function(t){"100100"==t.code&&(e.dataList=t.data,e.processDataList(t.data),e.$nextTick(function(){e.reCalculate(),e._trialBalance()}))},error:function(t){console.log(t)}})},processDataList:function(t){var e={},r={};$.each(t,function(t,a){var i={},n={},o="",s="";$.each(a,function(t,e){"assetLineNum"==t&&(o=e),"debtLineNum"==t&&(s=e),/^asse/.test(t)?(i[t]=e,"asseFormula"==t&&null!=e&&(r[a.assetLineNum]={type:"asset",formula:a.asseFormula,lineNumber:a.asseFormula.split(/[+-]/),operator:a.asseFormula.replace(/\d/g,"").split("")})):/^debt/.test(t)&&(n[t]=e,"debtFormula"==t&&null!=e&&(r[a.debtLineNum]={type:"debt",formula:a.debtFormula,lineNumber:a.debtFormula.split(/[+-]/),operator:a.debtFormula.replace(/\d/g,"").split("")}))}),e[o]=i,e[s]=n}),this.objDataList=e,this.objFormula=r},reCalculate:function(){var i=this;i.processDataList(i.dataList);var t=i.dataList,c=(i.objDataList,i.objFormula);$.each(i.dataList,function(t,a){var e=function(t){if(t in c){i.processDataList(i.dataList);var n=i.objDataList,o=c[t],e=o.type,s=e+"Amount1",r=e+"Amount2",d="",u="";$.each(o.lineNumber,function(t,e){var a=o.operator,i=void 0!==a[t]?a[t]:"";d+="("+n[Number(e)][s]+")"+i,u+="("+n[Number(e)][r]+")"+i}),a[s]=math.eval(d),a[r]=math.eval(u)}};""!=a.assetLineNum&&""!=a.debtLineNum&&(e(Number(a.assetLineNum)),e(Number(a.debtLineNum)))}),i.dataList=t},saveFormula:function(t){this.dataList.splice(this.clickedIndex,1,t),this.reCalculate()},refresh:function(){console.log("分页改变")},editClick:function(t){console.log(t)},editMark:function(t,e){var a=this;a.clickedCol=e,a.editTitle="编辑公式 - "+t.row[e],a.editName=t.row[e],a.editAyp=a.currDateTime,"assetField"===e?(a.editId=t.row.assetId,this.editVisable=!0):"debtField"===e?(a.editId=t.row.debtId,this.editVisable=!0):"assetAmount1"!==e&&"assetAmount2"!==e&&"debtAmount1"!==e&&"debtAmount2"!==e||console.log("跳转总账页面")},testAA:function(){console.log(this.$refs.currentRowTable,"==this.$refs.currentRowTable")}},computed:{currentTabComponent:function(){return"tab-"+this.currentTab.toLowerCase()}},mounted:function(){}});