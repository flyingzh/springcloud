"use strict";var category=new Vue({el:"#productLevel",data:function(){var o=this;return{isShow:!1,isEdit:!1,reload:!1,isSave:!0,isSearchHide:!0,selected:[],openTime:"",userName:"",isUpdate:!1,productType:[{label:"钻石",value:"1"},{label:"黄金",value:"2"},{label:"白银",value:"3"},{label:"项链",value:"4"},{label:"金大祥的产品类别",value:"5"}],status:[{label:"有效",value:1},{label:"无效",value:0}],body:{name:"",startTime:"",endTime:"",status:""},addBody:{code:"",name:"",remark:"",status:1,createTime:"",createName:""},data_config:{url:contextPath+"/tmainproductcategory/list",colNames:["主营商品类别代码","主营商品类别","有效状态","备注","创建人","创建时间"],colModel:[{name:"code",index:"code",width:150,align:"left",formatter:function(e,t,a,r){return $(document).off("click",".detail"+e).on("click",".detail"+e,function(){o.detailClick({value:e,grid:t,rows:a,state:r})}),'<a class="detail'+e+'">'+e+"</a>"}},{name:"name",index:"name",width:180,align:"left",sortable:!1},{name:"status",index:"status",width:150,align:"left",formatter:function(e,t,a,r){return 1==e?"有效":"无效"}},{name:"remark",index:"remark",width:150,align:"left",sortable:!1},{name:"createName",index:"createName",width:180,align:"left"},{name:"createTime",index:"createTime",width:180,sortable:!1,align:"left"}]}}},methods:{hideSearch:function(){this.isSearchHide=!this.isSearchHide,$(".chevron").css("top","")},search:function(){this.reload=!this.reload},clear:function(){this.$refs.start.date="",this.$refs.end.date="",this.body={name:"",startTime:"",endTime:"",status:""}},exit:function(){window.parent.closeCurrentTab({exit:!0,openTime:this.openTime})},add:function(){this.addBody.createTime=(new Date).Format("yyyy-MM-dd hh:mm:ss"),this.addBody.createName=category.userName,this.isShow=!0},copy:function(){if(1===this.selected.length){var e=this.selected[0];e&&this.queryById(e,!1,!0)}else layer.alert("只能对单行数据操作!")},update:function(e,t){$.ajax({type:"POST",url:e,contentType:"application/json",data:JSON.stringify(t),dataType:"json",success:function(e){"100100"===e.code?layer.alert("操作成功",{icon:1,end:function(){category.cancel(),category.reload=!category.reload}}):layer.alert(e.msg,{icon:0}),category.isSave=!0},error:function(e){console.log("服务器出错")}})},del:function(){0!=this.selected.length?layer.confirm("当前数据有可能被引用，会影响数据准确性，确认是否删除？",{btn:["确认","取消"],btn1:function(){$.ajax({type:"POST",url:contextPath+"/tmainproductcategory/delete",contentType:"application/json",data:JSON.stringify(category.selected),dataType:"json",success:function(e){"100100"===e.code?(layer.alert(e.data,{icon:1}),category.selected=[],category.reload=!category.reload):layer.alert(e.msg,{icon:0})},error:function(e){layer.alert("数据删除失败",{icon:0})}})}}):layer.alert("请选择行!")},modify:function(){if(1===this.selected.length){var e=this.selected[0];e&&this.queryById(e,!1,!1)}else layer.alert("只能对单条数据进行操作!")},save:function(){if($("#add-product-category").valid()){this.isSave=!1;var e=this.addBody,t=contextPath+"/tmainproductcategory/save";e.id&&(t=contextPath+"/tmainproductcategory/update"),this.update(t,e)}},detailClick:function(e){var t=e.rows.id;t&&this.queryById(t,!0,!1)},queryById:function(e,t,a){$.ajax({type:"POST",url:contextPath+"/tmainproductcategory/info/"+e,data:{id:e},dataType:"json",success:function(e){"100100"===e.code&&(category.isEdit=t,a?(category.addBody.remark=null==e.data.remark?"":e.data.remark,category.addBody.status=e.data.status,category.addBody.createTime=(new Date).Format("yyyy-MM-dd hh:mm:ss"),category.addBody.createName=category.userName):(category.isUpdate=!0,category.addBody=e.data),category.isShow=!0)},error:function(e){console.log("服务器出错")}})},cancel:function(){this.addBody={code:"",name:"",remark:"",status:1,createTime:""},this.isUpdate=!1,this.isShow=!1,this.isEdit=!1,$("#add-product-category").validate().resetForm()},initFormValidate:function(){var e={onfocusout:function(e){$(e).valid()},onkeyup:!1,rules:{code:{isChar:!0,required:!0,remote:{url:contextPath+"/tmainproductcategory/checkcode",type:"post",dataType:"json",data:{id:function(){return null==category.addBody.id?"":category.addBody.id}},dataFilter:function(e){return"100100"===JSON.parse(e).code}}},name:{required:!0,remote:{url:contextPath+"/tmainproductcategory/checkname",type:"post",dataType:"json",data:{id:function(){return null==category.addBody.id?"":category.addBody.id},name:function(){return category.addBody.name}},dataFilter:function(e){return"100100"===JSON.parse(e).code}}}},messages:{code:{isChar:"请正确输入名称!",required:"请填写编码!",remote:"该编码已存在!"},name:{isChar:"请正确输入名称!",required:"请填写名称!",remote:"该名称已存在!"}}};$("#add-product-category").validate(e)}},mounted:function(){this.userName=layui.data("user").username,this.initFormValidate(),jQuery.validator.addMethod("isChar",function(e,t){return/^([a-zA-Z0-9]+)$/.test(e)},"编码格式错误!"),this.openTime=window.parent.params.openTime}});