"use strict";var currencyVm=new Vue({el:"#paraLevel",data:function(){var o=this;return{isSearchHide:!0,isDisable:!0,openTime:"",certificateType:[],body:{commodityCode:"",code:"",commodityId:"",createTimeEnd:"",createTimeStart:""},goldTableHeader:[],goldBoms:[],goldAssistAttr:[],goldAssistAttrAll:[],goldItemList:[],stonesTableHeader:[],stonesBoms:[],stonesAssistAttr:[],stonesAssistAttrAll:[],stonesItemList:[],partTableHeader:[],partBoms:[],partAssistAttr:[],partAssistAttrAll:[],partItemList:[],weightUnit:[],isShow:!1,isLock:!1,isAdd:!1,reload:!1,selected:[],offices:[],standBOM:[],setting1:{data:{simpleData:{enable:!0,idKey:"id",pIdKey:"parentId",rootPId:-1},key:{name:"commodityCode"}},callback:{onClick:this.clickEvent}},formType:[{value:1,name:"主石"},{value:0,name:"副石"}],type:[{value:1,label:"客户BOM"},{value:0,label:"标准BOM"}],weightWayArr:[{value:1,name:"范围值"},{value:0,name:"固定值"}],checkStatus:[{value:1,label:"已审核"},{value:2,label:"审核中"},{value:0,label:"待审核"}],add:{},data_config:{url:contextPath+"/tbasebom/list",colNames:["BOM编号","BOM类型","父项商品编码","父项商品名称","状态","创建日期","审核日期"],colModel:[{name:"code",index:"code",width:90,align:"left",formatter:function(t,e,a,s){return $(document).off("click",".detail"+t).on("click",".detail"+t,function(){o.detailClick({value:t,grid:e,rows:a,state:s})}),'<a class="detail'+t+'">'+t+"</a>"}},{name:"type",index:"",width:90,align:"left",formatter:function(t,e,a,s){return 1==t?"客户BOM":"标准BOM"}},{name:"commodityCode",index:"",width:80,align:"left"},{name:"commodityName",index:"",width:80,align:"left"},{name:"checkStatus",index:"",width:80,align:"left",formatter:function(s,t,e,a){var o="";return currencyVm.checkStatus.forEach(function(t,e,a){if(t.value==s)return o=t.label,!1}),o}},{name:"createTime",index:"",width:150,align:"left",sortable:!1},{name:"updateTime",index:"",width:150,align:"left",sortable:!1}]}}},methods:{hideSearch:function(){this.isSearchHide=!this.isSearchHide,$(".chevron").css("top","")},init:function(){var e=this;e.certificateType=getCodeList("base_Condition"),$.ajax({type:"POST",url:contextPath+"/tbaseunitgroup/listByNoPage",success:function(t){e.weightUnit=t.data}}),$.ajax({url:contextPath+"/tBaseAssistAttr/queryAll?rangeUse=attr_ranges_gold",type:"POST",dataType:"json",success:function(t){e.goldTableHeader=e.sortTabalHeader(t.data)},error:function(){alert("服务器出错")}}),$.ajax({url:contextPath+"/tBaseAssistAttr/queryAll?rangeUse=attr_ranges_stone",type:"POST",dataType:"json",success:function(t){e.stonesTableHeader=e.sortTabalHeader(t.data)},error:function(){alert("服务器出错")}}),$.ajax({url:contextPath+"/tBaseAssistAttr/queryAll?rangeUse=attr_ranges_part",type:"POST",dataType:"json",success:function(t){e.partTableHeader=e.sortTabalHeader(t.data)},error:function(){alert("服务器出错")}})},initBom:function(t,e,a){for(var s=0;s<t.length;s++){var o=t[s].assistAttrList,i=o.length;a.push(o);for(var n=0;n<e.length;n++){e[n].data[s];for(var r=0;r<i;r++)o[r].id===e[n].id&&e[n].data.splice(s,1,o[r].tBaseAssistAttrValuess)}}},sortTabalHeader:function(t){return t.map(function(t){t.data=[],t.isPush=!1}),t},initTableData:function(t,e){for(var a=[],s=0;s<t.length;s++)a.push({attrValueIds:"",id:t[s].id,isPush:""});e.push(a)},allTable:function(a,s,t){var o=this;t.map(function(t,e){o.initTableData(a,s)})},showSelectOption:function(t,s){t.map(function(t,e){t.assistAttrList.map(function(a,t){s[e].map(function(t,e){t.id===a.id&&(t.attrValueIds=a.attrValueIds)})})})},itemList:function(t,i){t.map(function(t,e){var a=t.commodityCode,s=t.commodityName,o=t.commodityId;i.push([{code:a,name:s,id:o}])})},itemStoneList:function(t,i){t.map(function(t,e){var a=t.commodityCode,s=t.commodityName,o=t.commodityId;i.push([{code:a,name:s,id:o}])})},search:function(){this.reload=!this.reload},add_click:function(){this.isShow=!0,this.isAdd=!0},cancel:function(){this.isShow=!1,this.isLock=!1,this.isAdd=!1,this.initAddBody()},cancle_out:function(){window.parent.closeCurrentTab({exit:!0,openTime:this.openTime})},clear:function(){var t=$.fn.zTree.getZTreeObj("tree").getSelectedNodes();$.fn.zTree.getZTreeObj("tree").cancelSelectedNode(t[0]),this.$refs.start.date="",this.$refs.end.date="",this.body={commodityCode:"",code:"",commodityId:"",createTimeEnd:"",createTimeStart:""}},view:function(){if(1===this.selected.length){var t=this.selected[0];t&&this.info(t,!0)}else layer.alert("查看只能对单条数据进行操作",{icon:0})},modify:function(){},del:function(){0!=this.selected.length?layer.confirm("当前数据有可能被引用，会影响数据准确性，确认是否删除？",{btn:["确认","取消"],btn1:function(){$.ajax({type:"POST",url:contextPath+"/tbankaccount/delete",contentType:"application/json",data:JSON.stringify(currencyVm.selected),dataType:"json",success:function(t){"100100"==t.code?layer.alert("数据删除成功",{icon:1}):layer.alert("数据删除失败",{icon:0})},error:function(t){layer.alert("数据删除失败",{icon:0})}})}}):layer.alert("请选择行!")},detailClick:function(t){console.log("=================");var e=t.rows.id;e&&this.info(e,!0)},clickEvent:function(t,e,a){console.log(a),this.body.commodityId=a.commodityId,this.search()},selectGroup:function(t){vm.groupId=t.id},info:function(t,e){if(t){var a=this;a.goldItemList=[],a.goldBoms=[],a.stonesItemList=[],a.stonesBoms=[],a.partItemList=[],a.partBoms=[],$.ajax({type:"POST",url:contextPath+"/tbasebom/info/"+t,contentType:"application/json",dataType:"json",async:!1,success:function(t){"100100"===t.code?(console.log(t.data),currencyVm.isShow=!0,a.add=t.data,a.goldBoms=t.data.goldBoms,a.allTable(a.goldTableHeader,a.goldAssistAttr,a.goldBoms),a.itemList(a.goldBoms,a.goldItemList),a.showSelectOption(a.goldBoms,a.goldAssistAttr),a.initBom(a.goldBoms,a.goldTableHeader,a.goldAssistAttrAll),a.stonesBoms=t.data.stonesBoms,a.allTable(a.stonesTableHeader,a.stonesAssistAttr,a.stonesBoms),a.itemStoneList(a.stonesBoms,a.stonesItemList),a.showSelectOption(a.stonesBoms,a.stonesAssistAttr),a.initBom(a.stonesBoms,a.stonesTableHeader,a.stonesAssistAttrAll),a.partBoms=t.data.partBoms,a.allTable(a.partTableHeader,a.partAssistAttr,a.partBoms),a.itemList(a.partBoms,a.partItemList),a.showSelectOption(a.partBoms,a.partAssistAttr),a.initBom(a.partBoms,a.partTableHeader,a.partAssistAttrAll),console.log(a.goldAssistAttr)):console.log("服务器出错")},error:function(t){console.log("服务器出错")}})}},initAddBody:function(){this.add={}},initStandBom:function(){var e=this;$.ajax({type:"POST",url:contextPath+"/tbasebom/listStandAll",dataType:"json",async:!1,success:function(t){console.log(t),"100100"===t.code?(e.standBOM=t.data,0<e.standBOM.length&&(e.$refs.my_tree.nodeData=t.data,e.$refs.my_tree.loadData())):console.log("服务器出错")},error:function(t){console.log("服务器出错")}})}},mounted:function(){this.initAddBody(),this.initStandBom(),this.init(),this.openTime=window.parent.params.openTime}});