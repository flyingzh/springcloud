"use strict";var ve=new Vue({el:"#asset-class",data:function(){return{tid:"zTreeAssetClass",openTime:"",writeIsChange:!0,parentNoNeeded:!0,baseData:{sobId:0,measurementsList:[]},addData:{id:0,advancedMethod:"",className:"",durableYears:"",measureGroupId:"",measurementsId:"",fixedAssetsSubjectName:"",fixedAssetsSubject:"",impairmentPreparationSubjectName:"",impairmentPreparationSubject:"",classCode:"",parentId:0,parentCode:"",netResidualRate:"",cumulativeDiscountSubjectName:"",cumulativeDiscountSubject:"",cardCodeRule:"",isDepreciate:2,measurementsList:[]},advancedMethodList:[],organizationList:[],nodesList:{},nodes:[],setting:{callback:{onClick:this.clickEvent}},isDisabled:!0,selected:"",showdepreciation:!1,treeUrl:"",treeSetting:{callback:{onClick:this.treeClickCallBack}},canAdd:!1,canEdit:!1,showAssetClass:!1,subjectVisable:!1,subjectTpye:""}},methods:{showSubjectVisable:function(e){this.subjectVisable=!0,console.log("type",e),this.subjectTpye=e},subjectClose:function(){this.subjectVisable=!1},subjectData:function(e){console.log(e,"====treeNode");var a=this;switch(this.subjectTpye){case 1:a.addData.fixedAssetsSubject=e.id,a.addData.fixedAssetsSubjectName=e.subjectCode+" "+e.subjectName;break;case 2:a.addData.impairmentPreparationSubject=e.id,a.addData.impairmentPreparationSubjectName=e.subjectCode+" "+e.subjectName;break;case 3:a.addData.cumulativeDiscountSubject=e.id,a.addData.cumulativeDiscountSubjectName=e.subjectCode+" "+e.subjectName}},treeClickCallBack:function(e,a,t){var s=this;console.log(t,"====treeClickCallBack"),s.addData.parentCode=t.code,s.addData.parentId=t.id,s.showAssetClass=!1},treeBeforeClick:function(e,a,t){return!a.isParent},showAssetClassTree:function(e){!0!==this.showAssetClass?this.showAssetClass=e:this.showAssetClass=!1},_nullData:function(e){return e||""},formartMoney:function(e){return null==e||0==e?"":accounting.formatNumber(e,2,",")},modify:function(e){var a=this;if("add"===e)a.clearAddData(),a.writeIsChange=!1;else if("edit"===e){if(!a.addData.id)return void a.$Message.warning({content:"请先选择一条数据.",duration:3});a.writeIsChange=!1}},delFun:function(){var a=this;a.addData.id?(console.log("删除前的id"),console.log(a.addData.id),$.ajax({type:"post",url:contextPath+"/assetsclassescontroller/deleteAC",data:{id:a.addData.id},success:function(e){"100100"==e.code?(a.$Message.success({content:e.msg,duration:.8,closable:!0}),a.delayRefreshFun()):layer.alert(e.msg)}})):layer.alert("请选择一条数据.")},saveFun:function(){var a=this,e=a.addData;this.writeIsChange?a.$Message.warning({content:"请点新增或者修改.",duration:3}):e.className&&e.classCode?(console.log("新增/修改时准备传回后台的参数 === "),console.log(e),$.ajax({type:"post",url:contextPath+"/assetsclassescontroller/saveOrUpdate",data:JSON.stringify(e),contentType:"application/json;charset=utf-8",dataType:"json",success:function(e){"100100"==e.code?(a.writeIsChange=!0,a.addData.id=e.data.id,console.log("保存/修改成功后返回的id值==="+a.addData.id),a.$Message.success({content:e.msg,duration:1,closable:!0}),a.delayRefreshFun()):layer.alert(e.msg)}})):layer.alert("名称和编码为必填项!")},cancelFun:function(){window.parent.closeCurrentTab({name:"资产类别",openTime:this.openTime,exit:!0})},refreshFun:function(){console.log("刷新refreshFun()"),window.location.reload()},init:function(){var s=this;s.advancedMethodList=getCodeList("fixedAssets_depreciation"),0!==s.advancedMethodList.length?$.ajax({type:"post",url:contextPath+"/assetsclassescontroller/initPage",data:null,success:function(e){if("100100"!=e.code){var a="数据初始化失败!";return result.hasOwnProperty("data")&&(a=e.msg),void layer.alert(a)}var t=e.data;s.initAssetsClassesTree(),s.organizationList=t.orgList,s.baseData.measureGroupList=t.measureGroupList,s.$nextTick(function(){s.baseData.sobId=t.sobId})}}):layer.alert("计量单位数据初始化失败!")},clickEvent:function(e,a,t){var s=this;s.isDisabled=!1;var n=s.$ztree.getSelectedNodes();s.selected=n[0].id,console.log(s.selected),$.ajax({type:"post",url:contextPath+"/assetsclassescontroller/getClassesById",data:{id:s.selected},success:function(e){console.log(e),"100100"==e.code?(s.$Message.loading({content:"查询中...",duration:.5,closable:!0}),s.addData=e.data,s.baseData.measurementsList=s.addData.measurementsList):layer.alert(e.msg)}})},initAssetsClassesTree:function(){console.log("initAssetsClassesTree");var a=this;$.ajax({type:"post",url:contextPath+"/assetsclassescontroller/assetsClassesList",data:null,success:function(e){"100100"==e.code?a.nodes=e.data:layer.alert(e.msg)}})},measureChange:function(e){if(e){var t=this;$.ajax({type:"post",url:contextPath+"/assetsclassescontroller/measureChange",data:{measureGroupId:e},success:function(e){if("100100"==e.code&&null!=e.data)t.baseData.measurementsList=e.data,t.$refs.addMeasurementsId.reset(),t.$nextTick(function(){t.baseData.measurementsList&&0!==t.baseData.measurementsList.length&&(t.addData.measurementsId=t.baseData.measurementsList[0].id)});else{var a="切换计量单位组异常!";e.msg&&(a=e.msg),t.$Message.error({content:a,duration:3,closable:!0})}}})}},clearAddData:function(){var e=this.addData;e.id=0,e.className="",e.durableYears="",e.fixedAssetsSubjectName="",e.fixedAssetsSubject="",e.impairmentPreparationSubjectName="",e.impairmentPreparationSubject="",e.classCode="",e.parentId="",e.parentCode="",e.netResidualRate="",e.cumulativeDiscountSubjectName="",e.cumulativeDiscountSubject="",e.cardCodeRule="",e.isDepreciate=2,e.advancedMethod="",e.measureGroupId="",e.measurementsId=""},delayRefreshFun:function(){var e=this;setTimeout(function(){e.refreshFun()},800)},classCodeChange:function(){var e=this.addData.classCode;console.log(e),this.parentNoNeeded="01"==e||"02"==e||"03"==e||"04"==e||"05"==e}},mounted:function(){this.init(),this.openTime=window.parent.params&&window.parent.params.openTime},watch:{}});