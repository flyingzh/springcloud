"use strict";var parvm=new Vue({el:"#paraLevel",data:function(){return{isShow:!1,isView:!1,reload:!1,codeFlag:!1,disabledFlag:!1,parentNameFlag:!0,buttonFlag:!0,openTime:"",selected:[],treeName:"",setting1:{data:{simpleData:{enable:!0,idKey:"id",pIdKey:"parentId"},key:{name:"styleName"}},callback:{onClick:this.clickEvent}},treeUrl:contextPath+"/tbasestylecategory/list",tree:{id:"",name:"",customCode:"",parentId:""},body:{id:"",styleName:"",styleCode:"",codingCodeRules:"",parentId:"",parentName:"",status:1,isDel:"",remark:"",organizationId:"",customCode:""}}},methods:{clickEvent:function(e,t,a){$("#my_from").validate().resetForm(),this.tree.id=a.id,this.tree.parentId=a.parentId,this.tree.name=a.styleName,this.tree.customCode=a.customCode,0!=a.parentId&&null!=a.parentId?parvm.queryStyle(!0):this.isShow=!1},queryStyle:function(t){$.ajax({type:"POST",url:contextPath+"/tbasestylecategory/info",data:{id:this.tree.id},success:function(e){parvm.body=e.data,parvm.tree.customCode=e.data.customCode,parvm.isShow=!0,parvm.codeFlag=!0,parvm.disabledFlag=t}})},addStyle:function(){this.tree.id?(parvm.codeFlag=!1,parvm.disabledFlag=!1,parvm.clear(),parvm.buttonFlag=!0,parvm.body.parentName=this.tree.name,parvm.isShow=!0):layer.alert("请先选择一条款式类别!")},modifyStyle:function(){this.tree.id?0!=this.tree.parentId&&null!=this.tree.parentId&&(this.queryStyle(!1),parvm.buttonFlag=!0):layer.alert("请先选择一条款式类别!")},save:function(){var t=this,a=$.fn.zTree.getZTreeObj("tree"),r=a.getSelectedNodes();if(0!=r.length&&$("form").valid()){var e=contextPath+"/tbasestylecategory/update";parvm.body.id||(e=contextPath+"/tbasestylecategory/save",parvm.body.parentId=parvm.tree.id,parvm.body.id=parvm.tree.id,parvm.body.customCode=parvm.tree.customCode),t.buttonFlag=!1,$.ajax({type:"POST",url:e,contentType:"application/json",data:JSON.stringify(parvm.body),success:function(e){t.buttonFlag=!0,"100100"===e.code?(layer.alert(e.msg),parvm.body.id?(r[0].styleName=parvm.body.styleName,r[0].styleCode=parvm.body.styleCode,r[0].codingCodeRules=parvm.body.codingCodeRules,r[0].status=parvm.body.status,r[0].remark=parvm.body.remark,a.updateNode(r[0])):(a.addNodes(r[0],e.data),parvm.clear(),parvm.isShow=!1)):layer.alert(e.msg)}})}},delStyle:function(){if(this.tree.id){var a=$.fn.zTree.getZTreeObj("tree"),r=a.getSelectedNodes();if(0!=r.length&&0!=r[0].parentId&&null!=r[0].parentId){var e=r[0].children;null!=e&&0<e.length?layer.alert("该类别下存在子类别，不能被删除!"):layer.confirm("当前数据有可能被引用，会影响数据准确性，确认是否删除？",{btn:["确定","取消"]},function(e,t){$.ajax({type:"POST",url:contextPath+"/tbasestylecategory/delete",data:{id:parvm.tree.id},success:function(e){"100100"==e.code?(layer.closeAll("dialog"),layer.msg(e.msg,{icon:1,time:1e3}),a.removeNode(r[0]),parvm.isShow=!1,parvm.clear(),parvm.tree.id=""):layer.alert(e.msg)},error:function(e){console.log("error")}})})}}else layer.alert("请选择款式类别!")},clear:function(){this.body={id:"",styleName:"",styleCode:"",codingCodeRules:"",parentId:"",parentName:"",status:1,isDel:"",remark:"",organizationId:""}},initFormValidate:function(){var e={onfocusout:function(e){$(e).valid()},onkeyup:!1,rules:{styleCode:{required:!0,remote:{url:contextPath+"/tbasestylecategory/infoByCodeAndNameAndRule",type:"post",dataType:"json",data:{id:function(){return null==parvm.body.id?"":parvm.body.id}},dataFilter:function(e,t){return"100100"===JSON.parse(e).code}}},styleName:{required:!0,remote:{url:contextPath+"/tbasestylecategory/infoByCodeAndNameAndRule",type:"post",dataType:"json",data:{id:function(){return null==parvm.body.id?"":parvm.tree.id}},dataFilter:function(e,t){return"100100"===JSON.parse(e).code}}},codingCodeRules:{isChar:!0,required:!0,remote:{url:contextPath+"/tbasestylecategory/infoByCodeAndNameAndRule",type:"post",dataType:"json",data:{parentId:function(){return parvm.tree.id}},dataFilter:function(e,t){return"100100"===JSON.parse(e).code}}}},messages:{styleCode:{required:"请填写编码!",remote:"款式类别代码已存在!"},styleName:{required:"请填写名称!",remote:"款式类别名称已存在!"},codingCodeRules:{required:"请填写编码取码规则!",remote:"款式类别编码规则取码已存在!"}}};$("#my_from").validate(e)},getUser:function(){$.ajax({type:"POST",url:contextPath+"/tbaseunit/findUser",success:function(e){console.log(e)}})},copy:function(){console.log("进复制了。。。。"),this.tree.id?(parvm.buttonFlag=!0,parvm.clear(),$.ajax({type:"POST",url:contextPath+"/tbasestylecategory/info",data:{id:this.tree.id},success:function(e){console.log(e),parvm.body.customCode=e.data.parentCustonCode,parvm.body.parentName=e.data.parentName,parvm.body.status=e.data.status,parvm.body.remark=e.data.remark}}),parvm.codeFlag=!1,parvm.disabledFlag=!1):layer.alert("请先选择一条款式类别!")},exit:function(){window.parent.closeCurrentTab({exit:!0,openTime:this.openTime})}},created:function(){},mounted:function(){this.initFormValidate(),jQuery.validator.addMethod("isChar",function(e,t){return/^\w$/.test(e)},"编码格式错误!"),jQuery.validator.addMethod("isNumOrChar",function(e,t){return/^([a-zA-Z0-9]+)$/.test(e)},"编码格式错误!"),this.openTime=window.parent.params.openTime}});