"use strict";function _defineProperty(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}var vm=new Vue({el:"#sale-settlement",data:function(){var e;return _defineProperty(e={area:{},areaInit:{isInit:!1,province:"",city:"",county:"",detail:"",disabled:!0},openTime:"",model10:[],list:[],viewShow:!1,flag:0,info:"",customer:{name:"",Num:""},temp:!0,isShow:!1,orderShow:!1,checked:[],isDisable:!0,approveComment:"",isSearchHide:!0,reload:!1,selected:[],modalTrigger:!1,modalType:"",steplist:[],approvalTableData:[],isTabulationHide:!0,documentNo:"",documentStatus:"",createTime:"",saleDeposit:{id:"",depositNo:"",saleOrderNo:"",organizationId:"",organizationName:"",customerId:"",customerNo:"",customerName:"",totalReceDepositAmount:0,totalPaidDepositAmount:0,payWay:[],status:1,remark:"",del:"",createId:"",createName:"",createTime:"",depositDate:"",updateId:"",updateName:"",dateTime:"",auditId:"",auditName:"",auditTime:""},payList:[{value:"转账",label:"转账"},{value:"微信",label:"微信"},{value:"支付宝",label:"支付宝"},{value:"现金",label:"现金"}],saleDepositDetailList:[],saleCustInfo:{custNo:"",detail:"",documentNo:"",documentType:"",email:"",id:"",name:"",organizationId:"",phone:"",area:"",province:"",city:"",county:"",weChatNo:"",zipCode:""},addlist:{custOrderNo:"",paidDepositAmount:"",receDepositAmount:"",orderAmount:""},delIndex:"",tabId:"customerTab"},"reload",!0),_defineProperty(e,"selected",[]),_defineProperty(e,"data_user_list",{url:contextPath+"/deposit/findCustomerCode",colNames:["操作","客户名称","客户编码"],colModel:[{name:"id",index:"invdate",width:80,align:"center",formatter:function(e,t,i,s){return $(document).off("click",".select"+i.id).on("click",".select"+i.id,function(){vm.confirm(e,t,i,s)}),'<a type="primary" class="select'+i.id+'">选取</a>'}},{name:"name",index:"name",width:300,align:"center"},{name:"code",index:"code",width:300,align:"center"}],multiselect:!1}),_defineProperty(e,"data_order_list",{url:contextPath+"/deposit/findSaleCustOrderVoPage",colNames:["单据编号","日期","业务状态","客户","客户编码","订单金额","应收定金","实收定金","序号"],colModel:[{name:"orderNo",index:"orderNo",width:280,align:"center"},{name:"createTime",index:"createTime",width:130,align:"center"},{name:"businessStatus",index:"businessStatus",width:130,align:"center",formatter:function(e,t,i,s){if(10==e)return"待收定金"}},{name:"custName",index:"custName",width:220,align:"center"},{name:"custNo",index:"custNo",width:220,align:"center",hidden:!0},{name:"totalRealSaleAmount",index:"totalRealSaleAmount",width:130,align:"center",formatter:function(e,t,i,s){if(null!=e)return e.toFixed(2);return(0).toFixed(2)}},{name:"receviableDeposit",index:"receviableDeposit",width:130,align:"center",formatter:function(e,t,i,s){if(null!=e)return e.toFixed(2);return(0).toFixed(2)}},{name:"paidDeposit",index:"paidDeposit",width:200,align:"center",formatter:function(e,t,i,s){if(null!=e)return e.toFixed(2);return(0).toFixed(2)}},{name:"id",index:"id",width:130,align:"center",hidden:"true"}]}),_defineProperty(e,"orderReload",!0),_defineProperty(e,"orderId","orderId"),_defineProperty(e,"orderSelected",[]),_defineProperty(e,"returnOrder",0),_defineProperty(e,"returnClick",0),_defineProperty(e,"Constant",{docType:"S_DEPOSIT"}),e},created:function(){},methods:{clearNum:function(e,t,i){return htInputNumber(e,t,i)},isEdit:function(e,t){eventHub.$emit("isEdit",e)},saveAccess:function(e,t,i){eventHub.$emit("saveFile",e,t)},getAccess:function(e,t,i){eventHub.$emit("queryFile",e,t)},goToCustOrder:function(e){null!=e&&window.parent.activeEvent({name:"客户订单",url:contextPath+"/sale/customer-order/customer-order-add.html",params:{type:"view",saleOrderNo:e}})},exitModal:function(){this.orderShow=!1},act:function(e){var t=this.saleDepositDetailList[e].receDepositAmount,i=this.saleDepositDetailList[e].paidDepositAmount;if(i&&(i=i.replace(/^[0]+/,""),this.saleDepositDetailList[e].paidDepositAmount=i),Number(t)>Number(i))return this.$Modal.info({content:"实收定金不能少于应收定金"}),void(this.saleDepositDetailList[e].paidDepositAmount=0);for(var s=0,a=0;a<this.saleDepositDetailList.length;a++)null==this.saleDepositDetailList[a].paidDepositAmount&&(this.saleDepositDetailList[a].paidDepositAmount=0),s+=Number(this.saleDepositDetailList[a].paidDepositAmount);this.saleDeposit.totalPaidDepositAmount=s.toFixed(2)},encomeMoney:function(){for(var e=0,t=0;t<this.saleDepositDetailList.length;t++)e+=Number(this.saleDepositDetailList[t].receDepositAmount);this.saleDeposit.totalReceDepositAmount=e.toFixed(2)},saveinfo:function(e){var i=this;null!=this.saleDeposit.payWay&&(this.saleDeposit.payWay=this.saleDeposit.payWay.toString()),this.saleDepositDetailList.map(function(e,t){""==e.custOrderNo&&i.saleDepositDetailList.splice(t,1)});var t={saleDeposit:this.saleDeposit,saleDepositDetailList:this.saleDepositDetailList,saleCustInfo:this.saleCustInfo,showflag:"",saveOrSubmit:e};if("1"!=this.saleDeposit.status&&1==e)return this.$Modal.warning({title:"提示",content:"非暂存状态不允许提交!"}),!1;if(0==e)console.log(t),$.ajax({type:"post",async:!0,traditional:!0,dataType:"json",contentType:"application/json;charset=utf-8",data:JSON.stringify(t),url:contextPath+"/deposit/save",success:function(e){"-1"!=e.code?"-2"!=e.data.code?("1"==e.data.code&&(vm.$Modal.info({content:e.data.msg}),vm.saleDeposit=e.data.data.saleDeposit,vm.saleCustInfo=e.data.data.saleCustInfo,vm.saleDepositDetailList=e.data.data.saleDepositDetailList,null!=vm.saleDeposit.payWay&&(vm.saleDeposit.payWay=vm.saleDeposit.payWay.split(",")),$.isEmptyObject(vm.saleDeposit.depositNo)||vm.saveAccess(vm.saleDeposit.depositNo,vm.Constant.docType)),"-1"==e.data.code&&vm.$Modal.info({content:e.data.msg})):vm.$Modal.info({content:e.data.msg}):vm.$Modal.info({content:e.msg})},error:function(e){console.log(e)}});else if(1==e){if(t.saleDepositDetailList.length<1)return void vm.$Modal.info({content:"请填写明细信息"});$.ajax({type:"post",async:!0,traditional:!0,dataType:"json",contentType:"application/json;charset=utf-8",data:JSON.stringify(t),url:contextPath+"/deposit/submit",success:function(e){if("2"==e.code)vm.$Modal.info({content:"提交成功！"});else if("-1"==e.code){if(console.log(e),null!=e.data.CreateTime)return void vm.$Modal.info({content:e.data.CreateTime});if(null!=e.data.Unequal)return void vm.$Modal.info({content:e.data.Unequal});if(null!=e.data.PayWay)return void vm.$Modal.info({content:e.data.PayWay});if(null!=e.data.TotalPaidDepositAmount)return void vm.$Modal.info({content:e.data.TotalPaidDepositAmount})}if("-2"==e.code)return console.log(e),void vm.$Modal.info({content:e.msg});vm.saleDeposit=e.data.saleDeposit,vm.saleCustInfo=e.data.saleCustInfo,vm.saleDepositDetailList=e.data.saleDepositDetailList,null==vm.saleDeposit.payWay&&""==vm.saleDeposit.payWay||(vm.saleDeposit.payWay=vm.saleDeposit.payWay.split(",")),1!=vm.saleDeposit.status&&(vm.viewShow=!0),$.isEmptyObject(vm.saleDeposit.depositNo)||vm.saveAccess(vm.saleDeposit.depositNo,vm.Constant.docType),vm.isEdit(1==vm.saleDeposit.status?"Y":"N")},error:function(e){console.log(e)}})}},OrderList:function(){window.parent.activeEvent({name:"定金列表",url:contextPath+"/sale/deposit/sale-order-list.html",params:{allInfo:null,type:"query"}})},userInfo:function(){this.isShow=!0},addRow:function(){""===this.saleDeposit.customerNo?this.$Modal.info({content:"请选择客户"}):0<this.saleDepositDetailList.length&&""===this.saleDepositDetailList[this.saleDepositDetailList.length-1].custOrderNo?this.$Modal.info({content:"不能连续新增空数据"}):this.saleDepositDetailList.push(this.addlist)},delRow:function(){if(""===this.delIndex)this.$Modal.info({content:"请选择需要删除行"});else{this.saleDepositDetailList.splice(this.delIndex,1),$(".tdInfo").eq(this.delIndex).removeClass("tr-back"),this.delIndex="";for(var e=0,t=0;t<this.saleDepositDetailList.length;t++)e+=Number(this.saleDepositDetailList[t].paidDepositAmount);this.saleDeposit.totalPaidDepositAmount=e.toFixed(2),this.encomeMoney()}},getIndex:function(e){this.delIndex!=e||""===this.delIndex?(this.delIndex=e,$(".tdInfo").eq(this.delIndex).addClass("tr-back").siblings().removeClass("tr-back")):($(".tdInfo").eq(this.delIndex).removeClass("tr-back"),this.delIndex="")},confirm:function(e,t,i,s){var a=i;console.log(a),this.saleDeposit.customerNo=a.code,this.saleDeposit.customerName=a.name,this.saleDeposit.customerId=a.id,this.isShow=!1,this.reload=!this.reload},getGoodsList:function(){if(this.saleDeposit.customerNo){this.orderShow=!0;var e={postData:{searchCustNo:this.saleDeposit.customerNo}};$("#"+this.orderId).jqGrid("setGridParam",e).trigger("reloadGrid")}else this.$Modal.info({content:"请先选择客户"})},view:function(t){if(null!=t&&1==t.allInfo[0]&&(this.temp=!1,$.ajax({type:"post",async:!0,traditional:!0,data:{saleOrderNos:t.allInfo[3],custNo:t.allInfo[1]},url:contextPath+"/deposit/view",dataType:"json",success:function(e){if(console.log(e),"100100"==e.code){vm.saleDeposit=e.data.saleDeposit,e.data.saleCustInfo&&(vm.saleCustInfo=e.data.saleCustInfo),vm.saleDepositDetailList=e.data.saleDepositDetailList,vm.saleDeposit.customerName=t.allInfo[2],vm.saleDeposit.depositDate=new Date,e.data.saleCustInfo&&(vm.areaInit={isInit:!0,province:e.data.saleCustInfo.province||"",city:e.data.saleCustInfo.city||"",county:e.data.saleCustInfo.county,detail:e.data.saleCustInfo.detail,disabled:!0});var i=0,s=0;vm.saleDepositDetailList.forEach(function(e,t){i+=Number(e.receDepositAmount),s+=Number(e.paidDepositAmount)}),vm.saleDeposit.totalReceDepositAmount=i.toFixed(2),vm.saleDeposit.totalPaidDepositAmount=s.toFixed(2),null==vm.saleDeposit.createTime&&""==vm.saleDeposit.createTime||(vm.createTime=vm.saleDeposit.createTime),null!=vm.saleDeposit.payWay&&(vm.saleDeposit.payWay=vm.saleDeposit.payWay.split(",")),vm.isEdit("Y"),$.isEmptyObject(vm.saleDeposit.depositNo)||null==vm.saleDeposit.depositNo||vm.getAccess(vm.saleDeposit.depositNo,vm.Constant.docType)}},error:function(e){console.log(e)}})),null!=t&&2==t.allInfo[0]){var e=t.allInfo[2];console.log(e),1==e?(this.viewShow=!1,this.isEdit("Y")):(this.viewShow=!0,this.isEdit("N")),$.ajax({type:"post",async:!0,traditional:!0,data:{id:t.allInfo[1]},url:contextPath+"/deposit/view",dataType:"json",success:function(e){console.log(e),vm.saleDeposit=e.data.saleDeposit,e.data.saleCustInfo&&(vm.saleCustInfo=e.data.saleCustInfo),vm.saleDepositDetailList=e.data.saleDepositDetailList,e.data.saleCustInfo&&(vm.areaInit={isInit:!0,province:e.data.saleCustInfo.province||"",city:e.data.saleCustInfo.city||"",county:e.data.saleCustInfo.county,detail:e.data.saleCustInfo.detail,disabled:!0});vm.saleDepositDetailList.forEach(function(e,t){null!=vm.saleDepositDetailList[t].orderAmount?vm.saleDepositDetailList[t].orderAmount=vm.saleDepositDetailList[t].orderAmount.toFixed(2):vm.saleDepositDetailList[t].orderAmount=(0).toFixed(2),null!=vm.saleDepositDetailList[t].paidDepositAmount?vm.saleDepositDetailList[t].paidDepositAmount=vm.saleDepositDetailList[t].paidDepositAmount.toFixed(2):vm.saleDepositDetailList[t].paidDepositAmount=(0).toFixed(2),null!=vm.saleDepositDetailList[t].receDepositAmount?vm.saleDepositDetailList[t].receDepositAmount=vm.saleDepositDetailList[t].receDepositAmount.toFixed(2):vm.saleDepositDetailList[t].receDepositAmount=(0).toFixed(2)}),null==vm.saleDeposit.createTime&&""==vm.saleDeposit.createTime||(vm.createTime=vm.saleDeposit.createTime),vm.saleDeposit.payWay&&(vm.saleDeposit.payWay=vm.saleDeposit.payWay.split(",")),vm.getAccess(vm.saleDeposit.depositNo,vm.Constant.docType)},error:function(e){console.log(e)}})}null!=t&&3==t.allInfo[0]&&$.ajax({type:"post",async:!0,traditional:!0,data:{id:t.allInfo[1]},url:contextPath+"/deposit/view",dataType:"json",success:function(e){vm.saleDeposit=e.data.saleDeposit,e.data.saleCustInfo&&(vm.saleCustInfo=e.data.saleCustInfo),vm.saleDepositDetailList=e.data.saleDepositDetailList,e.data.saleCustInfo&&(vm.areaInit={isInit:!0,province:e.data.saleCustInfo.province||"",city:e.data.saleCustInfo.city||"",county:e.data.saleCustInfo.county,detail:e.data.saleCustInfo.detail,disabled:!0});vm.saleDepositDetailList.forEach(function(e,t){null!=vm.saleDepositDetailList[t].orderAmount?vm.saleDepositDetailList[t].orderAmount=vm.saleDepositDetailList[t].orderAmount.toFixed(2):vm.saleDepositDetailList[t].orderAmount=(0).toFixed(2),null!=vm.saleDepositDetailList[t].paidDepositAmount?vm.saleDepositDetailList[t].paidDepositAmount=vm.saleDepositDetailList[t].paidDepositAmount.toFixed(2):vm.saleDepositDetailList[t].paidDepositAmount=(0).toFixed(2),null!=vm.saleDepositDetailList[t].receDepositAmount?vm.saleDepositDetailList[t].receDepositAmount=vm.saleDepositDetailList[t].receDepositAmount.toFixed(2):vm.saleDepositDetailList[t].receDepositAmount=(0).toFixed(2)}),null==vm.saleDeposit.createTime&&""==vm.saleDeposit.createTime||(vm.createTime=vm.saleDeposit.createTime),vm.saleDeposit.payWay=vm.saleDeposit.payWay.split(","),vm.isEdit("Y"),$.isEmptyObject(vm.saleDeposit.depositNo)||null==vm.saleDeposit.depositNo||vm.getAccess(vm.saleDeposit.depositNo,vm.Constant.docType)},error:function(e){console.log(e)}}),null!=t&&4==t.allInfo[0]&&$.ajax({type:"post",async:!0,traditional:!0,data:"",url:contextPath+"/deposit/findSysUser",success:function(e){vm.saleDeposit.organizationName=e.data,vm.saleDeposit.depositDate=new Date,vm.isEdit("Y"),$.isEmptyObject(vm.saleDeposit.depositNo)||null==vm.saleDeposit.depositNo||vm.getAccess(vm.saleDeposit.depositNo,vm.Constant.docType)},error:function(e){console.log(e)}})},orderSave:function(){var i=this;if(this.returnOrder=1,console.log(this.orderSelected),0<this.orderSelected.length){for(var s=[],e=0;e<this.orderSelected.length;e++){var t=$("#"+this.orderId).jqGrid("getRowData",this.orderSelected[e]),a=Object.assign({},this.addList);a.custOrderNo=t.orderNo,a.orderAmount=t.totalRealSaleAmount,a.receDepositAmount=t.receviableDeposit,a.id=t.id,s.push(a)}if(this.orderShow=!1,this.orderReload=!this.orderReload,this.orderSelected=[],console.log(this.saleDepositDetailList),this.saleDepositDetailList.map(function(e){for(var t=0;t<s.length;t++)s[t].custOrderNo==e.custOrderNo&&s.splice(t,1)}),s.map(function(e){var t=Object.assign({},e);i.saleDepositDetailList.push(t)}),this.saleDepositDetailList.map(function(e,t){""==e.custOrderNo&&i.saleDepositDetailList.splice(t,1)}),1===this.returnOrder){var o=this;$.ajax({type:"post",async:!0,traditional:!0,data:{saleOrderNo:this.saleDepositDetailList[0].custOrderNo,customerNo:this.saleDeposit.customerNo},url:contextPath+"/deposit/findSaleCustInfoEntity",success:function(e){o.areaInit={isInit:!0,province:e.province||"",city:e.city||"",county:e.county,detail:e.detail,disabled:!0},console.log(o.areaInit),vm.saleCustInfo=e},error:function(e){console.log(e)}})}this.encomeMoney()}else this.$Modal.warning({content:"请选择单据编号"})},approvalOrRejectCallBack:function(e){console.log(e);var t=this;if("100515"==e.result.code&&("approve"==t.modalType&&t.updateStatus(this.saleDeposit.id,this.saleDeposit.depositNo,4),"reject"==t.modalType&&t.updateStatus(this.saleDeposit.id,this.saleDeposit.depositNo,1)),"100100"==e.result.code){var i=e.result.data.approvalStatus,s="";if(0==i)s=3;else if(1==i)s=4;else if(-1==i)s=5;else{if(-2!=i)return t.$Modal.warning({content:"审核异常!",title:"警告"}),!1;s=1}4==s&&(t.updataCustOrder(this.saleDeposit.id),t.saveFinancialData(this.saleDeposit.id)),t.updateStatus(this.saleDeposit.id,this.saleDeposit.depositNo,s)}},updateStatus:function(e,t,i){1==i?(this.saleDeposit.status=1,this.viewShow=!1,vm.isEdit("Y")):vm.isEdit("N");$.ajax({type:"post",url:contextPath+"/deposit/updateStatus",data:{id:e,deposit:t,status:i},dataType:"json",success:function(e){4==e.data.status&&(vm.saleDeposit.auditName=e.data.auditName,vm.saleDeposit.auditTime=e.data.auditTime,vm.saleDeposit.status=e.data.status,console.log(vm.saleDeposit))}})},updataCustOrder:function(e){$.ajax({type:"post",url:contextPath+"/deposit/updataCustOrder",data:{id:e},dataType:"json",success:function(e){"100100"==e.code&&(vm.reload=!vm.reload)}})},saveFinancialData:function(e){$.ajax({type:"post",url:contextPath+"/deposit/saveFinancialData",data:{id:e},dataType:"json",success:function(e){"100100"==e.code&&(vm.reload=!vm.reload)}})},audit:function(){var e=this.saleDeposit.depositNo,t=this.saleDeposit.status;if(2===t||3===t||5===t){var i=this;i.id=this.saleDeposit.id,i.documentStatus=t,i.documentNo=e,i.modalType="approve",i.modalTrigger=!i.modalTrigger}else{if(1===t)return void this.$Modal.warning({title:"提示信息",content:"请提交单据！"});if(4===t)return void this.$Modal.warning({title:"提示信息",content:"该单已审核,不能重复审核！"})}},reject:function(){var e=this.saleDeposit.depositNo,t=this.saleDeposit.status;if(2===t||3===t||5===t||1===t){var i=this;i.id=this.saleDeposit.id,i.documentStatus=t,i.documentNo=e,i.modalType="reject",i.modalTrigger=!i.modalTrigger}else this.$Modal.warning({title:"提示信息",content:"该单状态不能驳回！"})},searchCut:function(){var e={postData:{customerName:this.customer.name,customerNum:this.customer.Num}};$("#customerTab").jqGrid("setGridParam",e).trigger("reloadGrid")},searchClear:function(){this.customer={name:"",Num:""};var e={postData:{customerName:this.customer.name,customerNum:this.customer.Num}};$("#"+this.tabId).jqGrid("clearGridData"),$("#customerTab").jqGrid("setGridParam",e).trigger("reloadGrid")},exit:function(){window.parent.closeCurrentTab({exit:!0,openTime:this.openTime})}},watch:{},mounted:function(){this.openTime=window.parent.params.openTime,$("form").validate();var e=window.parent.params.params;this.view(e),this.encomeMoney()}});