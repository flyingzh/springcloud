"use strict";var inspectionItemVm=new Vue({el:"#inspection-item",data:function(){return{record_url:"",openTime:"",params:{},modalTrigger:!1,modalType:"",stepList:[],approvalTableData:[],reload:!1,selected:[],isStampShow:!1,showAdd:!0,showSave:!0,showSubmit:!0,showApproval:!0,showReject:!0,showList:!0,showAttachment:!0,showBack:!0,lotData:[],checkindex:[],isCheckedAll:!1,islotDataChecked:!1,isDxfx:!1,isQtfx:!1,isbet:!1,changeFrame:!1,showMenu:!0,upperLimitDisable:!1,lowerLimitDisable:!1,upperCommDiffDisable:!1,lowerCommDiffDisable:!1,inspectionItem:{id:0,groupName:"",groupId:"",name:"",importantFlag:!1,inspectStandard:1,testItemStatus:"",productId:"",productName:"",unitId:"",unitName:"",testMethodId:"",testMethodName:"",code:"",bugRankId:"",bugRankName:"",testInstrumentId:"",testInstrumentName:"",testBasisId:"",testBasisName:"",analyseMethod:"",analyseMethodName:"",goalValue:"",goalValueName:"",upperCommonDifference:"",qualityStandardStatus:"",qualityStandardStatusName:"",upperLimitValue:"",lowerCommonDifferent:"",compareSymbol:"",compareSymbolName:"",lowerLimitValue:"",sampleType:"",sampleTypeName:"",samplePlanEntities:[],createId:"",createName:"",createTime:"",updateId:"",updateName:"",updateTime:"",examineVerifyId:"",examineVerifyName:"",examineVerifyTime:"",sysFileId:"",sysFile:{fileId:"",fileType:5,fileDetails:[]}},showUpload:!1,uploadBtn:!0,deleteBtn:!0,itemstatusList:[],productList:[],unitList:[],testMethodList:[],bugRankList:[],testInstrumentList:[],analyseMethodList:[],standardList:[],statusList:[],operatorList:[],sampleTypeList:[],goalValueList:[],approvalUrl:"",data_config_changeLog:{colNames:["变更信息","变更前","变更后","变更日期","变更人"],colModel:[{name:"changeInfo",index:"changeInfo",width:200,align:"left"},{name:"operationBefore",index:"operationBefore",width:210,align:"left"},{name:"operationAfter",index:"operationAfter",width:210,align:"left"},{name:"operationTime",index:"operationTime",width:220,align:"left"},{name:"userName",index:"userName",width:210,align:"left"}],multiselect:!1},statusMap:{tmp_save:"zc",await_check:"dsh",checking:"jyshz",auditing:"jyysh",reject:"bh"},canRejectWhenAudit:!0}},methods:{approval:function(t){var e=this;e.modalType="approve",e.modalTrigger=!e.modalTrigger},reject:function(t){var e=this;e.modalType="reject",e.modalTrigger=!e.modalTrigger},approvalOrRejectCallBack:function(t){"100100"==t.result.code&&(this.inspectionItem.testItemStatus=parseInt(t.result.data),this.initItem(2))},autoSubmitOrReject:function(){var e=this;$.ajax({url:contextPath+"/testItemController/submitApproval?submitType=1",method:"post",contentType:"application/json;charset=utf-8",data:JSON.stringify({receiptsId:e.inspectionItem.code,approvalResult:"reject"===e.modalType?1:0}),success:function(t){"100100"===t.code?e.inspectionItem.documentStatus=parseInt(t.data):e.$Modal.warning({content:t.msg}),e.initItem(2)}})},getData:function(t){if(-1<this.checkindex.indexOf(t)){var e=this.checkindex.indexOf(t);this.checkindex.splice(e,1),this.lotData.splice(e,1)}else this.checkindex.push(t),this.lotData.push(this.inspectionItem.samplePlanEntities[t]);console.log(this.lotData),console.log(this.checkindex),this.checkindex.length===this.inspectionItem.samplePlanEntities.length?this.isCheckedAll=!0:this.isCheckedAll=!1},checkAll:function(){var i=this;this.isCheckedAll?(this.checkindex=[],this.lotData=[],this.inspectionItem.samplePlanEntities.forEach(function(t,e){i.inspectionItem.samplePlanEntities[e].isChecked=!1})):(this.checkindex=[],this.lotData=[],this.inspectionItem.samplePlanEntities.forEach(function(t,e){i.checkindex.push(e),i.inspectionItem.samplePlanEntities[e].isChecked=!0,i.lotData.push(i.inspectionItem.samplePlanEntities[e])})),console.log(this.checkindex),console.log(this.lotData)},add:function(){window.parent.activeEvent({name:"新增检验项目",url:contextPath+"/quality/quality/inspection-item.html",params:{data:"zc",type:0}})},dealDictionary:function(){var e=this;this.productList&&this.productList.forEach(function(t){t.id==e.inspectionItem.productId&&(e.inspectionItem.productName=t.name)}),this.unitList&&this.unitList.forEach(function(t){t.id==e.inspectionItem.unitId&&(e.inspectionItem.unitName=t.name)}),this.bugRankList&&this.bugRankList.forEach(function(t){t.id==e.inspectionItem.bugRankId&&(e.inspectionItem.bugRankName=t.name)}),this.analyseMethodList&&this.analyseMethodList.forEach(function(t){t.value==e.inspectionItem.analyseMethod&&(e.inspectionItem.analyseMethodName=t.name)}),this.statusList&&this.statusList.forEach(function(t){t.value==e.inspectionItem.qualityStandardStatus&&(e.inspectionItem.qualityStandardStatusName=t.name)}),this.operatorList&&this.operatorList.forEach(function(t){t.value==e.inspectionItem.compareSymbol&&(e.inspectionItem.compareSymbolName=t.name)}),this.testMethodList&&this.testMethodList.forEach(function(t){t.id==e.inspectionItem.testMethodId&&(e.inspectionItem.testMethodName=t.name)}),this.testInstrumentList&&this.testInstrumentList.forEach(function(t){t.id==e.inspectionItem.testInstrumentId&&(e.inspectionItem.testInstrumentName=t.name)}),this.standardList&&this.standardList.forEach(function(t){t.id==e.inspectionItem.testBasisId&&(e.inspectionItem.testBasisName=t.name)}),this.inspectionItem.goalValueName="",this.goalValueList&&this.goalValueList.forEach(function(t){t.id==e.inspectionItem.goalValue&&(e.inspectionItem.goalValueName=t.name)})},dealCompareSymbolName:function(){this.inspectionItem.compareSymbolName&&(this.inspectionItem.compareSymbolName=this.inspectionItem.compareSymbolName.replace(">","&gt;")),this.inspectionItem.compareSymbolName&&(this.inspectionItem.compareSymbolName=this.inspectionItem.compareSymbolName.replace("<","&lt;")),this.inspectionItem.compareSymbolName&&(this.inspectionItem.compareSymbolName=this.inspectionItem.compareSymbolName.replace("<>","&lt;&gt;")),this.inspectionItem.compareSymbolName&&(this.inspectionItem.compareSymbolName=this.inspectionItem.compareSymbolName.replace(">=","&gt;=")),this.inspectionItem.compareSymbolName&&(this.inspectionItem.compareSymbolName=this.inspectionItem.compareSymbolName.replace("<=","&lt;="))},save:function(){var e=this;if("dsh"===this.inspectionItem.testItemStatus||"jyysh"===this.inspectionItem.testItemStatus||"jyshz"===this.inspectionItem.testItemStatus)return layer.alert("检验项目已提交"),!1;!0===this.inspectionItem.importantFlag?this.inspectionItem.importantFlag=1:this.inspectionItem.importantFlag=0,this.convertNumber(),this.dealDictionary(),this.dealCompareSymbolName(),e.inspectionItem.testItemStatus="zc";var t="";t=""===e.inspectionItem.code?contextPath+"/testItemController/saveToExistCode":contextPath+"/testItemController/updateToExistCode",$.ajax({type:"POST",url:t,contentType:"application/json",data:JSON.stringify(e.inspectionItem),dataType:"json",success:function(t){"100100"===t.code?(console.log(t.data),e.inspectionItem.code=t.data.code,layer.alert("保存成功"),1===t.data.importantFlag?e.inspectionItem.importantFlag=!0:e.inspectionItem.importantFlag=!1,e.initItem(3)):layer.alert("保存失败"),e.$refs.my_log.reload()},error:function(t){layer.alert("服务器出错")}})},submititem:function(){var e=this;if(console.log($("form").valid()),!$("form").valid())return layer.alert("请输入必填项"),!1;if("dlfx"===e.inspectionItem.analyseMethod&&("dy"===e.inspectionItem.compareSymbol||"between"===e.inspectionItem.compareSymbol)&&Number(e.inspectionItem.upperLimitValue)<Number(e.inspectionItem.lowerLimitValue))return layer.alert("上限值不能小于下限值!"),!1;for(var t=e.inspectionItem.samplePlanEntities,i=[],a=0,n=0,o=0;o<t.length;o++)(Number(t[o].allowNumber)<0||Number(t[o].rejectNumber)<0)&&(a=1),Number(t[o].allowNumber)>=Number(t[o].rejectNumber)&&(n=1),i.push(t[o].amount);if(1===a&&1===n)return layer.alert("允收数和拒收数不能小于0且允收数不能大于或等于拒收数!"),!1;if(1===a)return layer.alert("允收数和拒收数不能小于0!"),!1;if(1===n)return layer.alert("允收数不能大于或等于拒收数!"),!1;for(var s=i.sort(),l=0;l<s.length;l++)if(s[l]==s[l+1])return this.$Modal.warning({title:"提示信息",content:"<p>抽样方案批量列中，不能存在相同的数字哦</p>"}),!1;if("dsh"===this.inspectionItem.testItemStatus||"jyysh"===this.inspectionItem.testItemStatus||"jyshz"===this.inspectionItem.testItemStatus)return layer.alert("检验项目已提交"),!1;!0===this.inspectionItem.importantFlag?this.inspectionItem.importantFlag=1:this.inspectionItem.importantFlag=0,this.convertNumber(),this.dealDictionary(),this.dealCompareSymbolName(),e.inspectionItem.testItemStatus="dsh";var m="";m=""===e.inspectionItem.code?contextPath+"/testItemController/saveToExistCode":contextPath+"/testItemController/updateToExistCode",$.ajax({type:"POST",url:m,contentType:"application/json",data:JSON.stringify(e.inspectionItem),dataType:"json",success:function(t){"100100"===t.code?(e.inspectionItem=t.data,1===t.data.importantFlag?e.inspectionItem.importantFlag=!0:e.inspectionItem.importantFlag=!1,"dxfx"===t.data.analyseMethod&&(e.inspectionItem.goalValue=Number(t.data.goalValue)),t.data.groupId===window.parent.userInfo.organId&&(e.inspectionItem.groupName=window.parent.userInfo.orgName,e.inspectionItem.groupId=window.parent.userInfo.organId),e.changeFrame=!0,e.isbet=!0,e.upperCommDiffDisable=!0,e.upperLimitDisable=!0,e.lowerCommDiffDisable=!0,e.isQtfx=!0,e.lowerLimitDisable=!0,e.showMenu=!1,layer.alert("提交成功")):layer.alert("提交失败"),e.initItem(1),e.$refs.my_log.reload()},error:function(t){layer.alert("服务器出错")}})},convertNumber:function(){if(console.log(this.inspectionItem.upperCommonDifference),0===this.inspectionItem.upperCommonDifference&&(this.inspectionItem.upperCommonDifference=Number(this.inspectionItem.upperCommonDifference).toFixed(2)),0===this.inspectionItem.lowerCommonDifferent&&(this.inspectionItem.lowerCommonDifferent=Number(this.inspectionItem.lowerCommonDifferent).toFixed(2)),this.inspectionItem.upperCommonDifference&&(this.inspectionItem.upperCommonDifference=Number(this.inspectionItem.upperCommonDifference).toFixed(2)),this.inspectionItem.lowerCommonDifferent&&(this.inspectionItem.lowerCommonDifferent=Number(this.inspectionItem.lowerCommonDifferent).toFixed(2)),this.inspectionItem.samplePlanEntities)for(var t=0;t<this.inspectionItem.samplePlanEntities.length;t++)this.inspectionItem.samplePlanEntities[t].randomTestProportion=Number(this.inspectionItem.samplePlanEntities[t].randomTestProportion).toFixed(2)},saveMethod:function(){var e=this,t="";t=""===e.inspectionItem.code?contextPath+"/testItemController/saveToExistCode":contextPath+"/testItemController/updateToExistCode",$.ajax({type:"POST",url:t,contentType:"application/json",data:JSON.stringify(e.inspectionItem),dataType:"json",success:function(t){e.initItem(2),console.log("修改成功")},error:function(t){layer.alert("服务器出错")}})},list:function(){window.parent.activeEvent({name:"检验项目",url:contextPath+"/quality/quality/inspection-item-list.html"})},attachment:function(){},back:function(){$.isEmptyObject(this.params)||(0===this.params.params.type&&window.parent.closeCurrentTab({name:"新增检验项目",exit:!0,openTime:this.openTime}),1===this.params.params.type&&window.parent.closeCurrentTab({name:"修改检验项目",exit:!0,openTime:this.openTime}),2===this.params.params.type&&window.parent.closeCurrentTab({name:"查看检验项目",exit:!0,openTime:this.openTime}))},underNumber:function(t,e){100<Number(t)&&(this.inspectionItem.samplePlanEntities[e].randomTestProportion=100)},addOneRow:function(){if(this.inspectionItem.samplePlanEntities.length<1)this.inspectionItem.samplePlanEntities.push({isChecked:!1,amount:"",randomTestProportion:"",allowNumber:"",rejectNumber:""});else{var t=this.inspectionItem.samplePlanEntities[this.inspectionItem.samplePlanEntities.length-1];if(""===t.allowNumber||""===t.amount||""===t.randomTestProportion||""===t.rejectNumber)return void this.$Modal.warning({title:"提示信息",content:"<p>请完善该行所有信息后，再新增行</p>"});this.inspectionItem.samplePlanEntities.push({isChecked:!1,amount:"",randomTestProportion:"",allowNumber:"",rejectNumber:""}),this.isCheckedAll=!1}},isSelected:function(){this.lotData.length<1&&this.$Modal.warning({title:"提示信息",content:"<p>当前没有勾选任何数据，请重新选择！！</p>"})},clearlotData:function(){this.lotData=[]},copyOneRow:function(){if(this.lotData.length<1)this.$Modal.warning({title:"提示信息",content:"<p>当前没有勾选任何数据，请重新选择！</p>"});else if(1<this.lotData.length)this.$Modal.warning({title:"提示信息",content:"<p>只能选择一笔数据，请重新选择！</p>"});else{var t,e=this.lotData[this.lotData.length-1];if(console.log(e),""===e.allowNumber||""===e.amount||""===e.randomTestProportion||""===e.rejectNumber)return void this.$Modal.warning({title:"提示信息",content:"<p>请完善该行所有信息后，再复制行</p>"});if(0===this.checkindex[0])(t=Object.assign({},this.lotData[0])).isChecked=!1,this.isCheckedAll=!1,t.id="",inspectionItemVm.inspectionItem.samplePlanEntities.push(t);else(t=Object.assign({},this.lotData[0])).isChecked=!1,t.id="",inspectionItemVm.inspectionItem.samplePlanEntities.push(t);console.log(inspectionItemVm.inspectionItem.samplePlanEntities),console.log(this.lotData),console.log(this.checkindex)}},DeleteOneRow:function(){var i=this;this.lotData.length<1?this.$Modal.warning({title:"提示信息",content:"<p>当前没有勾选任何数据，请重新选择！！</p>"}):this.$Modal.confirm({title:"提示信息",content:"<p>是否要删除这些记录？</p>",onOk:function(){console.log("点击了确定");var t=i.checkindex;t.sort();for(var e=t.length-1;0<=e;e--)i.inspectionItem.samplePlanEntities.splice(t[e],1);i.checkindex=[],i.lotData=[]},onCancel:function(){console.log("点击了取消")}})},setColumns:function(){},itemListInit:function(){this.inspectionItem={id:0,groupId:1,name:"",importantFlag:!1,inspectStandard:1,testItemStatus:"zc",productId:"",productName:"",unitId:"",unitName:"",testMethodId:"",code:"",bugRankId:"",bugRankName:"",testInstrumentId:"",testInstrumentName:"",testBasisId:"",testBasisName:"",analyseMethod:"",goalValue:"",upperCommonDifference:"",qualityStandardStatus:"",upperLimitValue:"",lowerCommonDifferent:"",compareSymbol:"",lowerLimitValue:"",sampleType:"abfbcy",samplePlanEntities:[],createId:"",createName:"",createTime:"",updateId:"",updateName:"",updateTime:"",examineVerifyId:"",examineVerifyName:"",examineVerifyTime:""}},numberOnly:function(t){if("dlfx"===this.inspectionItem.analyseMethod)return!isNaN(t)||(this.$Modal.warning({title:"提示信息",content:"<p>请输入合法数字！</p>"}),t===this.inspectionItem.goalValue?this.inspectionItem.goalValue="":t===this.inspectionItem.upperLimitValue?this.inspectionItem.upperLimitValue="":t===this.inspectionItem.lowerLimitValue?this.inspectionItem.lowerLimitValue="":t===this.inspectionItem.upperCommonDifference?this.inspectionItem.upperCommonDifference="":this.inspectionItem.lowerCommonDifferent="",!1)},statusInit:function(){this.isbet=!1,this.isDxfx=!1,this.isQtfx=!1,this.upperLimitDisable=!1,this.lowerLimitDisable=!1,this.upperCommDiffDisable=!1,this.lowerCommDiffDisable=!1,this.inspectionItem.goalValue="",this.inspectionItem.upperLimitValue="",this.inspectionItem.lowerLimitValue="",this.inspectionItem.lowerCommonDifferent="",this.inspectionItem.upperCommonDifference=""},symboleEdit:function(t){void 0!==t&&("dy"===t?(console.log("选择了等于"),this.statusInit(),this.inspectionItem.compareSymbol=t,this.isDxfx=!1,this.upperLimitDisable=!1,this.lowerLimitDisable=!1,this.upperCommDiffDisable=!1,this.lowerCommDiffDisable=!1):"between"===t?(console.log("选择了between"),this.statusInit(),this.inspectionItem.compareSymbol=t,this.isbet=!0,this.upperCommDiffDisable=!0,this.lowerCommDiffDisable=!0):"dy"===t&&"between"===t||(this.statusInit(),this.inspectionItem.compareSymbol=t,this.upperLimitDisable=!0,this.lowerLimitDisable=!0,this.upperCommDiffDisable=!0,this.lowerCommDiffDisable=!0))},editControl:function(){"dxfx"===this.inspectionItem.analyseMethod?(this.statusInit(),this.inspectionItem.compareSymbol="dy",this.isDxfx=!0,this.isQtfx=!0,this.upperLimitDisable=!0,this.lowerLimitDisable=!0,this.upperCommDiffDisable=!0,this.lowerCommDiffDisable=!0):"dlfx"===this.inspectionItem.analyseMethod?(console.log("定量分析"),this.statusInit(),this.symboleEdit()):"qtfxff"===this.inspectionItem.analyseMethod&&(console.log("其他分析方法"),this.statusInit(),this.inspectionItem.compareSymbol="dy",this.isQtfx=!0,this.upperCommDiffDisable=!0,this.lowerCommDiffDisable=!0)},echoCtrl:function(t){if("dxfx"===this.inspectionItem.analyseMethod)this.inspectionItem.compareSymbol="dy",this.isDxfx=!0,this.isQtfx=!0,this.upperLimitDisable=!0,this.lowerLimitDisable=!0,this.upperCommDiffDisable=!0,this.lowerCommDiffDisable=!0;else if("dlfx"===this.inspectionItem.analyseMethod){if(console.log("定量分析"),void 0===t)return;this.isQtfx=!1,"dy"===t?(console.log("选择了等于"),this.inspectionItem.compareSymbol=t,this.isDxfx=!1,this.isbet=!1,this.upperLimitDisable=!1,this.lowerLimitDisable=!1,this.upperCommDiffDisable=!1,this.lowerCommDiffDisable=!1):"between"===t?(console.log("选择了between"),this.inspectionItem.compareSymbol=t,this.isDxfx=!1,this.isbet=!0,this.upperCommDiffDisable=!0,this.lowerCommDiffDisable=!0,this.upperLimitDisable=!1,this.lowerLimitDisable=!1):"dy"===t&&"between"===t||(this.inspectionItem.compareSymbol=t,this.isDxfx=!1,this.isbet=!1,this.upperLimitDisable=!0,this.lowerLimitDisable=!0,this.upperCommDiffDisable=!0,this.lowerCommDiffDisable=!0)}else"qtfxff"===this.inspectionItem.analyseMethod&&(console.log("其他分析方法"),this.inspectionItem.compareSymbol="dy",this.isQtfx=!0,this.isDxfx=!1,this.isbet=!1,this.upperCommDiffDisable=!0,this.lowerCommDiffDisable=!0,this.upperLimitDisable=!1,this.lowerLimitDisable=!1)},initItem:function(e){var i=this,a=i.params,t={ifQueryUser:1};if(!$.isEmptyObject(a)){if(0===a.params.type)if("copy"===a.params.prop)t={id:a.params.data},!e||1!==e&&2!==e&&3!==e||(t={id:i.inspectionItem.id});else{if(0===a.params.type&&!i.inspectionItem.code)return i.getOrgan(),!1;t={code:i.inspectionItem.code}}1===a.params.type&&(t={id:a.params.data}),2===a.params.type&&(t={code:a.params.data})}$.ajax({type:"POST",url:contextPath+"/testItemController/getTestItem",data:JSON.stringify(t),contentType:"application/json",dataType:"json",success:function(t){i.$nextTick(function(){i.initHandler(t,a,e)})},error:function(t){layer.alert("服务器出错")}})},initHandler:function(t,e,i){var a=this;if(a.getOrgan(),t.data&&t.data.id){if(t.data.importantFlag&&1===t.data.importantFlag?t.data.importantFlag=!0:t.data.importantFlag=!1,"copy"===e.params.prop&&1!==i&&2!==i&&3!==i)if(t.data.testItemStatus="zc",t.data.code="",t.data.id="",t.data.createName="",t.data.createTime="",t.data.updateName="",t.data.updateTime="",t.data.samplePlanEntities&&!t.data.samplePlanEntities[0].id)a.inspectionItem.samplePlanEntities=[];else for(var n=0;n<t.data.samplePlanEntities.length;n++)t.data.samplePlanEntities[n].id="";if(t.data.sysFile||(t.data.sysFile=a.inspectionItem.sysFile),t.data.samplePlanEntities||(t.data.samplePlanEntities=[]),a.inspectionItem=t.data,t.data.sysFile&&!t.data.sysFile.fileDetails&&(a.inspectionItem.sysFile.fileDetails=[]),a.inspectionItem.sysFile.fileType=5,"copy"!==e.params.prop&&t.data.samplePlanEntities&&!t.data.samplePlanEntities[0].id&&(a.inspectionItem.samplePlanEntities=[]),"dxfx"===t.data.analyseMethod&&(a.inspectionItem.goalValue=Number(t.data.goalValue)),a.echoCtrl(a.inspectionItem.compareSymbol),t.data.groupId===window.parent.userInfo.organId&&(a.inspectionItem.groupName=window.parent.userInfo.orgName,a.inspectionItem.groupId=window.parent.userInfo.organId),"jyysh"===t.data.testItemStatus?a.isStampShow=!0:a.isStampShow=!1,"zc"===t.data.testItemStatus&&(a.changeFrame=!1,a.showMenu=!0,a.uploadBtn=!0,a.deleteBtn=!0),(t.data.testItemStatus&&"zc"!==t.data.testItemStatus||2===e.params.type)&&(a.changeFrame=!0,a.isbet=!0,a.upperCommDiffDisable=!0,a.upperLimitDisable=!0,a.lowerCommDiffDisable=!0,a.isQtfx=!0,a.lowerLimitDisable=!0,a.uploadBtn=!1,a.deleteBtn=!1,a.showMenu=!1),2===e.params.type&&(a.showAdd=!1,a.showSave=!1,a.showSubmit=!1,a.showApproval=!1,a.showReject=!1,a.showAttachment=!1,a.uploadBtn=!1,a.deleteBtn=!1),"copy"===e.params.prop&&1!==i&&2!==i&&3!==i)return!1}},goalValueBlur:function(t){console.log(t.target.value);this.numberOnly(t.target.value)&&(this.inspectionItem.goalValue=t.target.value)},uploadfile:function(){this.showUpload=!0},download:function(e){if(!e.fdUrl)return layer.alert("文件地址为空!请先上传文件!"),!1;var i=[];Object.keys(e).map(function(t){e[t]&&i.push(t+"="+e[t])});var t=contextPath+"/testItemController/download?"+i.join("&");console.log(t),location.href=encodeURI(t)},delFile:function(t){layer.confirm("是否要删除这条信息!",{btn:["确定","取消"]},function(){t.del=!0,layer.closeAll("dialog")})},modalOk:function(){this.showUpload=!1},modalCancel:function(){},handleSuccess:function(t){"100100"===t.code?this.addAttachment(t.data[0]):layer.alert("上传失败")},handleFormatError:function(t){this.$Notice.warning({title:"文件格式异常!",desc:"File format of "+t.name+" is incorrect, please select jpg or png."})},handleMaxSize:function(t){this.$Notice.warning({title:"文件大小超出限制!",desc:"【"+t.name+"】的大小超过2M"})},handleBeforeUpload:function(){},addAttachment:function(t){var e={fdName:t.fdName,fdSize:parseFloat(t.fdSize).toFixed(2)+"kb",uploadTime:t.uploadTime,uploadUser:t.uploadUser,fdUrl:t.fdUrl,fdType:5,del:!1};this.inspectionItem.sysFile.fileDetails.push(e)},getOrgan:function(){var e=this;window.top.home.loading("show"),$.ajax({type:"post",url:contextPath+"/testItemController/getOrgName",dataType:"json",success:function(t){if(window.top.home.loading("hide"),"100100"===t.code)e.inspectionItem.groupId=t.data.id,e.inspectionItem.groupName=t.data.name,e.$forceUpdate();else if("-1"===t.code)return e.$Modal.warning({title:"提示信息",content:"服务器出错啦!"}),!1},error:function(){window.top.home.loading("hide"),alert("服务器出错啦")}})}},created:function(){var t=window.parent.params;this.params=t,null!=this.params.params.id&&(this.body={id:this.params.params.id},this.record_url=contextPath+"/testItemController/queryOperationLog?id="+this.body.id)},watch:{inspectionItem:{handler:function(){this.inspectionItem.code&&($("#approvalList").jqGrid("clearGridData"),$("#approvalList").jqGrid("setGridParam",{postData:{receiptsId:this.inspectionItem.code}}).trigger("reloadGrid"))},deep:!0}},mounted:function(){var t=this;$("#upperCommonDifference").blur(function(){t.numberOnly($("#upperCommonDifference").val())&&""!==$("#upperCommonDifference").val().replace(/[^0-9.]/g,"")&&""!==$("#upperCommonDifference").val()&&""!==$("#goalValue").val()&&"qtfxff"!==t.inspectionItem.analyseMethod&&($("#upperLimitValue").val(Number($("#upperCommonDifference").val())+Number($("#goalValue").val())),t.inspectionItem.upperLimitValue=$("#upperLimitValue").val())}),$("#upperLimitValue").blur(function(){t.numberOnly($("#upperLimitValue").val())&&""!==$("#upperLimitValue").val().replace(/[^0-9.]/g,"")&&""!==$("#upperLimitValue").val()&&""!==$("#goalValue").val()&&"qtfxff"!==t.inspectionItem.analyseMethod&&($("#upperCommonDifference").val(Number($("#upperLimitValue").val())-Number($("#goalValue").val())),t.inspectionItem.upperCommonDifference=$("#upperCommonDifference").val())}),$("#lowerCommonDifferent").blur(function(){t.numberOnly($("#lowerCommonDifferent").val())&&""!==$("#lowerCommonDifferent").val().replace(/[^0-9.]/g,"")&&"qtfxff"!==t.inspectionItem.analyseMethod&&""!==$("#lowerCommonDifferent").val()&&""!==$("#goalValue").val()&&($("#lowerLimitValue").val(Number($("#lowerCommonDifferent").val())+Number($("#goalValue").val())),t.inspectionItem.lowerLimitValue=$("#lowerLimitValue").val())}),$("#lowerLimitValue").blur(function(){t.numberOnly($("#lowerLimitValue").val())&&""!==$("#lowerLimitValue").val().replace(/[^0-9.]/g,"")&&"qtfxff"!==t.inspectionItem.analyseMethod&&""!==$("#lowerLimitValue").val()&&""!==$("#goalValue").val()&&($("#lowerCommonDifferent").val(Number($("#lowerLimitValue").val())-Number($("#goalValue").val())),t.inspectionItem.lowerCommonDifferent=$("#lowerCommonDifferent").val())}),this.openTime=window.parent.params.openTime,$("form").validate(),$.ajax({type:"POST",url:contextPath+"/baseDataController/listBean?datatypeId=2",contentType:"application/json",dataType:"json",success:function(t){inspectionItemVm.testMethodList=t.data},error:function(t){layer.alert("服务器出错")}}),$.ajax({type:"POST",url:contextPath+"/baseDataController/listBean?datatypeId=3",contentType:"application/json",dataType:"json",success:function(t){inspectionItemVm.standardList=t.data},error:function(t){layer.alert("服务器出错")}}),$.ajax({type:"POST",url:contextPath+"/baseDataController/listBean?datatypeId=4",contentType:"application/json",dataType:"json",success:function(t){inspectionItemVm.testInstrumentList=t.data},error:function(t){layer.alert("服务器出错")}}),$.ajax({type:"POST",url:contextPath+"/baseDataController/listBean?datatypeId=6",contentType:"application/json",dataType:"json",success:function(t){inspectionItemVm.bugRankList=t.data},error:function(t){layer.alert("服务器出错")}}),$.ajax({type:"POST",url:contextPath+"/baseDataController/listBean?datatypeId=7",contentType:"application/json",dataType:"json",success:function(t){inspectionItemVm.goalValueList=t.data},error:function(t){layer.alert("服务器出错")}}),t.itemstatusList=getCodeList("root_zj_jyxm_jyxmzt"),t.analyseMethodList=getCodeList("root_zj_jyxm_fxff"),t.statusList=getCodeList("root_zj_jyxm_zt"),t.operatorList=getCodeList("root_zj_jyxm_bjf"),t.sampleTypeList=getCodeList("root_zj_jyxm_cylx"),$.ajax({type:"POST",url:contextPath+"/testItemController/getProcessType",data:{parentId:1,isDel:1},dataType:"json",success:function(t){inspectionItemVm.productList=t.data},error:function(t){layer.alert("服务器出错")}}),$.ajax({type:"POST",url:contextPath+"/testItemController/getUnit",data:{groupId:1},dataType:"json",success:function(t){inspectionItemVm.unitList=t.data},error:function(t){layer.alert("服务器出错")}}),t.inspectionItem.testItemStatus="zc",t.inspectionItem.qualityStandardStatus="hg",t.inspectionItem.sampleType="abfbcy",t.initItem()}});