"use strict";function _defineProperty(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}var vm=new Vue({el:"#sale-order-list",data:function(){var e;return _defineProperty(e={isHideSearch:!0,isHideList:!0,openTime:"",modalType:"",approveComment:"",isSearchHide:!0,reload:!1,selected:[],modalTrigger:!1,isTabulationHide:!0},"modalType",""),_defineProperty(e,"documentNo",""),_defineProperty(e,"documentStatus",""),_defineProperty(e,"stepList",[]),_defineProperty(e,"dateArr",""),_defineProperty(e,"body",{searchDepositNo:"",searchSaleOrderNo:"",searchCustNo:"",searchCustName:"",searchPayWay:"",searchCreateTime:"",searchEndTime:"",page:"",limit:""}),_defineProperty(e,"auditParams",{approvalResult:"1",approvalInfo:"",nextLevel:"",lastNode:"",docTypeCode:"S_DEPOSIT",boeId:"",userId:"63",processId:"S_DEPOSIT_123",receiptsId:"",currentLevel:"",approvalStatus:""}),_defineProperty(e,"data_user_list",{url:contextPath+"/deposit/findSaleDepositEntityList",colNames:["日期","单据编号","单据状态","客户","应收总定金","实收总定金","支付方式"],colModel:[{name:"createTime",index:"createTime",width:200,align:"center",formatter:function(e,t,a,o){return new Date(e).format("yyyy-MM-dd")}},{name:"depositNo",index:"depositNo",width:200,align:"center",formatter:function(e,t,a,o){return $(document).off("click",".updateDetail"+e).on("click",".updateDetail"+e,function(){vm.updateDetail({value:e,grid:t,rows:a,state:o})}),'<a class="updateDetail'+e+'">'+e+"</a>"}},{name:"status",index:"status",width:200,align:"center",formatter:function(e,t,a,o){return 1==e?(console.log(1),"暂存"):2==e?(console.log(1),"待审核"):3==e?(console.log(1),"审核中"):4==e?(console.log(1),"已审核"):5==e?"驳回":void 0}},{name:"customerName",index:"customerName",width:200,align:"center"},{name:"totalReceDepositAmount",index:"totalReceDepositAmount",width:200,align:"center",formatter:function(e,t,a,o){if(null!=e)return e.toFixed(2);return(0).toFixed(2)}},{name:"totalPaidDepositAmount",index:"totalPaidDepositAmount",width:200,align:"center",formatter:function(e,t,a,o){if(null!=e)return e.toFixed(2);return(0).toFixed(2)}},{name:"payWay",index:"payWay",width:200,align:"center"}]}),e},methods:{updateDetail:function(e){var t=e.rows;console.log(t);var a=[];a.push(2),a.push(t.id),a.push(t.status),null!=t.id&&window.parent.activeEvent({name:"销售定金-查看",url:contextPath+"/sale/deposit/sale-order-add.html",params:{allInfo:a,type:"query"}})},clean:function(){this.$refs.payWay.reset(),this.$nextTick(function(){this.body.searchPayWay=""}),this.body={searchDepositNo:"",searchSaleOrderNo:"",searchCustName:"",searchPayWay:"",searchCreateTime:"",searchEndTime:""},this.dateArr=[],vm.reload=!vm.reload},newButton:function(){var e=[];e.push(4),window.parent.activeEvent({name:"销售定金单-新增",url:contextPath+"/sale/deposit/sale-order-add.html",params:{allInfo:e,type:"query"}})},update:function(){var e=this.selected,t=$("#myTable").jqGrid("getRowData",this.selected[0]).status.replace(/<.*?>+/g,"");if(1!=e.length)vm.$Modal.info({content:"提交和修改只支持单条记录操作，谢谢合作！"});else{if("暂存"!==t)return this.$Modal.warning({title:"提示",content:"非暂存状态不允许修改!"}),!1;var a=[];a.push(3),a.push(this.selected[0]),console.log(a),window.parent.activeEvent({name:"销售定金-修改",url:contextPath+"/sale/deposit/sale-order-add.html",params:{allInfo:a,type:"query"}})}},refresh:function(){vm.reload=!vm.reload},changeDate:function(e){this.body.searchCreateTime=""==e[0]?"":e[0].replace(/\//g,"-")+" 00:00:00",this.body.searchEndTime=""==e[1]?"":e[1].replace(/\//g,"-")+" 23:59:59"},search1:function(){this.reload=!this.reload},deleteSaleOrder:function(){for(var e=[],t=0;t<this.selected.length;t++){var a=$("#myTable").jqGrid("getRowData",this.selected[t]),o=a.status.replace(/<.*?>+/g,""),n=a.depositNo.replace(/<.*?>+/g,"");"暂存"!=o&&e.push(n)}if(this.selected.length<=0)return this.$Modal.warning({title:"提示",content:"请先选择需要删除的销售定金单数据"}),!1;if(0<e.length)return console.log(e),this.$Modal.warning({title:"提示",content:e+"单据状态为非暂存，不能删除"}),!1;var i=new Array;for(t=0;t<this.selected.length;t++)i[t]=this.selected[t];$.ajax({type:"post",async:!0,traditional:!0,data:{ids:i},url:contextPath+"/deposit/delete",success:function(e){"刪除成功！"==e.data?vm.$Modal.info({content:e.data}):vm.$Modal.info({content:"删除失败！"}),vm.reload=!vm.reload},error:function(e){console.log(e)}})},submitCheck:function(){var e=this.selected,t=$("#myTable").jqGrid("getRowData",this.selected[0]).status.replace(/<.*?>+/g,"");if(1!=e.length)vm.$Modal.info({content:"提交和修改只支持单条记录操作，谢谢合作！"});else{if("暂存"!==t)return this.$Modal.warning({title:"提示",content:"非暂存状态不允许提交!"}),!1;var a=$("#myTable").jqGrid("getRowData",e).depositNo.replace(/<.*?>+/g,"");$.ajax({type:"post",async:!0,traditional:!0,data:{id:e,depositNo:a},url:contextPath+"/deposit/submitCheck",dataType:"json",success:function(e){if("100100"==e.code)vm.$Modal.info({content:"提交成功！"}),vm.reload=!vm.reload;else if("100101"==e.code)vm.$Modal.info({content:"审批申请未成功！"}),vm.reload=!vm.reload;else if("-1"==e.code){if(null!=e.data.CreateTime)return void vm.$Modal.info({content:e.data.CreateTime});if(null!=e.data.Unequal)return void vm.$Modal.info({content:e.data.Unequal});if(null!=e.data.PayWay)return void vm.$Modal.info({content:e.data.PayWay});if(null!=e.data.TotalPaidDepositAmount)return void vm.$Modal.info({content:e.data.TotalPaidDepositAmount})}},error:function(e){console.log(e)}})}},approvalOrRejectCallBack:function(e){var t=this,a=this.selected,o=$("#myTable").jqGrid("getRowData",this.selected[0]).depositNo.replace(/<.*?>+/g,"");if("100515"==e.result.code&&("approve"==t.modalType&&t.updateStatus(a[0],o,4),"reject"==t.modalType&&t.updateStatus(a[0],o,1)),"100100"==e.result.code){var n=e.result.data.approvalStatus,i="";if(0==n)i=3;else if(1==n)i=4;else if(-1==n)i=5;else{if(-2!=n)return t.$Modal.warning({content:"审核异常!",title:"警告"}),!1;i=1}4==i&&(t.updataCustOrder(a[0]),t.saveFinancialData(a[0])),t.updateStatus(a[0],o,i)}},updateStatus:function(e,t,a){$.ajax({type:"post",url:contextPath+"/deposit/updateStatus",data:{id:e,deposit:t,status:a},dataType:"json",success:function(e){vm.reload=!vm.reload}})},updataCustOrder:function(e){$.ajax({type:"post",url:contextPath+"/deposit/updataCustOrder",data:{id:e},dataType:"json",success:function(e){"100100"==e.code&&(vm.reload=!vm.reload)}})},saveFinancialData:function(e){$.ajax({type:"post",url:contextPath+"/deposit/saveFinancialData",data:{id:e},dataType:"json",success:function(e){"100100"==e.code&&(vm.reload=!vm.reload)}})},audit:function(){var e=this.selected,t=$("#myTable").jqGrid("getRowData",this.selected[0]),a=t.depositNo.replace(/<.*?>+/g,""),o=t.status.replace(/<.*?>+/g,"");if(1==e.length)if("待审核"===t.status||"审核中"===t.status||"驳回"===t.status){var n=this;n.id=t.id,n.documentStatus=o,n.documentNo=a,n.modalType="approve",n.modalTrigger=!n.modalTrigger}else{if("暂存"===t.documentStatus)return void this.$Modal.warning({title:"提示信息",content:"请提交单据！"});if(4===t.documentStatus)return void this.$Modal.warning({title:"提示信息",content:"该单已审核,不能重复审核！"})}else this.$Modal.warning({title:"提示信息",content:"只能选择一条数据！"})},reject:function(){var e=this.selected,t=$("#myTable").jqGrid("getRowData",this.selected[0]),a=t.depositNo.replace(/<.*?>+/g,""),o=t.status.replace(/<.*?>+/g,"");if(1==e.length)if("待审核"===t.status||"审核中"===t.status||"驳回"===t.status){var n=this;n.id=t.id,n.documentStatus=o,n.documentNo=a,n.modalType="reject",n.modalTrigger=!n.modalTrigger}else this.$Modal.warning({title:"提示信息",content:"该单状态不能驳回！"});else this.$Modal.warning({title:"提示信息",content:"请选择一条数据！"})},exit:function(){window.parent.closeCurrentTab({exit:!0,openTime:this.openTime})}},mounted:function(){this.openTime=window.parent.params.openTime}});