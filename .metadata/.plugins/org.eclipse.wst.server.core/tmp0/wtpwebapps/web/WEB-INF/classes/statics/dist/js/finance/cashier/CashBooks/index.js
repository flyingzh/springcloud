"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},vm=new Vue({el:"#cash-book-test",data:function(){var a=this;return{openTime:"",baseData:{standardCurrencyId:"",subjectName:"",currencyName:"",periodDate:"",curYear:"",curPeriod:"",startCnDate:"",cnStartYear:"",cnStartPeriod:""},voucherFilter:{voucherWordId:0,abnormalDataProcessing:"1",subjectMergerDebit:!1,subjectMergerLender:!1},editData:{id:"",sobId:"",subjectId:"",subjectCode:"",subjectName:"",subjectValue:"",relativeSubjectId:"",relativeSubjectCode:"",relativeSubjectName:"",relativeSubjectValue:"",currencyId:"",datetime:"",periodDate:"",serialNumber:"",debitAmount:"",debitAmountFor:"",debitAmountForRate:"",creditAmountFor:"",creditAmountForRate:"",creditAmount:"",remark:"",direction:"",exchangeRate:"",accountYear:"",accountPeriod:"",handleId:"",handleName:"",isProject:"",isCarryOver:"1",dataSource:"2",summary:""},addData:{sobId:"",subjectId:"",currencyId:"",datetime:"",serialNumber:"",periodDate:"",debitAmount:"",debitAmountFor:"",debitAmountForRate:"",creditAmountFor:"",creditAmountForRate:"",creditAmount:"",remark:"",relativeSubjectId:"",relativeSubjectCode:"",relativeSubjectName:"",relativeSubjectValue:"",direction:"",exchangeRate:"",accountYear:"",accountPeriod:"",handleId:"",handleName:"",isProject:"",isCarryOver:"1",dataSource:"2",summary:""},openData:{sobId:"",subjectId:"",currencyId:"",startYear:"",endYear:"",startPeriod:"",endPeriod:"",startDate:"",endDate:"",voucherGroupId:"-1",startVoucherGroupNumber:"",endVoucherGroupNumber:"",explains:"",relateSubjectId:"",handleId:"",prepareId:"",showInitBalance:!0,showDetailRecord:!0,showDaySum:!0,showPeriodSum:!0,showYearSum:!0,showTotalSum:!0,type:"1",subjectName:"",currencyName:""},importData:{startYear:"",startPeriod:"",voucherGroupId:"",startVoucherGroupNumber:"",endVoucherGroupNumber:"",audited:"",posted:"",preparerId:"",importId:[]},filterVisible:!1,editVisible:!1,voucherModelTxt:"",viewReportTxt:"",showVoucherVisible:!1,voucherVisible:!1,importVisible:!1,base_config:{multiselect:!0,mtype:"POST",styleUI:"Bootstrap",url:contextPath+"/cashier/cashierDetail",ajaxGridOptions:{contentType:"application/json;charset=utf-8"},datatype:"json",jsonReader:{root:"data.resultVo"},height:$(window).height()-140,viewrecords:!0,rowNum:999999999,onSelectAll:function(t,e){a.handlerId(t,e,"selected")},onSelectRow:function(t,e){console.log("data---------",t,e),t&&(a.handlerId(t,e,"selected"),console.log(a.selected))},gridComplete:function(){$("table[id='grid'] tr[id='null'] input").attr("style","display:none"),$("table[id='grid'] tr[id='0'] input").attr("style","display:none"),window.top.home.loading("hide")}},colNames:[],colModel:[],tableHeaders:[],organisationList:[{label:"金大祥",value:1}],subjectList:[],currencyList:[],voucherExpList:[],voucherDataList:[],voucherDataLists:[],voucherDataListForImport:[],periodYear:[],periodList:[{name:"1",value:1},{name:"2",value:2},{name:"3",value:3},{name:"4",value:4},{name:"5",value:5},{name:"6",value:6},{name:"7",value:7},{name:"8",value:8},{name:"9",value:9},{name:"10",value:10},{name:"11",value:11},{name:"12",value:12}],auditedList:[{id:-1,name:"全部"},{id:1,name:"已审核"},{id:2,name:"未审核"}],postedList:[{id:-1,name:"全部"},{id:1,name:"已过账"},{id:2,name:"未过账"}],editTitle:"",subjectVisable:!1,isContinue:!1,viewReportVisible:!1,subjectTpye:"",tableList:[],selected:[],selectedId:[],importSelected:[],addSubjectListOpt:[],addSubjectListOptShow:!1,subjectOpts:{},optsVal:{},remarkVisable:!1,remarklist:[],remarkType:0,handManList:[],openMakerList:[],openHandleList:[],importVoucherHandleList:[],editExchangeRateDisabled:!0,dataList:[],printModal:!1,printInfo:{}}},mounted:function(){this.openTime=window.parent.params&&window.parent.params.openTime,this.initPage(),this._queryObject()},methods:{openSubjectChange:function(a){var r={};vm.subjectList.map(function(t,e){t.accountId==a&&(r=t)}),console.log(r),$.ajax({type:"post",url:contextPath+"/cashier/getCurrencyListBySubjectId",data:{subjectId:a},success:function(t){console.log(t),"100100"!=t.code?layer.alert("获取币别列表异常"):vm.currencyList=t.data}})},currencyChange:function(a){$.each(vm.currencyList,function(t,e){a==e.id&&(vm.editData.debitAmountForRate=e.exchangeRate,vm.editData.creditAmountForRate=e.exchangeRate,a===vm.baseData.standardCurrencyId?vm.editExchangeRateDisabled=!0:vm.editExchangeRateDisabled=!1)})},bookDateChange:function(e){if(null!=e&&""!=e){var t={currentDate:new Date(e).format("yyyy-MM-dd"),currencyId:vm.editData.currencyId};$.ajax({type:"post",url:contextPath+"/cashier/getPeriodByDate",data:t,success:function(t){console.log(t),"100100"==t.code&&null!=t.data?(vm.editData.periodDate=t.data.year+"年"+t.data.month+"期",vm.editData.serialNumber=t.data.serialNum,vm.editData.datetime=e):layer.alert("请求错误")}})}},clickDigest:function(t){this.remarkType=t,this.remarkVisable=!0},onDblclickRemarkRow:function(t){var e=this;1===e.remarkType?e.editData.summary=t.content:e.openData.explains=t.content,e.remarkVisable=!1},onRemarkModalChange:function(t){this.remarkVisable=t},onRemarkListChange:function(t){this.remarklist=t},initPage:function(){var r=this;$.ajax({type:"post",url:contextPath+"/cashier/init",dataType:"json",data:null,success:function(t){if(console.log(t),"100100"==t.code){var a=t.data;r.organisationList=a.org,r.baseData.standardCurrencyId=a.standardCurrencyId,r.currencyList=a.currencyList,r.voucherExpList=a.voucherExpList,r.remarklist=a.voucherExpList,r.subjectList=a.subjectList,r.voucherDataList=$.extend(!0,[],a.voucherDataList),r.voucherDataLists=$.extend(!0,[],a.voucherDataList),console.log("_vm.voucherDataLists",r.voucherDataLists),r.voucherDataListForImport=a.voucherDataList,r.periodYear=a.periodYear,r.handManList=a.projectList[3],r.addData.accountYear=a.cnCurrentAccountYear,r.addData.accountPeriod=a.cnCurrentAccountPeriod,r.baseData.curYear=a.cnCurrentAccountYear,r.baseData.curPeriod=a.cnCurrentAccountPeriod,r.baseData.cnStartYear=a.cnStartYearAndPeriod.generalLedgerYear,r.baseData.cnStartPeriod=a.cnStartYearAndPeriod.generalLedgerPeriod,r.baseData.startCnDate=a.startCnDate,r.addData.sobId=a.org[0].value,$.isEmptyObject(a.subjectList)||0==a.subjectList.length||(r.addData.subjectId=a.subjectList[0].accountId,r.openData.subjectId=a.subjectList[0].accountId,r.openData.subjectName=a.subjectList[0].accountName),r.addData.currencyId=a.currencyList[0].id,$.each(r.currencyList,function(t,e){r.addData.currencyId==e.id&&(r.addData.debitAmountForRate=e.exchangeRate,r.addData.creditAmountForRate=e.exchangeRate,r.openData.currencyName=e.currencyName)}),r.addData.serialNumber=a.serialNum,r.addData.datetime=a.endDate,r.addData.periodDate=a.cnCurrentAccountYear+"年"+a.cnCurrentAccountPeriod+"期",Object.assign(r.editData,r.addData),r.openData.startDate=a.startDate,r.openData.endDate=a.endDate,r.openData.sobId=a.org[0].value,r.openData.currencyId=a.currencyList[0].id,$.each(a.periodYear,function(t,e){e.name==a.cnCurrentAccountYear&&(r.openData.startYear=e.value,r.openData.endYear=e.value,r.importData.startYear=e.value)}),$.each(r.periodList,function(t,e){e.name==a.cnCurrentAccountPeriod&&(r.openData.startPeriod=e.value,r.openData.endPeriod=e.value,r.importData.startPeriod=e.value)}),r.subjectOpts=a.projectOpts,r.openMakerList=a.handleAndMakerList.handle,r.openHandleList=a.handleAndMakerList.make,r.importVoucherHandleList=a.handleAndMakerList.voucherMake;r.voucherDataListForImport.unshift({id:-1,name:"全部"});r.importVoucherHandleList.unshift({preparerId:-1,prepareName:"全部"}),r.importData.voucherGroupId=r.voucherDataListForImport[0].id,r.importData.audited=r.auditedList[0].id,r.importData.posted=r.postedList[0].id,r.importData.preparerId=r.importVoucherHandleList[0].preparerId,r.initMethod(),r.importInit()}else layer.alert("页面初始化失败")}})},showVoucherVisibleClose:function(){$("#list").setGridParam({postData:JSON.stringify(this.openData)}).trigger("reloadGrid"),this.selected=[],this.isContinue=!1,this.initMethod()},showViewReport:function(t){this.viewReportVisible=!this.viewReportVisible},initMethod:function(){var t=this.openData;if(1==t.type){if(t.startYear>t.endYear||t.startYear==t.endYear&&t.startPeriod>t.endPeriod)return void this.$Message.error("开始期间不能大于结束期间");if(t.startYear<this.baseData.cnStartYear||t.startYear==this.baseData.cnStartYear&&t.startPeriod<this.baseData.cnStartPeriod)return void this.$Message.error("有效查询起始期间为："+this.baseData.cnStartYear+"年第"+this.baseData.cnStartPeriod+"期");if(t.endYear>this.baseData.curYear||t.endYear==this.baseData.curYear&&t.endPeriod>this.baseData.curPeriod+1)return void this.$Message.error("只允许查询"+this.baseData.curYear+"年第"+(this.baseData.curPeriod+1)+"期之前的日记账")}else if(2==t.type){var e=Date.parse(t.startDate)/1e3,a=Date.parse(t.endDate)/1e3;if(console.log(e,a),a<e)return void this.$Message.error("开始日期不能大于结束日期");if(e<this.baseData.startCnDate/1e3){var r=new Date;r.setTime(this.baseData.startCnDate);var i=new Date(r.toDateString()).format("yyyy-MM-dd");return void this.$Message.error("有效查询起始日期为："+i)}t.startDate=new Date(t.startDate).format("yyyy-MM-dd"),t.endDate=new Date(t.endDate).format("yyyy-MM-dd")}this.delTable(),this.setTableHeader(),this.filterVisible=!1},printV:function(){var e=this;if(e.dataList&&e.dataList.length)if($.each(e.dataList,function(t,e){e.audited=1==e.audited?"Y":"N",e.posted=1==e.posted?"Y":"N","1"==e.dataSource?e.dataSource="总账引入":"2"==e.dataSource?e.dataSource="手工录入":"3"==e.dataSource?e.dataSource="Excel导入":e.dataSource=""}),e.openData.currencyId==e.baseData.standardCurrencyId){var t={title:"现金日记账",template:1,titleInfo:[{name:"科目",val:e.baseData.subjectName},{name:"币别",val:e.baseData.currencyName}],colNames:[{name:"日期",col:"datetimeStr"},{name:"当日序号",col:"serialNumber"},{name:"凭证字号",col:"voucherGroupData"},{name:"凭证期间",col:"voucherPeriodData"},{name:"凭证审核",col:"audited"},{name:"过账标志",col:"posted"},{name:"摘要",col:"summary"},{name:"对方科目",col:"relateSubjectName"},{name:"借方金额",col:"debitAmount",formatNub:!0},{name:"贷方金额",col:"creditAmount",formatNub:!0},{name:"余额",col:"balance",formatNub:!0},{name:"经手人",col:"handleName"},{name:"制单人",col:"createName"},{name:"数据来源",col:"dataSource"},{name:"备注",col:"remark"}],styleCss:"",colMaxLenght:9,data:e.dataList};e.printInfo=t,e.printModalShow(!0)}else{var a=e.dataList,r="";'\n                    <tr class=\'thCs\'>\n                        <th rowspan="2" style="width: 6%">日期</th>\n                        <th rowspan="2" style="width: 6%">当日序号</th>\n                        <th rowspan="2" style="width: 6%">凭证字号</th>\n                        <th rowspan="2" style="width: 6%">凭证期间</th>\n                        <th rowspan="2" style="width: 6%">凭证审核</th>\n                        <th rowspan="2" style="width: 6%">过账标志</th>\n                        <th rowspan="2" style="width: 6%">摘要</th>\n                        <th rowspan="2" style="width: 6%">对方科目</th>\n                        <th colspan="2" style="width: 12%">借方金额</th>\n                        <th colspan="2" style="width: 12%">贷方金额</th>\n                        <th colspan="2" style="width: 12%">余额</th>\n                        <th rowspan="2" style="width: 6%">经手人</th>\n                        <th rowspan="2" style="width: 6%">制单人</th>\n                        <th rowspan="2" style="width: 6%">数据来源</th>\n                        <th rowspan="2" style="width: 6%">备注</th>\n                    </tr>\n                     <tr class=\'thCs\'>\n                        <th style="width: 6%">原币</th>\n                        <th style="width: 6%">本位币</th>\n                        <th style="width: 6%">原币</th>\n                        <th style="width: 6%">本位币</th>\n                        <th style="width: 6%">原币</th>\n                        <th style="width: 6%">本位币</th>\n                    </tr>\n                ',a.forEach(function(t){r+="\n                        <tr>\n                            <td>"+e._nullData(t.datetimeStr)+"</td>\n                            <td>"+e._nullData(t.serialNumber)+"</td>\n                            <td>"+e._nullData(t.voucherGroupData)+"</td>\n                            <td>"+e._nullData(t.voucherPeriodData)+"</td>\n                            <td>"+e._nullData(t.audited)+"</td>\n                            <td>"+e._nullData(t.posted)+"</td>\n                            <td>"+e._nullData(t.summary)+"</td>\n                            <td>"+e._nullData(t.relateSubjectName)+"</td>\n                            <td>"+e.formartMoney(t.debitAmountFor)+"</td>\n                            <td>"+e.formartMoney(t.debitAmount)+"</td>\n                            <td>"+e.formartMoney(t.creditAmountFor)+"</td>\n                            <td>"+e.formartMoney(t.creditAmount)+"</td>\n                            <td>"+e.formartMoney(t.balanceFor)+"</td>\n                            <td>"+e.formartMoney(t.balance)+"</td>\n                            <td>"+e._nullData(t.handleName)+"</td>\n                            <td>"+e._nullData(t.createName)+"</td>\n                            <td>"+e._nullData(t.dataSource)+"</td>\n                            <td>"+e._nullData(t.remark)+"</td>\n                        </tr>\n                    "});var i={title:"现金日记账",template:12,titleInfo:[{name:"科目",val:e.baseData.subjectName},{name:"币别",val:e.baseData.currencyName}],data:[],colMaxLenght:10,tbodyInfo:{theadTX:'\n                    <tr class=\'thCs\'>\n                        <th rowspan="2" style="width: 6%">日期</th>\n                        <th rowspan="2" style="width: 6%">当日序号</th>\n                        <th rowspan="2" style="width: 6%">凭证字号</th>\n                        <th rowspan="2" style="width: 6%">凭证期间</th>\n                        <th rowspan="2" style="width: 6%">凭证审核</th>\n                        <th rowspan="2" style="width: 6%">过账标志</th>\n                        <th rowspan="2" style="width: 6%">摘要</th>\n                        <th rowspan="2" style="width: 6%">对方科目</th>\n                        <th colspan="2" style="width: 12%">借方金额</th>\n                        <th colspan="2" style="width: 12%">贷方金额</th>\n                        <th colspan="2" style="width: 12%">余额</th>\n                        <th rowspan="2" style="width: 6%">经手人</th>\n                        <th rowspan="2" style="width: 6%">制单人</th>\n                        <th rowspan="2" style="width: 6%">数据来源</th>\n                        <th rowspan="2" style="width: 6%">备注</th>\n                    </tr>\n                     <tr class=\'thCs\'>\n                        <th style="width: 6%">原币</th>\n                        <th style="width: 6%">本位币</th>\n                        <th style="width: 6%">原币</th>\n                        <th style="width: 6%">本位币</th>\n                        <th style="width: 6%">原币</th>\n                        <th style="width: 6%">本位币</th>\n                    </tr>\n                ',tbodyTX:r,tfootTX:""}};htPrint(i)}else e.$Message.info({content:"无打印数据",duration:3})},_nullData:function(t){return t||""},formartMoney:function(t){return null==t||0==t?"":accounting.formatNumber(t,2,"")},printModalShow:function(t){this.printModal=t},setTableHeader:function(){this.baseData.standardCurrencyId===this.openData.currencyId?(this.colNames=["id","日期","当日序号","凭证字号","凭证期间","凭证审核","过账标志","摘要","对方科目","借方金额","贷方金额","余额","经手人","制单人","数据来源","备注","voucherId","sobId"],this.colModel=[{name:"id",width:30,hidden:!0},{name:"datetimeStr",width:100},{name:"serialNumber",width:100,formatter:function(t,e,a){return null!=t&&0!=t?t:""}},{name:"voucherGroupData",width:100},{name:"voucherPeriodData",width:100},{name:"audited",width:100,align:"center",formatter:function(t,e,a){return 1==t?'<i class="ivu-icon ivu-icon-checkmark-round"></i>':""}},{name:"posted",width:100,align:"center",formatter:function(t,e,a){return 1==t?'<i class="ivu-icon ivu-icon-checkmark-round"></i>':""}},{name:"summary",width:120},{name:"relateSubjectName",width:150,formatter:function(t,e,a){return null!=t&&0!=t?t:""}},{name:"debitAmount",width:100,align:"right",formatter:function(t,e,a){return null==t||0==t?"":accounting.formatNumber(t,2,",")}},{name:"creditAmount",width:100,align:"right",formatter:function(t,e,a){return null==t||0==t?"":accounting.formatNumber(t,2,",")}},{name:"balance",width:100,align:"right",formatter:function(t,e,a){return null==t||0==t?"":accounting.formatNumber(t,2,",")}},{name:"handleName",width:90},{name:"createName",width:90},{name:"dataSource",width:150,formatter:function(t,e,a){return 1==t?"总账引入":2==t?"手工录入":3==t?"Excel导入":""}},{name:"remark",width:90},{name:"voucherId",hidden:!0},{name:"sobId",hidden:!0}],this.tableHeaders=[]):(this.colNames=["id","日期","当日序号","凭证字号","凭证期间","凭证审核","过账标志","摘要","对方科目","原币","本位币","原币","本位币","原币","本位币","经手人","制单人","数据来源","备注","voucherId","sobId"],this.colModel=[{name:"id",width:30,hidden:!0},{name:"datetimeStr",width:100},{name:"serialNumber",width:100,formatter:function(t,e,a){return null!=t&&0!=t?t:""}},{name:"voucherGroupData",width:100},{name:"voucherPeriodData",width:100},{name:"audited",width:100,align:"center",formatter:function(t,e,a){return 1==t?'<i class="ivu-icon ivu-icon-checkmark-round"></i>':""}},{name:"posted",width:100,align:"center",formatter:function(t,e,a){return 1==t?'<i class="ivu-icon ivu-icon-checkmark-round"></i>':""}},{name:"summary",width:120},{name:"relateSubjectName",width:150,formatter:function(t,e,a){return null!=t&&0!=t?t:""}},{name:"debitAmountFor",width:100,align:"right",formatter:function(t,e,a){return null==t||0==t?"":accounting.formatNumber(t,2,",")}},{name:"debitAmount",width:100,align:"right",formatter:function(t,e,a){return null==t||0==t?"":accounting.formatNumber(t,2,",")}},{name:"creditAmountFor",width:100,align:"right",formatter:function(t,e,a){return null==t||0==t?"":accounting.formatNumber(t,2,",")}},{name:"creditAmount",width:100,align:"right",formatter:function(t,e,a){return null==t||0==t?"":accounting.formatNumber(t,2,",")}},{name:"balanceFor",width:100,align:"right",formatter:function(t,e,a){return null==t||0==t?"":accounting.formatNumber(t,2,",")}},{name:"balance",width:100,align:"right",formatter:function(t,e,a){return null==t||0==t?"":accounting.formatNumber(t,2,",")}},{name:"handleName",width:90},{name:"createName",width:90},{name:"dataSource",width:150,formatter:function(t,e,a){return 1==t?"总账引入":2==t?"手工录入":3==t?"Excel导入":""}},{name:"remark",width:90},{name:"voucherId",hidden:!0},{name:"sobId",hidden:!0}],this.tableHeaders=[{startColumnName:"debitAmountFor",numberOfColumns:2,titleText:"借方金额"},{startColumnName:"creditAmountFor",numberOfColumns:2,titleText:"贷方金额"},{startColumnName:"balanceFor",numberOfColumns:2,titleText:"余额"}]),this.jqGridInit(this.colNames,this.colModel,this.tableHeaders)},showVoucher:function(t){this.showVoucherVisible=t},delTable:function(){$("#grid").empty();var t=$(".jqGrid_wrapper");t.empty(),$('<table id="grid"></table><div id="page"></div>').appendTo(t)},jqGridInit:function(t,e,r){var i=this,a=Object.assign({},this.base_config,{colNames:t,colModel:e,postData:JSON.stringify(i.openData),loadComplete:function(t){console.log(t),null!=t&&null!=t.data&&null!=t.data.resultVo&&(i.dataList=t.data.resultVo),jQuery("#grid").jqGrid("destroyGroupHeader"),jQuery("#grid").jqGrid("setGroupHeaders",{useColSpanStyle:!0,groupHeaders:r});var e=jQuery("#grid").jqGrid("getRowData"),a=$("#grid").jqGrid("getDataIDs");e.push($("#grid").jqGrid("getRowData",a[a.length-1])),i.tableList=e,console.log("tableList",i.tableList),"100100"==t.code?(i.baseData.subjectName=t.data.subjectName,i.baseData.currencyName=t.data.currencyName,i.baseData.periodDate=t.data.queryPeriod):layer.alert(t.msg)}});jQuery("#grid").jqGrid(a)},open:function(){this.filterVisible=!0},refresh:function(){window.top.home.loading("show"),this.showVoucherVisibleClose()},exitPrevent:function(){window.parent.closeCurrentTab({name:"现金日记账",openTime:this.openTime,exit:!0})},addFun:function(){Object.assign(this.editData,this.addData),this.bookDateChange(this.openData.endDate),this.editTitle="现金日记账 - 新增",this.editVisible=!0},editFun:function(){var r=this;Object.assign(r.editData,r.addData);var t=r.selected.filter(function(t){return!!t});1==r.filterCashierId(t).length?$.ajax({type:"post",url:contextPath+"/cashier/info",data:{id:t[0]},dataType:"json",success:function(t){if(console.log(t),"100100"==t.code){r.editTitle="现金日记账 - 编辑",r.editVisible=!0;var e=t.data.cashJournal,a=t.data.opts;r.editData.id=e.id,r.editData.sobId=e.sobId,r.editData.subjectId=e.subjectId,r.editData.currencyId=e.currencyId,r.editData.datetime=new Date(e.datetime).format("yyyy-MM-dd"),r.editData.periodDate=e.accountYear+"年"+e.accountPeriod+"期",r.editData.serialNumber=e.serialNumber,r.editData.debitAmount=0==e.debitAmount?"":e.debitAmount,r.editData.debitAmountFor=0==e.debitAmountFor?"":e.debitAmountFor,r.editData.debitAmountForRate=e.exchangeRate,r.editData.creditAmount=0==e.creditAmount?"":e.creditAmount,r.editData.creditAmountFor=0==e.creditAmountFor?"":e.creditAmountFor,r.editData.creditAmountForRate=e.exchangeRate,r.editData.remark=e.remark,r.editData.relativeSubjectId=e.relativeSubjectId,r.editData.exchangeRate=e.exchangeRate,r.editData.accountYear=e.accountYear,r.editData.accountPeriod=e.accountPeriod,r.editData.handleId=e.handleId,r.editData.handleName=e.handleName,r.editData.isProject=e.isProject,r.editData.isCarryOver=e.isCarryOver,r.editData.dataSource=e.dataSource,r.editData.summary=e.summary,r.editData.relativeSubjectCode=e.relativeSubjectCode||"",r.editData.relativeSubjectName=e.relativeSubjectName||"",r.optsVal=a||{},r.addSubjectListOptClose()}else layer.alert(t.msg)}}):r.$Message.error("请选择一条日记账")},importFun:function(){this.importVisible=!0},deleteCashierRecord:function(){var e=this,t=e.selected;if(null!=t&&0!=t.length){var a=e.filterCashierId(t);$.ajax({type:"post",url:contextPath+"/cashier/deleteDailyAccount",data:{ids:a},success:function(t){if("100100"==t.code){e.voucherModelTxt=t.data.resultData;e.viewReportTxt=t.data.detailResult,e.showVoucher(!0),e.isContinue=!1}else null==t?layer.alert("系统异常"):layer.alert(t.msg)}})}else e.$Message.error("请选择一条日记账")},creatVoucher:function(){this.voucherVisible=!0},openSave:function(){this.showVoucherVisibleClose()},editSave:function(){var e=this,a=e.editData;if(null!=a.serialNumber&&0!=a.serialNumber)if(null!=a.summary&&""!=a.summary)if(a.debitAmountFor||a.creditAmountFor){var t=a.debitAmountFor&&parseFloat(a.debitAmountFor),r=a.creditAmountFor&&parseFloat(a.creditAmountFor);if(t&&r)e.$Message.error("不能同时输入借方金额和贷方金额");else{$.each(e.handManList,function(t,e){e.name==a.handleId&&(a.handleName=e.value)});var i={cashJournal:a,opts:e.optsVal};console.log(i),$.ajax({type:"post",url:contextPath+"/cashier/saveOrUpdate",data:JSON.stringify(i),contentType:"application/json;charset=utf-8",dataType:"json",success:function(t){"100100"==t.code?(layer.alert("操作成功"),e.editVisible=!1,e.showVoucherVisibleClose()):layer.alert(t.msg)}})}}else e.$Message.error("请输入借方金额或贷方金额");else e.$Message.error("摘要不能为空");else e.$Message.error("当日序号不能小于1")},importSave:function(){var e=this;console.log(e.importData),$.ajax({type:"post",url:contextPath+"/cashier/importCashierJournal",data:JSON.stringify(e.importData),contentType:"application/json;charset=utf-8",dataType:"json",success:function(t){"100100"==t.code?(layer.alert("操作成功"),e.importSelected=[],e.importData.importId=[],e.importVisible=!1,e.showVoucherVisibleClose()):null==t?layer.alert("系统异常"):layer.alert(t.msg)}})},_queryObject:function(){var e=this,t=baseURL+"generatingCredentialOption/getCredentialOption",a=new FormData;a.append("ownershipSystem",31),http.post(t,a).then(function(t){"100100"===t.code&&(e.voucherFilter=t.data)},function(t){})},voucherSave:function(){var e=this;console.log(e.voucherFilter,"===that.voucherFilter");var t=baseURL+"generatingCredentialOption/update",a=new FormData;a.append("voucherWordId",parseInt(e.voucherFilter.voucherWordId)),a.append("abnormalDataProcessing",parseInt(e.voucherFilter.abnormalDataProcessing)),a.append("subjectMergerDebit",e.voucherFilter.subjectMergerDebit),a.append("subjectMergerLender",e.voucherFilter.subjectMergerLender),a.append("ownershipSystem",31),http.post(t,a).then(function(t){"100100"===t.code&&e.cancel("voucher"),e.$Message.info({content:t.msg,duration:3})},function(t){}),this.voucherVisible=!1},filterCashierId:function(t){return t.filter(function(t,e,a){return""!=t&&"0"!=t&&"null"!=t})},selectRowAction:function(t){console.log("type",t);var r=this,e="",a=r.selected;console.log("选中的id数组为====>>",a);var i=a.filter(function(t,e,a){return"0"!=t&&"null"!=t});if(0!==i.length){if(console.log("id数组为====>>",i),"according"===t)r._ajaxAccording(i);else if("summary"===t)e=baseURL+"cashier/setPoolVoucher",$.ajax({type:"post",async:!1,url:e,data:{ids:i},success:function(t){var e="";if("100100"===t.code){if("1"===t.data.gcoe.abnormalDataProcessing){var a={name:"查看凭证",url:contextPath+"/finance/voucher-lrt/index.html?key="+t.data.key+"&sys=31&type=3"};window.parent.activeEvent(a)}e=t.msg}else e=t.msg;r.refresh(),r.$Message.info({content:e,duration:3})}});else if("voucher"===t){if(console.log("that.parame",i),0===i.length)return void r.$Message.info({content:"请选择一个单据。",duration:3});for(var o=i[i.length-1],n="",d=0;d<r.tableList.length;d++)if(r.tableList[d].id==o){n=r.tableList[d];break}if(console.log("_d",n),console.log("_d",n.voucherId),""===n.voucherGroupData||void 0===_typeof(n.voucherId))return void r.$Message.info({content:"最后选取的单据暂未生成凭证。",duration:3});console.log("parame",i);var s={name:"查看凭证",url:contextPath+"/finance/voucher-lrt/index.html?voucherId="+n.voucherId+"&sobId="+n.sobId};window.parent.activeEvent(s)}else if("delete"===t){var c=[];for(d=0;d<r.tableList.length;d++)for(var u=0;u<i.length;u++)r.tableList[d].id===i[u]&&c.push(r.tableList[d].voucherId);console.log("_voucherId",c);var l=[],h=c.length;for(d=0;d<h;d++){for(u=d+1;u<h;u++)c[d]===c[u]&&(u=++d);l.push(c[d])}console.log("_result",l),e=baseURL+"voucherController/deleteMechanismVoucherBatch",$.ajax({type:"post",async:!1,url:e,data:{sobId:1,ids:l},success:function(t){var e="";"100100"===t.code?(e=t.msg,r.refresh()):e=t.msg,r.$Message.info({content:e,duration:3})}})}}else r.$Message.info({content:"请选择至少一条单据",duration:3})},_ajaxAccording:function(a){var r=this,t=baseURL+"cashier/setGeneratingCertificate";console.log("parame",a),$.ajax({type:"post",async:!1,url:t,data:{ids:a},success:function(t){if("100100"===t.code){if(console.log("按单生成凭证成功！"),"1"===t.data.gcoe.abnormalDataProcessing){var e={name:"查看凭证",url:contextPath+"/finance/voucher-lrt/index.html?key="+t.data.key+"&sys=31&type=3"};return window.parent.activeEvent(e),void r.refresh()}"2"===t.data.gcoe.abnormalDataProcessing?r.showVoucher(!0):"3"===t.data.gcoe.abnormalDataProcessing&&(r.showVoucher(!0),r.isContinue=!1),console.log("json.data.vses.length",t.data.vses),r.voucherModelTxt=t.data.vses.length===a.length?"生成凭证成功！":"生成凭证失败！";r.viewReportTxt=t.data.log}else r.$Message.info({content:t.msg,duration:3})}})},accordingAction:function(){this.showVoucher(!1),this.showVoucherVisibleClose()},save:function(t){switch(t){case"open":this.openSave();break;case"edit":this.editSave();break;case"import":this.importSave();break;case"voucher":this.voucherSave()}},cancel:function(t){switch(t){case"open":this.filterVisible=!1;break;case"edit":this.editVisible=!1;break;case"import":this.importVisible=!1;break;case"voucher":this.voucherVisible=!1}},showSubjectVisable:function(t){this.subjectVisable=!0,this.subjectTpye=t},subjectClose:function(){this.subjectVisable=!1},subjectData:function(t){console.log(t,"====treeNode");var e=this;switch(e.subjectTpye){case 1:e.openData.relateSubjectId=t.id,e.openData.subjectCode=t.subjectCode,e.openData.subjectName=t.subjectName;break;case 2:e.editData.relativeSubjectId=t.id,e.editData.relativeSubjectCode=t.subjectCode,e.editData.relativeSubjectName=t.subjectName,e.editData.relativeSubjectValue=t.subjectCode+" "+t.subjectName;var a=contextPath+"/voucherController/getListBySubjectId";$.ajax({type:"POST",data:{id:e.editData.relativeSubjectId},url:a,success:function(t){if("100100"==t.code){if(e.addSubjectListOpt=t.data.opts,t.data.opts.length){var a={};$.each(t.data.opts,function(t,e){a[e]=""}),e.optsVal=a,e.addSubjectListOptShow=!0}}else layer.alert("页面初始化失败")},error:function(t){console.log(t)}})}this.subjectClose()},importInit:function(){var a=this;jQuery("#importGrid").jqGrid({multiselect:!0,datatype:"local",colNames:["id","科目"],colModel:[{name:"id",width:70,align:"center",sortable:!1,key:!0,hidden:!0},{name:"name",width:250,align:"left",sortable:!1}],rownumbers:!0,rowNum:999999999,styleUI:"Bootstrap",height:210,onSelectAll:function(t,e){a.handlerId(t,e,"importSelected"),a.getImportId()},onSelectRow:function(t,e){t&&(a.handlerId(t,e,"importSelected"),a.getImportId())}});for(var t=0;t<=a.importTableList.length;t++)jQuery("#importGrid").jqGrid("addRowData",t+1,a.importTableList[t])},handlerId:function(t,e,a){var r=this;if("object"===(void 0===t?"undefined":_typeof(t))&&e&&(r[a]=t.filter(function(t){if("null"!=t&&"0"!=t)return t})),"object"!==(void 0===t?"undefined":_typeof(t))||e||(r[a]=[]),"string"==typeof t)if(e){"null"!=t&&"0"!=t&&!(-1<r[a].indexOf(t.toString()))&&r[a].push(t.toString())}else{var i=r[a].indexOf(t.toString());-1<i&&r[a].splice(i,1)}},getImportId:function(){var e=this;this.importData.importId=[],this.importSelected.map(function(t){e.importData.importId.push(e.importTableList[t-1].id),console.log(t+"---item")}),console.log(this.importData.importId)},openAddSubject:function(){console.log(this.addSubjectListOpt,"====this.addSubjectListOpt"),this.addSubjectListOptShow=!0},addSubjectEnterd:function(){var e=this,t=contextPath+"/cashier/getSubjectInfoByCode";$.ajax({type:"POST",data:{code:e.editData.relativeSubjectValue},url:t,success:function(t){if("100100"==t.code)if(t.data.subjectId){if(e.editData.relativeSubjectId=t.data.subjectId,e.editData.relativeSubjectCode=t.data.subjectCode,e.editData.relativeSubjectName=t.data.subjectName,e.addSubjectListOpt=t.data.opts,t.data.opts.length){var a={};$.each(t.data.opts,function(t,e){a[e]=""}),e.optsVal=a,e.addSubjectListOptShow=!0}}else layer.alert("查询无数据");else layer.alert("页面初始化失败")},error:function(t){console.log(t)}})},addSubjectListOptClose:function(){var i=this,o="";console.log(i.optsVal,"===that.optsVal"),$.each(i.optsVal,function(t,e){if(""!==e&&void 0!==e){var a=i.subjectOpts[t],r=a.list[e];o+=a.label+":"+e+"-"+r+";"}}),""!==o&&(o="/"+o),i.editData.relativeSubjectValue=i.editData.relativeSubjectCode+" "+i.editData.relativeSubjectName+o},addSubjectFocus:function(){this.editData.relativeSubjectValue=this.editData.relativeSubjectCode},addSubjectBlur:function(){var i=this;if(null==i.editData.relativeSubjectValue||""==i.editData.relativeSubjectValue)return i.editData.relativeSubjectCode="",i.editData.relativeSubjectName="",i.optsVal={},i.editData.relativeSubjectValue="",void(i.editData.relativeSubjectId="");var o="";$.each(i.optsVal,function(t,e){if(""!==e&&void 0!==e){var a=i.subjectOpts[t],r=a.list[e];o+=a.label+":"+e+"-"+r+";"}}),""!==o&&(o="/"+o),i.editData.relativeSubjectValue=i.editData.relativeSubjectCode+" "+i.editData.relativeSubjectName+o},selectOpt:function(){},exportExcel:function(){var t=vm.openData,e=contextPath+"/cashier/exportExcel?sobId="+t.sobId+"&subjectId="+t.subjectId+"&currencyId="+t.currencyId+"&startYear="+t.startYear+"&endYear="+t.endYear+"&startPeriod="+t.startPeriod+"&endPeriod="+t.endPeriod+"&startDate="+t.startDate+"&endDate="+t.endDate+"&voucherGroupId="+t.voucherGroupId+"&startVoucherGroupNumber="+t.startVoucherGroupNumber+"&endVoucherGroupNumber="+t.endVoucherGroupNumber+"&explains="+t.explains+"&relateSubjectId="+t.relateSubjectId+"&handleId="+t.handleId+"&prepareId="+t.prepareId+"&showInitBalance="+t.showInitBalance+"&showDetailRecord="+t.showDetailRecord+"&showDetailRecord="+t.showDetailRecord+"&showDaySum="+t.showDaySum+"&showPeriodSum="+t.showPeriodSum+"&showYearSum="+t.showYearSum+"&showTotalSum="+t.showTotalSum+"&type="+t.type+"&subjectName="+t.subjectName+"&currencyName="+t.currencyName;console.log(e),window.open(e)}},computed:{importTableList:function(){var t=this,r=[];return this.subjectList.forEach(function(a){t.currencyList.forEach(function(t){var e={id:a.accountId+"-"+t.id,name:a.accountCode+" "+a.accountName+" - "+t.currencyName};r.push(e)})}),r},addSubjectDisabled:function(){return 0===this.addSubjectListOpt.length}},watch:{"editData.debitAmountFor":function(t,e){vm.editData.debitAmount=vm.formartMoney(vm.editData.debitAmountFor*vm.editData.debitAmountForRate)},"editData.creditAmountFor":function(t,e){vm.editData.creditAmount=vm.formartMoney(vm.editData.creditAmountFor*vm.editData.creditAmountForRate)},"editData.debitAmountForRate":function(t,e){vm.editData.debitAmount=vm.formartMoney(vm.editData.debitAmountFor*vm.editData.debitAmountForRate)},"editData.creditAmountForRate":function(t,e){vm.editData.creditAmount=vm.formartMoney(vm.editData.creditAmountFor*vm.editData.creditAmountForRate)},"openData.currencyId":function(a,t){$.each(vm.currencyList,function(t,e){a==e.id&&(vm.openData.currencyName=e.currencyName)})}}});