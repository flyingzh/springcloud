"use strict";var vm=new Vue({el:"#app",data:{isShow:!1,isEdit:!1,isSearchHide:!0,isTabulationHide:!0,isBarCode:!1,selectedData:[],selectedRow:[],treeSetting:{check:{enable:!0,chkboxType:{Y:"",N:""}}},goodsTypeTreeSetting:{check:{enable:!0},data:{simpleData:{enable:!0,idKey:"id",pIdKey:"parentId",rootPId:0},callback:{onCheck:(void 0).goodsTypezTree}}},categoryStyleTreeSetting:{check:{enable:!0},data:{simpleData:{enable:!0,idKey:"id",pIdKey:"parentId",rootPId:0},key:{name:"styleName"},callback:{onCheck:(void 0).categoryStylezTree}}},isHide:!0,openTime:"",isSearchShow:!1,isShowGoodsType:!1,isCategoryStyle:!1,warehouseList:[],reservoirPositionList:[],goodsMainType:"",productType:"",organization:"",productDetailModal:{showModal:!1,ids:{goodsId:"",commodityId:"",documentType:"W_STOCK_IN"}},body:{warehouseId:"",reservoirPositionId:"",goodsNo:"",goodsName:"",custStyleType:"",productTypeArr:[],styleCategoryArr:[]},productDetail:[]},methods:{search:function(){var e={organization:encodeURIComponent(this.body.organization),productTypeArr:this.body.productTypeArr.join(","),goodsNo:encodeURIComponent(this.body.goodsNo),goodsName:encodeURIComponent(this.body.goodsName),warehouseId:1==encodeURIComponent(this.body.warehouseId)?encodeURIComponent(this.body.warehouseId):"",reservoirPositionId:1==encodeURIComponent(this.body.reservoirPositionId)?encodeURIComponent(this.body.reservoirPositionId):"",styleCategoryArr:this.body.styleCategoryArr.join(",")};$("#list").jqGrid("setGridParam",{postData:e}),$("#list").jqGrid("setGridParam",{page:1}),$("#list").jqGrid("setGridParam",{url:contextPath+"/sku/list"}).trigger("reloadGrid")},clear:function(){this.body={warehouseId:"",reservoirPositionId:"",goodsNo:"",goodsName:"",custStyleType:"",productTypeArr:[],styleCategoryArr:[]}},refresh:function(){console.log(2343),this.clear(),this.search()},exit:function(){window.parent.closeCurrentTab({openTime:this.openTime,exit:!0})},searchAction:function(){},goodsTypeAction:function(){this.isShowGoodsType=!0},categoryStyle:function(){this.isCategoryStyle=!0},pageInit:function(){var a=this;jQuery("#list").jqGrid({url:contextPath+"/sku/list",datatype:"json",colNames:["id","commodityId","skuMark","所属组织","商品编码","商品名称","计数单位","数量","计重单位","总重","金重","已分配","可用库存","仓库","进货总成本","销售总成本","规格","金料成色","分段","颜色","净度","条码号"],colModel:[{name:"id",width:"80",align:"left",hidden:!0,fixed:"true"},{name:"commodityId",width:"80",align:"left",hidden:!0,fixed:"true"},{name:"skuMark",width:"80",align:"left",hidden:!0,fixed:"true"},{name:"organizationName",width:"150",align:"left",fixed:"true"},{name:"goodsNo",width:"150",align:"left",fixed:"true",formatter:function(e,t,o,i){return $(document).off("click",".detail"+e).on("click",".detail"+e,function(){vm.showGoodsInfo({value:e,grid:t,rows:o,state:i})}),e?'<a class="detail'+e+'">'+e+"</a>":""}},{name:"goodsName",width:"150",align:"left",fixed:"true"},{name:"countUnit",width:"80",align:"left",fixed:"true"},{name:"totalNum",width:"80",align:"left",fixed:"true"},{name:"weightUnit",width:"80",align:"left",fixed:"true"},{name:"totalWeight",width:"80",align:"left",fixed:"true",formatter:function(e,t,o,i){return Number(e).toFixed(3)}},{name:"totalGoldWeight",width:"80",align:"left",fixed:"true",formatter:function(e,t,o,i){return Number(e).toFixed(3)}},{name:"assignedNum",width:"80",align:"left",fixed:"true"},{name:"mayInventory",width:"210",align:"left",formatter:function(e,t,o,i){return Number(o.totalNum)-Number(o.assignedNum)}},{name:"warehouse",width:"120",align:"left",fixed:"true"},{name:"totalPurchaseCost",width:"80",align:"left",fixed:"true",formatter:function(e,t,o,i){return Number(e).toFixed(2)}},{name:"totalPurPriceCost",width:"80",align:"left",fixed:"true",formatter:function(e,t,o,i){return Number(e).toFixed(2)}},{name:"goodsNorm",width:"80",align:"left",fixed:"true"},{name:"goldColor",width:"80",align:"left",fixed:"true"},{name:"stoneSection",width:"80",align:"left",fixed:"true"},{name:"stoneColor",width:"80",align:"left",fixed:"true"},{name:"stoneClarity",width:"80",align:"left",fixed:"true"},{name:"id",width:"80",align:"left",fixed:"true",formatter:function(e,t,o,i){return $(document).off("click",".detail").on("click",".detail"+e,function(){vm.barCodeClick(o.skuMark)}),'<a class="detail'+e+'">条码号</a>'}}],rowNum:10,rowList:[10,20,30],pager:"#pager",mtype:"post",multiselect:!0,jsonReader:{root:"data.list",total:"data.totalPage",records:"data.totalCount",cell:"list"},prmNames:{page:"page",rows:"limit"},sortable:!1,viewrecords:!0,footerrow:!0,userDataOnFooter:!0,gridComplete:a.completeMethod,onSelectRow:function(e,t){for(var o=[],i=$("#list").jqGrid("getGridParam","selarrrow"),r=0;r<i.length;r++)o.push($("#list").jqGrid("getRowData",i[r]));a.selectedRow=o,console.log(a.selectedRow)}})},completeMethod:function(){var e=$("#list").getCol("totalNum",!1,"sum"),t=$("#list").getCol("totalWeight",!1,"sum"),o=$("#list").getCol("totalGoldWeight",!1,"sum"),i=$("#list").getCol("mayInventory",!1,"sum"),r=$("#list").getCol("assignedNum",!1,"sum"),a=$("#list").getCol("totalPurchaseCost",!1,"sum"),n=$("#list").getCol("totalPurPriceCost",!1,"sum");i=e-r;$("#list").footerData("set",{organizationName:"合计",totalNum:e,totalWeight:Number(t).toFixed(3),totalGoldWeight:Number(o).toFixed(3),assignedNum:r,mayInventory:Number(i),totalPurchaseCost:Number(a).toFixed(2),totalPurPriceCost:Number(n).toFixed(2)})},needReload:function(){this.selectedData=[];var e={postData:this.$parent.body||this.$root.body};this.jqGridClearData(),$("#list").jqGrid("setGridParam",e).trigger("reloadGrid")},getRowData:function(){$.each(config.colModel,function(e,t){})},getWareHouseGroup:function(){var t=this;$.ajax({type:"post",url:contextPath+"/wareHouse/queryAll",dataType:"json",success:function(e){"100100"===e.code&&(console.log("仓库组",e.data),t.warehouseList=e.data)},error:function(){layer.alert("服务器出错啦")}})},goodsTypezTree:function(e,t,o){var i=$.fn.zTree.getZTreeObj("tree-demo").getCheckedNodes(!0),r={},a=i.filter(function(e){return!e.children}).map(function(e){return e.name}).join("/"),n=i.filter(function(e){return!e.children}).map(function(e){return e.customCode});return r.names=a,r.customCode=n,console.log(r),r},categoryStylezTree:function(e,t,o){var i=$.fn.zTree.getZTreeObj("tree-demo1").getCheckedNodes(!0),r={},a=i.filter(function(e){return!e.children}).map(function(e){return e.styleName}).join("/"),n=i.filter(function(e){return!e.children}).map(function(e){return e.customCode});return r.names=a,r.customCode=n,console.log(r),r},goodsTypeClick:function(){console.log(this.goodsTypezTree(),780),this.body.productType=this.goodsTypezTree().names,this.body.productTypeArr=this.goodsTypezTree().customCode,console.log(this.body.productTypeArr,0x3f28cb71571c7)},categoryStyleClick:function(){console.log(this.categoryStylezTree(),9789),this.body.custStyleType=this.categoryStylezTree().names,this.body.styleCategoryArr=this.categoryStylezTree().customCode},queryBarCodeClick:function(){console.log(this.selectedRow),this.selectedRow.length<1?this.$Modal.warning({title:"提示信息",content:"请先选择一笔数据！"}):1<this.selectedRow.length?this.$Modal.warning({title:"提示信息",content:"只能选择一笔数据！"}):this.barCodeClick(this.selectedRow[0].skuMark)},barCodeClick:function(e){var t=this;$.ajax({type:"post",url:contextPath+"/goodsController/queryListBySkuMark",data:JSON.stringify({skuMark:e}),contentType:"application/json",dataType:"json",success:function(e){if("100100"===e.code){if(console.log("商品明细",e.data),t.productDetail=[],t.productDetail=e.data,t.productDetail&&t.productDetail.length<=0)return t.$Modal.warning({title:"提示信息",content:"该商品编码不存在条码！"}),!1;t.isBarCode=!0}},error:function(){layer.alert("服务器出错啦")}})},getRepertoryPositionGroup:function(e){var t=this;console.log(e,333344),$.ajax({type:"post",url:contextPath+"/tbaserepertoryposition/listbygroup/"+e,dataType:"json",success:function(e){"100100"===e.code&&(console.log("库位组",e.data),console.log(t.reservoirPositionList,33443),t.reservoirPositionList=[],t.$forceUpdate(),t.reservoirPositionList=e.data)},error:function(){layer.alert("服务器出错啦")}})},warehouseChange:function(e){var t=!0,o=!1,i=void 0;try{for(var r,a=this.warehouseList[Symbol.iterator]();!(t=(r=a.next()).done);t=!0){var n=r.value;if(console.log(e,n.id,7799),e&&e===n.id){console.log(e,n.id,22222),this.repertoryPositionGroupId=n.groupId;break}}}catch(e){o=!0,i=e}finally{try{!t&&a.return&&a.return()}finally{if(o)throw i}}this.body.reservoirPositionId=""},getOrgan:function(){var t=this;$.ajax({type:"post",url:contextPath+"/entrustOut/getOrgName",dataType:"json",success:function(e){"100100"===e.code&&(t.organization=e.data.name)},error:function(){alert("服务器出错啦")}})},showProductDetail:function(e){var t=this,o={goodsId:this.productDetail[e].id,commodityId:"",documentType:"W_STOCK_IN"};t.goodsMainType=this.productDetail[e].goodsMainType,Object.assign(t.productDetailModal,{showModal:!0,ids:o}),t.$nextTick(function(){t.$refs.modalRef.getProductDetail()})},modalSure:function(e){},modalCancel:function(e){},productDetailModalClick:function(e){"attr_ranges_goods"===this.outDetailEntity[this.selectedIndex].goodsMainType?Object.assign(this.outDetailEntity[this.selectedIndex],{tBaseBomEntity:e,assistAttrs:null,overEdit:!0}):Object.assign(this.outDetailEntity[this.selectedIndex],{assistAttrs:e,tBaseBomEntity:null,overEdit:!0})},showGoodsInfo:function(e){window.parent.activeEvent({name:"商品",url:contextPath+"/base-data/commodity/commodity-info.html",params:{id:e.rows.commodityId,type:"skip"}})}},created:function(){this.openTime=window.parent.params.openTime,this.getWareHouseGroup(),this.getOrgan()},mounted:function(){this.pageInit()}});