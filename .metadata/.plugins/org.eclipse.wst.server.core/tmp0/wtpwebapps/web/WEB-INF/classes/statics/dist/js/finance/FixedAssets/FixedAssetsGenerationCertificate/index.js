"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},vm=new Vue({el:"#fixedAssetsGenerationCertificate",data:function(){return{openTime:"",baseData:{subjectName:"",periodDate:""},filterModal:!1,currentOrgName:JSON.parse(localStorage.user).currentOrgName,filterBody:{sobId:JSON.parse(localStorage.user).userCurrentOrganId,accountYear:"",accountPeriod:"",changeType:-1,certificateStatus:-1,audited:-1,cardIds:[]},certificateStatus:[{value:-1,label:"全部"},{value:1,label:"已生成凭证"},{value:2,label:"未生成凭证"}],audited:[{value:-1,label:"全部"},{value:1,label:"已审核"},{value:2,label:"未审核"}],changeTypes:[{value:-1,label:"全部"},{value:1,label:"新增"},{value:2,label:"变动"},{value:3,label:"清理"}],selected:[],accountYear:[],accountPeriod:[],accordingModal:!1,accordingCheck:!1,summaryModal:!1,summaryCheck:!1,voucherVisible:!1,voucherModelTxt:"",isContinue:!1,viewReportVisible:!1,viewReportTxt:"",showVoucherVisible:!1,dataList:[],voucherFilter:{abnormalDataProcessing:"",subjectMergerDebit:!1,subjectMergerLender:!1},subjectVisable:!1,subjectTpye:"",printModal:!1,printInfo:{}}},mounted:function(){this.init(),this._queryObject(),this.openTime=window.parent.params&&window.parent.params.openTime},methods:{initPage:function(){this.initJqGrid()},initJqGrid:function(){var r=this;jQuery("#grid").jqGrid({multiselect:!0,postData:JSON.stringify(r.filterBody),mtype:"POST",styleUI:"Bootstrap",url:contextPath+"/fixedAssetsVoucher/generatingCredentialDataPresentation",ajaxGridOptions:{contentType:"application/json;charset=utf-8"},colNames:["id","日期","凭证字号","凭证审核","记账标志","资产编码","资产名称","事务类型","变动方式","原值增加","原值减少","累计折旧增加","累计折旧减少","减值准备增加","减值准备减少","残值收入","可抵扣税额","清理费用","voucherId"],colModel:[{name:"id",width:70,align:"center",sortable:!1,key:!0,hidden:!0},{name:"enterAccountDate",width:100,align:"center",sortable:!1,formatter:function(e,t,a){return new Date(e).format("yyyy-MM-dd")}},{name:"voucherWord",width:100,align:"center",sortable:!1},{name:"voucherAudit",width:100,align:"center",sortable:!1},{name:"voucherPosting",width:100,align:"center",sortable:!1},{name:"assetCode",width:100,align:"center",sortable:!1},{name:"assetName",width:100,align:"center",sortable:!1},{name:"changeType",width:100,align:"center",sortable:!1,formatter:function(e,t,a){return 1==e?"新增":2==e?"变动":3==e?"清理":void 0}},{name:"alterTypeName",width:100,align:"center",sortable:!1},{name:"buyOrgVal",width:100,align:"center",sortable:!1,formatter:function(e,t,a){return e<=0?"":accounting.formatNumber(e,2,",")}},{name:"buyOrgVal",width:100,align:"center",sortable:!1,formatter:function(e,t,a){return 0<=e?"":accounting.formatNumber(-e,2,",")}},{name:"deprService",width:100,align:"center",sortable:!1,formatter:function(e,t,a){return e<=0?"":accounting.formatNumber(e,2,",")}},{name:"deprService",width:100,align:"center",sortable:!1,formatter:function(e,t,a){return 0<=e?"":accounting.formatNumber(-e,2,",")}},{name:"devalPreparation",width:100,align:"center",sortable:!1,formatter:function(e,t,a){return e<=0?"":accounting.formatNumber(e,2,",")}},{name:"devalPreparation",width:100,align:"center",sortable:!1,formatter:function(e,t,a){return 0<=e?"":accounting.formatNumber(-e,2,",")}},{name:"salvageIncome",width:100,align:"center",sortable:!1,formatter:function(e,t,a){return 0==e?"":accounting.formatNumber(e,2,",")}},{name:"deductionAmount",width:100,align:"center",sortable:!1,formatter:function(e,t,a){return 0==e?"":accounting.formatNumber(e,2,",")}},{name:"clearAmount",width:100,align:"center",sortable:!1,formatter:function(e,t,a){return 0==e?"":accounting.formatNumber(e,2,",")}},{name:"voucherId",width:70,align:"center",sortable:!1,hidden:!0}],datatype:"json",jsonReader:{root:"data"},height:$(window).height()-140,viewrecords:!0,rownumbers:!0,rowNum:999999999,onSelectAll:function(e,t){r.handlerId(e,t,"selected")},onSelectRow:function(e,t){console.log("data---------",e,t),e&&(r.handlerId(e,t,"selected"),console.log("that.selected",r.selected))},gridComplete:function(){$("table[id='grid'] tr[id='null'] input").attr("style","display:none"),$("table[id='grid'] tr[id='0'] input").attr("style","display:none"),window.top.home.loading("hide")},loadComplete:function(e){console.log(e,"ret"),null!=e&&null!=e.data&&(r.dataList=e.data),jQuery("#grid").jqGrid("destroyGroupHeader"),jQuery("#grid").jqGrid("setGroupHeaders",{useColSpanStyle:!0});var t=jQuery("#grid").jqGrid("getRowData"),a=$("#grid").jqGrid("getDataIDs");t.push($("#grid").jqGrid("getRowData",a[a.length-1])),r.tableList=t,console.log("tableList",r.tableList)}})},delTable:function(){$("#grid").empty();var e=$(".jqGrid_wrapper");e.empty(),$('<table id="grid"></table><div id="page"></div>').appendTo(e)},handlerId:function(e,t,a){console.log("data",e,t,a);var r=this;if("object"===(void 0===e?"undefined":_typeof(e))&&t&&(r.selected=e.filter(function(e){if("null"!=e&&"0"!=e&&""!=e)return e})),"object"!==(void 0===e?"undefined":_typeof(e))||t||(r.selected=[]),"string"==typeof e)if(t){"null"!=e&&"0"!=e&&""!=e&&!(-1<r.selected.indexOf(e.toString()))&&this.selected.push(e.toString())}else{var n=r.selected.indexOf(e.toString());-1<n&&r.selected.splice(n,1)}},init:function(){var t=this;$.ajax({type:"post",url:contextPath+"/fixedAssetsVoucher/getAccountYearAndPeriod",dataType:"json",data:null,success:function(e){"100100"===e.code&&(console.log(e,"======>"),t.filterBody.accountYear=e.data.presents[0],t.filterBody.accountPeriod=e.data.presents[1],t.accountYear=e.data.year,t.accountPeriod=e.data.period,t.delTable(),t.initPage())}})},_queryObject:function(){var t=this,e=baseURL+"generatingCredentialOption/getCredentialOption",a=new FormData;a.append("ownershipSystem",4),http.post(e,a).then(function(e){"100100"===e.code&&(t.voucherFilter=e.data)},function(e){})},voucherSave:function(){var t=this;console.log(t.voucherFilter,"===that.voucherFilter");var e=baseURL+"generatingCredentialOption/update",a=new FormData;a.append("abnormalDataProcessing",parseInt(t.voucherFilter.abnormalDataProcessing)),a.append("subjectMergerDebit",t.voucherFilter.subjectMergerDebit),a.append("subjectMergerLender",t.voucherFilter.subjectMergerLender),a.append("ownershipSystem",4),http.post(e,a).then(function(e){"100100"===e.code&&t.cancel(),t.$Message.info({content:e.msg,duration:3})},function(e){})},save:function(e){switch(e){case"open":this.openSave();break;case"edit":this.editSave();break;case"import":this.importSave();break;case"voucher":this.voucherSave()}},formartMoney:function(e){return null==e||0==e?"":accounting.formatNumber(e,2,",")},cancel:function(){this.voucherVisible=!1},refresh:function(){this.selected=[],this.saveData()},open:function(){this.filterModal=!0},saveData:function(){$("#grid").setGridParam({postData:JSON.stringify(this.filterBody)}).trigger("reloadGrid")},cancelData:function(){this.filterModal=!1},saveAccordingData:function(){},cancelAccordingData:function(){this.accordingModal=!1},saveSummaryData:function(){},cancelSummaryData:function(){this.summaryModal=!1},selectRowAction:function(e){var t=this,a=t.selected;switch(t.filterBody.cardIds=a,e){case"pressTheBill":t.singleGenerationCertificate();break;case"gather":t.summaryGenerationCertificate();break;case"delete":t.deleteVoucher();break;case"auditing":t.auditingVoucher();break;case"counterAudit":t.counterAuditVoucher()}},singleGenerationCertificate:function(){var a=this;console.log("_that.filterBody",a.filterBody),$.ajax({type:"post",url:contextPath+"/fixedAssetsVoucher/singleGenerationCertificate",dataType:"json",data:JSON.stringify(a.filterBody),contentType:"application/json;charset=utf-8",success:function(e){if("100100"===e.code){if(console.log(e,"======>"),"2"!=e.data.gcoe.abnormalDataProcessing&&"3"!=e.data.gcoe.abnormalDataProcessing){var t={name:"查看凭证",url:contextPath+"/finance/voucher-lrt/index.html?key="+e.data.key+"&sys=4&type=4"};return window.parent.activeEvent(t),void a.refresh()}a.voucherModelTxt="开始生成凭证";a.viewReportTxt=e.data.log,a.showVoucher(!0),a.isContinue=!1}else a.$Message.info({content:e.msg,duration:3})}})},accordingAction:function(){this.showVoucher(!1),this.showVoucherVisibleClose()},showVoucherVisibleClose:function(){this.isContinue=!1,this.refresh()},showVoucher:function(e){this.showVoucherVisible=e},showViewReport:function(e){this.viewReportVisible=!this.viewReportVisible},summaryGenerationCertificate:function(){},deleteVoucher:function(){},auditingVoucher:function(){},counterAuditVoucher:function(){},creatVoucher:function(){this.voucherVisible=!0},goPathBook:function(){var e={name:"固定资产凭证",url:contextPath+"/finance/FixedAssets/FixedAssetsCertificateOrderBook/index.html"};window.parent.activeEvent(e)},printV:function(){var e=this;if(e.dataList&&e.dataList.length){for(var t=[],a=0;a<e.dataList.length;a++){var r={enterAccountDate:new Date(e.dataList[a].enterAccountDate).format("yyyy-MM-dd"),voucherWord:e.dataList[a].voucherWord,voucherAudit:e.dataList[a].voucherAudit,voucherPosting:e.dataList[a].voucherPosting,assetCode:e.dataList[a].assetCode,assetName:e.dataList[a].assetName,alterTypeName:"",changeType:"",buyOrgVal1:"",buyOrgVal2:"",deprService1:"",deprService2:"",devalPreparation1:"",devalPreparation2:"",salvageIncome:"",deductionAmount:"",clearAmount:""};1==e.dataList[a].changeType?r.changeType="新增":2==e.dataList[a].changeType?r.changeType="变动":3==e.dataList[a].changeType&&(r.changeType="清理"),r.alterTypeName=e.dataList[a].alterTypeName,0<e.dataList[a].buyOrgVal?(r.buyOrgVal1=e.dataList[a].buyOrgVal?e.formartMoney(e.dataList[a].buyOrgVal):"",r.buyOrgVal2=""):(r.buyOrgVal1="",r.buyOrgVal2=-e.dataList[a].buyOrgVal?e.formartMoney(-e.dataList[a].buyOrgVal):""),0<e.dataList[a].buyOrgVal?(r.deprService1=e.dataList[a].deprService?e.formartMoney(e.dataList[a].deprService):"",r.deprService2=""):(r.deprService1="",r.deprService2=-e.dataList[a].deprService?e.formartMoney(-e.dataList[a].deprService):""),0<e.dataList[a].buyOrgVal?(r.devalPreparation1=e.dataList[a].devalPreparation?e.formartMoney(e.dataList[a].devalPreparation):"",r.devalPreparation2=""):(r.devalPreparation1="",r.devalPreparation2=-e.dataList[a].devalPreparation?e.formartMoney(-e.dataList[a].devalPreparation):""),r.salvageIncome=e.dataList[a].salvageIncome?e.formartMoney(e.dataList[a].salvageIncome):"",r.deductionAmount=e.dataList[a].deductionAmount?e.formartMoney(e.dataList[a].deductionAmount):"",r.clearAmount=e.dataList[a].clearAmount?e.formartMoney(e.dataList[a].clearAmount):"",t[a]=Object.assign(r,t[a])}var n={title:"固定资产生成凭证",template:1,totalRow:!1,titleInfo:[],colNames:[{name:"日期",col:"enterAccountDate"},{name:"凭证字号",col:"voucherWord"},{name:"凭证审核",col:"voucherAudit"},{name:"记账标志",col:"voucherPosting"},{name:"资产编码",col:"assetCode"},{name:"资产名称",col:"assetName"},{name:"事务类型",col:"changeType"},{name:"变动方式",col:"alterTypeName"},{name:"原值增加",col:"buyOrgVal1"},{name:"原值减少",col:"buyOrgVal2"},{name:"累计折旧增加",col:"deprService1"},{name:"累计折旧减少",col:"deprService2"},{name:"减值准备增加",col:"devalPreparation1"},{name:"减值准备减少",col:"devalPreparation2"},{name:"残值收入",col:"salvageIncome"},{name:"可抵扣税额",col:"deductionAmount"},{name:"清理费用",col:"clearAmount"}],styleCss:"",colMaxLenght:9,data:t};e.printInfo=n,e.printModalShow(!0)}else e.$Message.info({content:"无打印数据",duration:3})},printModalShow:function(e){this.printModal=e},exportExcel:function(){var e=this.filterBody,t=contextPath+"/fixedAssetsVoucher/leadToExcel?sobId="+e.sobId+"&accountYear="+e.accountYear+"&accountPeriod="+e.accountPeriod+"&changeType="+e.changeType+"&certificateStatus="+e.certificateStatus+"&audited="+e.audited;window.open(t)},exitPrevent:function(){},subjectClose:function(){this.subjectVisable=!1},subjectData:function(e){console.log(e,"====treeNode");this.subjectClose()}},computed:{},watch:{}});