"use strict";var _extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var s=arguments[t];for(var o in s)Object.prototype.hasOwnProperty.call(s,o)&&(e[o]=s[o])}return e};function _defineProperty(e,t,s){return t in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}var purchaseVm=new Vue({el:"#purchaseOrder",data:function(){return{isSearchHide:!0,isTabulationHide:!0,isSaveDisable:!1,isSubmitDisable:!1,isApproveDisable:!1,isRejectDisable:!1,isAddRowDisable:!1,isDelRowDisable:!1,productDetailModal:{dataSourceType:!1,dataSource:null,showModal:!1,ids:{goodsId:"",commodityId:"",documentType:"P_ORDER"}},selectedIndex:0,productDetailList:[],boeType:"P_ORDER",selectedRowIndex:"",needReload:!1,businessTypeList:[{name:"标准采购",value:"P_ORDER_01"},{name:"受托加工采购",value:"P_ORDER_02"}],param:{},isHint:!0,showSupplierModal:!1,isFromList:!1,OriginData:[],unitMap:{},categoryType:[],showProductProperty:!1,commodityList:[],purchase:{id:"",dataSources:1,orderStatus:"",businessTypeId:"",orderNo:"",purchaseDate:"",goodsTypeName:"",goodsGroupPath:"",organizationId:"",salesmanName:"",salesmanId:"",supplierId:"",supplierCode:"",supplierName:"",defaultContact:"",phone:"",concreteAddress:"",commodityId:"",createName:"",createTime:"",updateName:"",updateTime:"",auditorId:"",auditor:"",auditTime:"",purchaseCount:"",purchaseWeight:"",goodList:[],delGoodIds:[]},addBody:{orderNo:""},approveComment:!1,rejectComment:!1,approvement:{receiptsId:"",approvalResult:"1",approvalInfo:""},rejectement:{receiptsId:"",approvalResult:"0",approvalInfo:""},modalTrigger:!1,modalType:"",steplist:[],approvalTableData:[],employees:[],options:{disabledDate:function(e){return e&&e.valueOf()<purchaseVm.purchase.purchaseDate-576e5}}}},methods:{isHintShow:function(e){var t=this;e&&this.typeValue&&this.isHint&&this.purchase.goodList&&0<this.purchase.goodList.length&&this.$Modal.warning({content:"温馨提示：改变商品类型将删除所有商品信息!",onOk:function(){t.isHint=!1}})},changeProductType:function(e,t){var s=this;if(console.log(e,t),e==this.typeValue)return!1;this.purchase.id&&(this.purchase.delGoodIds||(this.purchase.delGoodIds=[]),this.purchase.goodList.map(function(e){e.goodsId&&s.purchase.delGoodIds.push(e.goodsId)})),this.purchase.goodList=[],this.productDetailList=this.purchase.goodList,this.purchase.goodsTypeName=t[t.length-1].label,this.purchase.goodsGroupPath=t[t.length-1].value,this.getCommodityList()},getCommodityList:function(){console.log("默认商品明细数据");var t=this,e={categoryCustomCode:t.purchase.goodsGroupPath,field:"",limit:""};$.ajax({type:"post",async:!1,url:contextPath+"/tbasecommodity/findByType",data:e,dataType:"json",success:function(e){if("100100"!=e.code)return this.$Modal.error({content:e.msg}),void(t.commodityList=[]);t.commodityList=e.data},error:function(){this.$Modal.error({content:"网络异常,请联系技术人员！"})}})},isEdit:function(e,t){eventHub.$emit("isEdit",e)},saveAccess:function(e,t,s){eventHub.$emit("saveFile",e,t)},getAccess:function(e,t,s){eventHub.$emit("queryFile",e,t)},approvalOrRejectCallBack:function(e){if("100100"==e.result.code){var t=e.result.data;this.purchase.orderStatus=t.orderStatus,4===this.purchase.orderStatus&&(this.purchase.auditor=t.auditor,this.purchase.auditorId=t.auditorId,this.purchase.auditTime=t.auditTime),1===this.purchase.orderStatus&&(this.isAddRowDisable=!1,this.isDelRowDisable=!1,this.isSaveDisable=!1,this.isSubmitDisable=!1,2===this.purchase.dataSources?this.isFromList=!0:this.isFromList=!1)}},initUnit:function(){var o=this;$.ajax({type:"post",url:contextPath+"/tbaseunit/list",contentType:"application/json",dataType:"json",async:!1,success:function(e){"100100"===e.code?(e.data.map(function(e){var t=e.id,s=e.name;o.unitMap[t]=s}),console.log(o.unitMap)):o.$Modal.warning({content:"服务器异常,请联系技术人员！"})},error:function(e){o.$Modal.warning({content:"网络异常,请联系技术人员！"})}})},getSelectedItem:function(e,o){var a=this;$.ajax({type:"post",url:contextPath+"/tbasecommodity/getBriefById/"+e.id,dataType:"json",success:function(e){var t=e.data;t.countUnitId=a.unitMap[t.countUnitId],t.weightUnitId=a.unitMap[t.weightUnitId],console.log(t);var s={};Object.assign(s,{goodsCode:t.code,goodsName:t.name,commodityId:t.id,pictureUrl:t.frontPic&&t.frontPic.fdUrl,goodsType:t.categoryName,goodsTypePath:t.categoryCustomCode,custStyleCode:t.styleCustomCode,goodsMainType:t.mainType,goodsSpecifications:t.specification,digitUnit:t.countUnitId,weightUnit:t.weightUnitId,chargeUnit:t.pricingType}),a.productDetailList[a.selectedRowIndex].goodsId&&(a.purchase.delGoodIds||(a.purchase.delGoodIds=[]),a.purchase.delGoodIds.push(a.productDetailList[a.selectedRowIndex].goodsId)),a.$set(a.purchase.goodList,o,s),"attr_ranges_gold"===t.mainType&&(a.purchase.goodList[o].goldColor=t.certificateType),a.$forceUpdate()},error:function(){a.$Modal.warning({content:"服务器出错啦"})}})},getInputValue:function(e,t){var s=this;console.log(e,t,s.purchase.goodsGroupPath);var o={categoryCustomCode:s.purchase.goodsGroupPath,field:e,limit:""};$.ajax({type:"post",url:contextPath+"/tbasecommodity/findByType",data:o,dataType:"json",success:function(e){Object.assign(s.purchase.goodList[t],{options:e.data}),s.$forceUpdate()},error:function(){s.$Modal.warning({content:"服务器出错啦"})}})},getProductType:function(){var t=this;$.ajax({type:"post",url:contextPath+"/tbasecommoditycategory/listByAll?parentId=0",dataType:"json",success:function(e){t.productTypeList=t.initGoodCategory(e.data.cateLists)},error:function(){t.$Modal.warning({content:"服务器出错啦"})}})},rcv:function(e,t,s){console.log(e,t,s),this.purchase.supplierId=e,this.getSupplierInfo(e)},closeSupplierModal:function(){this.showSupplierModal=!1},selectSupplier:function(e){!0!==e&&(this.showSupplierModal=!0)},queryByCode:function(e){var t=this;$.ajax({type:"post",async:!0,data:JSON.stringify(t.addBody),url:contextPath+"/tpurchaseorder/purchaseOrderGoodslist",dataType:"json",contentType:"application/json",success:function(e){console.log(e),t.originData=JSON.parse(JSON.stringify(e.data)),t.purchase.goodList=e.data,t.productDetailList=t.purchase.goodList,console.log(e.data),t.isEdit(1==t.purchase.orderStatus?"Y":"N"),t.getAccess(t.purchase.id,t.boeType)},error:function(e){console.log(e)}})},loadProductType:function(){var t=this;$.ajax({type:"post",url:contextPath+"/tbasecommoditycategory/listByAll?parentId=0",dataType:"json",success:function(e){t.categoryType=t.initGoodCategory(e.data.cateLists)},error:function(){t.$Modal.warning({content:"服务器出错啦"})}})},initGoodCategory:function(e){var i=this,r=[];return e.forEach(function(e){var t=e.customCode,s=e.name,o=e.cateLists,a=e.code;o&&(o=i.initGoodCategory(o)),r.push({value:t,label:s,children:o,code:a})}),r.forEach(function(e){e.children||delete e.children}),r},add:function(){window.parent.activeEvent({name:"新增采购订单",url:contextPath+"/purchase/purchase-order/purchase-order.html",params:{type:"add"}})},verifyInfo:function(){var e=!0,t={"业务类型":this.purchase.businessTypeId,"供应商":this.purchase.supplierCode};for(var s in t)if(!t[s]){this.$Modal.warning({title:"提示信息",content:"您还没有填写"+s+"！"}),e=!1;break}return e},verifyGoodLine:function(){var e=!0;if(this.purchase.goodList.length<1)this.$Modal.warning({title:"提示信息",content:"您还没有填写商品分录行明细，请点击 新增行 添加！"}),e=!1;else for(var t=0;t<this.purchase.goodList.length;t++){if(!this.purchase.goodList[t].goodsCode){this.$Modal.warning({title:"提示信息",content:"您还没有填写第"+(t+1)+"行的商品编码！"}),e=!1;break}if(!this.purchase.goodList[t].deliveryDate){this.$Modal.warning({title:"提示信息",content:"您还没有填写第"+(t+1)+"行的交货日期！"}),e=!1;break}if(new Date(this.purchase.goodList[t].deliveryDate).getTime()<new Date(this.purchase.purchaseDate).getTime()){this.$Modal.warning({title:"提示信息",content:"第"+(t+1)+"行的交货日期不能小于采购日期，请重新选择！"}),e=!1;break}if("attr_ranges_gold"!=this.purchase.goodList[t].goodsMainType){if(!this.purchase.goodList[t].purchaseCount){this.$Modal.warning({title:"提示信息",content:"第"+(t+1)+"行的采购数量为必填项，且采购数量>0！"}),e=!1;break}if("0"===this.purchase.goodList[t].purchaseCount||0===this.purchase.goodList[t].purchaseCount){this.$Modal.warning({title:"提示信息",content:"第"+(t+1)+"行的采购数量为必填项，且采购数量>0！"}),e=!1;break}}if(!this.purchase.goodList[t].purchaseWeight){this.$Modal.warning({title:"提示信息",content:"第"+(t+1)+"行的采购重量为必填项，且采购重量>0！"}),e=!1;break}if("0"===this.purchase.goodList[t].purchaseWeight||0===this.purchase.goodList[t].purchaseWeight){this.$Modal.warning({title:"提示信息",content:"第"+(t+1)+"行的采购重量为必填项，且采购重量>0！"}),e=!1;break}}return e},validateProduct:function(){var s=!0,o=this;return $.each(o.productDetailList,function(e,t){if(t.goodsId)return!0;if("attr_ranges_goods"==t.goodsMainType){if(!t.tBaseBomEntity)return s=!1,o.$Modal.error({content:"第"+(e+1)+"行商品明细未选择，请先选择商品明细！"}),!1}else if(!t.assistAttrs)return s=!1,o.$Modal.error({content:"第"+(e+1)+"行商品明细未选择，请先选择商品明细！"}),!1}),s},addSubmit:function(t){var s=this,e=s.handlerDataToPost();0===s.purchase.goodList.length&&(e.goodList=[]),$.ajax({type:"post",async:!0,contentType:"application/text",data:JSON.stringify(e),url:contextPath+"/tpurchaseorder/addpurchaseOrder",dataType:"json",success:function(e){"100100"===e.code?(s.saveAccess(e.data.id,s.boeType),s.$Modal.success({content:"保存成功！"}),s.getAccess(s.purchase.id,s.boeType),s.purchase.id=e.data.id,s.purchase.orderNo=e.data.orderNo,s.purchase.createName=e.data.createName,s.purchase.createTime=e.data.createTime,Object.assign(s.purchase,_extends({},e.data)),s.purchase.delGoodIds=[],console.log("data.data.goodList",e.data.goodList),s.purchase.goodList=e.data.goodList,s.productDetailList=s.purchase.goodList,console.log(e.data.orderStatus),s.isEdit(1==s.purchase.orderStatus?"Y":"N"),1<e.data.orderStatus?(s.isSaveDisable=!0,s.isSubmitDisable=!0):(s.isSaveDisable=!1,s.isSubmitDisable=!1),1===e.data.orderStatus?2==s.purchase.datasources?(s.isAddRowDisable=!0,s.isDelRowDisable=!1):s.isAddRowDisable=!1:"submit"===t&&(s.isAddRowDisable=!0,s.isDelRowDisable=!0,s.isFromList=!0)):(s.$Modal.warning({content:e.msg}),s.isSaveDisable=!1,s.isSubmitDisable=!1)},error:function(e){console.log(e)}})},updateSubmit:function(t){var s=this,e=s.handlerDataToPost();0===s.purchase.goodList.length&&(e.goodList=[]),$.ajax({type:"post",async:!0,contentType:"application/text",data:JSON.stringify(e),url:contextPath+"/tpurchaseorder/updatepurchaseOrder",dataType:"json",success:function(e){"100100"===e.code?(s.saveAccess(e.data.id,s.boeType),s.$Modal.success({content:"更新成功！"}),s.getAccess(s.purchase.id,s.boeType),s.purchase.updateName=e.data.updateName,s.purchase.updateTime=e.data.updateTime,Object.assign(s.purchase,_extends({},e.data)),s.purchase.delGoodIds=[],s.purchase.goodList=e.data.goodList,s.productDetailList=s.purchase.goodList,console.log(e.data.orderStatus),s.isEdit(1==s.purchase.orderStatus?"Y":"N"),1<e.data.orderStatus?(s.isSaveDisable=!0,s.isSubmitDisable=!0):(s.isSaveDisable=!1,s.isSubmitDisable=!1),1===e.data.orderStatus?(s.isAddRowDisable=!1,s.isDelRowDisable=!1):"submit"===t&&(s.isAddRowDisable=!0,s.isDelRowDisable=!0,s.isFromList=!0)):(s.$Modal.warning({content:e.msg}),s.isSaveDisable=!1,s.isSubmitDisable=!1)},error:function(e){console.log(e)}})},save:function(e){console.log(e,this.purchase.orderStatus),console.log(this.purchase),1<this.purchase.orderStatus?this.isSubmitDisable=!0:(this.isSaveDisable=!0,this.isSubmitDisable=!0,""===this.purchase.orderNo||null===this.purchase.orderNo?"save"===e?(this.purchase.orderStatus=1,2==this.purchase.dataSources&&this.addSubmit("save"),1==this.purchase.dataSources&&(this.validateProduct()?this.addSubmit("save"):(this.isSaveDisable=!1,this.isSubmitDisable=!1))):"submit"===e&&(console.log("新增校验："+this.verifyInfo(),this.verifyGoodLine()),2==this.purchase.dataSources&&(this.verifyInfo()&&this.verifyGoodLine()?(this.purchase.orderStatus=2,this.addSubmit("submit")):(this.isSaveDisable=!1,this.isSubmitDisable=!1)),1==this.purchase.dataSources&&(this.validateProduct()&&this.verifyInfo()&&this.verifyGoodLine()?(this.purchase.orderStatus=2,this.addSubmit("submit")):(this.isSaveDisable=!1,this.isSubmitDisable=!1))):"save"===e?(2==this.purchase.dataSources&&this.updateSubmit("save"),1==this.purchase.dataSources&&(this.validateProduct()?this.updateSubmit("save"):(this.isSaveDisable=!1,this.isSubmitDisable=!1))):"submit"===e&&(console.log("修改校验："+this.verifyInfo(),this.verifyGoodLine()),2==this.purchase.dataSources&&(this.verifyInfo()&&this.verifyGoodLine()?(this.purchase.orderStatus=2,this.updateSubmit("submit")):(this.isSaveDisable=!1,this.isSubmitDisable=!1)),1==this.purchase.dataSources&&(this.validateProduct()&&this.verifyInfo()&&this.verifyGoodLine()?(this.purchase.orderStatus=2,this.updateSubmit("submit")):(this.isSaveDisable=!1,this.isSubmitDisable=!1))))},approval:function(){this.modalType="approve",this.modalTrigger=!this.modalTrigger},reject:function(){this.modalType="reject",this.modalTrigger=!this.modalTrigger},loadData:function(){var t=this;$.ajax({type:"post",url:contextPath+"/tpurchasecollectgoods/data",dataType:"json",success:function(e){t.employees=e.data.employees},error:function(){console.log("服务器出错啦")}})},changeEmp:function(e){this.purchase.salesmanId=e.value;var t=e.label;this.purchase.salesmanName=t.substring(t.lastIndexOf("-")+1,t.length)},showlist:function(){window.parent.activeEvent({name:"采购订单列表",url:contextPath+"/purchase/purchase-order-list/purchase-order-list.html"})},preview:function(){},print:function(){},addattachment:function(){},exit:function(){window.parent.closeCurrentTab({openTime:this.openTime,exit:!0})},modalSure:function(e){this.productDetailModalClick(e)},modalCancel:function(e){},productDetailModalClick:function(e){"attr_ranges_goods"===this.purchase.goodList[this.selectedIndex].goodsMainType?Object.assign(this.purchase.goodList[this.selectedIndex],{tBaseBomEntity:e,assistAttrs:null,overEdit:!0}):Object.assign(this.purchase.goodList[this.selectedIndex],{assistAttrs:e,tBaseBomEntity:null,overEdit:!0})},showProductDetail:function(e){var t=this;if(this.selectedIndex=e,console.log(this.purchase.goodList),!this.purchase.goodList[e].commodityId)return this.$Modal.error({content:"还未选择商品，请先选择商品，再选择明细！"}),!1;var s={goodsId:this.purchase.goodList[e].goodsId,commodityId:this.purchase.goodList[e].commodityId,documentType:"P_ORDER"},o=null;this.productDetailModal.dataSourceType&&!this.purchase.id&&(this.purchase.goodList[e].goldParts&&1==this.purchase.goodList[e].goldParts.length&&Object.assign(this.purchase.goodList[e].goldParts[0],{checked:!0}),o={},Object.assign(o,{goldParts:this.purchase.goodList[e].goldParts,stonesParts:this.purchase.goodList[e].stonesParts,partParts:this.purchase.goodList[e].partParts,materialParts:this.purchase.goodList[e].materialParts})),Object.assign(this.productDetailModal,{showModal:!0,ids:s,dataSource:o}),this.$nextTick(function(){t.$refs.modalRef.getProductDetail()})},handlerDataToPost:function(){var s=this,e={stonesParts:[],materialParts:[],partParts:[],goldParts:[]},o=JSON.parse(JSON.stringify(this.purchase));return o.goodList=[JSON.parse(JSON.stringify(e))],htHandlerProductDetail(this.purchase.goodList,o,e,this.productDetailModal.dataSourceType),this.purchase.goodList.map(function(e,t){o.goodList[t]||(o.goodList[t]={}),Object.assign(o.goodList[t],{mrpId:e.mrpId,commodityId:e.commodityId,pictureUrl:e.pictureUrl,goodsId:e.goodsId,orderNo:e.orderNo,purchaseType:e.purchaseType,goodsCode:e.goodsCode,goodsName:e.goodsName,deliveryDate:e.deliveryDate,purchaseCount:e.purchaseCount,goodsSpecifications:e.goodsSpecifications,weightUnit:e.weightUnit,purchaseWeight:e.purchaseWeight,digitUnit:e.digitUnit,chargeUnit:e.chargeUnit,price:e.price,amount:e.amount,remark:e.remark,goodsLineNo:e.goodsLineNo,goodsMainType:e.goodsMainType,alreadyCollectCount:"0.0",alreadyCollectWeight:"0.0",goodsTypeName:s.purchase.goodsTypeName,goodsTypePath:s.purchase.goodsGroupPath,custStyleCode:e.custStyleCode,documentType:e.documentType,productFlag:e.productFlag,stoneSection:e.stoneSection,stoneClarity:e.stoneClarity,stoneColor:e.stoneColor,viceStoneWeight:e.viceStoneWeight,mainStoneWeight:e.mainStoneWeight,goldColor:e.goldColor,goldWeight:e.goldWeight}),s.productDetailModal.dataSourceType&&!e.overEdit&&Object.assign(o.goodList[t],{materialParts:e.materialParts,goldParts:e.goldParts,stonesParts:e.stonesParts,partParts:e.partParts})}),console.log(o),o},modalOk:function(){},sum:function(e,s){return e.reduce(function(e,t){return""===t[s]||null===t[s]||void 0===t[s]?0+e:(isNaN(t[s])&&(t[s]=""),parseFloat(t[s])+e)},0)},addOneRow:function(e){if(console.log(this.purchase.goodsTypeName),""===this.purchase.goodsTypeName)return this.$Modal.warning({content:"请先选择商品类型"}),!1;var t;this.validateProduct()&&(0==this.commodityList.length&&this.getCommodityList(),this.purchase.goodList.push((_defineProperty(t={orderNo:e,commodityId:"",pictureUrl:"",goodsId:""},"orderNo",""),_defineProperty(t,"purchaseType",""),_defineProperty(t,"goodsCode",""),_defineProperty(t,"goodsName",""),_defineProperty(t,"deliveryDate",""),_defineProperty(t,"purchaseCount",""),_defineProperty(t,"goodsSpecifications",""),_defineProperty(t,"weightUnit",""),_defineProperty(t,"purchaseWeight",""),_defineProperty(t,"digitUnit",""),_defineProperty(t,"chargeUnit",""),_defineProperty(t,"price",""),_defineProperty(t,"amount",""),_defineProperty(t,"remark",""),_defineProperty(t,"goodsLineNo",""),_defineProperty(t,"goodsMainType",""),_defineProperty(t,"alreadyCollectCount","0.0"),_defineProperty(t,"alreadyCollectWeight","0.0"),_defineProperty(t,"goodsTypeName",""),_defineProperty(t,"goodsTypePath",""),_defineProperty(t,"custStyleCode",""),_defineProperty(t,"stoneSection",""),_defineProperty(t,"stoneClarity",""),_defineProperty(t,"stoneColor",""),_defineProperty(t,"viceStoneWeight",""),_defineProperty(t,"mainStoneWeight",""),_defineProperty(t,"goldColor",""),_defineProperty(t,"goldWeight",""),_defineProperty(t,"options",this.commodityList),t)))},deleteOneRow:function(e){var t=this;""!==e?this.$Modal.confirm({content:"要删除该行信息吗？",closable:!0,onOk:function(){t.purchase.goodList[t.selectedRowIndex].goodsId&&t.purchase.delGoodIds.push(t.purchase.goodList[t.selectedRowIndex].goodsId),2!=t.purchase.dataSources||1!=t.purchase.goodList.length?t.purchase.goodList.splice(e,1):t.$Message.warning({content:"当前数据来源采购清单，不能全部删除！"})}}):this.$Message.warning({content:"您没有选中任何行，请选择一条数据！"})},selectOneRow:function(e,t){this.selectedRowIndex=e},getSupplierInfo:function(e){var t=e,s=this;t&&$.ajax({type:"POST",url:contextPath+"/tpurchaseorder/getSupplierDetail?supplierId="+t,contentType:"application/json",dataType:"json",success:function(e){s.purchase.supplierCode=e.data.siShortName,s.purchase.supplierName=e.data.supplierName,s.purchase.phone=e.data.phone,s.purchase.defaultContact=e.data.defaultContact,s.purchase.concreteAddress=e.data.concreteAddress},error:function(e){s.$Modal.warning({content:"服务器出错啦"})}})},showBasicInfo:function(e){this.purchase.businessTypeId=e.basicInfo.businessTypeId,this.purchase.orderNo=e.basicInfo.orderNo,this.purchase.goodList.orderNo=e.basicInfo.orderNo,this.purchase.purchaseDate=e.basicInfo.purchaseDate,this.purchase.goodsTypeName=e.basicInfo.goodsTypeName,this.purchase.organizationId=e.basicInfo.organizationId,this.purchase.salesmanName=e.basicInfo.salesmanName,this.purchase.salesmanId=e.basicInfo.salesmanId,this.purchase.supplierId=e.basicInfo.supplierId,this.purchase.createName=e.basicInfo.createName,this.purchase.createTime=e.basicInfo.createTime,this.purchase.updateName=e.basicInfo.updateName,this.purchase.updateTime=e.basicInfo.updateTime,this.purchase.auditor=e.basicInfo.auditor,this.purchase.auditTime=e.basicInfo.auditTime,this.purchase.goodsGroupPath=e.basicInfo.goodsGroupPath,this.purchase.id=e.basicInfo.id,this.purchase.dataSources=e.basicInfo.dataSources,this.purchase.orderStatus=e.basicInfo.orderStatus,this.getSupplierInfo(e.basicInfo.supplierId)},valueVerify:function(e,t,s,o){console.log(e,t,s,o),console.log(this.originData);var a=this;if(!("add"===a.param.type||1<a.param.basicInfo.orderStatus)&&t.goodsId){var i=a.originData[o].purchaseCount,r=a.originData[o].purchaseWeight;if(console.log(i,r,a.purchase.dataSources),"purchaseCount"===e)if(2==a.purchase.dataSources){if(i<s)return a.$Message.warning("修改值不能大于原值，请重新修改！"),void(a.purchase.goodList[o].purchaseCount=i)}else if(1==a.purchase.dataSources&&null!==i&&0!==i&&i<s)return a.$Message.warning("修改值不能大于原值，请重新修改！"),void(a.purchase.goodList[o].purchaseCount=i);if("purchaseWeight"===e)if(2==a.purchase.dataSources){if(r<s)return a.$Message.warning("修改值不能大于原值，请重新修改！"),void(a.purchase.goodList[o].purchaseWeight=r)}else if(1==a.purchase.dataSources&&null!==r&&0!==r&&r<s)return a.$Message.warning("修改值不能大于原值，请重新修改！"),void(a.purchase.goodList[o].purchaseWeight=r)}},clearNoNum:function(e,t,s){return htInputNumber(e,t,s)},typeInit:function(e,t,s){for(var o=0;o<e.length;o++){if(e[o].value==s)return t.push(e[o].value),!0;if(e[o].children&&0<e[o].children.length&&this.typeInit(e[o].children,t,s))return t.push(e[o].value),!0}},repositionDropdown:function(){return repositionDropdownOnSroll("testTableWrap","goods")}},watch:{purchase:{handler:function(e,t){2==e.dataSources?this.productDetailModal.dataSourceType=!0:this.productDetailModal.dataSourceType=!1},deep:!0},productDetailList:{handler:function(e,t){var s=this,o=0,a=0,i=0;e.map(function(e){e.purchaseCount&&!isNaN(e.purchaseCount)&&(o=math.eval(Number(o)+Number(e.purchaseCount))),e.purchaseWeight&&!isNaN(e.purchaseWeight)&&(a=math.eval(Number(a)+Number(e.purchaseWeight))),e.price&&(1==e.chargeUnit&&e.purchaseWeight?e.amount=parseFloat(math.eval(Number(e.price)*Number(e.purchaseWeight)).toFixed(3)):2==e.chargeUnit&&e.purchaseCount?e.amount=parseFloat(math.eval(Number(e.price)*Number(e.purchaseCount)).toFixed(3)):e.amount=0,i=parseFloat(math.eval(Number(i)+Number(e.amount)).toFixed(2))),s.purchase.goodList.purchaseCount=o,s.purchase.goodList.purchaseWeight=a,s.purchase.goodList.amount=i})},immediate:!0,deep:!0}},computed:{totalCount:function(){return this.purchase.purchaseCount=this.sum(this.purchase.goodList,"purchaseCount").toFixed(0)},totalWeight:function(){return this.purchase.purchaseWeight=this.sum(this.purchase.goodList,"purchaseWeight").toFixed(2)},totalAmount:function(){return this.sum(this.purchase.goodList,"amount").toFixed(2)},typeValue:function(){var e=this.purchase.goodsGroupPath,t=[];return this.typeInit(this.categoryType,t,e),t.reverse()}},created:function(){},mounted:function(){this.loadProductType(),this.initUnit(),this.loadData(),this.repositionDropdown();var e=this;e.param=window.parent.params.params,console.log(e.param),this.openTime=window.parent.params.openTime,this.purchase.organizationName=layui.data("user").currentOrganization.orgName;var t=window.parent.params.params;if("update"===t.type)console.log("修改状态！"),this.isEdit("Y"),this.addBody.orderNo=t.basicInfo.orderNo,this.queryByCode(),this.showBasicInfo(t),console.log("修改状态数据来源"+this.purchase.dataSources),2==this.purchase.dataSources&&(this.isFromList=!0,this.isAddRowDisable=!0);else if("query"===t.type)console.log("查看状态"),this.isEdit("N"),this.addBody.orderNo=t.docCode,this.showBasicInfo(t),this.queryByCode(t.docCode),console.log("查看状态数据来源"+this.purchase.dataSources),1!==t.basicInfo.orderStatus?(this.isSaveDisable=!0,this.isSubmitDisable=!0,this.isAddRowDisable=!0,this.isDelRowDisable=!0,this.isFromList=!0):(console.log(t.basicInfo.dataSources),2===t.basicInfo.dataSources&&(this.isAddRowDisable=!0,this.isFromList=!0));else if("add"===t.type)console.log("手动新增状态"),this.isFromList=!1,this.isEdit("Y"),this.purchase.purchaseDate=new Date,this.purchase.orderStatus=1,this.purchase.dataSources=1,e.isEdit(1==e.purchase.orderStatus?"Y":"N");else if("sAdd"===t.type){console.log("进入源单新增状态"),this.isFromList=!0,console.log(t.basicInfo),this.showBasicInfo(t);for(var s=0;s<t.basicInfo.goodList.length;s++)t.basicInfo.goodList[s].deliveryDate||(t.basicInfo.goodList[s].deliveryDate=new Date);this.purchase.goodList=t.basicInfo.goodList,this.productDetailList=this.purchase.goodList,console.log(this.productDetailList),this.purchase.dataSources=2,this.productDetailModal.dataSourceType=!0,this.isAddRowDisable=!0,this.originData=JSON.parse(JSON.stringify(t.basicInfo.goodList)),e.isEdit(1==e.purchase.orderStatus?"Y":"N")}this.productDetailList=this.purchase.goodList}});