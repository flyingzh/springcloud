"use strict";function _defineProperty(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}var voucherVm=new Vue({el:"#voucher-info",data:function(){var i=this;return{body:{name:"",status:""},voucher:{name:"",status:1},selected:[],isShow:!1,reload:!1,isEdit:!1,isSave:!0,isSearchHide:!0,openTime:"",status:[{value:1,label:"有效"},{value:0,label:"无效"}],statusNum:0,voucherName:"",nodeData:[{id:1,pId:0,name:"1001 库存现金",open:!0},{id:11,pId:1,name:"100101 现金"},{id:12,pId:1,name:"100102 库存外币"},{id:2,pId:0,name:"1002 银行存款",open:!0},{id:21,pId:2,name:"100201 建行"},{id:22,pId:2,name:"100202 中行"},{id:23,pId:2,name:"100203 测试辅助账科目",open:!0},{id:231,pId:23,name:"10020300001 奉公守法"},{id:232,pId:23,name:"10020300002 勤俭节约"},{id:24,pId:2,name:"100204 项目辅助账"},{id:25,pId:2,name:"100205 农行"},{id:3,pId:0,name:"1012 其他货币资金"},{id:4,pId:0,name:"1101 短期投资",open:!0},{id:41,pId:4,name:"110101 基金"},{id:42,pId:4,name:"110102 股票"},{id:43,pId:4,name:"110103 债券"},{id:44,pId:4,name:"110104 其他"},{id:5,pId:0,name:"1121 应收票据"},{id:6,pId:0,name:"1122 应收账款"},{id:7,pId:0,name:"1123 预付账款"},{id:8,pId:0,name:"1131 应收股利"},{id:9,pId:0,name:"1132 应收利息"},{id:10,pId:0,name:"1135 辅助核算验证"},{id:11,pId:0,name:"1221 其他应收款",open:!0},{id:111,pId:11,name:"122101 社保"},{id:112,pId:11,name:"122102 公积金"}],setting:{data:{simpleData:{enable:!0}},callback:{onClick:"clickEvent"}},tmpSubject:"",subject:{sub1:"",sub2:"",sub3:"",sub4:"",sub5:"",sub6:""},data_config:{url:contextPath+"/tbasevoucherdata/list",colNames:["凭证字","有效状态","创建人","创建时间"],colModel:[{name:"name",index:"name",width:300,align:"left",formatter:function(e,t,a,n){return $(document).off("click",".detail"+e).on("click",".detail"+e,function(){i.detailClick({value:e,grid:t,rows:a,state:n})}),'<a class="detail'+e+'">'+e+"</a>"}},{name:"status",index:"status",width:300,align:"left",sortable:!1,formatter:function(e){return 1==e?"有效":"无效"}},{name:"createName",index:"createName",width:300,align:"left",sortable:!1},{name:"createTime",index:"createTime",width:300,align:"left",sortable:!1}]}}},methods:{hideSearch:function(){this.isSearchHide=!this.isSearchHide,$(".chevron").css("top","")},clickEvent:function(e,t,a){var n=this.$ztree.getSelectedNodes();void 0===a.children&&(this.tmpSubject=n[0].name)},search:function(){this.reload=!this.reload},clear:function(){this.body={name:"",status:""}},add:function(){this.isShow=!0},copy:function(){if(1===this.selected.length){var e=this.selected[0];e&&this.queryById(e,!1,!0)}else layer.alert("只能对单行数据操作!")},update:function(e,t){var a;$.ajax((_defineProperty(a={type:"POST",url:e,data:t,contentType:"application/json"},"data",JSON.stringify(t)),_defineProperty(a,"dataType","json"),_defineProperty(a,"success",function(e){"100100"===e.code?layer.alert("操作成功",{icon:1,end:function(){voucherVm.cancel(),voucherVm.reload=!voucherVm.reload}}):layer.alert(e.msg,{icon:0}),voucherVm.isSave=!0}),_defineProperty(a,"error",function(e){console.log("服务器出错")}),a))},del:function(){this.isShow=!1,0!=this.selected.length?layer.confirm("当前数据有可能被引用，会影响数据准确性，确认是否删除？",{btn:["确认","取消"],btn1:function(){$.ajax({type:"POST",url:contextPath+"/tbasevoucherdata/delete",contentType:"application/json",data:JSON.stringify(voucherVm.selected),dataType:"json",success:function(e){"100100"===e.code?(layer.alert(e.data,{icon:1}),voucherVm.selected=[],voucherVm.reload=!voucherVm.reload):layer.alert(e.msg,{icon:0})},error:function(e){layer.alert("数据删除失败",{icon:0})}})}}):layer.alert("请选择行!")},modify:function(){if(1===this.selected.length){var e=this.selected[0];e&&voucherVm.queryById(e,!1)}else layer.alert("只能对单条数据进行操作!")},exit:function(){window.parent.closeCurrentTab({exit:!0,openTime:this.openTime})},queryById:function(e,t,a){e&&$.ajax({type:"POST",url:contextPath+"/tbasevoucherdata/info/"+e,dataType:"json",success:function(e){"100100"===e.code&&(voucherVm.isEdit=t,a?voucherVm.voucher.status=e.data.status:voucherVm.voucher=e.data,voucherVm.isShow=!0)},error:function(e){layer.alert("服务器出错!")}})},save:function(){if($("#addVoucherForm").valid()){this.isSave=!1;var e=this.voucher,t=contextPath+"/tbasevoucherdata/save";e.id&&(t=contextPath+"/tbasevoucherdata/update"),this.update(t,e)}},detailClick:function(e){var t=e.rows.id;t&&voucherVm.queryById(t,!0)},cancel:function(){this.voucher={name:"",status:1},this.isShow=!1,this.isEdit=!1,$("#addVoucherForm").validate().resetForm()},initFormValidate:function(){var e={onfocusout:function(e){$(e).valid()},onkeyup:!1,rules:{name:{required:!0,remote:{url:contextPath+"/tbasevoucherdata/checkname",type:"post",dataType:"json",data:{id:function(){return null==voucherVm.voucher.id?"":voucherVm.voucher.id},name:function(){return voucherVm.voucher.name}},dataFilter:function(e){return"100100"===JSON.parse(e).code}}}},messages:{name:{required:"请填写名称!",remote:"该凭证字已存在!"}}};$("#addVoucherForm").validate(e)}},mounted:function(){this.initFormValidate(),jQuery.validator.addMethod("isChar",function(e,t){return/^([a-zA-Z0-9]+)$/.test(e)},"编码格式错误!"),this.openTime=window.parent.params.openTime}});