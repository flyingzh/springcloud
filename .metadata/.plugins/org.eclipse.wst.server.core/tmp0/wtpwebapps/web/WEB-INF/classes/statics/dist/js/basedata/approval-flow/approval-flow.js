"use strict";new Vue({el:"#approval-flow",data:function(){return{tree_data:null,detail:{},levelList:[{userIds:[]}],userList:[],levelMap:{0:"一级审批",1:"二级审批",2:"三级审批",3:"四级审批",4:"五级审批",5:"六级审批"},tree_setting:{data:{view:{dblClickExpand:!1},simpleData:{enable:!1},key:{name:"name",children:"children"}},callback:{onClick:this.treeClickEvent,beforeClick:this.treeBeforeClick}}}},methods:{treeClickEvent:function(e,t,a){var n=this;$.ajax({type:"POST",url:contextPath+"/ApprovalController/getApprovalNodes",data:JSON.stringify({docTypeCode:a.value}),contentType:"application/json",success:function(e){"100100"===e.code?e.data&&0<e.data.nodes.length?(n.levelList=e.data.nodes,n.detail=e.data):(n.levelList=[{userIds:[]}],n.detail=Object.assign({},{docTypeCode:a.value})):layer.alert(e.msg)}})},treeBeforeClick:function(e,t,a){return!t.isParent},add:function(){this.levelList.length<6?this.levelList.push({userIds:[]}):this.$Modal.warning({content:"最多只能有六级审核"})},del:function(e){1<this.levelList.length?this.levelList.splice(e,1):this.$Modal.warning({content:"最少需要有一级审核"})},save:function(){var t=this;Object.assign(this.detail,{nodes:this.levelList}),this.validate()||$.ajax({type:"POST",url:contextPath+"/ApprovalController/saveOrUpdateNodes",contentType:"application/json",data:JSON.stringify(this.detail),success:function(e){"100100"===e.code?t.$Modal.success({content:"保存成功"}):layer.alert(e.msg)}})},validate:function(){var a=this;return this.detail.docTypeCode?void 0===this.detail.status?(this.$Modal.warning({content:"请选择状态"}),!0):this.levelList.some(function(e,t){if(0===e.userIds.length)return a.$Modal.warning({content:a.levelMap[t]+"必选"}),!0}):(this.$Modal.warning({content:"请先选择左侧树"}),!0)}},created:function(){var t=this;this.tree_data=getCodeAll("sys_approval"),$.ajax({type:"POST",url:contextPath+"/user/queryUsesByOrgin",contentType:"application/json",success:function(e){"100100"===e.code?t.userList=e.data:layer.alert(e.msg)}})},mounted:function(){}});