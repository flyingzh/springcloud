"use strict";var vm=new Vue({el:"#app",data:{openTime:"",isShow:!1,isEdit:!1,reload:!1,isSearchHide:!0,isTabulationHide:!0,categoryType:[],productId:"",body:{orderNo:"",customerId:"",goodsTypePath:"",goodsCode:"",qualityStatus:5,sourceType:"S_CUST_MATERIAL",businessType:"P_RECEIPT_01"},custList:[],selected:"",data_config:{url:contextPath+"/entrustMaterialInController/getPurchaseCollectgoods",datatype:"json",colNames:["id","客户id","goodsId","商品类型路径","源单类型","单据编号","商品类型","客户","业务类型","质检状态","商品编码","商品名称","计数单位","数量","计重单位","重量","合格数量","不合格数量","特别放行数量"],colModel:[{name:"cid",index:"cid",hidden:!0},{name:"customerId",index:"customerId",hidden:!0},{name:"goodsId",index:"goodsId",hidden:!0},{name:"goodsTypePath",index:"goodsTypePath",hidden:!0},{name:"sourceType",width:210,align:"left",formatter:function(e){switch(e){case"P_ORDER_01":return"收货单一客户送料";case"P_ORDER_02":return"收货单一标准采购收货";case"S_CUST_MATERIAL":return"收货单一受托加工";default:return""}},unformat:function(e){switch(e){case"收货单一客户送料":return"P_ORDER_01";case"收货单一标准采购收货":return"P_ORDER_02";case"收货单一受托加工":return"S_CUST_MATERIAL";default:return""}}},{name:"orderNo",width:210,align:"left",formatter:function(e,t,n,o){return $(document).off("click",".updateDetail"+e).on("click",".updateDetail"+e,function(){vm.updateDetail(e)}),'<a class="updateDetail'+e+'">'+e+"</a>"},unformat:function(e,t,n){return e.replace(/(<\/?a.*?>)/g,"")}},{name:"goodsTypeName",width:210,align:"left"},{name:"customerName",width:210,align:"left"},{name:"businessType",align:"left",width:210,formatter:function(e){switch(e){case"P_RECEIPT_01":return"客户送料";case"P_RECEIPT_02":return"标准采购收货";case"P_RECEIPT_03":return"受托加工收货";case"P_RECEIPT_04":return"供应商退料";default:return""}},unformat:function(e){switch(e){case"客户送料":return"P_RECEIPT_01";case"标准采购收货":return"P_RECEIPT_02";case"受托加工收货":return"P_RECEIPT_03";case"供应商退料":return"P_RECEIPT_04";default:return""}}},{name:"qualityStatus",align:"left",width:210,formatter:function(e,t,n,o){var a="";return n.qualifiedNumber&&0<Number(n.qualifiedNumber)&&(a="放行"),n.releaseNumber&&0<Number(n.releaseNumber)&&(a="特别放行"),a}},{name:"goodsCode",align:"left",width:210},{name:"goodsName",align:"left",width:210},{name:"countingUnit",align:"left",width:210},{name:"actualCount",align:"left",width:210},{name:"weightUnit",align:"left",width:210},{name:"actualWeight",align:"left",width:210},{name:"qualifiedNumber",align:"left",width:210},{name:"backNumber",align:"left",width:210},{name:"releaseNumber",align:"left",width:210}],rowNum:5,rowList:[10,20,30],mtype:"post",viewrecords:!0}},methods:{clear:function(){var e=this;this.body.orderNo="",this.body.goodsTypePath="",this.body.goodsCode="",this.body.qualityStatusIds="3,4",this.body.businessType="P_RECEIPT_01",this.productId&&this.$nextTick(function(){e.productId=[]}),this.body.customerId&&(this.$refs.customerId.reset(),this.$nextTick(function(){e.body.customerId=""})),console.log(this.body.customerId)},refresh:function(){this.reload=!this.reload},search:function(){this.refresh()},loadProductType:function(){var t=this;$.ajax({type:"post",url:contextPath+"/entrustMaterialInController/queryStyleCategory",dataType:"json",success:function(e){t.categoryType=t.initGoodCategory(e.data.cateLists)},error:function(){alert("服务器出错啦")}})},changeproductTypeName:function(e,t){this.body.goodsTypePath=t[t.length-1].value,console.log(this.selected,333333)},initGoodCategory:function(e){var a=this,i=[];return e.forEach(function(e){var t=e.customCode,n=e.name,o=e.cateLists;o&&(o=a.initGoodCategory(o)),i.push({value:t,label:n,children:o})}),i.forEach(function(e){e.children||delete e.children}),i},getCust:function(){var t=this;$.ajax({type:"post",url:contextPath+"/entrustMaterialInController/queryAllCustomer",contentType:"application/json",dataType:"json",success:function(e){console.log("客户",e),t.custList=e.data},error:function(){alert("服务器出错啦")}})},updateDetail:function(e){console.log(e);$.ajax({type:"POST",url:contextPath+"/tpurchasecollectgoods/info?code="+e}).then(function(e){window.parent.activeEvent({name:"采购收货单-新增",url:contextPath+"/purchase/purchase-collectgoods/purchase-collectgoods-add.html",params:e.data,type:4})})},generate:function(){var e=this.selected;if(!ht.util.hasValue(e,"array"))return this.$Modal.warning({content:"请先选择一条记录!",title:"提示"}),!1;if(this.checkConsistent(e)){var t=[];e.forEach(function(e){t.push(e.goodsId)}),window.parent.activeEvent({name:"新增受托加工材料入库单",url:contextPath+"/warehouse/entrust-material-in/entrust-material-in-info.html",params:{data:{goodsIds:t},type:3}})}},checkConsistent:function(t){var n=!1,o=!1,a=!1,i=!1;return t.every(function(e,t,n){console.log("item="+e+",index="+t+",array="+n)}),t.forEach(function(e){t[0].sourceType!==e.sourceType&&(n=!0),t[0].customerId!==e.customerId&&(o=!0),t[0].goodsTypePath!==e.goodsTypePath&&(a=!0),t[0].businessType!==e.businessType&&(i=!0)}),n?(this.$Modal.warning({content:"源单类型不一致!",title:"提示"}),console.log("源单类型不一致"),!1):o?(this.$Modal.warning({content:"客户不一致!",title:"提示"}),console.log("客户不一致"),!1):a?(this.$Modal.warning({content:"商品类型不一致!",title:"提示"}),console.log("商品类型不一致"),!1):!i||(this.$Modal.warning({content:"业务类型不一致!",title:"提示"}),console.log("业务类型不一致"),!1)},exit:function(){console.log(1111),window.parent.closeCurrentTab({name:"客来料待入库列表",exit:!0,openTime:this.openTime})}},mounted:function(){this.loadProductType(),this.getCust(),this.openTime=window.parent.params.openTime}});