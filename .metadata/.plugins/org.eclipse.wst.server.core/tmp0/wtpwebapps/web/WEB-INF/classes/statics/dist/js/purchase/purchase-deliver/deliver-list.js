"use strict";function _defineProperty(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var deliverList=new Vue({el:"#deliverList",data:function(){var e,i=this;return{openTime:"",isSearchHide:!0,isTabulationHide:!0,isShow:!1,isHide:!0,reload:!1,selected:[],categoryType:[],commodityCategoty:[],deliverGoods:{},suppliers:[],dateArr:[],body:{goodsTypePath:"",supplierId:"",startTime:"",endTime:"",orderStatus:"",orderNo:""},data_config:{url:contextPath+"/purchaseDeliverController/list",colNames:["单据编号","id","日期","单据状态","供应商","商品类型","送料数量","送料重量"],colModel:[{name:"orderNo",index:"orderNo",width:180,align:"left",formatter:function(e,t,r,o){return $(document).off("click",".detail"+e).on("click",".detail"+e,function(){console.log({value:e,grid:t,rows:r,state:o}),i.selectByOrderDetail(r.id)}),'<a class="detail'+e+'">'+e+"</a>"},unformat:function(e,t,r){return e.replace(/(<\/?a.*?>)/g,"")}},{name:"id",hidden:!0},(e={name:"createTime",index:"createTime",width:180,align:"center"},_defineProperty(e,"align","left"),_defineProperty(e,"formatter",function(e,t,r,o){return new Date(e).format("yyyy-MM-dd")}),e),{name:"orderStatus",index:"orderStatus",align:"left",width:150,formatter:function(e){return 1==e?"暂存":2==e?"待审核":3==e?"审核中":4==e?"已审核":5==e?"驳回":void 0}},{name:"supplierName",index:"supplierName",align:"left",width:300},{name:"goodsTypeName",index:"goodsTypeName",align:"left",width:180},{name:"deliverWeight",index:"deliverWeight",width:180,align:"left"},{name:"deliverCount",index:"deliverCount",align:"left",width:180}]}}},methods:{loadSuppliers:function(){var t=this;$.ajax({type:"post",url:contextPath+"/tpurchasecollectgoods/findSupplierByOrgId",dataType:"json",success:function(e){t.suppliers=e.data},error:function(){t.$Modal.error({context:"系统出现异常,请联系管理人员"})}})},changeProductType:function(e,t){var r=t[t.length-1];this.body.goodsTypePath=r.value},search:function(){0<this.dateArr.length&&this.dateArr[0]&&this.dateArr[1]?(this.body.startTime=this.dateArr[0].format("yyyy-MM-dd")+" 00:00:00",this.body.endTime=this.dateArr[1].format("yyyy-MM-dd")+" 23:00:00"):(this.body.startTime="",this.body.endTime=""),this.reload=!this.reload},modify:function(){if(this.selected.length<1)this.$Modal.warning({title:"提示信息",content:"<p>请选择一条记录！</p>"});else if(1<this.selected.length)this.$Modal.warning({title:"提示信息",content:"<p>只能选择一条记录！</p>"});else{var e=this.selected;$.ajax({url:contextPath+"/purchaseDeliverController/queryByOrderInfo/"+e[0].id,method:"post",dataType:"json",success:function(e){"100100"==e.code?window.parent.activeEvent({name:"采购送料单-详情",url:contextPath+"/purchase/purchase-deliver/deliver-add.html",params:{type:"detail",goodsData:e.data,activeType:"detail"}}):layer.alert(e.msg,{icon:0})},error:function(){layer.alert("服务器异常，请稍后再试！",{icon:0})}})}},selectByOrderDetail:function(e){$.ajax({url:contextPath+"/purchaseDeliverController/queryByOrderInfo/"+e,method:"post",dataType:"json",success:function(e){"100100"==e.code?window.parent.activeEvent({name:"采购送料单-详情",url:contextPath+"/purchase/purchase-deliver/deliver-add.html",params:{type:"detail",goodsData:e.data,activeType:"detail"}}):layer.alert(e.msg,{icon:0})},error:function(){layer.alert("服务器异常，请稍后再试！",{icon:0})}})},loadProductType:function(){var t=this;$.ajax({type:"post",url:contextPath+"/documentController/getCategory?parentId=0",contentType:"application/json",dataType:"json",success:function(e){t.categoryType=t.initGoodCategory(e.data.cateLists)},error:function(e){console.log("服务器出错")}})},initGoodCategory:function(e){var i=this,a=[];return e.forEach(function(e){var t=e.customCode,r=e.name,o=e.cateLists;o&&(o=i.initGoodCategory(o)),a.push({value:t,label:r,children:o})}),a.forEach(function(e){e.children||delete e.children}),a},clear:function(){this.$refs.supplier.reset(),this.$nextTick(function(){this.body.supplierId=""}),this.body.goodsTypePath="",this.dateArr=[],this.body.supplierId="",this.body.startTime="",this.body.endTime="",this.body.orderStatus="",this.body.orderNo=""},refresh:function(){this.reload=!this.reload},add:function(){var e=this,t=layui.data("user");e.deliverGoods.orgName=t.currentOrganization.orgName,e.deliverGoods.organizationId=t.userCurrentOrganId,e.deliverGoods.createName=t.username,e.deliverGoods.createId=t.id,e.deliverGoods.orderStatus=1,e.deliverGoods.dataSource=1,e.deliverGoods.goodList=[],e.deliverGoods.createTime=(new Date).format("yyyy-MM-dd"),e.deliverGoods.deliveryDate=(new Date).format("yyyy-MM-dd"),window.parent.activeEvent({name:"采购送料单-新增",url:contextPath+"/purchase/purchase-deliver/deliver-add.html",params:{type:"add",goodsData:e.deliverGoods,activeType:"handworkAdd"}})},del:function(){var t=this,e=[],r=[];for(var o in this.selected)if(e.push(this.selected[o].id),r.push(this.selected[o].orderStatus),1!=this.selected[o].orderStatus)return void this.$Modal.warning({title:"提示信息",content:"<p>只有暂存状态的单据可以删除！</p>"});this.selected.length<1?this.$Modal.warning({title:"提示信息",content:"<p>请先选择至少一条数据！</p>"}):1<=this.selected.length&&this.$Modal.confirm({title:"提示信息",content:"<p>是否删除信息？</p>",onOk:function(){$.ajax({url:contextPath+"/purchaseDeliverController/delete",method:"post",dataType:"json",data:JSON.stringify(e),contentType:"application/json;charset=utf-8",success:function(e){"100100"===e.code?setTimeout(function(){t.$Modal.success({title:"提示信息",content:"删除成功！"}),t.selected=[],t.refresh()},300):layer.alert(e.msg,{icon:0})},error:function(e){layer.alert("删除失败！",{icon:0})}})}})},cancel:function(){window.parent.closeCurrentTab({name:"",openTime:this.openTime,exit:!0})}},created:function(){this.loadProductType(),this.loadSuppliers()},watch:{},mounted:function(){this.openTime=window.parent.params.openTime}});