"use strict";new Vue({el:"#paymentReceiptTimeBook",data:function(){var o=this;return{openTime:"",curDate:(new Date).format("yyyy-MM-dd"),initInfo:{pageType:1,pageTitle:"收款单序时簿"},isInit:!0,showFilter:!1,subjectVisable:!1,visible_filter:!1,deleteVisible:!1,deleteLoading:!0,id:"",sobId:"",voucherId:"",auditStatus:"",confirmConfig:{showConfirm:!1,title:"提示",content:"这是内容",onlySure:!0,success:!0},filterBody:{timeStart:"",timeEnd:(new Date).format("yyyy-MM-dd"),documentType:0,dateScore:"",auditStatus:"",isVoucher:"",documentNumber:"",sobId:0},detailDate:[{label:"今天",value:"today"},{label:"昨天",value:"yesterday"},{label:"近7天",value:"interval7"},{label:"近30天",value:"interval30"},{label:"本月",value:"thisMon"},{label:"上月",value:"lastMon"},{label:"本季度",value:"thisQuarter"},{label:"上季度",value:"lastQuarter"},{label:"本年",value:"thisYear"},{label:"去年",value:"lastYear"}],auditStatusList:[{label:"未审核",value:1},{label:"已审核",value:2}],isVoucherList:[{label:"未记账",value:1},{label:"已记账",value:2}],colNames:[],base_config:{postData:JSON.stringify(o.filterBody),ajaxGridOptions:{contentType:"application/json;charset=utf-8"},datatype:"json",colModel:[{name:"paymentReceiptEntity.auditMark",width:70,formatter:function(t,e,i,n){return 2===t?"Y":"N"}},{name:"paymentReceiptEntity.orderDate",index:"orderDate",sortable:!0,sortorder:"asc",width:90,formatter:function(t,e,i,n){return t.slice(0,10)}},{name:"paymentReceiptEntity.documentNumber",width:80,align:"left"},{name:"financeSourceSingleDataEntities",width:100,align:"left",formatter:function(t,e,i,n){var a="";return i.financeSourceSingleDataEntities.map(function(t,e){a+=t.sourceListNumber+"<br>"}),a}},{name:"paymentReceiptEntity.clearanceAccount",width:80,align:"left"},{name:"paymentReceiptEntity.discountSubject",width:80,align:"right"},{name:"paymentReceiptEntity.reducedAmountFor",width:80,align:"right",formatter:function(t,e,i,n){return accounting.formatMoney(t,"",2)}},{name:"paymentReceiptEntity.reducedAmount",width:120,align:"right",formatter:function(t,e,i,n){return accounting.formatMoney(t,"",2)}},{name:"paymentReceiptEntity.voucherSize",width:80,align:"left"},{name:"paymentReceiptEntity.bulkDiscount",width:80,align:"right"},{name:"paymentReceiptEntity.coinStop",width:80,align:"left"},{name:"paymentReceiptEntity.exchangeRate",width:50,align:"right"},{name:"paymentReceiptEntity.watchPaymentFor",width:120,align:"right",formatter:function(t,e,i,n){return accounting.formatMoney(t,"",2)}},{name:"paymentReceiptEntity.watchPayment",width:150,align:"right",formatter:function(t,e,i,n){return accounting.formatMoney(t,"",2)}},{name:"paymentReceiptEntity.typePaymentReceived",index:"typePaymentReceived",width:120,align:"right",formatter:function(t,e,i,n){var a="";switch(t){case 1:a="收款单";break;case 2:a="付款单";break;case 3:a="预收款单";break;case 4:a="预付款单";break;case 5:a="收款退款单";break;case 6:a="付款退款单";break;default:a=""}return a}},{name:"financeSourceSingleDataEntities",width:80,align:"right",formatter:function(t,e,i,n){var a="";return i.financeSourceSingleDataEntities.map(function(t,e){a+=t.documentDate+"<br>"}),a}},{name:"paymentReceiptEntity.documentaryAmountForList",width:80,align:"right",formatter:function(t,e,i,n){return o.sortData(t,e,i,n)}},{name:"paymentReceiptEntity.documentaryAmountList",width:100,align:"right",formatter:function(t,e,i,n){return o.sortData(t,e,i,n)}},{name:"paymentReceiptEntity.cancellationAmountList",width:100,align:"right",formatter:function(t,e,i,n){return o.sortData(t,e,i,n)}},{name:"paymentReceiptEntity.notCancellationAmountList",width:100,align:"right",formatter:function(t,e,i,n){return o.sortData(t,e,i,n)}},{name:"paymentReceiptEntity.thisTiemCancellationForList",width:100,align:"right",formatter:function(t,e,i,n){return o.sortData(t,e,i,n)}},{name:"paymentReceiptEntity.thisTiemCancellationList",width:100,align:"right",formatter:function(t,e,i,n){return o.sortData(t,e,i,n)}},{name:"financeSourceSingleDataEntities",width:100,align:"right",formatter:function(t,e,i,n){var a="";return i.financeSourceSingleDataEntities.map(function(t,e){a+=t.invoiceCoinType+"<br>"}),a}},{name:"financeSourceSingleDataEntities",width:100,align:"right",formatter:function(t,e,i,n){var a="";return i.financeSourceSingleDataEntities.map(function(t,e){a+=t.surfaceExchangeRate+"<br>"}),a}},{name:"paymentReceiptEntity.summary",width:80,align:"right"},{name:"paymentReceiptEntity.department",width:80,align:"right"},{name:"paymentReceiptEntity.director",width:80,align:"right"},{name:"paymentReceiptEntity.occurrenceObject",width:80,align:"right"},{name:"paymentReceiptEntity.salesman",width:80,align:"right"},{name:"paymentReceiptEntity.singlePerson",width:80,align:"right"},{name:"paymentReceiptEntity.auditorName",width:80,align:"right"},{name:"paymentReceiptEntity.auditDate",width:80,align:"right"},{name:"paymentReceiptEntity.printingTimes",width:80,align:"right"},{name:"financeSourceSingleDataEntities",width:100,align:"right",formatter:function(t,e,i,n){var a="";return i.financeSourceSingleDataEntities.map(function(t,e){a+=t.remark+"<br>"}),a}},{name:"paymentReceiptEntity.id",hidden:!0},{name:"paymentReceiptEntity.sobId",hidden:!0},{name:"paymentReceiptEntity.voucherId",hidden:!0}],rowNum:999999999,sortorder:"desc",mtype:"post",jsonReader:{root:"data"},sortable:!1,styleUI:"Bootstrap",height:$(window).height()-120,viewrecords:!0,footerrow:!0,userDataOnFooter:!0,gridComplete:o.completeMethod,onCellSelect:function(t){var e=jQuery("#list").jqGrid("getRowData",t),i=e["paymentReceiptEntity.id"],n=e["paymentReceiptEntity.sobId"],a=e["paymentReceiptEntity.voucherId"];console.log(e),console.log("主表id: "+i),console.log("账套id: "+n),console.log("凭证id: "+a),console.log("审核标志: "+e["paymentReceiptEntity.auditMark"]),o.id=i,o.sobId=n,o.voucherId=a,o.auditStatus=e["paymentReceiptEntity.auditMark"]||""},ondblClickRow:function(t){var e=jQuery("#list").jqGrid("getRowData",t)["paymentReceiptEntity.id"],i="";"1"===o.initInfo.pageType?(i="/web/finance/paymentReceipt/index.html?type=1&id="+e+"&action=query",window.parent.activeEvent({name:"收款单",url:i})):(i=i="/web/finance/paymentReceipt/index.html?type=2&id="+e+"&action=query",window.parent.activeEvent({name:"付款单",url:i}))}}}},methods:{sortData:function(t,e,i,n){var a="";return t.map(function(t,e){"number"==typeof t&&(t=accounting.formatMoney(t,"",2)),a+="<div class='sumCol'>"+t+"</div>"}),a},getColSum:function(t){var e=$("td[aria-describedby='list_"+t+"']"),i=0;return(e=0!==e.children("div.sumCol").length?$("td[aria-describedby='list_"+t+"']").children("div.sumCol"):$("td[aria-describedby='list_"+t+"']:not(:last)")).each(function(t,e){i+=1e3*accounting.unformat($(e).text())}),i/=1e3,i=accounting.formatMoney(i,"",2)},gridInit:function(){var t=baseURL+"paymentreceiptController/filtrate",e=Object.assign({},this.base_config,{url:t,colNames:this.colNames,postData:JSON.stringify(this.filterBody)});jQuery("#list").jqGrid(e)},pageInit:function(){var t=getUrlParam("type");this.initInfo.pageType=t,"1"===(this.filterBody.documentType=t)?(this.colNames=["审核标志","日期","单据号","源单编号","结算账号","折扣科目","折后金额","折后金额本位币","凭证字号","整单折扣","币别","汇率","表头收款金额","表头收款金额本位币","收款单据类型","单据日期","单据金额","单据金额本位币","已核销金额","未核销金额","本次核销","本次核销本位币","发票币别","表体汇率","摘要","部门","主管","客户","业务员","制单人","审核人","审核日期","打印次数","备注","peId","peSobId","peVoucherId"],this.initInfo.pageTitle="收款单序时簿"):"2"===t&&(this.colNames=["审核标志","日期","单据号","源单编号","结算账号","折扣科目","折后金额","折后金额本位币","凭证字号","整单折扣","币别","汇率","表头付款金额","表头付款金额本位币","付款单据类型","单据日期","单据金额","单据金额本位币","已核销金额","未核销金额","本次核销","本次核销本位币","发票币别","表体汇率","摘要","部门","主管","供应商","业务员","制单人","审核人","审核日期","打印次数","备注","peId","peSobId","peVoucherId"],this.initInfo.pageTitle="付款单序时簿"),this.gridInit()},completeMethod:function(){$("#list").footerData("set",{"paymentReceiptEntity.orderDate":"合计","paymentReceiptEntity.documentaryAmountForList":[0],"paymentReceiptEntity.documentaryAmountList":[0],"paymentReceiptEntity.cancellationAmountList":[0],"paymentReceiptEntity.notCancellationAmountList":[0],"paymentReceiptEntity.thisTiemCancellationForList":[0],"paymentReceiptEntity.thisTiemCancellationList":[0]});var t=this.getColSum("paymentReceiptEntity.reducedAmountFor"),e=this.getColSum("paymentReceiptEntity.reducedAmount"),i=this.getColSum("paymentReceiptEntity.watchPaymentFor"),n=this.getColSum("paymentReceiptEntity.watchPayment"),a=this.getColSum("paymentReceiptEntity.documentaryAmountForList"),o=this.getColSum("paymentReceiptEntity.documentaryAmountList"),r=this.getColSum("paymentReceiptEntity.cancellationAmountList"),c=this.getColSum("paymentReceiptEntity.notCancellationAmountList"),l=this.getColSum("paymentReceiptEntity.thisTiemCancellationForList"),s=this.getColSum("paymentReceiptEntity.thisTiemCancellationList");$("#list").footerData("set",{"paymentReceiptEntity.orderDate":"合计","paymentReceiptEntity.reducedAmountFor":t,"paymentReceiptEntity.reducedAmount":e,"paymentReceiptEntity.watchPayment":n,"paymentReceiptEntity.watchPaymentFor":i,"paymentReceiptEntity.documentaryAmountForList":[a],"paymentReceiptEntity.documentaryAmountList":[o],"paymentReceiptEntity.cancellationAmountList":[r],"paymentReceiptEntity.notCancellationAmountList":[c],"paymentReceiptEntity.thisTiemCancellationForList":[l],"paymentReceiptEntity.thisTiemCancellationList":[s]})},handleOpen:function(){this.visible_filter=!0},detailClick:function(t){},iconPopup:function(t){this.subjectVisable=!0},subjectClose:function(){this.subjectVisable=!1},conformCancel:function(){this.confirmConfig.showConfirm=!1},conformSure:function(){this.confirmConfig.showConfirm=!1,this.confirmConfig.onlySure=!this.confirmConfig.onlySure},subjectDate:function(t){},sure:function(t){console.log(this.filterBody),!1===t||$("#list").setGridParam({postData:JSON.stringify(this.filterBody)}).trigger("reloadGrid"),this.visible_filter=!1},addRow:function(){console.log("add");var t="";"1"===this.initInfo.pageType?(t="/web/finance/paymentReceipt/index.html?type=1&id="+this.initInfo.pageType+"&action=add",window.parent.activeEvent({name:"收款单",url:t})):(t=t="/web/finance/paymentReceipt/index.html?type=2&id="+this.initInfo.pageType+"&action=add",window.parent.activeEvent({name:"付款单",url:t}))},delRow:function(){console.log("del"),""===this.id?this.$Message.info({content:"请选择要删除的数据",duration:3}):this.deleteVisible=!0},deleteOK:function(){var i=this,n=this,t=baseURL+"paymentreceiptController/delete",e=new FormData;e.append("id",n.id),http.post(t,e).then(function(t){var e="";e=("100100"===t.code&&$("#list").setGridParam({postData:JSON.stringify(i.filterBody)}).trigger("reloadGrid"),t.msg),n.deleteVisible=!1,n.id="",n.$Message.info({content:e,duration:3})},function(t){})},copyRow:function(){},refresh:function(){console.log("执行刷新..."),$("#list").setGridParam({postData:JSON.stringify(this.filterBody)}).trigger("reloadGrid")},reviewAction:function(t){var i=this,n=this,e=!1,a="";if(""===n.id?(e=!0,a="请选择一条数据"):("review"===t&&"Y"===n.auditStatus&&(e=!0,a="该单据已审核"),"reReview"===t&&"N"===n.auditStatus&&(e=!0,a="该单据未审核")),e)n.$Message.info({content:a,duration:3});else{var o="";o="N"===n.auditStatus?baseURL+"paymentreceiptController/audit":baseURL+"paymentreceiptController/counterAudit";var r=new FormData;r.append("id",n.id),http.post(o,r).then(function(t){var e="";e=("100100"===t.code&&$("#list").setGridParam({postData:JSON.stringify(i.filterBody)}).trigger("reloadGrid"),t.msg),n.$Message.info({content:e,duration:3})},function(t){})}},reReview:function(){console.log("反审核跟上面的审核使用同一个功能.")},derivation:function(){console.log("引出,导出excel...");var t="";for(var e in this.filterBody)t+=e+"="+this.filterBody[e]+"&";t=t.slice(0,t.length-1),window.open("/web/paymentreceiptController/exportPaymentReceiptTimeBook?"+t)},print:function(){console.log("序时簿准备打印.htPrint()"),htPrint()},checkVoucher:function(){var t=this;if(console.log("查看凭证前校验: 凭证id为: ==="+t.voucherId+", 账套id为:==="+t.sobId),"0"!==t.voucherId&&""!==t.voucherId){var e=t.voucherId,i=t.sobId,n=contextPath+"/finance/voucher-lrt/index.html?voucherId="+e+"&sobId="+i;window.parent.activeEvent({name:"查看凭证",url:n,params:null})}else t.$Message.info({content:"请选择单据,或者该单据未生成凭证.",duration:3})},createVoucher:function(){var i=this,n=this,t=baseURL+"paymentreceiptController/createVoucher",e=new FormData;e.append("id",n.id),http.post(t,e).then(function(t){var e="";e=("100100"===t.code&&$("#list").setGridParam({postData:JSON.stringify(i.filterBody)}).trigger("reloadGrid"),t.msg),n.$Message.info({content:e,duration:3})},function(t){})},closeWindow:function(){var t="";t="1"===this.filterBody.documentType?"收款单序时簿":"付款单序时簿",window.parent.closeCurrentTab({name:t,openTime:this.openTime,exit:!0})}},mounted:function(){var t=getUrlParam("type");this.initInfo.pageType=t,"1"===(this.filterBody.documentType=t)?this.initInfo.pageTitle="收款单序时簿":"2"===t&&(this.initInfo.pageTitle="付款单序时簿"),this.pageInit(),this.openTime=window.parent.params&&window.parent.params.openTime}});