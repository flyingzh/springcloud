"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};Vue.component("source-list",{props:{config:{type:Object,require:!1,default:function(){return!1}},code:{default:function(){return""}},sourceType:{type:String,default:function(){return"P_ORDER_01"}},showModal:{default:function(){return!1}},url:{default:function(){return"/tpurchaseorder/findByReceipt"}}},data:function(){var o=this;return{materialTypeMap:{P_ORDER_01:"采购订单一标准采购",P_ORDER_02:"采购订单一受托加工采购",S_CUST_MATERIAL:"客户来料单",P_APPLY_DELIVER:"采购送料单"},selected:[],selectedRows:[],alReadySelectedData:[],idKey:"goodsLineNo",responseRaw:[],showDetailModal:!1,body:{hasCreateTestDocument:0,orderNo:""},base_config:{colNames:["操作","源单编号","源单类型"],colModel:[{name:"codes",index:"invdate",width:80,align:"center",formatter:function(e,t,i,n){return $(document).off("click",".select"+i.id).on("click",".select"+i.id,function(){o.doSelect(e,t,i,n)}),'<a type="primary" class="select'+i.id+'">选取</a>'}},{name:"orderNo",index:"currencyName asc, invdate",width:220,align:"center",sort:!1},{name:"orderType",index:"currencyName asc, invdate",width:220,align:"center",sort:!1,formatter:function(e,t,i,n){var a=o.url.substring(0,o.url.lastIndexOf("?"));return"/tpurchaseorder/findByReceipt"==a?o.materialTypeMap[i.businessTypeId]:"/tsaleMaterialOrder/quarylist"==a?"客户来料单":"/purchaseDeliverController/list"==a?"采购送料单":""}}],jsonReader:{root:"data.list",total:"data.totalPage",records:"data.totalCount",cell:"list"},prmNames:{page:"page",rows:"limit"},mtype:"POST",contentType:"application/json",datatype:"json",styleUI:"Bootstrap",rownumbers:!0,pagination:!0,multiselectWidth:50,viewrecords:!0,rowNum:10,rowList:[10,30,50],pager:"#my_pager_id"},base_config_detail:{ajaxGridOptions:{complete:function(e,t){o.responseRaw=e.responseText}},colNames:["源单类型","商品分录行","源单编号","商品图片","商品类型","商品编码","商品名称","数量","总量","供应商名称","客户名称"],colModel:[{name:"resourceType",index:"goodsTypeName",width:200,align:"center",formatter:function(e,t,i,n){return o.materialTypeMap[e]}},{name:"goodsLineNo",index:"goodsLineNo",width:200,align:"center",key:!0,hidden:!0},{name:"resourceNumber",index:"resourceNumber",width:200,align:"center"},{name:"pictureUrl",index:"pictureUrl",width:200,align:"center",formatter:function(e,t,i,n){return e?'<img width="60" src="'+e+'">':'<img width="60" src="'+("http://"+window.location.host+contextPath+"/images/no_pic.png")+'">'}},{name:"goodsTypeName",index:"goodsTypeName",width:200,align:"center"},{name:"goodsCode",index:"goodsCode",width:200,align:"center"},{name:"goodsName",index:"goodsName",width:200,align:"center"},{name:"receivableCount",index:"weightUnit",width:200,align:"center"},{name:"receivableWeight",index:"countingUnit",width:200,align:"center"},{name:"supplierName",index:"supplierName",width:200,align:"center"},{name:"customerName",index:"customerName",width:200,align:"center"}],jsonReader:{root:"data.collectGoods",cell:"collectGoods"},mtype:"POST",contentType:"application/json",datatype:"json",styleUI:"Bootstrap",rownumbers:!0,multiselect:!0,pagination:!0,multiselectWidth:50,viewrecords:!1,rowNum:10,rowList:[10,30,50],pager:"#my_pager_id_detail",onSelectAll:function(e,t){o.handlerId(e,t)},onSelectRow:function(e,t){o.handlerId(e,t)}}}},methods:{doSelect:function(e,t,i,n){this.showModal=!1,this.showDetailModal=!0,this.reInitDetail(i)},init:function(){jQuery("#my_table_id").jqGrid(this.base_config),this.initDetailTable()},initDetailTable:function(){jQuery("#my_table_id_detail").jqGrid(this.base_config_detail)},clear:function(){this.body={orderNo:""}},search:function(){var e=$("#my_table_id"),t={postData:Object.assign(this.body)};e.jqGrid("clearGridData"),e.jqGrid("setGridParam",t).trigger("reloadGrid")},reInit:function(){this.base_config.url=contextPath+this.url;var e=$("#jqGrid_wrapper_source");e.empty();$("<table id=my_table_id></table>").appendTo(e),$("<div id=my_pager_id></div>").appendTo(e),this.init()},reInitDetail:function(e){this.base_config_detail.url=contextPath+"/tpurchasecollectgoods/findByTypeId?type="+this.sourceType+"&id="+e.id;var t=$("#jqGrid_wrapper_source_detail");t.empty();$("<table id=my_table_id_detail></table>").appendTo(t),$("<div id=my_pager_id_detail></div>").appendTo(t),this.initDetailTable()},cancel:function(){this.body.orderNo="",this.showModal=!1,this.showDetailModal=!1,this.$emit("cancel"),this.search()},changeDate:function(e){this.body.startTime=e[0].replace(/\//g,"-")+" 00:00:00",this.body.endTime=e[1].replace(/\//g,"-")+" 23:59:59"},detailSelected:function(){this.validate()&&(this.showModal=!1,this.showDetailModal=!1,this.$emit("sure",this.selectedRows),this.selected=[])},validate:function(){for(var e=0<this.alReadySelectedData.length?this.alReadySelectedData[0]:this.selectedRows[0],t=e.resourceType,i=e.goodsTypePath,n=e.customerId,a=e.supplierId,o=[],d=!1,r=0,l=this.alReadySelectedData.length;r<l;r++)o.push(this.alReadySelectedData[r].streamId);for(var s=0,c=this.selectedRows.length;s<c;s++){if(this.selectedRows[s].resourceType!=t)return this.$Modal.info({content:"请选择相同的源单类型进行收货"}),!(d=!0);if(this.selectedRows[s].goodsTypePath!=i)return this.$Modal.info({content:"请选择相同的商品类型进行收货"}),!(d=!0);if("S_CUST_MATERIAL"==this.selectedRows[s].resourceType){if(n!=this.selectedRows[s].customerId)return this.$Modal.info({content:"请选择相同的客户进行收料"}),!(d=!0)}else if(a!=this.selectedRows[s].supplierId)return this.$Modal.info({content:"请选择相同的供应商进行收料"}),!(d=!0);if(-1<o.indexOf(this.selectedRows[s].streamId))return this.$Modal.info({content:"请勿选择相同的商品进行收货！"}),!(d=!0);o.push(this.selectedRows[s].streamId)}if(!d)return!0},detailCancel:function(){this.showModal=!0,this.showDetailModal=!1},handlerId:function(e,t){var n=this;if("object"===(void 0===e?"undefined":_typeof(e))&&t&&(this.selected=e),"object"!==(void 0===e?"undefined":_typeof(e))||t||(this.selected=[]),"string"==typeof e)if(t)!(-1<this.selected.indexOf(e.toString()))&&this.selected.push(e.toString());else{var i=this.selected.indexOf(e.toString());-1<i&&this.selected.splice(i,1)}var a=$("#my_table_id_detail").jqGrid("getGridParam","selarrrow");if(0<a.length){var o=[],d=JSON.parse(this.responseRaw);$.each(d.data&&d.data.collectGoods,function(e,t){var i=!1;-1<$.inArray(t[n.idKey].toString(),a)&&(i=!0),i&&o.push(t)}),this.selectedRows=o}else this.selectedRows=[]}},mounted:function(){this.base_config.url=contextPath+this.url,this.init()},watch:{url:{handler:function(){this.reInit()}}},template:'<div>\n            <Modal\n            @on-ok="doSelect"\n            @on-cancel="cancel"\n            width="60"\n        class-name="source-list"\n        v-model="showModal"\n        title="选择源单信息">\n        <div class="content clearfix">\n           <div style="border: 1px solid #ccc;">\n              <div>\n                  <i-form :model="body" style="display:inline-block; margin-top: 10px;" :label-width="80">\n                    <form-item label="单据编号">\n                        <i-input v-model="body.orderNo"></i-input>\n                    </form-item>\n                    \x3c!--<form-item label="单据日期">\n                        &lt;!&ndash;<date-picker format="yyyy-MM-dd" v-model="body.date" :key="body.date" @on-change="body.date=$event"  type="datetime" placeholder="请选择时间" style="width: 200px"></date-picker>&ndash;&gt;\n                    <date-picker @on-change="changeDate" format="yyyy/MM/dd" v-model="body.date" type="daterange" placement="bottom-end" placeholder="Select date" style="width: 200px"></date-picker>--\x3e\n                    </form-item>\n                    <i-button type="primary" @click="search">搜索</i-button>\n                  </i-form>\n            </div>\n            <div class="jqGrid_wrapper" id="jqGrid_wrapper_source">\n                <table id="my_table_id"></table> \n                <div id="my_pager_id"></div>\n            </div>\n            </div>\n        </div>\n        <div class="source-list-detail-wrap">\n        <Modal\n            @on-cancel="detailCancel"\n            class-name="source-list-detail"\n            width="80"\n        v-model="showDetailModal"\n        title="请选择单据">\n        <div class="content clearfix">\n           <div style="border: 1px solid #ccc;">\n              <div>\n            </div>\n            <div class="jqGrid_wrapper" id="jqGrid_wrapper_source_detail">\n                <table id="my_table_id_detail"></table> \n                <div id="my_pager_id_detail"></div>\n            </div>\n            </div>\n        </div>\n         <div slot="footer">\n                    <i-button type="text" size="large" @click="detailCancel">取消</i-button>\n                    <i-button type="primary" size="large" @click="detailSelected">确定</i-button>\n                </div>\n    </Modal>\n</div>\n        <div>\n</div>\n    </Modal>\n</div>'});