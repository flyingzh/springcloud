"use strict";new Vue({el:"#voucher-summary",data:function(){return{formData:{startDate:"2018-01-01",endDate:"2018-01-31",voucherId:"",startVoucherNum:"",endVoucherNum:"",subjctStartNum:1,subjctEndNum:1,voucherCount:0,attachmentsCount:0},formDataList:[],visible:!1,optionList:[{label:"月报",value:1},{label:"季报",value:2}],reload:!1,dateList:[],editTitle:"",editVisable:!1,floatNum:2,filterVisible:!1}},created:function(){this.getVoucher()},mounted:function(){this.formData.startDate=this.operateDate(this.formData.startDate),this.formData.endDate=this.operateDate(this.formData.endDate),this.pageInit(),this.queryVoucherEnclosure()},methods:{openFun:function(){this.filterVisible=!0},pageInit:function(){var r=this;jQuery("#list").jqGrid({datatype:"json",postData:r.formData,url:contextPath+"/voucherController/voucherCount",colNames:["id","科目编码","科目名称","借方金额","贷方金额"],colModel:[{name:"id",width:10,align:"center",sortable:!1,key:!0,hidden:!0},{name:"subjectCode",width:200,align:"left",sortable:!1,formatter:function(t,e,a,o){return $(document).off("click",".detaila"+a.id).on("click",".detaila"+a.id,function(){r.detailClick(a)}),'<a class="detaila'+a.id+' ht-link">'+a.subjectCode+"</a>"}},{name:"subjectName",width:200,align:"center",sortable:!1},{name:"debitTotal",width:200,align:"center",sortable:!1,formatter:function(t,e,a,o){return accounting.formatMoney(t,"",this.floatNum)}},{name:"creditTotal",width:200,align:"center",sortable:!1,formatter:function(t,e,a,o){return accounting.formatMoney(t,"",this.floatNum)}}],rowNum:999999999,pager:"#pager",sortorder:"desc",mtype:"post",jsonReader:{root:"data"},styleUI:"Bootstrap",height:$(window).height()-210,viewrecords:!0,footerrow:!0,userDataOnFooter:!1,gridComplete:this.completeMethod,onCellSelect:function(t){},ondblClickRow:function(t,e,a){console.log(t),console.log(a)}})},queryVoucherEnclosure:function(){var e={};$.ajax({type:"post",async:!1,url:contextPath+"/voucherController/queryVoucherEnclosure",data:this.formData,success:function(t){null!=t.data&&(e=t.data)}});var t=e.voucherCount,a=e.attachmentsCount;this.formData.attachmentsCount=void 0===a?0:a,this.formData.voucherCount=void 0===t?0:t},getVoucher:function(){var e=[];$.ajax({type:"post",async:!1,url:contextPath+"/voucherController/initQueryVoucherFormData",data:null,success:function(t){null!=t.data&&(e=t.data)}}),this.formDataList=e.voucherGroupName.data,this.formDataList.splice(0,0,{id:"",name:"不限"});var t=e.currentAccountYear,a=e.currentAccountPeriod;this.formData.startDate=t+"-"+a+"-01",this.formData.endDate=this.getLastDay(t,a)},completeMethod:function(){var t=this.getColSum("debitTotal"),e=this.getColSum("creditTotal");$("#list").footerData("set",{id:"",subjectCode:"",subjectName:"合计",debitTotal:t,creditTotal:e})},getColSum:function(t){var e=$("td[aria-describedby='list_"+t+"']"),o=$("td[aria-describedby='list_subjectCode']"),r=this.formData.subjctStartNum,i=0;return e.each(function(t,e){if(""!=o[t].title){var a=o[t].title.split(".").length;r==a&&(i+=1e3*accounting.unformat($(e).text()))}}),i/=1e3,i=accounting.formatMoney(i,"",2)},operateDate:function(t){return new Date(t).format("yyyy-MM-dd")},getLastDay:function(t,e){var a=new Date(t,e,1);return cdt=new Date(a.getTime()-864e5),cdt.getFullYear()+"-"+(Number(cdt.getMonth())+1)+"-"+cdt.getDate()},detailClick:function(t){console.log(t.subjectCode);var e=contextPath+"/finance/detail-account/detail-account.html?subjectCode="+t.subjectCode;window.parent.activeEvent({name:"明细账",url:e,params:null})},more:function(){this.visible=!0},nomore:function(){this.visible=!1},blur:function(t,e){var a=Number(t.target.value);1<=a||(this.formData[e]=a)},save:function(){this.formData.startDate=this.operateDate(this.formData.startDate),this.formData.endDate=this.operateDate(this.formData.endDate),$("#list").jqGrid("setGridParam",{postData:this.formData}).trigger("reloadGrid"),this.queryVoucherEnclosure(),this.cancel()},cancel:function(){this.filterVisible=!1},exportExcel:function(){this.formData.startDate=this.operateDate(this.formData.startDate),this.formData.endDate=this.operateDate(this.formData.endDate),console.log(this.formData.subjctStartNum),window,open(contextPath+"/voucherController/exportExcel?voucherId="+this.formData.voucherId+"&startVoucherNum="+this.formData.startVoucherNum+"&endVoucherNum="+this.formData.endVoucherNum+"&startDate="+this.formData.startDate+"&endDate="+this.formData.endDate+"&subjctStartNum="+this.formData.subjctStartNum+"&subjctEndNum="+this.formData.subjctEndNum)},refresh:function(){jQuery("#list").trigger("reloadGrid")},clear:function(){this.formData.startDate="2018-01-01",this.formData.endDate="2018-01-31",this.formData.voucherId="",this.formData.startVoucherNum="",this.formData.endVoucherNum="",this.formData.subjctStartNum=1,this.formData.subjctEndNum=1,this.cancel()}}});