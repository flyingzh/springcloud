"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},vm=new Vue({el:"#reconciliationGeneralLedger",data:function(){return{openTime:"",yearList:[],monthList:[],subjectList:[],exportList:[{value:1,name:"出纳管理数据系统"},{value:2,name:"总账管理数据系统"}],exportId:1,systemId:1,formData:{currentYear:"",currentMonth:"",currencyId:0,subjectId:0},queryData:{year:"",month:"",subjectId:0,currencyId:0,periodDate:""},titleData:{currencyName:"",fullSubjectName:"",dateStr:""},disabled:!1,show:!1,tableList:[],tableList2:[],printModal:!1,printInfo:{},baseData:{standardCurrencyId:"",subjectName:"",currencyName:"",periodDate:""},voucherFilter:{voucherWordId:0,abnormalDataProcessing:"",subjectMergerDebit:"",subjectMergerLender:""},editData:{sobId:"",subjectId:"",subjectCode:"",subjectName:"",subjectValue:"",currencyId:"",datetime:"",periodDate:"",serialNumber:"",debitAmountFor:"",debitAmountForRate:"",creditAmountFor:"",creditAmountForRate:"",creditAmount:"",remark:"",relativeSubjectId:"",direction:"",exchangeRate:"",accountYear:"",accountPeriod:"",handleId:"",handleName:"",isProject:"",isCarryOver:"1",dataSource:"2",summary:""},addData:{sobId:"",subjectId:"",currencyId:"",datetime:"",serialNumber:"",periodDate:"",debitAmountFor:"",debitAmountForRate:"",creditAmountFor:"",creditAmountForRate:"",creditAmount:"",remark:"",relativeSubjectId:"",direction:"",exchangeRate:"",accountYear:"",accountPeriod:"",handleId:"",handleName:"",isProject:"",isCarryOver:"1",dataSource:"2",summary:""},openData:{sobId:"",subjectId:"",currencyId:"",startYear:"",endYear:"",startPeriod:"",endPeriod:"",startDate:"",endDate:"",voucherGroupId:"-1",startVoucherGroupNumber:"",endVoucherGroupNumber:"",explains:"",relateSubjectId:"",handleId:"",prepareId:"",showInitBalance:!0,showDetailRecord:!0,showDaySum:!0,showPeriodSum:!0,showYearSum:!0,showTotalSum:!0,type:"1",subjectName:"",currencyName:""},importData:{startDate:"",endDate:"",voucherGroupId:"-1",startVoucherGroupNumber:"-1",endVoucherGroupNumber:"-1",audited:"-1",posted:"-1",preparerId:"",importId:[]},filterVisible:!1,editVisible:!1,importVisible:!1,exportVisible:!1,base_config:{datatype:"local",styleUI:"Bootstrap",height:$(window).height()-140,rowNum:999999999},journalGeneralLedgerVOList:[],voucherEntryList:[],bankColNames:[],bankColModel:[],financeColNames:[],financeColModel:[],tableHeaders:[],organisationList:[{label:"金大祥",value:1}],currencyList:[],voucherExpList:[],voucherDataList:[],periodYear:[],periodList:[{name:"1",value:1},{name:"2",value:2},{name:"3",value:3},{name:"4",value:4},{name:"5",value:5},{name:"6",value:6},{name:"7",value:7},{name:"8",value:8},{name:"9",value:9},{name:"10",value:10},{name:"11",value:11},{name:"12",value:12}],auditedList:[{id:-1,name:"全部"},{id:1,name:"已审核"},{id:2,name:"未审核"}],postedList:[{id:-1,name:"全部"},{id:1,name:"已过账"},{id:2,name:"未过账"}],editTitle:"",subjectVisable:!1,subjectTpye:"",selected:[],selectedId:[],importSelected:[],addSubjectListOpt:[],addSubjectListOptShow:!1,subjectOpts:{},optsVal:{},remarkVisable:!1,remarklist:[],remarkType:0,handManList:[],openMakerList:[],openHandleList:[]}},created:function(){},mounted:function(){this.openTime=window.parent.params&&window.parent.params.openTime;var e=parseInt(getUrlParam("subjectId")),t=parseInt(getUrlParam("currencyId")),a=parseInt(getUrlParam("year")),i=getUrlParam("month");this.initData(e),this.formData.subjectId=e,this.formData.currencyId=t,this.queryData.subjectId=e,this.queryData.currencyId=t,this.formData.currentYear=a,this.formData.currentMonth=i,this.queryData.year=a,this.queryData.month=i,this.queryData.periodDate=a+"-"+i,this.titleParams(),this.initMethod()},methods:{initData:function(e){var a=this;$.ajax({type:"post",async:!1,url:contextPath+"/app/bankAccount/initData",success:function(e){var t=e.data;null!=t&&(a.yearList=t.systemProfile.yearList,a.monthList=t.systemProfile.monthList,a.formData.currentYear=t.systemProfile.currentYear,a.formData.currentMonth=t.systemProfile.currentMonth,a.subjectList=t.subject.data)}}),a.currency(e),a.subjectList.splice(0,0,{accountId:0,accountName:"(所有科目)"})},currency:function(e){var a=this;if(a.currencyList=[],0==e)return a.currencyList.splice(0,0,{currencyId:0,currencyName:"(所有币别)"}),a.formData.currencyId=0,void(a.disabled=!0);$.ajax({type:"post",async:!1,url:contextPath+"/cashierBalanceController/app/initCnCurrency",data:{accountId:e},success:function(e){var t=e.data;null!=t&&(a.currencyList=t)}}),1<a.currencyList.length&&(a.currencyList.splice(0,0,{currencyId:0,currencyName:"(所有币别)"}),a.formData.currencyId=0,a.disabled=!1),1==a.currencyList.length&&(a.formData.currencyId=a.currencyList[0].currencyId,a.disabled=!1)},titleParams:function(){var e=this.subjectList;if(null!=e)for(var t=0;t<e.length;t++)if(e[t].accountId==this.queryData.subjectId){if(void 0===e[t].accountCode){this.titleData.fullSubjectName=e[t].accountName;break}this.titleData.fullSubjectName=e[t].accountCode+" "+e[t].accountName;break}var a=this.currencyList;if(null!=a)for(t=0;t<a.length;t++)if(a[t].currencyId==this.queryData.currencyId){this.titleData.currencyName=a[t].currencyName;break}this.titleData.dateStr=this.queryData.year+"年第"+this.queryData.month+"期"},currencyChange:function(a){$.each(vm.currencyList,function(e,t){a==t.id&&(vm.editData.debitAmountForRate=t.exchangeRate,vm.editData.creditAmountForRate=t.exchangeRate)})},bookDateChange:function(e){var t={currentDate:new Date(e).format("yyyy-MM-dd"),currencyId:vm.editData.currencyId};$.ajax({type:"post",url:contextPath+"/cashier/getPeriodByDate",data:t,success:function(e){console.log(e),"100100"==e.code&&null!=e.data?(vm.editData.periodDate=e.data.year+"年"+e.data.month+"期",vm.editData.serialNumber=e.data.serialNum):layer.alert("请求错误")}})},clickDigest:function(e){this.remarkType=e,this.remarkVisable=!0},onDblclickRemarkRow:function(e){var t=this;1===t.remarkType?t.editData.for6=e.content:t.openData.explains=e.content,t.remarkVisable=!1},onRemarkModalChange:function(e){this.remarkVisable=e},onRemarkListChange:function(e){this.remarklist=e},initMethod:function(){this.delTable(),this.jqGridData()},setTableHeader:function(){this.bankColNames=["行序号","id","凭证字号","日期","摘要","科目代码","科目名称","币别","对方科目","原币借方金额","原币贷方金额","本位币借方金额","本位币贷方金额","勾对","制单人","数据来源","对账结果","备注","isCash"],this.bankColModel=[{name:"rowNum",width:30,hidden:!0,key:!0,frozen:!0},{name:"id",width:30,hidden:!0,frozen:!0},{name:"voucherName",width:100,frozen:!0},{name:"voucherDate",width:100},{name:"summary",width:100},{name:"subjectCode",width:100},{name:"subjectName",width:120},{name:"currencyName",width:60},{name:"fullRelativeSubjectName",width:120},{name:"debitAmountFor",width:100,formatter:function(e,t,a){return 0==e?"":e}},{name:"creditAmountFor",width:100,formatter:function(e,t,a){return 0==e?"":e}},{name:"debitAmount",width:100,formatter:function(e,t,a){return 0==e?"":e}},{name:"creditAmount",width:100,formatter:function(e,t,a){return 0==e?"":e}},{name:"tick",width:50},{name:"createName",width:90},{name:"dataSourceName",width:80},{name:"result",width:90},{name:"remark",width:90},{name:"isCash",width:20,hidden:!0}],this.financeColNames=["行序号","id","凭证字号","日期","摘要","科目代码","科目名称","币别","原币借方金额","原币贷方金额","本位币借方金额","本位币贷方金额","制单人","对账结果"],this.financeColModel=[{name:"rowNum",width:30,hidden:!0,key:!0,frozen:!0},{name:"id",width:30,hidden:!0,frozen:!0},{name:"voucherName",width:100,frozen:!0},{name:"voucherDate",width:100},{name:"explains",width:100},{name:"subjectCode",width:100},{name:"subjectName",width:120},{name:"currencyName",width:60},{name:"debitAmountFor",width:100,formatter:function(e,t,a){return 0==e?"":e}},{name:"creditAmountFor",width:100,formatter:function(e,t,a){return 0==e?"":e}},{name:"debitAmount",width:100,formatter:function(e,t,a){return 0==e?"":e}},{name:"creditAmount",width:100,formatter:function(e,t,a){return 0==e?"":e}},{name:"createName",width:90},{name:"result",width:90}],this.jqGridBankInit(this.bankColNames,this.bankColModel),this.jqGridFinanceInit(this.financeColNames,this.financeColModel)},delTable:function(){$("#grid").empty(),$("#grid2").empty();var e=$(".jqGrid_wrapper"),t=$(".jqGrid_wrapper2");e.empty(),t.empty(),$('<table id="grid"></table><div id="page"></div>').appendTo(e),$('<table id="grid2"></table><div id="page2"></div>').appendTo(t)},jqGridBankInit:function(e,t){var i=this,a=Object.assign({},this.base_config,{colNames:e,colModel:t,data:i.journalGeneralLedgerVOList,loadComplete:function(e){var t=jQuery("#grid").jqGrid("getRowData"),a=$("#grid").jqGrid("getDataIDs");t.push($("#grid").jqGrid("getRowData",a[a.length-1])),i.tableList=t},gridComplete:function(){},onSelectRow:function(e,t){i.systemId=1,$("#grid").jqGrid("setCaption","<div style='text-align: center;font-size: 18px;font-weight: bold'>出纳管理数据系统</div>"),$("#grid2").jqGrid("setCaption","<div style='text-align: center;font-size: 18px;'>总账数据系统</div>")}});jQuery("#grid").jqGrid(a),jQuery("#grid").jqGrid("setCaption","<div style='text-align: center;font-size: 18px;'>出纳管理数据系统</div>"),jQuery("#grid").jqGrid("setFrozenColumns")},jqGridFinanceInit:function(e,t){var i=this,a=Object.assign({},this.base_config,{colNames:e,colModel:t,data:i.voucherEntryList,loadComplete:function(e){var t=jQuery("#grid2").jqGrid("getRowData"),a=$("#grid2").jqGrid("getDataIDs");t.push($("#grid2").jqGrid("getRowData",a[a.length-1])),i.tableList2=t},onSelectRow:function(e,t){i.systemId=2,i.show=!0,$("#grid").jqGrid("setCaption","<div style='text-align: center;font-size: 18px;'>出纳管理数据系统</div>"),$("#grid2").jqGrid("setCaption","<div style='text-align: center;font-size: 18px;font-weight: bold'>总账数据系统</div>")}});jQuery("#grid2").jqGrid(a),jQuery("#grid2").jqGrid("setCaption","<div style='text-align: center;font-size: 18px;'>总账数据系统</div>"),jQuery("#grid2").jqGrid("setFrozenColumns")},jqGridData:function(){var a=this;$.ajax({type:"post",async:!0,url:contextPath+"/app/journalGeneralLedger/accountDetailList",data:a.queryData,success:function(e){var t=e.data;null!=t&&(a.journalGeneralLedgerVOList=t.journalGeneralLedgerVOList,a.voucherEntryList=t.voucherEntryList),a.setTableHeader()},error:function(){a.setTableHeader()}})},open:function(){this.filterVisible=!0},refresh:function(){this.initMethod(),this.$Message.info("刷新数据完毕")},addFun:function(){var e=$("#grid").jqGrid("getGridParam","selrow");if(null!=e){console.log(e);var t=$("#grid").jqGrid("getRowData",e);console.log(t),this.editTitle="现金日记账 - 新增",this.editVisible=!0}else this.$Message.info("请至少选择一行数据！")},editFun:function(){this.editTitle="现金日记账 - 编辑",this.editVisible=!0},openSave:function(){this.filterVisible=!1;var e=this.formData.currentYear,t=this.formData.currentMonth;this.queryData.year=e,this.queryData.month=t,this.queryData.subjectId=this.formData.subjectId,this.queryData.currencyId=this.formData.currencyId,this.queryData.periodDate=e+"-"+t,this.titleParams(),this.initMethod()},exportExcel:function(){this.exportVisible=!0},exportData:function(){this.exportVisible=!1,window.open(contextPath+"/app/journalGeneralLedger/exportExcelDetail?exportId="+this.exportId+"&subjectName="+this.titleData.fullSubjectName+"&currencyName="+this.titleData.currencyName+"&dateStr="+this.titleData.dateStr)},print:function(){var e=this;e.printInfo={};var t={};if(1==e.systemId){if(!e.tableList||!e.tableList.length)return void e.$Message.info({content:"无打印数据",duration:3});t={title:"与总账对账_出纳管理系统数据",template:1,titleInfo:[{name:"科目",val:e.titleData.fullSubjectName},{name:"币别",val:e.titleData.currencyName},{name:"期间",val:e.titleData.dateStr}],colNames:[{name:"凭证字号",col:"voucherName"},{name:"日期",col:"voucherDate"},{name:"摘要",col:"summary"},{name:"科目代码",col:"subjectCode"},{name:"科目名称",col:"subjectName"},{name:"币别",col:"currencyName"},{name:"对方科目",col:"fullRelativeSubjectName"},{name:"原币借方金额",col:"debitAmountFor"},{name:"原币贷方金额",col:"creditAmountFor"},{name:"本位币借方金额",col:"debitAmount"},{name:"本位币贷方金额",col:"creditAmount"},{name:"勾对",col:"tick"},{name:"制单人",col:"createName"},{name:"数据来源",col:"dataSourceName"},{name:"对账结果",col:"result"},{name:"备注",col:"remark"}],styleCss:"",colMaxLenght:16,data:e.tableList,totalRow:!1}}else if(2==e.systemId){if(!e.tableList2||!e.tableList2.length)return void e.$Message.info({content:"无打印数据",duration:3});t={title:"与总账对账_总账系统数据",template:2,titleInfo:[{name:"科目",val:e.titleData.fullSubjectName},{name:"币别",val:e.titleData.currencyName},{name:"期间",val:e.titleData.dateStr}],colNames:[{name:"凭证字号",col:"voucherName"},{name:"日期",col:"voucherDate"},{name:"摘要",col:"explains"},{name:"科目代码",col:"subjectCode"},{name:"科目名称",col:"subjectName"},{name:"币别",col:"currencyName"},{name:"原币借方金额",col:"debitAmountFor"},{name:"原币贷方金额",col:"creditAmountFor"},{name:"本位币借方金额",col:"debitAmount"},{name:"本位币贷方金额",col:"creditAmount"},{name:"制单人",col:"createName"},{name:"对账结果",col:"result"}],styleCss:"",colMaxLenght:13,data:e.tableList2,totalRow:!1}}e.printInfo=t,e.printModalShow(!0)},outHtml:function(){window.parent.closeCurrentTab({name:"与总账对账",openTime:this.openTime,exit:!0})},printModalShow:function(e){this.printModal=e},editSave:function(){var e=this.editData;null!=e.serialNumber&&0!=e.serialNumber||this.$Message.error("当日序号不能小于1"),this.editVisible=!1},save:function(e){switch(e){case"open":this.openSave();break;case"edit":this.editSave();break;case"export":this.exportData()}},cancel:function(e){switch(e){case"open":this.filterVisible=!1;break;case"edit":this.editVisible=!1;break;case"import":this.importVisible=!1;break;case"export":this.exportVisible=!1}},showSubjectVisable:function(e){this.subjectVisable=!0,this.subjectTpye=e},subjectClose:function(){this.subjectVisable=!1},subjectData:function(e){console.log(e,"====treeNode");var t=this;switch(t.subjectTpye){case 1:t.openData.relateSubjectId=e.id,t.openData.subjectCode=e.subjectCode,t.openData.subjectName=e.subjectName;break;case 2:t.editData.subjectId=e.id,t.editData.subjectCode=e.subjectCode,t.editData.subjectName=e.subjectName,t.editData.subjectValue=e.subjectCode+" "+e.subjectName;var a=contextPath+"/voucherController/getListBySubjectId";$.ajax({type:"POST",data:{id:t.editData.subjectId},url:a,success:function(e){if("100100"==e.code){if(t.addSubjectListOpt=e.data.opts,e.data.opts.length){var a={};$.each(e.data.opts,function(e,t){a[t]=""}),t.optsVal=a,t.addSubjectListOptShow=!0}}else layer.alert("页面初始化失败")},error:function(e){console.log(e)}})}this.subjectClose()},handlerId:function(e,t,a){var i=this;if("object"===(void 0===e?"undefined":_typeof(e))&&t&&(i[a]=e),"object"!==(void 0===e?"undefined":_typeof(e))||t||(i[a]=[]),"string"==typeof e)if(t)!(-1<i[a].indexOf(e.toString()))&&i[a].push(e.toString());else{var r=i[a].indexOf(e.toString());-1<r&&i[a].splice(r,1)}},getImportId:function(){var t=this;this.importData.importId=[],this.importSelected.map(function(e){t.importData.importId.push(t.importTableList[e-1].id)})},openAddSubject:function(){console.log(this.addSubjectListOpt,"====this.addSubjectListOpt"),this.addSubjectListOptShow=!0},addSubjectEnterd:function(){var t=this,e=contextPath+"/cashier/getSubjectInfoByCode";$.ajax({type:"POST",data:{code:t.editData.subjectValue},url:e,success:function(e){if("100100"==e.code)if(e.data.subjectId){if(t.editData.subjectId=e.data.subjectId,t.editData.subjectCode=e.data.subjectCode,t.editData.subjectName=e.data.subjectName,t.addSubjectListOpt=e.data.opts,e.data.opts.length){var a={};$.each(e.data.opts,function(e,t){a[t]=""}),t.optsVal=a,t.addSubjectListOptShow=!0}}else layer.alert("查询无数据");else layer.alert("页面初始化失败")},error:function(e){console.log(e)}})},addSubjectListOptClose:function(){var r=this,n="";$.each(r.optsVal,function(e,t){if(""!==t&&void 0!==t){var a=r.subjectOpts[e],i=a.list[t];n+=a.label+":"+t+"-"+i+";"}}),""!==n&&(n="/"+n),r.editData.subjectValue=r.editData.subjectCode+" "+r.editData.subjectName+n},addSubjectFocus:function(){this.editData.subjectValue=this.editData.subjectCode},addSubjectBlur:function(){var r=this,n="";$.each(r.optsVal,function(e,t){if(""!==t&&void 0!==t){var a=r.subjectOpts[e],i=a.list[t];n+=a.label+":"+t+"-"+i+";"}}),""!==n&&(n="/"+n),r.editData.subjectValue=r.editData.subjectCode+" "+r.editData.subjectName+n},selectOpt:function(){}},computed:{importTableList:function(){var e=this,i=[];return this.subjectList.forEach(function(a){e.currencyList.forEach(function(e){var t={id:a.accountId+"-"+e.id,name:a.accountCode+" "+a.accountName+" - "+e.currencyName};i.push(t)})}),i},addSubjectDisabled:function(){return 0===this.addSubjectListOpt.length}},watch:{"editData.debitAmountFor":function(e,t){console.log(123),vm.editData.debitAmount=vm.editData.debitAmountFor*vm.editData.debitAmountForRate},"editData.creditAmountFor":function(e,t){vm.editData.creditAmount=vm.editData.creditAmountFor*vm.editData.creditAmountForRate},"editData.debitAmountForRate":function(e,t){vm.editData.debitAmount=vm.editData.debitAmountFor*vm.editData.debitAmountForRate},"editData.creditAmountForRate":function(e,t){vm.editData.creditAmount=vm.editData.creditAmountFor*vm.editData.creditAmountForRate},"openData.currencyId":function(a,e){$.each(vm.currencyList,function(e,t){a==t.id&&(vm.openData.currencyName=t.currencyName)})}}});