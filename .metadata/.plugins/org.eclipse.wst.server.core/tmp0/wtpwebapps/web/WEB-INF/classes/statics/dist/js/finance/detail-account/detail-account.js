"use strict";new Vue({el:"#detail-account",data:function(){return{visible_filter:!1,subjectVisiable:!1,subjectEnd:!1,jump:!1,openTime:"",standardCurrencyId:"",search:{currency:"-1",yearStart:"",yearEnd:"",subjectPeriodStart:"",subjectPeriodEnd:"",continuous:"iscontinuous",subjectLevelStart:"",subjectLevelEnd:"",subjectCodeStart:"",subjectCodeEnd:"",showDisable:!1,showUnposted:!1,noShowAndHappen:!1,noShowAndHappenZero:!1,showOpposite:!1,showDetailOnly:!1,showOppositeAccountItem:!1,showNoOccurencePeriod:!1,showOppositeMultiple:!1,sobId:1,preSubject:"",nextSubject:"",curIndex:"-1",subjectCode:""},years:[],currencyList:[],subjectList:[{name:"第一期",value:1},{name:"第二期",value:2},{name:"第三期",value:3},{name:"第四期",value:4},{name:"第五期",value:5},{name:"第六期",value:6},{name:"第七期",value:7},{name:"第八期",value:8},{name:"第九期",value:9},{name:"第十期",value:10},{name:"第十一期",value:11},{name:"第十二期",value:12}],subjectLevelList:[{name:"1",value:4},{name:"2",value:5},{name:"3",value:6},{name:"4",value:7},{name:"5",value:8},{name:"6",value:9},{name:"7",value:10},{name:"8",value:11},{name:"9",value:12}],dataList:[],printModal:!1,printInfo:{},subjectName:"",subjectCode:"",base_config:{url:contextPath+"/bookInquiryController/detailAccount",datatype:"json",rowNum:"99999999",ajaxGridOptions:{contentType:"application/json; charset=utf-8"},sortorder:"desc",mtype:"post",jsonReader:{root:"data.list"},styleUI:"Bootstrap",height:$(window).height()-120,viewrecords:!0},colNames1:[],colModel1:[],tableHeader:[],url:""}},methods:{preSubject:function(){var e=parseInt(this.search.curIndex)-1;if(e<0)return this.$Message.error("没有上一科目了"),!1;this.search.curIndex=e,this.refreshData()},nextSubject:function(){var e=parseInt(this.search.curIndex)+1;this.search.curIndex=e,this.refreshData()},refreshData:function(){console.log(this.search),$("#list").jqGrid("setGridParam",{mtype:"POST",postData:JSON.stringify(this.search),ajaxGridOptions:{contentType:"application/json; charset=utf-8"},dataType:"json"}).trigger("reloadGrid")},clearData:function(){this.search={currency:"",yearStart:"",yearEnd:"",subjectPeriodStart:"",subjectPeriodEnd:"",continuous:"iscontinuous",subjectLevelStart:"",subjectLevelEnd:"",subjectCodeStart:"",subjectCodeEnd:"",showDisable:!1,showUnposted:!1,noShowAndHappen:!1,noShowAndHappenZero:!1,showOpposite:!1,showDetailOnly:!1,showOppositeAccountItem:!1,showNoOccurencePeriod:!1,showOppositeMultiple:!1,sobId:1,preSubject:"",nextSubject:"",curIndex:"-1",subjectCode:""}},jumpDetail:function(){this.jump=!0,this.subjectVisiable=!0},exitDetail:function(){window.parent.closeCurrentTab({name:"总分类账",openTime:this.openTime,exit:!0})},handleOpen:function(){this.visible_filter=!0},subjectDate:function(e){if(this.jump)return this.jump=!1,this.clearData(),this.search.subjectCode=e.subjectCode,this.refreshData(),!1;this.subjectEnd?this.search.subjectCodeEnd=e.subjectCode:this.search.subjectCodeStart=e.subjectCode,console.log(e)},showVoucher:function(){var e=jQuery("#list").jqGrid("getGridParam","selrow");if(null==e)return this.$Message.info("请选择一条明细"),!1;var t=jQuery("#list").getRowData(e);null!=t.voucherId&&0!=t.voucherId&&this.voucherDetail(t)},showGeneralLedge:function(){var e=contextPath+"/finance/general-ledge/general-ledge.html?fromDetail=1&subjectYearStart="+this.search.yearStart+"&subjectYearEnd="+this.search.yearEnd+"&subjectPeriodStart="+this.search.subjectPeriodStart+"&subjectPeriodEnd="+this.search.subjectPeriodEnd+"&subjectStart="+this.subjectCode+"&subjectEnd="+this.subjectCode+"&currencyId="+this.search.currency;console.log(e),window.parent.activeEvent({name:"总分类账",url:e,params:null})},sure:function(e){this.visible_filter=!1;var t=this;if(t.search.subjectCode="",t.search.curIndex="0",!0===e){console.log(t.search),"-1"==this.search.currency?(console.log(this.search.currency),t.pageInitType()):"-2"==this.search.currency||this.search.currency==this.standardCurrencyId?(console.log(this.search.currency),t.pageInit()):"1"<this.search.currency?(console.log(this.search.currency),t.pageInitForein()):t.pageInit();var n={postData:t.search};$("#list").jqGrid("setGridParam",n).trigger("reloadGrid")}},iconPopup:function(e){console.log(e),this.subjectEnd=1==e,this.subjectVisiable=!0},subjectClose:function(){this.subjectVisiable=!1},formartMoney:function(e){return null==e||0==e?"":accounting.formatNumber(e,2,",")},initGrid:function(e,t,n){var r=this,a=Object.assign({},this.base_config,{postData:JSON.stringify(r.search),colNames:e,colModel:t,gridComplete:function(){jQuery("#list").jqGrid("destroyGroupHeader"),jQuery("#list").jqGrid("setGroupHeaders",{useColSpanStyle:!0,groupHeaders:n})},loadComplete:function(e){console.log(e),null!=e.data?(r.dataList=e.data.list,null!=e.data.entity&&(r.search.curIndex=e.data.entity.curIndex,null!=e.data.entity.subjectName&&(r.subjectName=e.data.entity.subjectName,r.subjectCode=e.data.entity.subjectCode,$(this).jqGrid("setCaption","科目："+e.data.entity.subjectName))),null!=e.data.standardCurrencyId&&""!=e.data.standardCurrencyId&&(r.standardCurrencyId=e.data.standardCurrencyId)):this.$Message.error(e.msg)}});jQuery("#list").jqGrid(a)},pageInit:function(){this.clearTable();var a=this;this.colNames1=["日期","凭证字号","摘要","借方","贷方","方向","余额","voucherId","sobId"],this.colModel1=[{name:"periodDate",width:110,align:"center"},{name:"voucherNumber",width:70,align:"left",formatter:function(e,t,n){$(document).off("click",".voucher"+n.voucherId).on("click",".voucher"+n.voucherId,function(){a.voucherDetail(n)});var r='<a class="voucher'+n.voucherId+'">'+e+"</a>";return void 0===e?"":r}},{name:"summary",width:180,align:"left"},{name:"debitMoney",width:100,align:"right",formatter:function(e,t,n){return a.formartMoney(e)}},{name:"creditMoney",width:100,align:"right",formatter:function(e,t,n){return a.formartMoney(e)}},{name:"direction",width:40,align:"center",formatter:function(e,t,n){return 1==e?"借":2==e?"贷":"平"}},{name:"balance",width:100,align:"right",formatter:function(e,t,n){return a.formartMoney(e)}},{name:"voucherId",width:10,align:"center",hidden:!0},{name:"sobId",width:10,align:"center",hidden:!0}],this.tableHeader=[],this.initGrid(this.colNames1,this.colModel1,this.tableHeader)},pageInitType:function(){this.clearTable(),this.base_config.url=contextPath+"/bookInquiryController/detailAccount";var a=this;this.colNames1=["日期","凭证字号","摘要","币别","原币","本位币","原币","本位币","方向","本位币","voucherId","sobId"],this.colModel1=[{name:"periodDate",width:110,align:"left"},{name:"voucherNumber",width:70,align:"left",formatter:function(e,t,n){$(document).off("click",".voucher"+n.voucherId).on("click",".voucher"+n.voucherId,function(){a.voucherDetail(n)});var r='<a class="voucher'+n.voucherId+'">'+e+"</a>";return void 0===e?"":r}},{name:"summary",width:180,align:"left"},{name:"currencyNameValue",width:70,align:"left"},{name:"debitMoney",width:100,align:"right",formatter:function(e,t,n){return a.formartMoney(e)}},{name:"debitAmountFor",width:100,align:"right",formatter:function(e,t,n){return a.formartMoney(e)}},{name:"creditMoney",width:100,align:"right",formatter:function(e,t,n){return a.formartMoney(e)}},{name:"creditAmountFor",width:100,align:"right",formatter:function(e,t,n){return a.formartMoney(e)}},{name:"direction",width:40,align:"center",formatter:function(e,t,n){return 1==e?"借":2==e?"贷":"平"}},{name:"balance",width:100,align:"right",formatter:function(e,t,n){return a.formartMoney(e)}},{name:"voucherId",width:10,align:"center",hidden:!0},{name:"sobId",width:10,align:"center",hidden:!0}],this.tableHeader=[{startColumnName:"debitMoney",numberOfColumns:2,titleText:"借方金额"},{startColumnName:"creditMoney",numberOfColumns:2,titleText:"贷方金额"},{startColumnName:"direction",numberOfColumns:2,titleText:"余额"}],this.initGrid(this.colNames1,this.colModel1,this.tableHeader)},pageInitForein:function(){this.clearTable(),this.base_config.url=contextPath+"/bookInquiryController/detailAccount";var a=this;this.colNames1=["日期","凭证字号","摘要","币别","原币","本位币","原币","本位币","方向","原币","本位币","voucherId","sobId"],this.colModel1=[{name:"periodDate",width:110,align:"left"},{name:"voucherNumber",width:70,align:"left",formatter:function(e,t,n){$(document).off("click",".voucher"+n.voucherId).on("click",".voucher"+n.voucherId,function(){a.voucherDetail(n)});var r='<a class="voucher'+n.voucherId+'">'+e+"</a>";return void 0===e?"":r}},{name:"summary",width:180,align:"left"},{name:"currencyNameValue",width:70,align:"left"},{name:"debitMoney",width:100,align:"right",formatter:function(e,t,n){return a.formartMoney(e)}},{name:"debitAmountFor",width:100,align:"right",formatter:function(e,t,n){return a.formartMoney(e)}},{name:"creditMoney",width:100,align:"right",formatter:function(e,t,n){return a.formartMoney(e)}},{name:"creditAmountFor",width:100,align:"right",formatter:function(e,t,n){return a.formartMoney(e)}},{name:"direction",width:40,align:"center",formatter:function(e,t,n){return 1==e?"借":2==e?"贷":"平"}},{name:"balanceFor",width:100,align:"right",formatter:function(e,t,n){return a.formartMoney(e)}},{name:"balance",width:100,align:"right",formatter:function(e,t,n){return a.formartMoney(e)}},{name:"voucherId",width:10,align:"center",hidden:!0},{name:"sobId",width:10,align:"center",hidden:!0}],this.tableHeader=[{startColumnName:"debitMoney",numberOfColumns:2,titleText:"借方金额"},{startColumnName:"creditMoney",numberOfColumns:2,titleText:"贷方金额"},{startColumnName:"direction",numberOfColumns:3,titleText:"余额"}],this.initGrid(this.colNames1,this.colModel1,this.tableHeader)},printV:function(){var n=this;if(n.dataList&&n.dataList.length)if($.each(n.dataList,function(e,t){"1"==t.direction?t.direction="借":"2"==t.direction?t.direction="贷":t.direction="平",t.debitMoney=n.formartMoney(t.debitMoney),t.creditMoney=n.formartMoney(t.creditMoney)}),n.search.currency==n.standardCurrencyId||"-2"==n.search.currency){var e={title:"明细分类账",template:1,titleInfo:[{name:"科目",val:n.subjectName}],colNames:[{name:"日期",col:"periodDate"},{name:"凭证字号",col:"voucherNumber"},{name:"摘要",col:"summary"},{name:"借方",col:"debitMoney"},{name:"贷方",col:"creditMoney"},{name:"方向",col:"direction"},{name:"余额",col:"balance"}],styleCss:"",colMaxLenght:9,data:n.dataList};n.printInfo=e,n.printModalShow(!0)}else if("-1"==n.search.currency){var t=n.dataList,r="",a="",o="";r='\n                    <tr class=\'thCs\'>\n                        <th rowspan="2" style="width: 6%">日期</th>\n                        <th rowspan="2" style="width: 6%">凭证字号</th>\n                        <th rowspan="2" style="width: 6%">摘要</th>\n                        <th rowspan="2" style="width: 6%">币别</th>\n                        <th colspan="2" style="width: 12%">借方金额</th>\n                        <th colspan="2" style="width: 12%">贷方金额</th>\n                        <th colspan="2" style="width: 12%">余额</th>\n                    </tr>\n                     <tr class=\'thCs\'>\n                        <th style="width: 6%">原币</th>\n                        <th style="width: 6%">本位币</th>\n                        <th style="width: 6%">原币</th>\n                        <th style="width: 6%">本位币</th>\n                        <th style="width: 6%">方向</th>\n                        <th style="width: 6%">本位币</th>\n                    </tr>\n                ',t.forEach(function(e){a+="\n                        <tr>\n                            <td>"+n._nullData(e.periodDate)+"</td>\n                            <td>"+n._nullData(e.voucherNumber)+"</td>\n                            <td>"+n._nullData(e.summary)+"</td>\n                            <td>"+n._nullData(e.currencyNameValue)+"</td>\n                            <td>"+n.formartMoney(e.debitMoney)+"</td>\n                            <td>"+n.formartMoney(e.debitAmountFor)+"</td>\n                            <td>"+n.formartMoney(e.creditMoney)+"</td>\n                            <td>"+n.formartMoney(e.creditAmountFor)+"</td>\n                            <td>"+n._nullData(e.direction)+"</td>\n                            <td>"+n.formartMoney(e.balance)+"</td>\n                        </tr>\n                    "});var i={title:"明细分类账",template:1,titleInfo:[{name:"科目",val:n.subjectName}],colMaxLenght:10,tbodyInfo:{theadTX:r,tbodyTX:a,tfootTX:o}};htPrint(i)}else{t=n.dataList,r="",a="",o="";r='\n                    <tr class=\'thCs\'>\n                        <th rowspan="2" style="width: 6%">日期</th>\n                        <th rowspan="2" style="width: 6%">凭证字号</th>\n                        <th rowspan="2" style="width: 6%">摘要</th>\n                        <th rowspan="2" style="width: 6%">币别</th>\n                        <th colspan="2" style="width: 12%">借方金额</th>\n                        <th colspan="2" style="width: 12%">贷方金额</th>\n                        <th rowspan="2" style="width: 6%">方向</th>\n                        <th colspan="2" style="width: 12%">余额</th>\n                    </tr>\n                     <tr class=\'thCs\'>\n                        <th style="width: 6%">原币</th>\n                        <th style="width: 6%">本位币</th>\n                        <th style="width: 6%">原币</th>\n                        <th style="width: 6%">本位币</th>\n                        <th style="width: 6%">方向</th>\n                        <th style="width: 6%">本位币</th>\n                    </tr>\n                ',t.forEach(function(e){a+="\n                        <tr>\n                            <td>"+n._nullData(e.periodDate)+"</td>\n                            <td>"+n._nullData(e.voucherNumber)+"</td>\n                            <td>"+n._nullData(e.summary)+"</td>\n                            <td>"+n._nullData(e.currencyNameValue)+"</td>\n                            <td>"+n.formartMoney(e.debitMoney)+"</td>\n                            <td>"+n.formartMoney(e.debitAmountFor)+"</td>\n                            <td>"+n.formartMoney(e.creditMoney)+"</td>\n                            <td>"+n.formartMoney(e.creditAmountFor)+"</td>\n                            <td>"+n._nullData(e.direction)+"</td>\n                            <td>"+n.formartMoney(e.balanceFor)+"</td>\n                            <td>"+n.formartMoney(e.balance)+"</td>\n                        </tr>\n                    "});var c={title:"明细分类账",template:1,titleInfo:[{name:"科目",val:n.subjectName}],colMaxLenght:10,tbodyInfo:{theadTX:r,tbodyTX:a,tfootTX:o}};htPrint(c)}else n.$Message.info({content:"无打印数据",duration:3})},_nullData:function(e){return e||""},formatMoney:function(e){return null==e||0==e?"":accounting.formatNumber(e,2,",")},printModalShow:function(e){this.printModal=e},clearTable:function(){var e=$(".jqGrid_wrapper");e.empty(),$(" <table id='list'></table>").appendTo(e),$("<div id='pager'></div>").appendTo(e)},voucherDetail:function(e){var t=contextPath+"/finance/voucher-lrt/index.html?voucherId="+e.voucherId+"&sobId="+e.sobId;console.log(t),window.parent.activeEvent({name:"查看凭证",url:t,params:null})},exportDetail:function(){var e=this.search,t=contextPath+"/bookInquiryController/exportExcel?currency="+e.currency+"&yearStart="+e.yearStart+"&yearEnd="+e.yearEnd+"&subjectPeriodStart="+e.subjectPeriodStart+"&subjectPeriodEnd="+e.subjectPeriodEnd+"&subjectLevelStart="+e.subjectLevelStart+"&subjectLevelEnd="+e.subjectLevelEnd+"&subjectCodeStart="+e.subjectCodeStart+"&subjectCodeEnd="+e.subjectCodeEnd+"&showDisable="+e.showDisable+"&showUnposted="+e.showUnposted+"&noShowAndHappen="+e.noShowAndHappen+"&noShowAndHappenZero="+e.noShowAndHappenZero+"&showDetailOnly="+e.showDetailOnly+"&showNoOccurencePeriod="+e.showNoOccurencePeriod+"&curIndex="+e.curIndex;console.log(t),window.open(t)},initHtml:function(){var r=this;$.ajax({type:"POST",data:null,url:contextPath+"/bookInquiryController/initPage",dataType:"json",success:function(e){if("100100"==e.code){r.years=e.data.financeYearPeriod.data,r.search.yearStart=r.years[0].value,r.search.yearEnd=r.years[0].value,r.currencyList=e.data.currencyList.data.slice(1),r.search.currency=r.currencyList[0].id,r.search.subjectLevelStart=r.subjectLevelList[0].value,r.search.subjectLevelEnd=r.subjectLevelList[0].value;var t=getUrlParam("subjectCode"),n=getUrlParam("currencyId");null!=t&&""!=t&&(r.search.subjectCode=t,r.search.currency=n,r.search.yearStart=getUrlParam("subjectYearEnd"),r.search.yearEnd=getUrlParam("subjectYearEnd"),r.search.subjectPeriodStart=getUrlParam("subjectPeriodStart"),r.search.subjectPeriodEnd=getUrlParam("subjectPeriodEnd"),r.search.subjectLevelStart=parseInt(getUrlParam("subjectLeaveStart"))+3,r.search.subjectLevelEnd=parseInt(getUrlParam("subjectLeaveEnd"))+3,r.search.showUnposted="true"==getUrlParam("posted")),"-1"==n?r.pageInitType():"-2"==n||n==r.standardCurrencyId?r.pageInit():"1"<n?r.pageInitForein():r.pageInit()}else layer.alert("页面初始化失败")},error:function(e){layer.alert("页面初始化失败")}})}},mounted:function(){this.openTime=window.parent.params&&window.parent.params.openTime,this.initHtml()}});