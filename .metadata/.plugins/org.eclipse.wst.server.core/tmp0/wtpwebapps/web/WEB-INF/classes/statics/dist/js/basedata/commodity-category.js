"use strict";var _methods;function _defineProperty(e,t,o){return t in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}var parvm=new Vue({el:"#paraLevel",data:function(){var i=this;return{isEdit:!1,isView:!1,reload:!1,disabledFlag:!1,typeNameFlag:!0,subjectFlag:!0,showSourceModal:!0,cateFlag:!1,buttonFlag:!0,subjectSelected:[],childNodes:1,openTime:"",isSearchHide:!0,categoryFlag:!1,codeFlag:!1,showView:!1,supplierReload:!1,showModal:!1,supplier_selected:[],organizationInfo:{id:""},tmp:"",status:[{value:2,label:"贷方"},{value:1,label:"借方"}],inputorder:{stocktCode:{id:"",name:""},saleRevenue:{id:"",name:""},saleCostCode:{id:"",name:""},costDiffCode:{id:"",name:""}},cashSelected:[],selected:[],banks:[],searchBody:{name:"",code:""},subjectEntity:{id:"",subjectCode:"",subjectName:"",balanceDirection:"",subjectCategoryName:""},subjectSearchBody:{id:"",fullSubjectCode:"",treeHeight:"",subjectName:"",balanceDirection:""},treeName:"",nodeData:[],setting1:{data:{view:{dblClickExpand:!1},simpleData:{enable:!0,idKey:"id",pIdKey:"parentId"},key:{name:"name"}},callback:{onClick:this.clickEvent}},treeUrl:contextPath+"/tbasecommoditycategory/list",subjectUrl:contextPath+"/tbaseAccountSubject/accountSubjectTree",subjectSetting:{data:{simpleData:{enable:!0,idKey:"id",pIdKey:"parentId"},key:{name:"subjectName"}},callback:{onClick:this.subjectClickEvent}},setting:{data:{simpleData:{enable:!0}}},receiveDate:[],superiorCategory:[],body:{code:"",name:"",customCode:""},commodityInfo:{id:"",crategoryId:"",name:"",code:"",codingCodeRules:"",status:"1",minRatingDifference:"",maxRatingDifference:"",countGroupId:"",countUnitId:"",quantityAccuracy:"",weightAccuracy:"",stocktCodeId:"",saleRevenueId:"",saleCostCodeId:"",costDiffCodeId:"",customCode:"",isDel:"",weightGroupId:"",weightUnitId:"",organizationId:"",remark:"",pricingType:""},parentCategory:{id:"",name:"",code:"",customCode:"",parentId:"",organizationId:""},unitWeightGroup:[],unitWeight:[],unitCountGroup:[],unitCount:[],data_config:{url:contextPath+"/tbasecommoditycategotyinfo/list",colNames:["类型编码","类型名称","上级类型","有效状态","描述","称差下限值","称差上限值","分类名称"],colModel:[{name:"code",width:200,align:"left",formatter:function(e,t){return console.log("mycode->"+e),$(document).off("click",".detail"+e).on("click",".detail"+e,function(){parvm.commodityInfo.code=e,i.detailClick()}),'<a class="detail'+e+'">'+e+"</a>"}},{name:"name",width:200,align:"left"},{name:"superiorTypeName",width:150,align:"left"},{name:"status",width:150,align:"left",sortable:!1,formatter:function(e){return 1==e?"有效":"无效"}},{name:"remark",width:200,align:"left"},{name:"minRatingDifference",width:130,align:"right"},{name:"maxRatingDifference",width:130,sortable:!1,align:"right"},{name:"crategoryId",width:130,sortable:!1,align:"left",hidden:!0}]},base_config:{colNames:["操作","科目代码","科目名称","科目类别","余额方向"],colModel:[{name:"codes",index:"invdate",width:50,align:"left",formatter:function(e,t,o,a){return $(document).on("click",".select"+o.id,function(){i.doSelect(e,t,o,a)}),'<a type="primary" class="select'+o.id+'">选取</a>'}},{name:"subjectCode",index:"subjectCode",width:100,align:"left"},{name:"subjectName",index:"subjectName",width:100,align:"left"},{name:"tBaseSubjectBalanceEntity.subjectCategory",index:"subjectCategoryName",width:80,align:"left"},{name:"balanceDirection",index:"balanceDirection",width:80,align:"left",formatter:function(e,t,o,a){return 1==e?"借方":2==e?"贷方":void 0}}],jsonReader:{root:"data.list",total:"data.totalPage",records:"data.totalCount",cell:"list"},prmNames:{page:"page",rows:"limit",sort:"sidx",order:"order"},mtype:"POST",contentType:"application/json",datatype:"json",styleUI:"Bootstrap",rownumbers:!0,pagination:!0,multiselectWidth:50,viewrecords:!0,rowNum:10,rowList:[10,30,50],pager:"#my_pager_id",url:contextPath+"/tbaseAccountSubject/list",onPaging:function(){}}}},methods:(_methods={keyDown:function(){},hideSearch:function(){this.isSearchHide=!this.isSearchHide,$(".chevron").css("top","")},clickEvent:function(e,t,o){console.log(t,o),this.parentCategory.id=o.id,this.body.customCode=o.customCode,this.parentCategory.parentId=o.parentId,this.parentCategory.customCode=o.customCode,this.parentCategory.code=o.code,this.parentCategory.name=o.name,0==o.parentId&&(this.commodityInfo.customCode=""),this.treeName=o.name,this.childNodes=this.findNodes(o),this.reload=!this.reload},findNodes:function(e){return e.isParent?e.children.length+1:1},addCategoty:function(){var o=this,e=this.parentCategory.id;if(console.log(e),""==e||"undefined"==e)return layer.alert("请先选择一条商品分类!"),!1;o.buttonFlag=!1,this.parentCategory.code="",this.parentCategory.name="",this.categoryFlag=!1;var t=layer.open({type:1,title:"新增商品分类",content:$("#addCategoty"),btn:["保存","取消"],area:"400px",btn1:function(){console.log(JSON.stringify(parvm.parentCategory)),parvm.parentCategory.parentId=parvm.parentCategory.id,parvm.codeFlag=!1,$.ajax({type:"POST",url:contextPath+"/tbasecommoditycategory/save",contentType:"application/json",data:JSON.stringify(parvm.parentCategory),success:function(e){console.log(e),layer.close(t),"100100"===e.code?layer.alert(e.msg,{icon:1,end:function(){o.buttonFlag=!0,location.reload()}}):layer.alert(e.msg)}})},btn2:function(e,t){$("#category_from").validate().resetForm(),o.buttonFlag=!0,layer.close(e)}})},queryCategory:function(){$.ajax({type:"POST",url:contextPath+"/tbasecommoditycategory/infoById",data:{id:this.parentCategory.id},success:function(e){console.log(e),parvm.parentCategory.name=e.data.name,parvm.parentCategory.code=e.data.code}})},modifyCategoty:function(){console.log("进修改了。。。。。。");var o=this,e=this.parentCategory.id;if(console.log(this.parentCategory.id),parvm.disabledFlag=!1,""==e||"undefined"==e)return layer.alert("请先选择一条商品分类!"),!1;o.buttonFlag=!1,this.queryCategory(),this.categoryFlag=!0;var t=layer.open({type:1,title:"修改分类",content:$("#modifyCategoty"),btn:["保存","取消"],area:"400px",btn1:function(){$.ajax({type:"POST",url:contextPath+"/tbasecommoditycategory/update",contentType:"application/json",data:JSON.stringify(parvm.parentCategory),success:function(e){"100100"===e.code?(console.log(e.msg),layer.alert(e.msg),o.buttonFlag=!0,layer.close(t),location.reload()):layer.alert(e.msg)}})},btn2:function(e,t){$("#category_from").validate().resetForm(),o.buttonFlag=!0,layer.close(e)}})},delCategory:function(){layer.confirm("当前数据有可能被引用，会影响数据准确性，确认是否删除？",{btn:["确定","取消"]},function(e,t){$.ajax({type:"POST",url:contextPath+"/tbasecommoditycategory/delete",data:{id:parvm.parentCategory.id},success:function(e){"100100"==e.code?(layer.closeAll("dialog"),layer.alert(e.msg),location.reload(),parvm.parentCategory.id=""):layer.alert(e.msg)},error:function(e){console.log("error")}})})},add_click:function(){var e=this;return e.clear(),parvm.codeFlag=!1,""==e.parentCategory.id?(layer.alert("请先选择一条商品分类!"),!1):1<e.childNodes?(layer.alert("该商品分类下存在下级分类，禁止添加商品分类明细！"),!1):(console.log(this.isEdit),e.clear(),e.subjectClear(),e.commodityInfo.crategoryId=e.parentCategory.id,parvm.disabledFlag=!1,this.isEdit=!0,void(this.buttonFlag=!0))},copy:function(){console.log("进复制了。。。"),this.buttonFlag=!0;var e=jQuery("#mytable").jqGrid("getRowData",this.selected[0]);console.log(e),parvm.treeName=e.superiorTypeName,parvm.commodityInfo.crategoryId=e.crategoryId;var t=this;if(console.log(this.isEdit),this.commodityInfo.id=this.selected[0],parvm.codeFlag=!1,1!=this.selected.length)return layer.alert("请先勾选一行商品分类详情!"),!1;t.commodityInfo.crategoryId=t.parentCategory.id,parvm.disabledFlag=!1,t.queryCommodityInfo(),t.commodityInfo.id="",t.commodityInfo.code="",t.commodityInfo.name="",t.commodityInfo.codingCodeRules="",this.isEdit=!0},del_click:function(){var o=this,a=o.selected;if(!ht.util.hasValue(a,"array"))return layer.alert("请先选择一条记录!"),!1;layer.confirm("当前数据有可能被引用，会影响数据准确性，确认是否删除？",{btn:["确定","取消"]},function(e,t){$.ajax({type:"POST",url:contextPath+"/tbasecommoditycategotyinfo/delete",contentType:"application/json",data:JSON.stringify(a),dataType:"json",success:function(e){"100100"==e.code?(layer.closeAll("dialog"),layer.alert(e.data),o.reload=!o.reload,o.selected=[]):layer.alert(e.msg)}})})},getUnitWeightByGroupId:function(){var t=this;$.ajax({type:"POST",url:contextPath+"/tbaseunit/list",data:{groupId:t.commodityInfo.weightGroupId},success:function(e){console.log(e),t.unitWeight=e.data}})},getUnitCountByGroupId:function(){var t=this;$.ajax({type:"POST",url:contextPath+"/tbaseunit/list",data:{groupId:t.commodityInfo.countGroupId},success:function(e){console.log(e),t.unitCount=e.data}})},sure:function(){this.reload=!this.reload},categoryClear:function(){this.parentCategory={id:"",name:"",code:"",customCode:"",parentId:"",organizationId:""}},clear:function(){this.commodityInfo={id:"",crategoryId:"",name:"",code:"",codingCodeRules:"",status:"1",minRatingDifference:"",maxRatingDifference:"",countGroupId:"",countUnitId:"",quantityAccuracy:"",weightAccuracy:"",stocktCodeId:"",saleRevenueId:"",saleCostCodeId:"",costDiffCodeId:"",customCode:"",isDel:"",weightGroupId:"",weightUnitId:"",organizationId:"",remark:"",pricingType:""},this.body={code:"",name:"",customCode:parvm.body.customCode}},bodyClear:function(){this.body={code:"",name:"",customCode:parvm.body.customCode}},subjectClear:function(){this.inputorder={stocktCode:{id:"",name:""},saleRevenue:{id:"",name:""},saleCostCode:{id:"",name:""},costDiffCode:{id:"",name:""}}},modify:function(){var e=this.selected;if(this.buttonFlag=!0,parvm.disabledFlag=!1,1<this.selected.length)return layer.msg("修改只能对单条数据进行操作！"),!1;if(!ht.util.hasValue(e,"array"))return layer.alert("请先选择一条记录!"),!1;parvm.codeFlag=!0,parvm.commodityInfo.id=this.selected[0];var t=$("#my_from #categoryCode");console.log(t),$.ajax({type:"POST",url:contextPath+"/tbasecommoditycategotyinfo/info",data:{id:parvm.commodityInfo.id},success:function(e){parvm.commodityInfo=e.data,console.log(e),parvm.copySubject(e)}}),parvm.getUnitWeightByGroupId(),parvm.getUnitCountByGroupId(),this.isEdit=!0},copySubject:function(e){parvm.inputorder.stocktCode.id=e.data.stocktCodeId,parvm.inputorder.saleRevenue.id=e.data.saleRevenueId,parvm.inputorder.saleCostCode.id=e.data.saleCostCodeId,parvm.inputorder.costDiffCode.id=e.data.costDiffCodeId,parvm.inputorder.stocktCode.name=e.data.stocktCodeName,parvm.inputorder.saleRevenue.name=e.data.saleRevenueName,parvm.inputorder.saleCostCode.name=e.data.saleCostCodeName,parvm.inputorder.costDiffCode.name=e.data.costDiffCodeName},doSelect:function(e,t,o,a){console.log(o),this.inputorder[this.tmp].name=o.subjectName,this.inputorder[this.tmp].id=o.id,this.showModal=!1,console.log(this.inputorder)},init:function(){jQuery("#my_table_id").jqGrid(this.base_config)},subClear:function(){this.subjectSearchBody={id:"",fullSubjectCode:"",treeHeight:"",subjectName:"",balanceDirection:""}},search:function(){var e=$("#my_table_id"),t={postData:this.subjectSearchBody};e.jqGrid("clearGridData"),e.jqGrid("setGridParam",t).trigger("reloadGrid")},cancel:function(){this.buttonFlag=!0,this.subjectSearchBody={id:"",fullSubjectCode:"",treeHeight:"",subjectName:"",balanceDirection:""}},exit:function(){window.parent.closeCurrentTab({exit:!0,openTime:this.openTime})},test:function(e){this.tmp=e,this.showModal=!0},subjectClickEvent:function(e,t,o){console.log(o),this.subjectSearchBody.fullSubjectCode=o.fullSubjectCode,this.subjectSearchBody.treeHeight=o.treeHeight,this.search()},view:function(){var e=this.selected;if(!ht.util.hasValue(e,"array"))return layer.alert("请先选择一条记录!"),!1;this.commodityInfo.id=this.selected[0],this.isEdit=!0,parvm.codeFlag=!0,$.ajax({type:"POST",url:contextPath+"/tbasecommoditycategotyinfo/info",data:{id:parvm.commodityInfo.id},success:function(e){parvm.commodityInfo=e.data,console.log(e)}}),parvm.getUnitWeightByGroupId(),parvm.getUnitCountByGroupId()},queryCommodityInfo:function(){$.ajax({type:"POST",url:contextPath+"/tbasecommoditycategotyinfo/info",data:{id:parvm.commodityInfo.id},success:function(e){parvm.commodityInfo=e.data,parvm.commodityInfo.id="",parvm.commodityInfo.code="",parvm.commodityInfo.name="",parvm.commodityInfo.codingCodeRules="",console.log(e),parvm.copySubject(e)}}),parvm.getUnitWeightByGroupId(),parvm.getUnitCountByGroupId()},save:function(){var t=this;if(t.commodityInfo.stocktCodeId=t.inputorder.stocktCode.id,t.commodityInfo.saleCostCodeId=t.inputorder.saleCostCode.id,t.commodityInfo.saleRevenueId=t.inputorder.saleRevenue.id,t.commodityInfo.costDiffCodeId=t.inputorder.costDiffCode.id,$("#my_from").valid()){if(""==t.commodityInfo.id){if(t.commodityInfo.customCode=t.parentCategory.customCode,""==t.commodityInfo.pricingType||"undefined"==t.commodityInfo.pricingType)return layer.alert("请勾选计价类型!"),!1;t.buttonFlag=!1,$.ajax({type:"POST",url:contextPath+"/tbasecommoditycategotyinfo/save",contentType:"application/json",data:JSON.stringify(t.commodityInfo),success:function(e){"100100"===e.code?layer.alert(e.msg,{icon:1,end:function(){parvm.clear(),t.isEdit=!1,t.reload=!t.reload,parvm.subjectClear()}}):layer.alert(e.msg)}})}else $.ajax({type:"POST",url:contextPath+"/tbasecommoditycategotyinfo/update",contentType:"application/json",data:JSON.stringify(parvm.commodityInfo),success:function(e){console.log(e),"100100"===e.code?layer.alert(e.msg,{icon:1,end:function(){t.buttonFlag=!0,t.isEdit=!1,parvm.clear(),parvm.subjectClear(),t.reload=!t.reload}}):layer.alert(e.msg)}});t.buttonFlag=!0}},queryWeightUnitById:function(){$.ajax({type:"POST",url:contextPath+"/tbaseunit/infoUnitById",data:{id:parvm.commodityInfo.weightUnitId},success:function(e){console.log(e),parvm.commodityInfo.weightUnitId=e.data.name}})},queryCountUnitById:function(){$.ajax({type:"POST",url:contextPath+"/tbaseunit/infoUnitById",data:{id:parvm.commodityInfo.countUnitId},success:function(e){console.log(e),parvm.commodityInfo.countUnitId=e.data.name}})},initFormValidate:function(){var e={rules:{categoryCode:{required:!0,remote:{url:contextPath+"/tbasecommoditycategory/info",type:"post",dataType:"json",data:{code:function(){return parvm.parentCategory.code}},dataFilter:function(e,t){return"100100"===JSON.parse(e).code}}},categoryName:{required:!0,remote:{url:contextPath+"/tbasecommoditycategory/info",type:"post",dataType:"json",data:{name:function(){return parvm.parentCategory.name}},dataFilter:function(e,t){return"100100"===JSON.parse(e).code}}},infoCode:{required:!0,remote:{url:contextPath+"/tbasecommoditycategotyinfo/infoByCodeAndNameAndRule",type:"post",dataType:"json",data:{code:function(){return parvm.commodityInfo.code},id:function(){return"undefined"==parvm.commodityInfo.id&&parvm.commodityInfo.id,parvm.commodityInfo.id}},dataFilter:function(e,t){return"100100"===JSON.parse(e).code}}},infoName:{required:!0,remote:{url:contextPath+"/tbasecommoditycategotyinfo/infoByCodeAndNameAndRule",type:"post",dataType:"json",data:{name:function(){return parvm.commodityInfo.name},id:function(){return console.log(parvm.commodityInfo.id),"undefined"==parvm.commodityInfo.id&&parvm.commodityInfo.id,parvm.commodityInfo.id}},dataFilter:function(e,t){return"100100"===JSON.parse(e).code}}},infoCodingCodeRules:{required:!0,validCode:!0,remote:{url:contextPath+"/tbasecommoditycategotyinfo/infoByCodeAndNameAndRule",type:"post",dataType:"json",data:{codingCodeRules:function(){return parvm.commodityInfo.codingCodeRules},parentId:function(){return parvm.parentCategory.id},id:function(){return"undefined"==parvm.commodityInfo.id&&parvm.commodityInfo.id,parvm.commodityInfo.id}},dataFilter:function(e,t){return"100100"===JSON.parse(e).code}}},infoStocktCode:{required:!0},infoSaleRevenue:{required:!0},infoCaleCostCode:{required:!0},infoCostDiffCode:{required:!0}},messages:{categoryCode:{required:"请填写编码!",remote:"商品分类编码已存在!"},categoryName:{required:"请填写名称!",remote:"商品分类名称已存在!"},infoCode:{required:"请填写编码!",remote:"商品分类详情编码已存在!"},infoName:{required:"请填写名称!",remote:"商品分类详情名称已存在!"},infoCodingCodeRules:{required:"请填写编码取码规则!",remote:"商品分类详情编码已存在!"},infoStocktCode:{required:"请填写存货科目代码!"},infoSaleRevenue:{required:"请填写销售收入科目代码!"},infoCaleCostCode:{required:"请填写销售成本科目代码!"},infoCostDiffCode:{required:"请填写销售成本科目代码!"}}};$("#category_from").validate(e),$("#my_from").validate(e)}},_defineProperty(_methods,"cancel",function(){this.selected=[],this.isEdit=!1,parvm.categoryClear(),parvm.clear(),parvm.bodyClear(),$("form").validate().resetForm(),this.reload=!this.reload}),_defineProperty(_methods,"closeCancel",function(){}),_defineProperty(_methods,"getUser",function(){$.ajax({type:"POST",url:contextPath+"/tbaseunit/findUser",success:function(e){console.log(e),parvm.commodityInfo.organizationId=e.data.organization.id}})}),_defineProperty(_methods,"detailClick",function(){console.log("金电极时间了。。。"),parvm.codeFlag=!0,this.buttonFlag=!1,$.ajax({type:"POST",url:contextPath+"/tbasecommoditycategotyinfo/info",data:{code:parvm.commodityInfo.code},success:function(e){console.log(e),parvm.commodityInfo=e.data,parvm.inputorder.stocktCode.name=e.data.stocktCodeName,parvm.inputorder.saleRevenue.name=e.data.saleRevenueName,parvm.inputorder.saleCostCode.name=e.data.saleCostCodeName,parvm.inputorder.costDiffCode.name=e.data.costDiffCodeName}}),parvm.getUnitWeightByGroupId(),parvm.getUnitCountByGroupId(),parvm.disabledFlag=!0,this.isEdit=!0}),_methods),created:function(){},watch:{isEdit:function(e){1==e&&$.ajax({type:"POST",url:contextPath+"/tbaseunitgroup/list",success:function(e){parvm.unitWeightGroup=e.data,parvm.unitCountGroup=e.data,console.log(e)}})}},mounted:function(){this.initFormValidate(),this.init(),jQuery.validator.addMethod("validCode",function(e,t){return/^([a-zA-Z0-9]{1})$/.test(e)},"只能输入一位数字和字母(字符A-Z, a-z, 0-9)"),this.openTime=window.parent.params.openTime}});