"use strict";var vm=new Vue({el:"#app",data:{isShow:!1,isEdit:!1,reload:!1,isSearchHide:!0,isTabulationHide:!0,categoryType:[],selectRowData:[],goodsTypePath:"",dataValue:[],selected:[],goodsValue:"",openTime:"",documentNo:"",documentStatus:"",modalTrigger:!1,modalType:"",approvalTableData:[],stepList:[],selectType:[{value:"W_CMATERIAL_OUT_01",label:"受托加工送料"},{value:"W_CMATERIAL_OUT_02",label:"受托加工退料"}],body:{documentNo:"",startTime:"",endTime:"",customCode:"",businessType:""},data_config:{url:contextPath+"/entrustOut/queryList",datatype:"json",colNames:["id","日期","单据编号","单据状态","业务类型","客户","供应商","业务员","商品类型","物流方式","备注"],colModel:[{name:"id",width:210,align:"left",hidden:!0},{name:"documentTime",width:210,align:"left",formatter:function(t,e,n,o){return new Date(t).format("yyyy-MM-dd")}},{name:"documentNo",width:210,align:"left",formatter:function(t,e,n,o){return $(document).off("click",".detail"+t).on("click",".detail"+t,function(){vm.detailClick({value:t,grid:e,rows:n,state:o})}),'<a class="detail'+t+'">'+t+"</a>"},unformat:function(t,e,n){return t.replace(/(<\/?a.*?>)/g,"")}},{name:"documentStatus",width:210,align:"left",formatter:function(t,e,n,o){return 1===t?"暂存":2===t?"待审核":3===t?"审核中":4===t?"已审核":5===t?"驳回":void 0},unformat:function(t,e,n,o){return"暂存"===t?1:"待审核"===t?2:"审核中"===t?3:"已审核"===t?4:"驳回"===t?5:void 0}},{name:"businessType",align:"left",width:210,formatter:function(t,e,n,o){return"W_CMATERIAL_OUT_01"===t?"受托加工送料":"W_CMATERIAL_OUT_02"===t?"受托加工退料":""}},{name:"custName",align:"left",width:210},{name:"supplierName",align:";left",width:210},{name:"salesmanName",align:";left",width:210},{name:"goodsTypeName",align:";left",width:210},{name:"logisticsWay",align:";left",width:210,formatter:function(t,e,n,o){return"wlfs_zt"===t?"自提":"wlfs_js"===t?"寄送":"wlfs_shsm"===t?"送货上门":""}},{name:"remark",align:";left",width:210}],rowNum:10,rowList:[10,20,30],mtype:"post",viewrecords:!0}},methods:{changeDate:function(t){this.body.startTime=t[0].replace(/\//g,"-")+" 00:00:00",this.body.endTime=t[1].replace(/\//g,"-")+" 23:59:59"},search:function(){this.reload=!this.reload},clear:function(){this.body={documentNo:"",startTime:"",endTime:"",customCode:"",businessType:""},this.$nextTick(function(){this.body.businessType="",this.body.customCode="",this.goodsValue=""}),this.dataValue=[]},refresh:function(){this.clear(),this.reload=!this.reload},loadProductType:function(){var e=this;$.ajax({type:"post",url:contextPath+"/entrustOut/queryStyleCategory?parentId=0",contentType:"application/json",dataType:"json",success:function(t){console.log(t),e.categoryType=e.initGoodCategory(t.data.cateLists)},error:function(){alert("服务器出错啦")}})},initGoodCategory:function(t){var a=this,i=[];return t.forEach(function(t){var e=t.customCode,n=t.name,o=t.cateLists;o&&(o=a.initGoodCategory(o)),i.push({value:e,label:n,children:o})}),i.forEach(function(t){t.children||delete t.children}),i},changeproductTypeName:function(t,e){this.body.customCode=e[e.length-1].value},DeleteOneRow:function(){var e=this;if(console.log(e.selected,88990),e.selected.length<1)e.$Modal.warning({title:"提示信息",content:"请先选择至少一笔数据！"});else{var t="",n=!0,o=!1,a=void 0;try{for(var i,s=e.selected[Symbol.iterator]();!(n=(i=s.next()).done);n=!0){var r=i.value;1!==r.documentStatus&&(t+="单据[ "+r.documentNo+" ]<br>")}}catch(t){o=!0,a=t}finally{try{!n&&s.return&&s.return()}finally{if(o)throw a}}if(t)e.$Modal.warning({title:"提示信息",content:t+" 单据状态不为暂存，不能删除"});else{var l=[],c=!0,u=!1,d=void 0;try{for(var m,h=e.selected[Symbol.iterator]();!(c=(m=h.next()).done);c=!0){var f=m.value;l.push(f.id)}}catch(t){u=!0,d=t}finally{try{!c&&h.return&&h.return()}finally{if(u)throw d}}this.$Modal.confirm({title:"提示信息",content:"是否删除？",onOk:function(){$.ajax({type:"POST",url:contextPath+"/entrustOut/deleteBatch",contentType:"application/json",data:JSON.stringify(l),dataType:"json",success:function(t){e.selected="","100100"==t.code?(e.refresh(),$.isEmptyObject(t.data)&&e.$Modal.success({title:"提示信息",content:"删除成功！"})):e.$Modal.warning({title:"提示信息",content:"删除失败！"})}})},onCancel:function(){}})}}},detailClick:function(t){window.parent.activeEvent({name:"受托加工材料出库-查看",url:contextPath+"/warehouse/entrust-material-out/entrust-material-out-info.html",params:{activeType:"listQuery",documentNo:t.rows.documentNo}})},add:function(){window.parent.activeEvent({name:"受托加工材料出库-新增",url:contextPath+"/warehouse/entrust-material-out/entrust-material-out-info.html",params:{activeType:"handworkAdd"}})},update:function(){this.selected.length<1?this.$Modal.warning({title:"提示信息",content:"请先选择至少一笔数据！"}):1<this.selected.length?this.$Modal.warning({title:"提示信息",content:"只能选择一笔数据！"}):(console.log(this.selected,233),window.parent.activeEvent({name:"受托加工材料出库-修改",url:contextPath+"/warehouse/entrust-material-out/entrust-material-out-info.html",params:{activeType:"listUpdate",documentNo:this.selected[0].documentNo}}))},submit:function(){var e=this.selected;if(console.log("document",e),e.length<1)layer.alert("请至少选择一条数据");else if(1<e.length)layer.alert("只能选择一条数据");else{var n=this;1===e[0].documentStatus?$.ajax({type:"POST",url:contextPath+"/entrustOut/submit",dataType:"json",data:{id:e[0].id},success:function(t){console.log(t),"100100"===t.code?(e[0].documentStatus=2,n.refresh(),n.$Modal.success({title:"提示信息",content:"提交成功！"})):(e[0].documentStatus=1,n.$Modal.warning({title:"提示信息",content:t.msg}))},error:function(t){n.$Spin.hide(),console.log("服务器出错")}}):layer.alert("单据状态不为暂存不能提交！")}},exit:function(){window.parent.closeCurrentTab({openTime:this.openTime,exit:!0})},approval:function(){var t=this,e=this.selected;if(1<e.length)this.$Modal.warning({title:"提示信息",content:"只能选择一条数据！"});else if(e.length<1)this.$Modal.warning({title:"提示信息",content:"请至少选择一条数据！"});else if(2===e[0].documentStatus||3===e[0].documentStatus||5===e[0].documentStatus)t.id=e[0].id,t.documentStatus=e[0].documentStatus,t.documentNo=e[0].documentNo,t.modalType="approve",t.modalTrigger=!t.modalTrigger,console.log(e[0].documentStatus,e[0].documentNo,77);else{if(1===e[0].documentStatus)return void this.$Modal.warning({title:"提示信息",content:"请提交单据！"});if(4===e[0].documentStatus)return void this.$Modal.warning({title:"提示信息",content:"该单已审核,不能重复审核！"})}},reject:function(){var t=this,e=this.selected;1<e.length?t.$Modal.warning({title:"提示信息",content:"请至少选择一条数据！"}):e.length<1?t.$Modal.warning({title:"提示信息",content:"请至少选择一条数据！"}):2===e[0].documentStatus||3===e[0].documentStatus||5===e[0].documentStatus?(t.id=e[0].id,t.documentStatus=e[0].documentStatus,t.documentNo=e[0].documentNo,t.modalType="reject",t.modalTrigger=!t.modalTrigger):t.$Modal.warning({title:"提示信息",content:"该单状态不能驳回！"})},approvalOrRejectCallBack:function(t){console.log(t,9988788),"100100"===t.result.code&&this.refresh()},autoSubmitOrReject:function(t){var e=this;$.ajax({url:contextPath+"/entrustOut/submitapproval?submitType=1",method:"post",contentType:"application/json;charset=utf-8",data:JSON.stringify({receiptsId:e.documentCode,approvalResult:"reject"==e.modalType?1:0}),success:function(t){"100100"===t.code||e.$Modal.warning({content:t.msg})}})},ajaxUpdateDocStatusById:function(t,e){var n=this;$.ajax({url:contextPath+"/entrustOut/updateDocumentStatusByid",method:"POST",dataType:"json",contentType:"application/json;charset=utf-8",data:JSON.stringify({id:t,documentStatus:e}),success:function(t){"100100"==t.code&&(n.body.documentStatus=e,n.refresh())}})}},mounted:function(){this.loadProductType(),this.openTime=window.parent.params.openTime}});