"use strict";function _defineProperty(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}var pendingList=new Vue({el:"#pendingList",data:function(){return{openTime:"",isSearchHide:!0,isBodyHide:!0,isTabulationHide:!0,isShow:!1,isHide:!0,isEdit:!1,reload:!1,selected:[],categoryType:[],empList:[],commodityCategoty:[],dateArr:[],supplierList:[],body:{goodsTypePath:"",certificateType:"",supplierId:"",orderNo:"",startTime:"",endTime:""},data_config:{url:contextPath+"/waitCertiBackInfo/listPage",colNames:["源单类型","日期","单据编号","id","供应商","供应商Id","商品类型","业务类型","证书类型","证书数量","发货数量","发货重量"],colModel:[{name:"sourceType",index:"sourceType",align:"left",width:180},{name:"deliveryDate",index:"deliveryDate",width:180,align:"left",formatter:function(e,t,i,n){return new Date(e).format("yyyy-MM-dd")}},{name:"orderNo",index:"orderNo",width:180,align:"left",formatter:function(e,t,i,n){return $(document).off("click",".detail"+e).on("click",".detail"+e,function(){console.log({value:e,grid:t,rows:i,state:n})}),'<a class="detail'+e+'">'+e+"</a>"},unformat:function(e,t,i){return e.replace(/(<\/?a.*?>)/g,"")}},{name:"id",hidden:!0},_defineProperty({name:"supplier",index:"supplier",width:180,align:"center"},"align","left"),{name:"supplierId",hidden:!0},{name:"goodsTypeName",index:"goodsTypeName",align:"left",width:180},{name:"businessType",index:"businessType",align:"left",width:180,formatter:function(e,t,i,n){return"P_CREDENTIAL_OUT_01"==e?"标配证书":"P_CREDENTIAL_OUT_02"==e?"特殊证书":""}},{name:"certificateType",index:"certificateType",width:180,align:"left"},{name:"certificateNumber",index:"certificateNumber",width:180,align:"left"},{name:"deliverGoodsNumber",index:"deliverGoodsNumber",align:"left",width:180},{name:"deliverWeight",index:"deliverWeight",align:"left",width:180}],shrinkToFit:!1}}},methods:{search:function(){console.log(this.body),0<this.commodityCategoty.length?this.body.goodsTypePath=this.commodityCategoty[this.commodityCategoty.length-1]:this.body.goodsTypePath="",0<this.dateArr.length&&this.dateArr[0]&&this.dateArr[1]?(this.body.startTime=this.dateArr[0].format("yyyy-MM-dd HH:mm:ss"),this.body.endTime=this.dateArr[1].format("yyyy-MM-dd HH:mm:ss")):(this.body.startTime="",this.body.endTime=""),this.reload=!this.reload},clear:function(){this.body={goodsTypePath:"",certificateType:"",supplierId:"",orderNo:"",startTime:"",endTime:""},this.$refs.certificateType.reset();this.commodityCategoty=[],this.dateArr=[],jQuery("#myTable").jqGrid("clearGridData"),jQuery("#myTable").jqGrid("setGridParam",{postData:{goodsTypePath:"",certificateType:"",supplierId:"",orderNo:"",startTime:"",endTime:""}}).trigger("reloadGrid")},refresh:function(){this.clear(),this.selected=[],this.reload=!this.reload},generateReport:function(){var e=[];if(0==pendingList.selected.length)return pendingList.$Modal.warning({title:"提示信息",content:"<p>请先勾选单据信息</p>"}),!1;for(var t=pendingList.selected[0].supplierId,i=pendingList.selected[0].goodsTypePath,n=pendingList.selected[0].businessType,a=pendingList.selected[0].certificateType,r=1;r<pendingList.selected.length;r++){if(t!=pendingList.selected[r].supplierId)return pendingList.$Modal.warning({title:"提示信息",content:"<p>请选择相同供应商</p>"}),!1;if(i!=pendingList.selected[r].goodsTypePath)return pendingList.$Modal.warning({title:"提示信息",content:"<p>请选择相同的商品类型</p>"}),!1;if(n!=pendingList.selected[r].businessType)return pendingList.$Modal.warning({title:"提示信息",content:"<p>请选择相同的业务类型</p>"}),!1;if(a!=pendingList.selected[r].certificateType)return pendingList.$Modal.warning({title:"提示信息",content:"<p>请选择相同的证书类型</p>"}),!1}for(r=0;r<pendingList.selected.length;r++)e.push(pendingList.selected[r].id);window.parent.activeEvent({name:"新增证书商品收回单",url:contextPath+"/purchase/certificate-back-report/certificate-back-add.html",params:{type:"generate",ids:e}})},cancel:function(){window.parent.closeCurrentTab({exit:!0,openTime:this.openTime})},getSupplierList:function(){$.ajax({type:"post",url:contextPath+"/waitCertiBackInfo/getSupplierList",data:{},success:function(e){if(""!=e.data)for(var t=0;t<e.data.length;t++)pendingList.supplierList.push({id:e.data[t].id,supplier:e.data[t].siShortName})}})},loadProductType:function(){var t=this;$.ajax({type:"post",url:contextPath+"/documentController/getCategory?parentId=0",contentType:"application/json",dataType:"json",success:function(e){t.categoryType=t.initGoodCategory(e.data.cateLists)},error:function(e){console.log("服务器出错")}})},changeCategory:function(e){this.body.goodsTypePath=e[e.length-1]},initGoodCategory:function(e){var a=this,r=[];return e.forEach(function(e){var t=e.customCode,i=e.name,n=e.cateLists;n&&(n=a.initGoodCategory(n)),r.push({value:t,label:i,children:n})}),r.forEach(function(e){e.children||delete e.children}),r},loadEmplist:function(){$.ajax({type:"post",url:"./empList.json",dataType:"json",success:function(e){purchaseOrderList.empList=e.data},error:function(){alert("服务器出错啦")}})}},created:function(){this.loadProductType(),this.getSupplierList()},watch:{"body.certificateType":function(e){"-1"===e&&(this.body.certificateType="")}},mounted:function(){this.openTime=window.parent.params.openTime}});