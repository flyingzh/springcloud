"use strict";function _defineProperty(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}Date.prototype.Format=function(e){var t={"M+":this.getMonth()+1,"d+":this.getDate(),"h+":this.getHours(),"m+":this.getMinutes(),"s+":this.getSeconds(),"q+":Math.floor((this.getMonth()+3)/3),S:this.getMilliseconds()};for(var r in/(y+)/.test(e)&&(e=e.replace(RegExp.$1,(this.getFullYear()+"").substr(4-RegExp.$1.length))),t)new RegExp("("+r+")").test(e)&&(e=e.replace(RegExp.$1,1==RegExp.$1.length?t[r]:("00"+t[r]).substr((""+t[r]).length)));return e};var currencyVm=new Vue({el:"#currency-info",data:function(){var e,c=this;return _defineProperty(e={openTime:"",isAdd:!1,isSearchHide:!0,isLook:!1,selected:[],isShow:!1,buttonFlag:!0,currency:{id:"",codes:"",currencyName:"",exchangeRate:"",precisions:4,status:1,remark:"",createName:"",createTime:"",createId:""},body:{id:""},reload:!1,precision:"",status:[{value:"",label:"全部"},{value:1,label:"有效"},{value:0,label:"无效"}],state:[{value:1,label:"有效"},{value:0,label:"无效"}],statusCode:0},"body",{codes:"",currencyName:"",status:""}),_defineProperty(e,"currencyName",""),_defineProperty(e,"currencySymbol",""),_defineProperty(e,"data_config",{url:contextPath+"/currency/list",colNames:["编码","币种名称","有效状态","备注","创建人","创建时间"],colModel:[{name:"codes",index:"invdate",width:200,align:"left",formatter:function(e,t,r,n){return $(document).off("click",".detail"+e).on("click",".detail"+e,function(){c.selected=[r.id],c.view()}),'<a class="detail'+e+'">'+e+"</a>"}},{name:"currencyName",index:"currencyName asc, invdate",width:200,align:"left"},{name:"status",index:"status",width:100,align:"left",formatter:function(e){return 1==e?"有效":"无效"}},{name:"remark",index:"remark",width:300,align:"left",sortable:!1},{name:"createName",index:"createName",width:230,align:"left"},{name:"createTime",index:"createTime",width:230,sortable:!1,align:"left",formatter:function(e){return new Date(e).Format("yyyy-MM-dd hh:mm:ss")}}]}),e},methods:{hideSearch:function(){this.isSearchHide=!this.isSearchHide,$(".chevron").css("top","")},initAddBody:function(){this.currency={id:"",codes:"",currencyName:"",exchangeRate:"",precisions:4,status:1,remark:"",createName:"",createId:""}},search:function(){console.log("搜索"),this.reload=!this.reload,console.log(JSON.stringify(this.body))},clear:function(){console.log("清空"),this.body.status="",this.body.currencyName="",this.body.codes="",this.reload=!this.reload},currencyClear:function(){this.currency.codes="",this.currency.currencyName="",this.currency.exchangeRate="",this.currency.remark=""},save:function(){console.log(currencyVm.currency.id);if($("#my_from").valid())if(this.buttonFlag=!1,currencyVm.currency.id)console.log("修改"),this.update();else{var t=this;console.log("增加"),$("form").valid()&&(console.log(11111),$.ajax({type:"POST",url:contextPath+"/currency/addCurrency",contentType:"application/json",data:JSON.stringify(currencyVm.currency),dataType:"json",success:function(e){"100100"==e.code?layer.alert(e.msg,{icon:1,end:function(){currencyVm.initAddBody(),t.isShow=!1,t.buttonFlag=!0,t.reload=!t.reload}}):layer.alert(e.msg)},error:function(e){console.error("error: "+e.msg)}}))}},cancel:function(){$("#my_from").validate().resetForm(),this.isShow=!1,this.currencyClear(),this.selected=[],this.buttonFlag=!0,this.reload=!this.reload},add:function(){console.log("add"),this.isShow=!0,this.currency.id="",this.isAdd=!1,this.buttonFlag=!0,this.isLook=!1,this.currency.createTime=(new Date).Format("yyyy-MM-dd hh:mm:ss")},del:function(){console.log("del"),console.log(JSON.stringify(this.selected)),layer.confirm("当前数据有可能被引用，会影响数据准确性，确认是否删除？",{btn:["确定","取消"]},function(e,t){$.ajax({type:"POST",url:contextPath+"/currency/delete",contentType:"application/json",data:JSON.stringify(currencyVm.selected),dataType:"json",success:function(e){"100100"==e.code?(layer.alert(e.data),currencyVm.selected=[],currencyVm.reload=!currencyVm.reload):layer.alert(e.msg)},error:function(e){alert(e)}})})},detailClick:function(e){var t=e.rows;this.isShow=!0,this.currency=t,currencyVm.isLook=!0},modify:function(){this.currency.createTime=(new Date).Format("yyyy-MM-dd hh:mm:ss"),console.log("modify操作"),this.buttonFlag=!0;var e=this.selected[0];this.currency.id=e,console.log(e),1!=this.selected.length?layer.alert("修改只能对单条数据进行操作"):(this.isShow=!0,this.isAdd=!0,$("form").valid()&&(currencyVm.isLook=!1,$.ajax({type:"POST",url:contextPath+"/currency/info/"+e,contentType:"application/json",data:JSON.stringify(this.selected[0]),dataType:"json",success:function(e){"100100"==e.code?(console.log(e),currencyVm.currency=e.data):layer.alert(e.msg)},error:function(e){alert(e.msg)}})))},update:function(){console.log(JSON.stringify(currencyVm.currency));var t=this;$.ajax({type:"POST",url:contextPath+"/currency/updateCurreny",contentType:"application/json",data:JSON.stringify(currencyVm.currency),dataType:"json",success:function(e){"100100"===e.code?layer.alert(e.msg,{icon:1,end:function(){currencyVm.contentType=e.data,t.isShow=!1,currencyVm.initAddBody(),t.buttonFlag=!0,t.reload=!t.reload}}):layer.alert(e.msg)},error:function(e){alert(e)}})},view:function(){if(1<this.selected.length)layer.alert("查看只能对单条数据进行操作");else if(this.selected.length<1)layer.alert("请选择操作数据");else if(this.buttonFlag=!1,$("form").valid()){currencyVm.isLook=!1;var e=this.selected[0];$.ajax({type:"POST",url:contextPath+"/currency/info/"+e,contentType:"application/json",data:JSON.stringify(this.selected[0]),dataType:"json",success:function(e){console.log(e),currencyVm.currency=e.data,currencyVm.isShow=!0,currencyVm.isLook=!0,currencyVm.isAdd=!0},error:function(e){alert(e.msg)}})}},exit:function(){window.parent.closeCurrentTab({exit:!0,openTime:this.openTime})},copy:function(){if(console.log("进复制了。。。"),1!=this.selected.length)return layer.alert("请选择一条操作数据"),!1;this.buttonFlag=!0,$.ajax({type:"POST",url:contextPath+"/currency/info/"+this.selected[0],contentType:"application/json",dataType:"json",success:function(e){console.log(e),currencyVm.currency.exchangeRate=e.data.exchangeRate,currencyVm.currency.precisions=e.data.precisions,currencyVm.currency.status=e.data.status,currencyVm.currency.remark=e.data.remark,currencyVm.currency.createName=e.data.createName},error:function(e){alert(e.msg)}}),this.isShow=!0,currencyVm.isAdd=!1,currencyVm.isLook=!1},getUser:function(){var t=this;$.ajax({type:"POST",url:contextPath+"/tbaseunit/findUser",success:function(e){console.log(e),t.currency.createName=e.data.username,t.currency.createId=e.data.createId}})},initFormValidate:function(){var e={onfocusout:function(e){$(e).valid()},onkeyup:!1,rules:{codes:{required:!0,remote:{url:contextPath+"/currency/validateCode",type:"post",dataType:"json",data:{codes:function(){return currencyVm.currency.codes},id:function(){return currencyVm.currency.id}},dataFilter:function(e,t){var r=JSON.parse(e);return"100100"===r.code?r.data:(layer.alert(r.msg),!1)}}},name:{required:!0,remote:{url:contextPath+"/currency/validateCode",type:"post",dataType:"json",data:{name:function(){return currencyVm.currency.currencyName},id:function(){return currencyVm.currency.id}},dataFilter:function(e,t){var r=JSON.parse(e);return"100100"===r.code?r.data:(layer.alert(r.msg),!1)}}}},messages:{codes:{required:"请填写币种代码!",remote:"该编码已存在!"},name:{required:"请填写币种名称!",remote:"该币种名称已存在!"}}};$("#my_from").validate(e)}},created:function(){this.getUser()},mounted:function(){this.initFormValidate(),this.openTime=window.parent.params.openTime}});