"use strict";var FileCodeVM=new Vue({el:"#orderNum",data:function(){return{temp:!1,checkAllGroup:[],ruleList:[],selectIndex:"",addEntity:{id:"",docName:"",category:"",tabName:"",tabField:"",docEntity:{docName:"",tabName:"",fieldName:""},ruleList:""},rule:{type:"",length:"",value:"",setNum:"",numStart:"",numStop:"",numStep:"",splitSymbol:"-",autoZeroFill:"",temp:1},sourceType:[{value:1,label:"常量"},{value:2,label:"日期字段"},{value:3,label:"流水号"}],dateType:[{value:"yyyy/mm/dd",label:"yyyy/mm/dd"},{value:"mm/dd/yy",label:"mm/dd/yy"},{value:"yy/mm/dd",label:"yy/mm/dd"},{value:"yyyy-mm-dd",label:"yyyy-mm-dd"},{value:"mm-dd-yy",label:"mm-dd-yy"},{value:"yyyymmdd",label:"yyyymmdd"},{value:"yyyyMMdd",label:"yyyyMMdd"}],docListData:[],docCategory:[]}},methods:{delNum:function(t,e,i){return htInputNumber(t,e,i)},actStart:function(t){var e=this.ruleList[t];if(console.log(e),Number(e.numStart)>Number(e.numStop))return this.$Modal.info({content:"开始值不能大于结束值"}),void(this.ruleList[t].numStart="")},actStep:function(t){var e=this.ruleList[t];return Number(e.numStep)>Number(e.numStop)?(this.$Modal.info({content:"步长不能大于结束值"}),void(this.ruleList[t].numStep="")):9<Number(e.numStep)?(this.$Modal.info({content:"步长不能大于9"}),void(this.ruleList[t].numStep="")):void 0},addRow:function(){var t=Object.assign({},this.rule);this.ruleList.push(t)},changeEmp:function(t){var e=Object.assign({},this.ruleList[t]);this.ruleList[t].length="",this.ruleList[t].type="",this.ruleList[t].numStart="",this.ruleList[t].numStop="",this.ruleList[t].numStep="",this.ruleList[t].splitSymbol="",this.ruleList[t].autoZeroFill="",this.ruleList[t].value="","1"==e.type?this.ruleList[t].type=1:"2"==e.type?this.ruleList[t].type=2:"3"==e.type&&(this.ruleList[t].type=3)},numInput:function(t){if("1"===this.ruleList[t].type){var e=this.ruleList[t].value.length;this.ruleList[t].length=e}else if("3"===this.ruleList[t].type){var i=this.ruleList[t].numStart.length;this.ruleList[t].length=i}},clearNum:function(t){var e=this.ruleList[t];e.value=e.value.toString().replace(/[^a-zA-Z]/g,""),this.ruleList[t].value=e.value},clearInput:function(t){var e=this.ruleList[t];e.length=e.length.toString().replace(/[^\d]/g,""),this.ruleList[t].length=e.length},changeDate:function(t){var e=this.ruleList[t].value,i="";this.dateType.map(function(t){t.value==e&&(i=t.label.length)}),this.ruleList[t].length=i},saveInfo:function(){if(this.checkRuleList()){var t=this.addEntity.docEntity;this.addEntity.docName=t.docName,this.addEntity.tabName=t.tabName,this.addEntity.tabField=t.fieldName,this.addEntity.ruleList=this.ruleList;var e=this.addEntity.id;$.isEmptyObject(String(e))?this.saveRequest(this.addEntity):this.updateRequest(this.addEntity)}},saveRequest:function(t){$.ajax({type:"post",url:contextPath+"/docAutoFieldCode/save",contentType:"application/json",data:JSON.stringify(t),dataType:"json",success:function(t){"100100"===t.code?FileCodeVM.$Modal.info({title:"提示",okText:"确定",content:"操作成功!",onOk:function(){}}):FileCodeVM.$Modal.warning({title:"提示",okText:"确定",content:t.msg,onOk:function(){}})}})},updateRequest:function(t){$.ajax({type:"post",url:contextPath+"/docAutoFieldCode/update",contentType:"application/json",data:JSON.stringify(t),dataType:"json",success:function(t){console.log(t),"100100"===t.code?FileCodeVM.$Modal.info({title:"提示",okText:"确定",content:"操作成功!",onOk:function(){}}):FileCodeVM.$Modal.warning({title:"提示",okText:"确定",content:t.msg,onOk:function(){}})}})},checkRuleList:function(){var t=this.ruleList;if(null!=t&&null!=t&&0<t.length){for(var e=0,i=0,n=0,a=0;a<t.length;a++){var s=t[a];1===s.type&&(e+=1),2===s.type&&(i+=1),3===s.type&&(n+=1)}return 1<e?(this.messageTip("warn","只能定义一个常量规则"),!1):1<i?(this.messageTip("warn","只能定义一个日期规则"),!1):1<n?(this.messageTip("warn","只能定义一个流水号规则"),!1):0==e&&0==n&&0==i?(this.messageTip("warn","请添加编码规则信息"),!1):1==e&&0==i&&0==n?(this.messageTip("warn","只有常量规则无法保证单据编码唯一,请定义日期、流水号规则"),!1):0==e&&0==n&&1==i?(this.messageTip("warn","只有日期规则无法保证单据编码唯一,请定义常量、流水号规则"),!1):1!=e||1!=i||0!=n||(this.messageTip("warn","只有常量、日期规则无法保证单据编码唯一,请定义流水号规则"),!1)}return this.messageTip("warn","请添加编码规则信息"),!1},messageTip:function(t,e){"warn"==t?FileCodeVM.$Modal.warning({title:"提示",okText:"确定",content:e,onOk:function(){}}):FileCodeVM.$Modal.info({title:"提示",okText:"确定",content:e,onOk:function(){}})},lenInput:function(t){var e=this.ruleList[t].length;if(e<1)return this.$Modal.info({content:"请输入大于0的数"}),void(this.ruleList[t].length="");for(var i="",n=0;n<e;n++)i+="9";this.ruleList[t].numStop=i,this.ruleList[t].numStart=1,this.ruleList[t].numStep=1},getSysDocumentData:function(){$.ajax({type:"POST",url:contextPath+"/sysDocument/list",contentType:"application/json",dataType:"json",success:function(t){"100100"===t.code&&(FileCodeVM.docListData=t.data)}})},getDocCategoryData:function(){this.docCategory=layui.data("dict")._document_sort,console.log(this.docCategory)},getFieldCodeEntity:function(t){$.ajax({type:"POST",url:contextPath+"/docAutoFieldCode/info/"+t,contentType:"application/json",dataType:"json",success:function(t){if("100100"===t.code){var e=t.data;FileCodeVM.addEntity.id=e.id,FileCodeVM.addEntity.docEntity.docName=e.docName,FileCodeVM.addEntity.docEntity.tabName=e.tabName,FileCodeVM.addEntity.category=e.category,FileCodeVM.ruleList=e.ruleList}}})},getIndex:function(t){this.selectedIndex!=t||""===this.selectedIndex?(this.selectedIndex=t,$(".tdInfo").eq(this.selectedIndex).addClass("tr-back").siblings().removeClass("tr-back")):($(".tdInfo").eq(this.selectedIndex).removeClass("tr-back"),this.selectedIndex="")},del:function(){""===this.selectedIndex?this.$Modal.info({content:"请选择需要删除的下标"}):(this.ruleList.splice(this.selectedIndex,1),$(".tdInfo").removeClass("tr-back"),this.delIndex="")}},mounted:function(){this.getSysDocumentData(),this.getDocCategoryData();var t=window.parent.params.params,e=t.type;if("update"===e){var i=t.id;this.getFieldCodeEntity(i)}if("view"===e){var n=t.id;this.temp=!0,console.log(n),this.getFieldCodeEntity(n)}}});