"use strict";function _defineProperty(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}var ztree,setting={data:{simpleData:{enable:!0,idKey:"id",pIdKey:"parentId",rootPId:0,type:"type"},key:{url:"nourl"}},check:{nocheckInherit:!0},view:{fontCss:{color:"blue","font-family":"微软雅黑","font-size":"16px"}},callback:{onClick:onClick}};function onClick(e,n,t){var i=$.fn.zTree.getZTreeObj("treeDemo").getSelectedNodes(),o="";i.sort(function(e,n){return e.id-n.id});for(var a=0,s=i.length;a<s;a++)o+=i[a].name+",";0<o.length&&(o=o.substring(0,o.length-1)),MenuVM.addBody.parentId=$.fn.zTree.getZTreeObj("treeDemo").getSelectedNodes()[0].id,MenuVM.treeNameInfo=o,console.log(MenuVM),hideMenu()}function _showMenu(){$("#info"),$("#info").offset();$("#menuContent").css({left:"15px",top:"26px"}).slideDown("fast"),$("body").bind("mousedown",onBodyDown)}function hideMenu(){$("#menuContent").fadeOut("fast"),$("body").unbind("mousedown",onBodyDown)}function onBodyDown(e){"menuBtn"==e.target.id||"menuContent"==e.target.id||0<$(e.target).parents("#menuContent").length||hideMenu()}var MenuVM=new Vue({el:"#menu-info",data:function(){var e;return _defineProperty(e={clickId:"",clickName:"",treeNameInfo:"",treeFlag:!1,setting:{view:{showLine:!1,addDiyDom:this.addDiyDom},data:{simpleData:{enable:!0}},callback:{onClick:this.zTreeOnClick}},isUpdate:!1,isShow:!1,isEdit:!1,isLook:!1,ishides:!0,saveStaus:"",buttonListShow:!1,parentSpan:!1,parentRequired:!1,urlDisabled:!0,urlSpan:!1,urlRequired:!1,permissionDisabled:!0,permissionSpan:!1,permissionRequired:!1,isMenuTreeShow:!1,reload:!1},"parentRequired",!1),_defineProperty(e,"selected",[]),_defineProperty(e,"selectedView",[]),_defineProperty(e,"Constant",{SUCCESS_CODE:"100100"}),_defineProperty(e,"confirmConfig",{showConfirm:!1,title:"提示",content:"请点击确认",onlySure:!0,success:!0}),_defineProperty(e,"status",[{label:"有效",value:1},{label:"无效",value:0}]),_defineProperty(e,"menuType",[{value:0,name:"目录"},{value:1,name:"菜单"}]),_defineProperty(e,"body",{name:"",whetherDisable:""}),_defineProperty(e,"addBody",{id:"",name:"",url:"",icon:"",permission:"",remark:"",parentId:"",sysButtonList:"",type:"0"}),_defineProperty(e,"zNodes",[]),_defineProperty(e,"parent",[]),_defineProperty(e,"buttonListLeft",[]),_defineProperty(e,"buttonListRight",[]),_defineProperty(e,"buttonIds",[]),_defineProperty(e,"data_config",{url:contextPath+"/menu/menuListPage",colNames:["序号","菜单名称","权限标识","类型","菜单图标","url地址","状态"],colModel:[{name:"id",index:"id",width:100,align:"center"},{name:"name",index:"name",width:200,align:"center"},{name:"permission",index:"permission",width:200,align:"center"},{name:"type",index:"type",width:100,align:"center",formatter:function(e,n,t,i){return 0==e?"目录":"菜单"}},{name:"icon",index:"icon",width:200,align:"center"},{name:"url",index:"url",width:400,align:"left"},{name:"status",index:"status",width:80,align:"center",formatter:function(e,n,t,i){return 0==e?"正常":"禁用"}}]}),e},methods:{refresh:function(){this.product()},zTreeOnClick:function(){var e=arguments.length<=2?void 0:arguments[2],n=$.fn.zTree.getZTreeObj("dataTree").getSelectedNodes();0<n.length&&(this.treeFlag=n[0].isParent),this.clickId=e.id,this.clickName=e.name},addDiyDom:function(e,n){var t=$("#"+n.tId),i=$("#"+n.tId+"_a"),o=$("#"+n.tId+"_switch"),a=$("#"+n.tId+"_ico"),s=$("#"+n.tId+"_span");i.attr("title",""),i.removeAttr("href"),i.append('<div class="divTd swich fnt" style="width:20%"></div>');var r=$(t).find("div").eq(0);o.remove(),s.remove(),a.remove(),r.append(o),r.append(s);var d="<span style='height:1px;display: inline-block;width:"+15*n.level+"px'></span>";o.before(d),a.css("margin-top","9px"),o.after(a);var u="";u+='<div class="divTd" style="width:5%">'+(null==n.id?"":n.id)+"</div>",u+='<div class="divTd" style="width:15%">'+(null==n.permission?"":n.permission)+"</div>",u+='<div class="divTd" style="width:10%">'+(0==n.type?"目录":"菜单")+"</div>",u+='<div class="divTd" style="width:10%">'+(null==n.icon?"":n.icon)+"</div>",u+='<div class="divTd" style="width:30%">'+(null==n.url?"":n.url)+"</div>",u+='<div class="divTd" style="width:10%">'+(0==n.status?"正常":"异常")+"</div>",i.append(u)},queryHandler:function(e){$.fn.zTree.init($("#dataTree"),this.setting,e);var n=' <li class="head"><span><div class="divTd" style="width:20%">菜单名称</div><div class="divTd" style="width:5%">序号</div><div class="divTd" style="width:15%">权限标识</div><div class="divTd" style="width:10%">类型</div><div class="divTd" style="width:10%">菜单图标</div><div class="divTd" style="width:30%">url地址</div><div class="divTd" style="width:10%">状态</div></span></li>',t=$("#dataTree").find("li");0<t.length?t.eq(0).before(n):($("#dataTree").append(n),$("#dataTree").append('<li ><div style="text-align: center;line-height: 30px;" >无符合条件数据</div></li>'))},search:function(){this.reload=!this.reload},clear:function(){this.body={name:"",status:""}},view:function(){if(this.clickId){var e=this.clickId;console.log(e),null!=e&&null!=e&&(MenuVM.queryAllButton(),this.viewInfo(e))}else this.$Modal.info({content:"请选中需要修改的行"})},viewInfo:function(e){this.modifyInfo(e),MenuVM.saveStaus="view"},add:function(){this.isShow=!0;if(this.queryParentMenu(),this.queryAllButton(),this.typeChangeCatalog(),this.treeFlag){var e=this.clickId;MenuVM.addBody.parentId=e,this.treeNameInfo=this.clickName}},queryParentMenu:function(){var t=this;$.ajax({url:contextPath+"/menu/queryParentMenu",method:"post",dataType:"json",data:{},success:function(e){MenuVM.parent=e.data,e.data.map(function(e){var n={};n.name=e.name,t.zNodes.push(n)});for(var n=0;n<t.zNodes.length;n++)t.zNodes[n].id=n,t.zNodes[n].pId=n},error:function(e){}})},queryAllButton:function(){$.ajax({url:contextPath+"/button/queryAllButton",type:"post",dataType:"json",data:null,success:function(e){"100100"==e.code&&(console.log(e.data),MenuVM.buttonListLeft=[].concat(e.data))},error:function(e){}})},save:function(){if("view"!==MenuVM.saveStaus){if($("form").valid()){var e=this.addBody;$.isEmptyObject(String(e.id))?this.insertMenuButton(e):this.updateMenuButton(e)}}else layer.alert("查看不能修改页面数据")},modify:function(){if(this.clickId)if(this.treeFlag)this.$Modal.info({content:"不可修改父节点"});else{var e=this.clickId;console.log(e),null!=e&&null!=e&&(MenuVM.queryAllButton(),this.modifyInfo(e))}else this.$Modal.info({content:"请选中需要修改的行"})},modifyInfo:function(e){console.log(e),$.ajax({type:"POST",url:contextPath+"/menu/menuInfo/"+e,dataType:"json",success:function(e){if(e.code===MenuVM.Constant.SUCCESS_CODE){var n=e.data;if(0===n.type)MenuVM.typeChangeCatalog();else{MenuVM.typeChangeMenu();var t=n.menuButtonList;MenuVM.selectedButtonProcess(t,n)}MenuVM.addBody={id:n.id,name:n.name,url:n.url,icon:n.icon,permission:n.permission,remark:n.remark,parentId:n.parentId,sysButtonList:"",type:n.type};var i=n.parentId,o=$.fn.zTree.getZTreeObj("dataTree").getNodesByParam("id",i,null);MenuVM.treeNameInfo=o[0].name,MenuVM.isShow=!0,MenuVM.buttonListShow=!0,MenuVM.queryParentMenu()}},error:function(){console.log(1)}})},treeBackShow:function(e,n){var t=$.fn.zTree.getZTreeObj("treeDemo");console.log("zTree===>"+t);var i=t.getNodeByParam(e,n);t.cancelSelectedNode(),t.selectNode(i,!0)},selectedButtonProcess:function(e,n){for(var t in e){var i=e[t];if(0===i.status){var o=i.buttonId;MenuVM.buttonIds.push(o);var a={};a.id=o,a.menuId=n.id,a.permission=i.permission,a.status=i.status,MenuVM.selectedView.push(a)}}},updateMenuButton:function(e){var n=this.updateParamProcess();e.menuButtonList=n,$.ajax({type:"POST",url:contextPath+"/menu/updateMenu",data:JSON.stringify(e),dataType:"json",contentType:"application/json;charset=utf-8",success:function(e){"100100"===e.code?(layer.alert("修改成功"),MenuVM.isShow=!1,MenuVM.reload=!MenuVM.reload):layer.alert(e.msg)},error:function(e){console.log("服务器出错")}})},updateParamProcess:function(){var e=[],n=MenuVM.buttonList,t=new Map;for(var i in n){var o=n[i];t.set(o.id,o)}var a=MenuVM.selectedView,s=new Map;for(var i in a){o=a[i];s.set(o.id,o)}e=new Array;var r=MenuVM.buttonIds;for(var i in r){var d=r[i];if(s.has(d)){o={};var u=s.get(d);o.buttonId=u.id,o.menuId=u.menuId,o.status=u.status,o.permission=u.permission,e.push(o)}if(t.has(d)&&!s.has(d)){o={},u=t.get(d);o.buttonId=u.id,o.menuId="",o.status=0,o.permission=u.permission,e.push(o)}}var l=new Map;for(var i in e){o=e[i];l.set(o.buttonId,o)}for(var i in a){o=a[i];if(!l.has(o.id)){u=s.get(o.id);(o={}).buttonId=u.id,o.menuId=u.menuId,o.status=1,o.permission=u.permission,e.push(o)}}return e},insertMenuButton:function(e){var n=this.buttonIds,t=new Array;for(var i in n){var o=new Object,a=n[i];for(var s in MenuVM.buttonList)a===MenuVM.buttonList[s].id&&(o.permission=MenuVM.buttonList[s].permission);o.id=a,t.push(o)}e.buttonList=t,$.ajax({type:"POST",url:contextPath+"/menu/insertSysMenu",data:JSON.stringify(e),dataType:"json",contentType:"application/json;charset=utf-8",success:function(e){e.code===MenuVM.Constant.SUCCESS_CODE?(layer.alert("添加菜单成功"),MenuVM.cancel()):layer.alert(e.msg)},error:function(e){console.log("服务器出错")}})},del:function(){if(this.clickId)if(this.treeFlag)this.$Modal.info({content:"不可删除父节点"});else{var e=this.clickId;$.ajax({type:"POST",url:contextPath+"/menu/delMenuById/"+e,data:"",dataType:"json",success:function(e){"100100"===e.code?(layer.alert("删除成功"),MenuVM.reload=!MenuVM.reload):console.log(e.msg)},error:function(e){console.log("服务器出错")}})}else this.$Modal.info({content:"请选中需要删除的行"})},cancel:function(){this.clearAddBody(),this.isShow=!1,this.isEdit=!1,this.selected=[]},clearAddBody:function(){this.addBody={id:"",name:"",url:"",icon:"",permission:"",remark:"",parentId:[],status:"",type:"0"}},typeChange:function(e){"0"===MenuVM.addBody.type?this.typeChangeCatalog():this.typeChangeMenu()},typeChangeCatalog:function(){MenuVM.buttonListShow=!1,MenuVM.urlDisabled=!0,MenuVM.urlSpan=!1,MenuVM.urlRequired=!1,MenuVM.addBody.url="",MenuVM.permissionDisabled=!0,MenuVM.permissionSpan=!1,MenuVM.permissionRequired=!1,MenuVM.addBody.permission="",MenuVM.parentSpan=!1,MenuVM.parentRequired=!1},typeChangeMenu:function(){MenuVM.buttonListShow=!0,MenuVM.urlDisabled=!1,MenuVM.urlSpan=!0,MenuVM.urlRequired=!0,MenuVM.addBody.url="",MenuVM.permissionDisabled=!1,MenuVM.permissionSpan=!0,MenuVM.permissionRequired=!0,MenuVM.addBody.permission="",MenuVM.parentSpan=!0,MenuVM.parentRequired=!0},showMenu:function(){_showMenu(),this.initTree()},initTree:function(){$.get(contextPath+"/menu/parentMenuTree",function(e){console.log(e.data),ztree=$.fn.zTree.init($("#treeDemo"),setting,e.data)})},product:function(){var t=this;$.ajax({url:contextPath+"/menu/queryAllMenu",type:"post",dataType:"json",success:function(e){var n=e.data;n.map(function(e){e.pId=e.parentId}),t.queryHandler(n)},error:function(){console.log(123123)}})},sideHandleSuccess:function(e){"100100"===e.code&&(this.addBody.icon=e.data.fdUrl)},handleFormatError:function(e){this.$Modal.error({content:"文件格式不正确,请重新选择"})},handleMaxSize:function(e){this.$Modal.error({content:"文件过大,请重新选择"})},delFile:function(e,n){this.addBody.icon=null}},created:function(){},mounted:function(){this.product()}});