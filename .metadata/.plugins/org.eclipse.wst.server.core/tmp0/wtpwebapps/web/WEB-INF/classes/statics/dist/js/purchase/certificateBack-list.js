"use strict";function _defineProperty(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}var pendingList=new Vue({el:"#pendingList",data:function(){return{openTime:"",isSearchHide:!0,isTabulationHide:!0,isShow:!1,isHide:!0,isEdit:!1,reload:!1,selected:[],categoryType:[],commodityCategoty:[],empList:[],supplierList:[],dateArr:[],id:"",body:{goodsTypePath:"",certificateType:"",supplierId:"",orderStatus:"",startTime:"",endTime:""},data_config:{url:contextPath+"/certificateBackInfo/listPage",colNames:["id","单据编号","日期","供应商","商品类型","业务类型","证书类型","证书数量","单据状态","收货数量","证书费用","总成本"],colModel:[{name:"id",hidden:!0},{name:"orderNo",index:"orderNo",width:180,align:"left",formatter:function(t,e,i,n){return $(document).off("click",".detail"+t).on("click",".detail"+t,function(){pendingList.id=i.id,pendingList.view()}),'<a class="detail'+t+'">'+t+"</a>"},unformat:function(t,e,i){return t.replace(/(<\/?a.*?>)/g,"")}},{name:"receiptDate",index:"receiptDate",width:180,align:"left",formatter:function(t,e,i,n){return new Date(t).format("yyyy-MM-dd")}},_defineProperty({name:"supplier",index:"supplier",width:180,align:"center"},"align","left"),{name:"goodsTypeName",index:"goodsTypeName",align:"left",width:180},{name:"businessType",index:"businessType",align:"left",width:180,formatter:function(t,e,i,n){return"P_CREDENTIAL_OUT_01"==t?"标配证书":"P_CREDENTIAL_OUT_02"==t?"特殊证书":""}},{name:"certificateType",index:"certificateType",width:180,align:"left"},{name:"certificateNum",index:"certificateNum",width:180,align:"left"},{name:"orderStatus",index:"orderStatus",width:180,align:"left",formatter:function(t,e,i,n){return 1==t?"暂存":2==t?"待审核":3==t?"审核中":4==t?"已审核":5==t?"驳回":""}},{name:"receiptCount",index:"receiptCount",width:180,align:"left"},{name:"certificateCost",index:"certificateCost",width:180,align:"left"},{name:"totalCost",index:"totalCost",width:180,align:"left"}],shrinkToFit:!1}}},methods:{search:function(){0<this.commodityCategoty.length?this.body.goodsTypePath=this.commodityCategoty[this.commodityCategoty.length-1]:this.body.goodsTypePath="",0<this.dateArr.length&&this.dateArr[0]&&this.dateArr[1]?(this.body.startTime=this.dateArr[0].format("yyyy-MM-dd HH:mm:ss"),this.body.endTime=this.dateArr[1].format("yyyy-MM-dd HH:mm:ss")):(this.body.startTime="",this.body.endTime=""),this.reload=!this.reload},loadProductType:function(){var e=this;$.ajax({type:"post",url:contextPath+"/documentController/getCategory?parentId=0",contentType:"application/json",dataType:"json",success:function(t){e.categoryType=e.initGoodCategory(t.data.cateLists)},error:function(t){console.log("服务器出错")}})},changeCategory:function(t){this.body.goodsTypePath=t[t.length-1]},initGoodCategory:function(t){var a=this,o=[];return t.forEach(function(t){var e=t.customCode,i=t.name,n=t.cateLists;n&&(n=a.initGoodCategory(n)),o.push({value:e,label:i,children:n})}),o.forEach(function(t){t.children||delete t.children}),o},getSupplierList:function(){$.ajax({type:"post",url:contextPath+"/waitCertiBackInfo/getSupplierList",data:{},success:function(t){if(""!=t.data)for(var e=0;e<t.data.length;e++)pendingList.supplierList.push({id:t.data[e].id,supplier:t.data[e].siShortName})}})},clear:function(){this.body={goodsTypePath:"",certificateType:"",supplierId:"",orderStatus:"",startTime:"",endTime:""};this.commodityCategoty=[],this.dateArr=[],jQuery("#myTable").jqGrid("clearGridData"),jQuery("#myTable").jqGrid("setGridParam",{postData:{goodsTypePath:"",certificateType:"",supplierId:"",orderStatus:"",startTime:"",endTime:""}}).trigger("reloadGrid")},refresh:function(){this.body={goodsTypePath:"",certificateType:"",supplierId:"",orderStatus:"",startTime:"",endTime:""},this.reload=!this.reload},add:function(){window.parent.activeEvent({name:"新增证书商品收回单",url:contextPath+"/purchase/certificate-back-report/certificate-back-add.html",params:{type:"add"}})},del:function(){for(var t=[],e=0;e<this.selected.length;e++)t.push(this.selected[e].id);if(0==t.length)return pendingList.$Modal.warning({title:"提示信息",content:"<p>请选择</p>"}),!1;this.$Modal.confirm({title:"提示信息",content:"<p>是否删除信息？</p>",onOk:function(){$.ajax({type:"post",url:contextPath+"/certificateBackInfo/delete",contentType:"application/json",data:JSON.stringify(t),dataType:"json",success:function(t){"100100"===t.code&&""===t.data?setTimeout(function(){pendingList.$Modal.success({content:"删除成功",onOk:function(){pendingList.reload=!pendingList.reload}})},300):"100100"===t.code&&""!=t.data?setTimeout(function(){pendingList.$Modal.warning({content:t.data,onOk:function(){pendingList.reload=!pendingList.reload}})},300):(pendingList.$Modal.warning({content:"删除失败",onOk:function(){pendingList.reload=!pendingList.reload}}),pendingList.reload=!pendingList.reload)},error:function(t){pendingList.$Modal.error({content:"服务器错误",closable:!0})}})}})},update:function(){var t=this;return 1<t.selected.length?(t.$Modal.warning({title:"提示信息",content:"<p>请单选</p>"}),!1):0==t.selected.length?(t.$Modal.warning({title:"提示信息",content:"<p>请选择</p>"}),!1):void window.parent.activeEvent({name:"修改证书商品收回单",url:contextPath+"/purchase/certificate-back-report/certificate-back-add.html",params:{type:"update",id:t.selected[0].id}})},view:function(){window.parent.activeEvent({name:"查看证书商品收回单",url:contextPath+"/purchase/certificate-back-report/certificate-back-add.html",params:{type:"update",id:this.id}})},print:function(){},annex:function(){},cancel:function(){window.parent.closeCurrentTab({exit:!0,openTime:this.openTime})},preView:function(){}},created:function(){this.getSupplierList(),this.loadProductType()},watch:{},mounted:function(){this.openTime=window.parent.params.openTime}});