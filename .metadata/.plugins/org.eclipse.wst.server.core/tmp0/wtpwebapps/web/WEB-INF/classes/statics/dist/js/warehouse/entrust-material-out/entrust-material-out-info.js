"use strict";var _methods;function _defineProperty(t,e,o){return e in t?Object.defineProperty(t,e,{value:o,enumerable:!0,configurable:!0,writable:!0}):t[e]=o,t}var vm=new Vue({el:"#app",data:{isShow:!1,reload:!1,isSearchHide:!0,isTabulationHide:!0,detailIndex:"",showProductProperty:!1,showAll:!1,showCust:!1,tabValid:!1,showBody:!1,showProduct:!1,isClick:!1,isGoodsBarcode:!1,isStampShow:!1,isCustId:!0,showSupplier:!1,showProductType:!1,showWeight:!1,isReadonly:!1,isExecuteGoodsNo:!0,isExecuteAdd:!0,detailType:"",orderStatus:"",goodsMainType:"",RepertoryPositionGroupId:"",warehouseId:"",custIdTemp:"",selectedIndex:0,tabVal:"name1",goodsValue:[],stepList:[],modalTrigger:!1,modalType:"",approvalTableData:[],openTime:"",productDetailModal:{showModal:!1,ids:{goodsId:"",commodityId:"",documentType:"W_EMATERIAL_OUT"}},categoryType:[],selectLogisticMode:[],selectBusinessType:[{value:"W_CMATERIAL_OUT_01",label:"受托加工送料"},{value:"W_CMATERIAL_OUT_02",label:"受托加工退料"}],supplierList:[],custList:[],salesmanList:[],countingUnitList:[],weightUnitList:[],warehouseList:[],reservoirPositionList:[],options:[],unitMap:[],selectedProductType:[],goodsNoOptions:[],goodsNoOptionsTemp:[],barCodeOptions:[],params:{},body:{documentNo:"",documentType:"W_EMATERIAL_OUT",documentStatus:1,organizationId:"",organizationName:"",documentTime:new Date,remark:"",goodsTypeName:"",customCode:"",supplierId:"",supplierCode:"",supplierName:"",custId:"",custCode:"",custName:"",salesmanId:"",salesmanName:"",logisticsWay:"",businessType:"",createName:"",createTime:"",updateTime:"",updateName:"",examineVerifyName:"",examineVerifyTime:"",goodList:[]},outDetailEntity:[],outDetailEntityTemp:{},selectedIndex1:0,selectTab:!0,codesUsed:{}},methods:(_methods={approval:function(){var t=this;if(1===t.body.documentStatus||!t.body.documentNo)return t.$Modal.error({title:"警告!",content:"请先提交单据!"}),console.log(2334,t.body.documentStatus),!1;t.modalType="approve",t.modalTrigger=!t.modalTrigger,console.log(322277,t.body.documentStatus)},reject:function(){var t=this;if(1===t.body.documentStatus||!t.body.documentNo)return t.$Modal.error({title:"警告!",content:"请先提交单据!"}),!1;t.modalType="reject",t.modalTrigger=!t.modalTrigger},approvalOrRejectCallBack:function(t){var e=this;if("100100"==t.result.code)if(e.body.documentStatus=t.result.data,1==e.body.documentStatus)e.isStampShow=!1,e.body.examineVerifyName="",e.body.examineVerifyTime="",e.isEdit("Y"),$(".is-submit-disabled").css({"pointer-events":"auto "}).css({color:"#495060"}),e.outDetailEntity&&0<e.outDetailEntity.length&&e.outDetailEntity[0].sourceNo?(e.showBody=!0,e.isClick=!0,e.showProduct=!0,e.showAll=!1):(e.showAll=!1,e.showBody=!1,e.isClick=!1,e.showProduct=!1,e.showSupplier=!1,e.showCust=!1);else if(2==e.body.documentStatus);else if(3==e.body.documentStatus);else if(4==e.body.documentStatus)e.isStampShow=!0,e.body.examineVerifyName=layui.data("user").username,e.body.examineVerifyTime=(new Date).format("yyyy-MM-dd HH:mm:ss")||"",$(".is-htPrint").css({"pointer-events":"auto "}).css({color:"#495060"});else if(5!=e.body.documentStatus)return e.$Modal.warning({content:"审核异常!",title:"警告"}),!1},autoSubmitOrReject:function(t){var e=this;$.ajax({url:contextPath+"/entrustOut/submitapproval?submitType=1",method:"post",contentType:"application/json;charset=utf-8",data:JSON.stringify({receiptsId:e.psiForm.stockNo,approvalResult:"reject"==e.modalType?1:0}),success:function(t){"100100"===t.code?1==e.body.documentStatus?(e.isStampShow=!1,e.body.examineVerifyName="",e.body.examineVerifyTime="",e.isEdit("Y"),$(".is-submit-disabled").css({"pointer-events":"auto "}).css({color:"#495060"}),e.outDetailEntity&&0<e.outDetailEntity.length&&e.outDetailEntity[0].sourceNo?(e.showBody=!0,e.isClick=!0,e.showProduct=!0,e.showAll=!1):(e.showAll=!1,e.showBody=!1,e.isClick=!1,e.showProduct=!1,e.showSupplier=!1,e.showCust=!1)):4==e.body.documentStatus&&(e.isStampShow=!0,e.body.examineVerifyName=layui.data("user").username,e.body.examineVerifyTime=(new Date).format("yyyy-MM-dd HH:mm:ss")||""):e.$Modal.warning({content:t.msg})}})},ajaxUpdateDocStatusById:function(t,e){var o=this;$.ajax({url:contextPath+"/entrustOut/updateDocumentStatusByid",method:"POST",dataType:"json",contentType:"application/json;charset=utf-8",data:JSON.stringify({id:t,documentStatus:e}),success:function(t){"100100"==t.code&&(o.body.documentStatus=e)}})},isEdit:function(t){eventHub.$emit("isEdit",t)},saveAccess:function(t,e){eventHub.$emit("saveFile",t,e)},getAccess:function(t,e){eventHub.$emit("queryFile",t,e)},showProductDetail:function(t){var e=this;if(e.detailType="CODING",e.orderStatus=e.body.documentStatus,e.goodsMainType=e.outDetailEntity[t].goodsMainType,e.selectedIndex=t,e.outDetailEntity[t].commodityId){if(!e.outDetailEntity[t].baileeNum){if(e.outDetailEntity[t].sourceNo)o={goodsId:e.outDetailEntity[t].goodsLineNo,commodityId:e.outDetailEntity[t].commodityId,documentType:"W_REQUISITION"};else var o={goodsId:e.outDetailEntity[t].id,commodityId:e.outDetailEntity[t].commodityId,documentType:"W_EMATERIAL_OUT"};Object.assign(e.productDetailModal,{showModal:!0,ids:o}),e.$nextTick(function(){e.$refs.modalRef.getProductDetail()})}}else e.$Modal.warning({title:"提示信息",content:"请先选择商品编码"})},showBarcodeDetail:function(t){var e=this;if(e.outDetailEntityTemp.goodsEntities[t].goodsBarcode){e.detailType="BARCODE",e.orderStatus=2,e.goodsMainType=e.outDetailEntityTemp.goodsEntities[t].goodsMainType;var o={goodsId:e.outDetailEntityTemp.goodsEntities[t].id,commodityId:"",documentType:"W_STOCK_IN"};Object.assign(e.productDetailModal,{showModal:!0,ids:o}),e.$nextTick(function(){e.$refs.modalRef.getProductDetail()})}else e.$Modal.warning({title:"提示信息",content:"请先选择商品条码"})},modalSure:function(t){"CODING"===this.detailType?this.productDetailModalClick(t):"BARCODE"===this.detailType&&(this.outDetailEntity[selectedIndex].overEdit=!1)},modalCancel:function(t){},productDetailModalClick:function(t){"attr_ranges_goods"===this.outDetailEntity[this.selectedIndex].goodsMainType?Object.assign(this.outDetailEntity[this.selectedIndex],{tBaseBomEntity:t,assistAttrs:null,overEdit:!0}):Object.assign(this.outDetailEntity[this.selectedIndex],{assistAttrs:t,tBaseBomEntity:null,overEdit:!0})},validateProduct:function(){var o=!0,i=this;return $.each(i.outDetailEntity,function(t,e){return!!e.id||(e.assistAttrs?void 0:(o=!1,i.$Modal.error({content:"第"+(t+1)+"行商品明细未选择，请先选择商品明细！"}),!1))}),o},commonTransferData:function(){var t=!0,e=!1,o=void 0;try{for(var i,s=this.supplierList[Symbol.iterator]();!(t=(i=s.next()).done);t=!0){var n=i.value;if(n.id===this.body.supplierId){this.body.supplierName=n.supplierName,this.body.supplierCode=n.supplierCode;break}}}catch(t){e=!0,o=t}finally{try{!t&&s.return&&s.return()}finally{if(e)throw o}}var a=!0,r=!1,d=void 0;try{for(var u,c=this.custList[Symbol.iterator]();!(a=(u=c.next()).done);a=!0){var l=u.value;if(l.id===this.body.custId){this.body.custName=l.name,this.body.custCode=l.code;break}}}catch(t){r=!0,d=t}finally{try{!a&&c.return&&c.return()}finally{if(r)throw d}}var y=!0,p=!1,h=void 0;try{for(var m,f=this.salesmanList[Symbol.iterator]();!(y=(m=f.next()).done);y=!0){var g=m.value;if(g.id===this.body.salesmanId){this.body.salesmanName=g.empName;break}}}catch(t){p=!0,h=t}finally{try{!y&&f.return&&f.return()}finally{if(p)throw h}}this.body.documentTime||(this.body.documentTime=(new Date).format("yyyy-MM-dd")||"")},handlerDataToPost:function(){var t={id:"",commodityId:"",pictureUrl:"",goodsNo:"",goodsName:"",goodsMainType:"",baileeNum:"",goodsNorm:"",countingUnit:"",weightUnit:"",weight:"",weightUnitId:"",countingUnitId:"",warehouseId:"",reservoirPositionId:"",RepertoryPositionGroupId:"",sourceId:"",sourceNo:"",stonesParts:[],materialParts:[],partParts:[],goldParts:[]},o=this.body;console.log("处理前表头的数据结构:",o),o.goodList=[JSON.parse(JSON.stringify(t))],console.log("商品简述数据",this.outDetailEntity);var e=htHandlerProductDetail(this.outDetailEntity,o,t);return console.log("经过处理后的数据结构为：",e),this.outDetailEntity.map(function(t,e){o.goodList[e]||(o.goodList[e]={}),Object.assign(o.goodList[e],{commodityId:t.commodityId,pictureUrl:t.pictureUrl,goodsNo:t.goodsNo,goodsName:t.goodsName,goodsNorm:t.goodsNorm,goodsMainType:t.goodsMainType,baileeNum:t.baileeNum,countingUnit:t.countingUnit,weightUnit:t.weightUnit,weight:t.weight,id:t.id,weightUnitId:t.weightUnitId,countingUnitId:t.countingUnitId,warehouseId:t.warehouseId,reservoirPositionId:t.reservoirPositionId,RepertoryPositionGroupId:t.RepertoryPositionGroupId,goodsEntities:t.goodsEntities,sourceId:t.sourceId,sourceNo:t.sourceNo})}),o},tableValidate:function(){return htValidateRow(this.outDetailEntity,{commodityId:{name:"商品编码",type:"string"},baileeNum:{name:"数量",type:"number",floor:0,empty:!0},weight:{name:"总重",type:"number",floor:3}})},submitVerify:function(){var e=this,t=[],o=!0,i=!1,s=void 0;try{for(var n,a=e.outDetailEntity[Symbol.iterator]();!(o=(n=a.next()).done);o=!0){var r=n.value;t.push(r.sourceId)}}catch(t){i=!0,s=t}finally{try{!o&&a.return&&a.return()}finally{if(i)throw s}}$.ajax({type:"post",url:contextPath+"/entrustOut/submitVerify",contentType:"application/json",data:JSON.stringify(t),dataType:"json",success:function(t){if("100100"===t.code&&t.data&&0<t.data.length)return e.$Modal.warning({title:"提示信息",content:t.data.join(", ")+" 商品编码已被提交,当前单据无法提交"}),!0},error:function(){alert("服务器出错啦")}})},save:function(o){this.tabValid=!1;var i=this;if(1===i.body.documentStatus){if("name2"===i.tabVal&&i.crolMark("name1"),"submit"===o&&i.outDetailEntity&&0<i.outDetailEntity.length&&i.outDetailEntity[0].sourceNo){if(!$("form").valid())return!1}else if("submit"===o&&(!$("form").valid()||i.tableValidate()))return!1;if("submit"===o&&i.outDetailEntity&&0<i.outDetailEntity.length&&i.outDetailEntity[0].sourceNo&&i.submitVerify())return!1;if(i.outDetailEntity&&0<i.outDetailEntity.length){for(var t=0;t<i.outDetailEntity.length;t++)if("attr_ranges_gold"!==i.outDetailEntity[t].goodsMainType){if(!i.outDetailEntity[t].baileeNum||!i.outDetailEntity[t].goodsEntities)return i.$Modal.warning({title:"提示！",content:"第"+(t+1)+"行商品简述列表里的数量与商品明细列表的长度不一致，请补全数据!"}),!1;if(i.outDetailEntity[t].baileeNum&&i.outDetailEntity[t].goodsEntities&&i.outDetailEntity[t].baileeNum!=i.outDetailEntity[t].goodsEntities.length)return i.$Modal.warning({title:"提示！",content:"第"+(t+1)+"行商品简述列表里的数量与商品明细列表的长度不一致，请补全数据!"}),!1}}else if("submit"===o)return i.$Modal.warning({title:"提示！",content:"请添加商品简述列表数据!"}),!1;for(var e=0;e<i.outDetailEntity.length;e++)if("attr_ranges_gold"!==i.outDetailEntity[e].goodsMainType)for(var s=0;s<i.outDetailEntity[e].goodsEntities.length;s++)if(!i.outDetailEntity[e].goodsEntities[s].goodsBarcode)return i.$Modal.warning({title:"提示！",content:"第"+(e+1)+"行商品简述列表里的商品明细列表的第"+(s+1)+"行内容为空!"}),!1;i.body.documentStatus="save"===o?1:2,i.commonTransferData();var n=i.handlerDataToPost();window.top.home.loading("show"),$.ajax({type:"post",url:contextPath+"/entrustOut/save",contentType:"application/json;charset=utf-8",data:JSON.stringify(n),dataType:"json",success:function(t){var e="save"===o?"保存":"提交";if("100100"===t.code)return i.$Modal.success({title:"提示！",content:e+"成功"}),i.body=t.data,i.outDetailEntity=t.data.goodList,"submit"===o&&(i.BannedClick(),i.isEdit("N"),$(".is-submit-disabled").css("pointer-events","none").css({color:"#bbbec4"})),i.saveAccess(i.body.documentNo,"W_EMATERIAL_OUT"),void window.top.home.loading("hide");i.body.documentStatus=1,window.top.home.loading("hide"),i.$Modal.warning({title:"提示！",content:e+"失败"})},error:function(){window.top.home.loading("hide"),i.body.documentStatus=1,alert("服务器出错啦")}})}else i.$Message.warning("单据状态不为暂存不能进行此操作！")},loadProductType:function(){var e=this;$.ajax({type:"post",url:contextPath+"/entrustOut/queryStyleCategory?parentId=0",contentType:"application/json",dataType:"json",success:function(t){"100100"===t.code&&(e.categoryType=e.initGoodCategory(t.data.cateLists))},error:function(){alert("服务器出错啦")}})},initGoodCategory:function(t){var s=this,n=[];return t.forEach(function(t){var e=t.customCode,o=t.name,i=t.cateLists;i&&(i=s.initGoodCategory(i)),n.push({value:e,label:o,children:i})}),n.forEach(function(t){t.children||delete t.children}),n},changeproductType:function(t,e){var o=this,i=this;if(!i.body.customCode)return i.body.customCode=e[e.length-1].value,i.body.goodsTypeName=e[e.length-1].label,void(i.selectedProductType=t);i.$Modal.confirm({title:"提示信息",content:"修改商品类型会清空商品简述和商品明细列表的所有数据，是否确定修改？",onOk:function(){i.body.customCode=e[e.length-1].value,i.body.goodsTypeName=e[e.length-1].label,i.selectedProductType=t,i.$nextTick(function(){i.outDetailEntity=[],i.outDetailEntityTemp.goodsEntities=[],i.warehouseList=[],i.reservoirPositionList=[],o.tabVal="name1"}),i.$forceUpdate()},onCancel:function(){i.goodsValue=i.selectedProductType,i.$forceUpdate()}})},changeBusinessType:function(t){console.log(t),this.showSupplier="W_CMATERIAL_OUT_02"===t},splitCustemCode:function(t,e){for(var o=[],i=0;i<t.length;i++){var s=t.indexOf(".",e);if(-1===s)break;o.push(s),e=s+1}for(var n=1;n<o.length;n++)this.goodsValue.push(t.substring(0,o[n])+".");return this.goodsValue},getOrgan:function(){var e=this;$.ajax({type:"post",url:contextPath+"/entrustOut/getOrgName",dataType:"json",success:function(t){"100100"===t.code&&(e.body.organizationName=t.data.name,e.body.organizationId=t.data.id)},error:function(){alert("服务器出错啦")}})},getSupplier:function(){var e=this;$.ajax({type:"post",url:contextPath+"/entrustOut/querySuppliers",contentType:"application/json",dataType:"json",success:function(t){"100100"===t.code&&(e.supplierList=t.data)},error:function(){alert("服务器出错啦")}})},getCust:function(){var e=this;$.ajax({type:"post",url:contextPath+"/entrustOut/queryAllCustomer",contentType:"application/json",dataType:"json",success:function(t){"100100"===t.code&&(e.custList=t.data)},error:function(){alert("服务器出错啦")}})},custChange:function(t){var a=this,r=this;if(r.outDetailEntity&&0<r.outDetailEntity.length&&r.outDetailEntity[0].sourceNo)return!1;if(r.isCustId){r.isCustId=!1,r.custIdTemp=r.body.custId;var e=!0,o=!1,i=void 0;try{for(var s,n=this.custList[Symbol.iterator]();!(e=(s=n.next()).done);e=!0){var d=s.value;if(d.id===this.body.custId)return this.getWareHouseGroup(d.wareHouse),!1}}catch(t){o=!0,i=t}finally{try{!e&&n.return&&n.return()}finally{if(o)throw i}}}r.$Modal.confirm({title:"提示信息",content:"修改客户会清空商品简述和商品明细列表的所有数据，是否确定修改？",onOk:function(){r.custIdTemp=r.body.custId;var t=!0,e=!1,o=void 0;try{for(var i,s=a.custList[Symbol.iterator]();!(t=(i=s.next()).done);t=!0){var n=i.value;if(n.id===a.body.custId){a.getWareHouseGroup(n.wareHouse),r.outDetailEntity=[],r.outDetailEntityTemp.goodsEntities=[],a.tabVal="name1";break}}}catch(t){e=!0,o=t}finally{try{!t&&s.return&&s.return()}finally{if(e)throw o}}},onCancel:function(){r.body.custId=r.custIdTemp}})},getSalesman:function(){var e=this;$.ajax({type:"post",url:contextPath+"/entrustOut/queryallempbyorganid",contentType:"application/json",dataType:"json",success:function(t){"100100"===t.code&&(e.salesmanList=t.data)},error:function(){alert("服务器出错啦")}})},getLogisticMode:function(){this.selectLogisticMode=getCodeList("jxc_jxc_wlfs"),this.body.logisticsWay="wlfs_zt"},getInputValue:function(t,e){var o=this,i={categoryCustomCode:o.body.customCode,field:t,limit:""};$.ajax({type:"post",url:contextPath+"/tbasecommodity/findByType",data:i,dataType:"json",success:function(t){"100100"===t.code&&(o.goodsNoOptions=t.data,o.$forceUpdate())},error:function(){layer.alert("服务器出错啦")}})},getSelectedItem:function(t,o){var i=this;$.ajax({type:"post",url:contextPath+"/tbasecommodity/getBriefById/"+t.id,dataType:"json",success:function(t){if("100100"===t.code){var e=t.data;i.outDetailEntity[o]={},e.countUnit=i.unitMap[e.countUnitId],e.weightUnit=i.unitMap[e.weightUnitId],Object.assign(i.outDetailEntity[o],{goodsNo:e.code,goodsName:e.name,commodityId:e.id,goodsMainType:e.mainType,pictureUrl:e.frontPic&&e.frontPic.fdUrl,goodsNorm:e.specification,warehouseId:i.warehouseId,RepertoryPositionGroupId:i.RepertoryPositionGroupId,weightUnitId:e.weightUnitId,countingUnitId:e.countUnitId,weightUnit:e.weightUnit,countingUnit:e.countUnit,pricingMethod:e.pricingType}),Vue.set(i.outDetailEntity,o,i.outDetailEntity[o]),i.showWeight=!1,i.$forceUpdate()}},error:function(){layer.alert("服务器出错啦")}})},getSelect:function(t,e){return repositionDropdownOnSroll(t,e)},initUnit:function(){var i=this;$.ajax({type:"post",url:contextPath+"/tbaseunit/list",contentType:"application/json",dataType:"json",async:!1,success:function(t){"100100"===t.code?t.data.map(function(t){var e=t.id,o=t.name;i.unitMap[e]=o}):layer.alert("服务器异常,请联系技术人员！",{icon:0})},error:function(t){layer.alert("网络异常,请联系技术人员！",{icon:0})}})},getWareHouseGroup:function(r){var d=this;$.ajax({type:"post",url:contextPath+"/wareHouse/listByTypeAndOrganizationId",data:{type:4},dataType:"json",success:function(t){if("100100"===t.code){d.warehouseList=t.data,d.warehouseId=r;var e=!0,o=!1,i=void 0;try{for(var s,n=d.warehouseList[Symbol.iterator]();!(e=(s=n.next()).done);e=!0){var a=s.value;if(a.id===r){d.RepertoryPositionGroupId=a.groupId;break}}}catch(t){o=!0,i=t}finally{try{!e&&n.return&&n.return()}finally{if(o)throw i}}}},error:function(){layer.alert("服务器出错啦")}})},getRepertoryPositionGroup:function(t){var e=this;$.ajax({type:"post",url:contextPath+"/tbaserepertoryposition/listbygroup/"+t,dataType:"json",success:function(t){"100100"===t.code&&(e.reservoirPositionList=[],e.reservoirPositionList=t.data)},error:function(){layer.alert("服务器出错啦")}})},getRepertoryPositionList:function(){var e=this;$.ajax({type:"post",url:contextPath+"/tbaserepertoryposition/queryAllPosition",dataType:"json",success:function(t){"100100"===t.code&&(e.reservoirPositionList=[],e.reservoirPositionList=t.data)},error:function(){layer.alert("服务器出错啦")}})},selectProductDetail:function(t,e){this.selectedIndex1=t},modalOk:function(){}},_defineProperty(_methods,"modalCancel",function(){}),_defineProperty(_methods,"tabsClose",function(){}),_defineProperty(_methods,"getGoodsBarcodeValue",function(e,o){var i=this,t={goodsBarcode:e,commodityId:i.outDetailEntityTemp.commodityId,isInStock:1,nature:0,stockInNo:"",warehouseId:i.outDetailEntityTemp.warehouseId,limit:""};$.ajax({type:"post",url:contextPath+"/goodsController/queryGoodsDetail",data:JSON.stringify(t),contentType:"application/json",dataType:"json",success:function(t){"100100"===t.code&&(i.barCodeOptions=t.data.map(function(t){return $.extend(!0,{},{code:t.goodsBarcode,name:t.goodsName,id:t.id})}),i.$forceUpdate(),i.updateCodesUsed(e,o))},error:function(){layer.alert("服务器出错啦")}}),console.log(e,11212)}),_defineProperty(_methods,"getGoodsItem",function(t,o){var i=this,e={id:t.id};$.ajax({type:"post",url:contextPath+"/goodsController/queryGoodsDetail",data:JSON.stringify(e),contentType:"application/json",dataType:"json",success:function(t){if(console.log("明细",t.data),"100100"===t.code){var e=$.extend(!0,{},t.data[0],{options:i.outDetailEntityTemp.goodsEntities[o].options});i.outDetailEntityTemp.goodsEntities.splice(o,1,e),i.$forceUpdate(),i.updateCodesUsed()}},error:function(){layer.alert("服务器出错啦")}})}),_defineProperty(_methods,"rowClick",function(t){var e=this;if("add"===t){if(!this.body.customCode)return void this.$Message.info("请先选择商品类型！");if(!this.body.custId)return void this.$Message.info("请先选择客户！");this.outDetailEntity.push({}),this.tabValid=!0,this.$nextTick(function(){e.getSelect("table-responsive","goods")}),this.getInputValue("",1)}else if("copy"===t){if(null===this.selectedIndex)layer.alert("请选择一条数据！");else{console.log(this.outDetailEntity);var o=Object.assign({},this.outDetailEntity[this.selectedIndex],{goodsEntities:[]});this.outDetailEntity.push(o),this.selectedIndex=null,console.log(this.outDetailEntity)}this.tabValid=!0,this.$nextTick(function(){e.getSelect("table-responsive","goods")})}}),_defineProperty(_methods,"action2",function(){null===this.selectedIndex?layer.alert("请选择一条数据！"):(this.outDetailEntity.splice(this.selectedIndex,1),this.$forceUpdate(),this.updateCodesUsed()),this.selectedIndex=null}),_defineProperty(_methods,"selectProductInfo",function(t){this.selectedIndex=t}),_defineProperty(_methods,"detailAction",function(t){var e=this;if(this.selectedIndex=t,"attr_ranges_gold"===this.outDetailEntity[t].goodsMainType)return this.$Message.info("商品主类型为金料，不存在条码明细！"),!1;if(!this.outDetailEntity[t].sourceNo){if(!this.outDetailEntity[t].goodsNo)return void this.$Message.info("请先选择商品编码！");if(!this.outDetailEntity[t].baileeNum)return void this.$Message.info("请先输入数量！");if(!this.outDetailEntity[t].warehouseId)return void this.$Message.info("请先选择仓库！")}this.tabVal="name2";var o=Number(this.outDetailEntity[t].baileeNum);if(o){this.outDetailEntityTemp.goodsEntities=new Array(o).fill({options:[]});var i=void 0,s=[].concat();if(this.outDetailEntity[t].goodsEntities&&(i=o-this.outDetailEntity[t].goodsEntities.length),0<i)s=[].concat(this.outDetailEntity[t].goodsEntities,this.outDetailEntityTemp.goodsEntities);else{var n=Math.abs(i);if(0<n)for(var a=0;a<n;a++)this.outDetailEntity[t].goodsEntities.pop()}s=$.extend(!0,{},this.outDetailEntityTemp,this.outDetailEntity[t]);this.outDetailEntityTemp=s,this.outDetailEntity[t].goodsEntities=s.goodsEntities,this.$forceUpdate(),this.getGoodsBarcodeValue(""),this.$nextTick(function(){e.getSelect("table-responsive","goods-child")})}}),_defineProperty(_methods,"crolMark",function(t){var e=this;if(this.tabVal=t,this.outDetailEntityTemp.goodsEntities&&0<this.outDetailEntityTemp.goodsEntities.length){var o=0,i=!0,s=!1,n=void 0;try{for(var a,r=this.outDetailEntityTemp.goodsEntities[Symbol.iterator]();!(i=(a=r.next()).done);i=!0){var d=a.value;isNaN(Number(d.totalWeight))||(o+=d.totalWeight)}}catch(t){s=!0,n=t}finally{try{!i&&r.return&&r.return()}finally{if(s)throw n}}o&&(this.outDetailEntity[this.selectedIndex].weight=Number(o))}this.outDetailEntity[this.selectedIndex]=$.extend(!0,{},this.outDetailEntity[this.selectedIndex],{goodsEntities:this.outDetailEntityTemp.goodsEntities}),this.outDetailEntityTemp.goodsEntities=[],this.$nextTick(function(){e.getSelect("table-responsive","goods")})}),_defineProperty(_methods,"getNumAction",function(t){var e=Number(this.outDetailEntity[t].baileeNum);console.log(e,"数量改变",99009),e?(this.showWeight=!0,this.outDetailEntity[t].weight=""):this.showWeight=!1}),_defineProperty(_methods,"BannedClick",function(){var t=this;t.showBody=!0,t.showProduct=!0,t.showWeight=!0,t.isClick=!0,t.showAll=!0,t.showCust=!0,t.showSupplier=!0,t.isReadonly=!0}),_defineProperty(_methods,"allowClick",function(){var t=this;t.showBody=!1,t.showProduct=!1,t.showWeight=!1,t.showAll=!1,t.showCust=!1}),_defineProperty(_methods,"exit",function(){window.parent.closeCurrentTab({openTime:this.openTime,exit:!0})}),_defineProperty(_methods,"add",function(){window.parent.activeEvent({name:"受托加工材料出库-新增",url:contextPath+"/warehouse/entrust-material-out/entrust-material-out-info.html",params:{activeType:"handworkAdd"}})}),_defineProperty(_methods,"list",function(){window.parent.activeEvent({name:"受托加工材料出库-新增",url:contextPath+"/warehouse/entrust-material-out/entrust-material-out-list.html"})}),_defineProperty(_methods,"detailClick",function(t){window.parent.activeEvent({name:"调拨单-查看",url:contextPath+"/warehouse/requisition/requisition-info.html",params:{activeType:"listQuery",id:t.sourceNo}})}),_defineProperty(_methods,"htPrint",function(t){function e(){return t.apply(this,arguments)}return e.toString=function(){return t.toString()},e}(function(){htPrint()})),_defineProperty(_methods,"clearNoNumber",function(t,e,o){return htInputNumber(t,e,o)}),_defineProperty(_methods,"sourcrEcho",function(t){var a=this;$.ajax({type:"post",url:contextPath+"/entrustOut/querySourceInfo",data:JSON.stringify(t),contentType:"application/json",dataType:"json",success:function(t){if("100100"===t.code){console.log("回显",t.data),a.getRepertoryPositionList(),"W_REQUISITION_04"===a.body.businessType?(a.body.businessType="W_CMATERIAL_OUT_01",this.showSupplier=!1):"W_REQUISITION_05"===a.body.businessType&&(a.body.businessType="W_CMATERIAL_OUT_02",this.showSupplier=!0),a.outDetailEntity=t.data;var e=!0,o=!1,i=void 0;try{for(var s,n=t.data[Symbol.iterator]();!(e=(s=n.next()).done);e=!0){s.value;Object.assign(a.body,{documentStatus:1,documentNo:"",documentType:"W_EMATERIAL_OUT",supplierId:t.data[0].supplierId,custId:t.data[0].custId,customCode:t.data[0].customCode,goodsTypeName:t.data[0].goodsTypeName})}}catch(t){o=!0,i=t}finally{try{!e&&n.return&&n.return()}finally{if(o)throw i}}a.body.custId&&(a.showCust=!0),a.goodsValue=a.splitCustemCode(a.body.customCode,0),a.selectedProductType=a.goodsValue,a.showBody=!0,a.isClick=!0,a.showProductType=!0,a.showProduct=!0,a.showWeight=!0,a.getOrgan(),a.getLogisticMode(),$(".is-htPrint").css("pointer-events","none").css({color:"#bbbec4"})}},error:function(){layer.alert("服务器出错啦")}})}),_defineProperty(_methods,"listEcho",function(t){var e=this,o={documentNo:t};console.log(o,"data"),$.ajax({type:"post",url:contextPath+"/entrustOut/queryDetail",data:JSON.stringify(o),contentType:"application/json",dataType:"json",success:function(t){"100100"===t.code&&(console.log("列表回显",t.data),e.getLogisticMode(),e.getWareHouseGroup(),e.body=t.data,e.goodsValue=e.splitCustemCode(e.body.customCode,0),e.selectedProductType=e.goodsValue,e.outDetailEntity=t.data.goodList,e.outDetailEntity&&0<e.outDetailEntity.length&&e.outDetailEntity[0].sourceNo&&(e.showBody=!0,e.isClick=!0,e.showProduct=!0,e.showWeight=!0),e.isEdit("Y"),$(".is-submit-disabled").css({"pointer-events":"auto "}).css({color:"#495060"}),"listQuery"===e.params.activeType&&($(".is-disabled").css("pointer-events","none").css({color:"#bbbec4"}),$(".is-submit-disabled").css("pointer-events","none").css({color:"#bbbec4"}),e.BannedClick(),e.isEdit("N")),1!==e.body.documentStatus&&($(".is-submit-disabled").css("pointer-events","none").css({color:"#bbbec4"}),e.BannedClick(),e.isEdit("N")),4==e.body.documentStatus?(e.isStampShow=!0,$(".is-htPrint").css({"pointer-events":"auto "}).css({color:"#495060"})):$(".is-htPrint").css("pointer-events","none").css({color:"#bbbec4"}),e.isCustId=!1,e.custIdTemp=e.body.custId,e.getAccess(e.body.documentNo,"W_EMATERIAL_OUT")),e.$forceUpdate()},error:function(){layer.alert("服务器出错啦")}})}),_defineProperty(_methods,"updateCodesUsed",function(t,e){var o,i={},s={},n=this.outDetailEntityTemp.goodsEntities||[];void 0!==t&&void 0!==e&&8!=String(t).length&&(n[e].goodsBarcode=""),$.each(this.outDetailEntity,function(t,e){$.isArray(e.goodsEntities)&&0<e.goodsEntities.length&&$.each(e.goodsEntities,function(t,e){i[Number(e.goodsBarcode)]=""})}),$.isArray(n)&&0<n.length&&$.each(n,function(t,e){s[Number(e.goodsBarcode)]=""}),o=$.extend(!0,{},i,s),this.codesUsed=o}),_methods),mounted:function(){$("form").validate(),this.getSelect("table-responsive","goods")},created:function(){this.loadProductType(),this.getSupplier(),this.getCust(),this.getSalesman(),this.getLogisticMode(),this.initUnit(),this.getOrgan(),this.body.businessType="W_CMATERIAL_OUT_01",this.params=window.parent.params.params,this.openTime=window.parent.params.openTime,"handworkAdd"===this.params.activeType?($(".is-htPrint").css("pointer-events","none").css({color:"#bbbec4"}),this.isEdit("Y")):"sourceAdd"===this.params.activeType?this.sourcrEcho(this.params.documentNoArr):"listUpdate"===this.params.activeType?(this.listEcho(this.params.documentNo),console.log(this.params,990)):"listQuery"===this.params.activeType&&this.listEcho(this.params.documentNo)}});