"use strict";var vm=new Vue({el:"#app",data:{openTime:"",isShow:!1,isEdit:!1,reload:!1,isSearchHide:!0,isTabulationHide:!0,selectType:[{value:"S_RETURN_01",label:"普通销售退货"},{value:"S_RETURN_02",label:"受托加工销售退货"}],categoryType:[],productId:"",selected:"",body:{documentNo:"",customerId:"",goodsType:"",businessType:"",reProcessMethod:"S_RETURN_TOWSALE",qualityResult:"S_RETURN_QUALITY_PASS",isDel:1},custList:[],unitList:[],data_config:{url:contextPath+"/refundGoodsController/getPendingReturnGoodsList",datatype:"json",colNames:["id","商品信息主键id","商品分录行号","源单类型","单据编号","质检判定","退货客户","业务类型","退货处理方式","商品类型","商品编码","商品名称","计数单位","数量","计重单位","重量"],colModel:[{name:"sid",index:"sid",hidden:!0},{name:"cid",index:"cid",hidden:!0},{name:"goodsLineNo",index:"goodsLineNo",hidden:!0},{name:"a1",width:210,align:"left",formatter:function(e,t,n,o){return"销售退货通知单"},unformat:function(e,t,n){return"销售退货通知单"===e?"S_RETURN":""}},{name:"documentNo",index:"documentNo",width:210,align:"left",formatter:function(e,t,n,o){return $(document).off("click",".updateDetail"+e).on("click",".updateDetail"+e,function(){vm.updateDetail(e)}),'<a class="updateDetail'+e+'">'+e+"</a>"},unformat:function(e,t,n){return e.replace(/(<\/?a.*?>)/g,"")}},{name:"qualityResult",index:"qualityResult",width:210,align:"left",formatter:function(e,t,n,o){switch(e){case"S_RETURN_QUALITY_PASS":return"放行";case"S_RETURN_QUALITY_NO_PASS":return"检查结果不符";default:return""}},unformat:function(e,t,n){switch(e){case"放行":return"S_RETURN_QUALITY_PASS";case"检查结果不符":return"S_RETURN_QUALITY_NO_PASS";default:return""}}},{name:"name",index:"custNo",width:210,align:"left"},{name:"businessType",index:"businessType",align:"left",width:210,formatter:function(e,t,n,o){return"S_RETURN_01"===e?"普通销售退货":"S_RETURN_02"===e?"受托加工销售退货":""},unformat:function(e,t,n){return"普通销售退货"===e?"S_RETURN_01":"受托加工销售退货"===e?"S_RETURN_02":""}},{name:"reProcessMethod",index:"reProcessMethod",align:"left",width:210,formatter:function(e,t,n,o){switch(e){case"S_RETURN_TOWSALE":return"二次销售";case"S_RETURN_REPAIR":return"维修";case"S_RETURN_OLD_MATERIAL":return"旧料处理";default:return""}},unformat:function(e,t,n){switch(e){case"二次销售":return"S_RETURN_TOWSALE";case"维修":return"S_RETURN_REPAIR";case"旧料处理":return"S_RETURN_OLD_MATERIAL";default:return""}}},{name:"goodsTypeName",index:"goodsTypeName",align:"left",width:210},{name:"goodsCode",index:"goodsCode",align:"left",width:210},{name:"goodsName",index:"goodsName",align:"left",width:210},{name:"countingUnit",index:"countingUnit",align:"left",width:210},{name:"num",index:"num",align:"left",width:210},{name:"weightUnit",index:"weightUnit",align:"left",width:210},{name:"weight",index:"weight",align:"left",width:210}],rowNum:5,rowList:[10,20,30],mtype:"post",viewrecords:!0}},methods:{clear:function(){var e=this;this.body.documentNo="",this.body.goodsType="",this.body.isDel=1,this.body.reProcessMethod="S_RETURN_TOWSALE",this.body.qualityResult="S_RETURN_QUALITY_PASS",this.body.businessType&&(this.$refs.businessType.reset(),this.$nextTick(function(){e.body.businessType=""})),this.body.customerId&&(this.$refs.customerId.reset(),this.$nextTick(function(){e.body.customerId=""})),this.$nextTick(function(){e.productId=""})},refresh:function(){this.reload=!this.reload},search:function(){this.refresh()},loadProductType:function(){var t=this;$.ajax({type:"post",url:contextPath+"/refundGoodsController/queryStyleCategory",dataType:"json",success:function(e){t.categoryType=t.initGoodCategory(e.data.cateLists)},error:function(){alert("服务器出错啦")}})},changeproductTypeName:function(e,t){this.body.groupPath=t[t.length-1].value,this.body.goodsType=t[t.length-1].value,console.log(this.selected,333333)},initGoodCategory:function(e){var i=this,a=[];return e.forEach(function(e){var t=e.customCode,n=e.name,o=e.cateLists;o&&(o=i.initGoodCategory(o)),a.push({value:t,label:n,children:o})}),a.forEach(function(e){e.children||delete e.children}),a},getCust:function(){var t=this;$.ajax({type:"post",url:contextPath+"/refundGoodsController/queryAllCustomer",contentType:"application/json",dataType:"json",success:function(e){console.log("客户",e),t.custList=e.data},error:function(){alert("服务器出错啦")}})},updateDetail:function(e){$.ajax({type:"POST",url:contextPath+"/tSaleReturnNotice/info",data:{documentNo:e}}).then(function(e){window.parent.activeEvent({name:"销售退货通知单新增",url:contextPath+"/sale/return-notice/sale-reject-add.html",params:{type:"query",data:e.data}})})},checkConsistent:function(t){var n=!1,o=!1,i=!1,a=!1;return t.forEach(function(e){t[0].customerId!==e.customerId&&(n=!0),t[0].goodsType!==e.goodsType&&(o=!0),t[0].businessType!==e.businessType&&(i=!0),t[0].reProcessMethod!==e.reProcessMethod&&(a=!0)}),n?(this.$Modal.warning({content:"客户不一致!",title:"提示"}),console.log("客户不一致"),!1):o?(this.$Modal.warning({content:"商品类型不一致!",title:"提示"}),console.log("商品类型不一致"),!1):i?(this.$Modal.warning({content:"业务类型不一致!",title:"提示"}),console.log("业务类型不一致"),!1):!a||(this.$Modal.warning({content:"退货处理方式不一致!",title:"提示"}),console.log("退货处理方式不一致"),!1)},generate:function(){var e=this.selected;if(console.log(e),!ht.util.hasValue(e,"array"))return this.$Modal.warning({content:"请先选择一条记录!",title:"提示"}),!1;if(this.checkConsistent(e)){var t=[];e.forEach(function(e){t.push(e.cid)}),console.log(t),window.parent.activeEvent({name:"新增销售退货单",url:contextPath+"/warehouse/return-goods/return-goods-info.html",params:{data:{ids:t},type:3}})}},exit:function(){window.parent.closeCurrentTab({name:"销售待退货列表",exit:!0,openTime:this.openTime})}},mounted:function(){this.loadProductType(),this.getCust(),this.openTime=window.parent.params.openTime}});