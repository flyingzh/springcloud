"use strict";new Vue({el:"#bank-reconciliation-report",data:function(){return{baseData:{subjectName:"",bankAccountNumber:"",currencyName:"",periodDate:""},openData:{subjectId:"",currencyId:"",accountYear:"",accountPeriod:""},filterVisible:!1,subjectList:[],currencyList:[],periodYear:[],periodList:[],colNames:[],colModel:[],printInfo:{},printModal:!1,openTime:"",dataList:[],tableHeaders:[]}},mounted:function(){this.initPage(),this.openTime=window.parent.params&&window.parent.params.openTime},methods:{initPage:function(){var n=this;$.ajax({type:"post",url:contextPath+"/bankReconciliationReportAppController/initPage",dataType:"json",data:null,success:function(t){if("100100"!=t.code){var e="初始化页面数据失败!";return t.msg&&(e=t.msg),void n.$Message.error({content:e,duration:3,closable:!0})}var a=t.data;n.currencyList=a.currencyList,n.periodYear=a.periodYear,n.periodList=a.monthList,n.subjectList=a.subjectList,n.openData.accountPeriod=a.cnCurrentAccountPeriod,$.each(a.periodYear,function(t,e){e.name==a.cnCurrentAccountYear&&(n.openData.accountYear=e.value)}),$.each(a.monthList,function(t,e){e.name==a.cnCurrentAccountPeriod&&(n.openData.accountPeriod=e.name)}),n.baseData.periodDate=n.openData.accountYear+"年"+n.openData.accountPeriod+"期",$.isEmptyObject(a.subjectList)||0==a.subjectList.length||(n.openData.subjectId=a.subjectList[0].accountId,$.each(a.subjectList,function(t,e){n.openData.subjectId==e.accountId&&(n.baseData.subjectName=a.subjectList[0].accountName,n.baseData.bankAccountNumber=a.subjectList[0].bankAccount)})),$.isEmptyObject(a.currencyList)||0==a.currencyList.length||(n.openData.currencyId=a.currencyList[0].currencyId,$.each(n.currencyList,function(t,e){n.openData.currencyId==e.currencyId&&(n.baseData.currencyName=e.currencyName)})),n.initMathod()}})},initMathod:function(){var e=this;jQuery("#grid").jqGrid({url:contextPath+"/bankReconciliationReportAppController/reportDetail",postData:JSON.stringify(e.openData),ajaxGridOptions:{contentType:"application/json;charset=utf-8"},datatype:"json",colNames:["id","项目","日期","金额","制单人","数据来源","备注","项目","日期","凭证字号","对方科目","金额","制单人","数据来源","备注"],colModel:[{name:"id",width:40,hidden:!0},{name:"projectL",width:170},{name:"dateStrL",width:80},{name:"amountL",width:80,formatter:function(t,e,a,n){return null==t||0==t?"":accounting.formatNumber(t,2,",")}},{name:"createNameL",width:100},{name:"dataSourceL",width:120},{name:"remarkL",width:100},{name:"projectR",width:170},{name:"dateStrR",width:80},{name:"voucherGroupDataR",width:80},{name:"tbasSubjectNameR",width:100},{name:"amountR",width:80,formatter:function(t,e,a,n){return null==t||0==t?"":accounting.formatNumber(t,2,",")}},{name:"createNameR",width:100},{name:"dataSourceR",width:120},{name:"remarkR",width:100}],rowNum:999999999,mtype:"post",jsonReader:{root:"data",total:"data.totalPage",records:"data.totalCount",cell:"list"},styleUI:"Bootstrap",height:$(window).height()-190,loadComplete:function(t){"100100"==t.code?(e.dataList=t.data,jQuery("#grid").jqGrid("destroyGroupHeader"),jQuery("#grid").jqGrid("setGroupHeaders",{useColSpanStyle:!0,groupHeaders:[{startColumnName:"projectL",numberOfColumns:6,titleText:"企业未达账"},{startColumnName:"projectR",numberOfColumns:8,titleText:"银行未达账"}]})):layer.alert(t.msg)}})},subjectChange:function(t){var e=this;$.ajax({type:"post",url:contextPath+"/cnbankdepositjournalappcontroller/subjectChange",data:{subjectId:t},success:function(t){"100100"==t.code&&null!=t.data?(e.currencyList=t.data,e.openData.currencyId=e.currencyList[0].currencyId):e.$Message.error({content:"切换银行科目异常!",duration:3,closable:!0})}})},open:function(){this.filterVisible=!0},refresh:function(){this.save()},save:function(){var a=this;$.each(a.subjectList,function(t,e){a.openData.subjectId==e.accountId&&(a.baseData.subjectName=e.accountName,a.baseData.bankAccountNumber=e.bankAccount)}),$.each(a.currencyList,function(t,e){a.openData.currencyId==e.currencyId&&(a.baseData.currencyName=e.currencyName)}),a.baseData.periodDate=a.openData.accountYear+"年"+a.openData.accountPeriod+"期",$("#grid").jqGrid("setGridParam",{postData:JSON.stringify(a.openData)}).trigger("reloadGrid"),this.filterVisible=!1},cancel:function(){this.filterVisible=!1},exportExcel:function(){var t=this.openData,e=this.baseData,a=contextPath+"/bankReconciliationReportAppController/exportExcel?subjectId="+t.subjectId+"&currencyId="+t.currencyId+"&accountYear="+t.accountYear+"&accountPeriod="+t.accountPeriod+"&subjectName="+e.subjectName+"&currencyName="+e.currencyName+"&bankAccountNumber="+e.bankAccountNumber+"&periodDate="+e.periodDate;console.log(a),window.open(a)},printV:function(){var e=this;if(e.dataList&&e.dataList.length){console.log("点击打印,查看that.dataList: "),console.log(e.dataList);var t=e.dataList,a="";'\n                    <tr class=\'thCs\'>\n                        <th colspan="6">企业未达账</th>\n                        <th colspan="8">银行未达账</th>\n                    </tr>\n                     <tr class=\'thCs\'>\n                        <th style="width: 12%">项目</th>\n                        <th style="width: 12%">日期</th>\n                        <th style="width: 12%">金额</th>\n                        <th style="width: 12%">制单人</th>\n                        <th style="width: 12%">数据来源</th>\n                        <th style="width: 12%">备注</th>\n                        <th style="width: 12%">项目</th>\n                        <th style="width: 12%">日期</th>\n                        <th style="width: 12%">凭证字号</th>\n                        <th style="width: 12%">对方科目</th>\n                        <th style="width: 12%">金额</th>\n                        <th style="width: 12%">制单人</th>\n                        <th style="width: 12%">数据来源</th>\n                        <th style="width: 12%">备注</th>\n                    </tr>\n                ',t.forEach(function(t){a+="\n                        <tr>\n                            <td>"+e._nullData(t.projectL)+"</td>\n                            <td>"+e._nullData(t.dateStrL)+"</td>\n                            <td>"+e.formartMoney(t.amountL)+"</td>\n                            <td>"+e._nullData(t.createNameL)+"</td>\n                            <td>"+e._nullData(t.dataSourceL)+"</td>\n                            <td>"+e._nullData(t.remarkL)+"</td>\n                            \n                            <td>"+e._nullData(t.projectR)+"</td>\n                            <td>"+e._nullData(t.dateStrR)+"</td>\n                            <td>"+e._nullData(t.voucherGroupDataR)+"</td>\n                            <td>"+e._nullData(t.tbasSubjectNameR)+"</td>\n                            <td>"+e.formartMoney(t.amountR)+"</td>\n                            <td>"+e._nullData(t.createNameR)+"</td>\n                            <td>"+e._nullData(t.dataSourceR)+"</td>\n                            <td>"+e._nullData(t.remarkR)+"</td>\n                        </tr>\n                    "});var n={title:"余额调节表",template:12,titleInfo:[{name:"公司名称",val:layui.data("user").currentOrgName},{name:"银行",val:e.baseData.subjectName},{name:"账号",val:e.baseData.bankAccountNumber},{name:"币别",val:e.baseData.currencyName},{name:"期间",val:e.baseData.periodDate}],data:[],colMaxLenght:14,setPageSize:2,tbodyInfo:{theadTX:'\n                    <tr class=\'thCs\'>\n                        <th colspan="6">企业未达账</th>\n                        <th colspan="8">银行未达账</th>\n                    </tr>\n                     <tr class=\'thCs\'>\n                        <th style="width: 12%">项目</th>\n                        <th style="width: 12%">日期</th>\n                        <th style="width: 12%">金额</th>\n                        <th style="width: 12%">制单人</th>\n                        <th style="width: 12%">数据来源</th>\n                        <th style="width: 12%">备注</th>\n                        <th style="width: 12%">项目</th>\n                        <th style="width: 12%">日期</th>\n                        <th style="width: 12%">凭证字号</th>\n                        <th style="width: 12%">对方科目</th>\n                        <th style="width: 12%">金额</th>\n                        <th style="width: 12%">制单人</th>\n                        <th style="width: 12%">数据来源</th>\n                        <th style="width: 12%">备注</th>\n                    </tr>\n                ',tbodyTX:a,tfootTX:""}};htPrint(n)}else e.$Message.error({content:"无打印数据!",duration:3})},_nullData:function(t){return t||""},formartMoney:function(t){return null==t||0==t?"":accounting.formatNumber(t,2,",")},printModalShow:function(t){this.printModal=t},closeWindow:function(){window.parent.closeCurrentTab({name:"余额调节表",openTime:this.openTime,exit:!0})}}});