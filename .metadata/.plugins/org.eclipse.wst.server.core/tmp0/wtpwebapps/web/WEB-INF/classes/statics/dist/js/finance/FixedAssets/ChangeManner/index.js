"use strict";var ve=new Vue({el:"#change-manner",data:function(){return{openTime:"",tid:"zTreeAssetClass",inputTreeId:"inputTreeClass",sobId:"",parentName:"",formData:{id:"",modeName:"",voucherGroupId:"",modeCode:"",parentId:"",relativeSubjectId:"",relativeSubjectName:"",itemRelateDetailEntity:[]},itemRelateDetailEntity:[],selectList:{},organizationList:[],voucherList:[],nodes:[],inputNodes:[],treeNode:{},setting:{callback:{onClick:this.clickEvent}},treeSetting:{callback:{onClick:this.treeClickCallBack}},isEdit:!1,editDisabled:!0,delDisabled:!0,showAssetClass:!1,subjectVisable:!1,subjectTpye:"",tableList:[]}},methods:{showSubjectVisable:function(e){this.subjectVisable=!0,this.subjectTpye=e},subjectClose:function(){this.subjectVisable=!1},subjectData:function(e){this.formData.relativeSubjectName=e.subjectCode+" "+e.subjectName,this.formData.relativeSubjectId=e.id,this.getAccountingProject(e.id)},treeClickCallBack:function(e,t,a){this.parentName=a.name,this.formData.parentId=a.id,this.showAssetClass=!1},treeBeforeClick:function(e,t,a){return!t.isParent},showAssetClassTree:function(e){!0!==this.showAssetClass?this.showAssetClass=e:this.showAssetClass=!1},_nullData:function(e){return e||""},formartMoney:function(e){return null==e||0==e?"":accounting.formatNumber(e,2,",")},modify:function(e){switch(e){case"add":this.formData.id="",this.formData.modeCode="",this.formData.modeName="",this.formData.relativeSubjectId="",this.formData.relativeSubjectName="",this.tableList=[];break;case"edit":this.clickEvent(null,null,this.treeNode)}},confirm:function(){var e=this;this.$Modal.confirm({title:"信息提示",content:"是否删除?",onOk:function(){e.delFun()},onCancel:function(){}})},delFun:function(){var t=this;$.ajax({type:"post",url:contextPath+"/app/financeFaChangeMode/deleteById",data:JSON.stringify(this.formData),contentType:"application/json;charset=utf-8",success:function(e){console.log(e,"初始化数据~~~~"),"100100"==e.code?t.init():t.$Message.info({content:e.msg,duration:5})}})},saveFun:function(){var t=this,e=new RegExp("^[ ]+$"),a=t.sobId,i=t.formData.modeCode,n=t.formData.modeName;if(""==a||void 0===a||null==a||e.test(a))t.$Message.info("所属组织必填！");else if(""==i||void 0===i||null==i||e.test(i))t.$Message.info("请填写编码！");else if(""==n||void 0===n||null==n||e.test(n))t.$Message.info("请填写名称！");else{if(t.itemRelateDetailEntity=[],null!=t.tableList)for(var s=0;s<t.tableList.length;s++){var o={relateType:6,itemClassId:t.tableList[s].itemClassId,itemId:t.tableList[s].itemId,relateId:0};t.itemRelateDetailEntity.push(o)}t.formData.itemRelateDetailEntity=t.itemRelateDetailEntity,$.ajax({type:"post",url:contextPath+"/app/financeFaChangeMode/save",data:JSON.stringify(this.formData),contentType:"application/json;charset=utf-8",success:function(e){console.log(e,"初始化数据~~~~"),"100100"==e.code?t.init():t.$Modal.info({title:"信息提示",content:e.msg})}})}},closeWindow:function(){window.parent.closeCurrentTab({name:"变动方式",openTime:this.openTime,exit:!0})},refreshFun:function(){this.init()},init:function(){var t=this;t.formData={},t.inputNodes=[],$.ajax({type:"post",url:contextPath+"/app/financeFaChangeMode/initData",success:function(e){"100100"==e.code?(t.nodes=e.data.treeData,jQuery.extend(!0,t.inputNodes,t.nodes).splice(0,0,{id:null,pId:-1,name:"主干"}),0<t.nodes.length?(t.editDisabled=!1,t.delDisabled=!1):(t.editDisabled=!0,t.delDisabled=!0),t.organizationList=e.data.organizationList,t.voucherList=e.data.voucherList,0<t.voucherList.length&&(t.formData.voucherGroupId=t.voucherList[0].id),0<t.organizationList.length&&(t.sobId=e.data.sobId)):t.$Message.info("初始化数据失败！")}}),setTimeout(function(){t.selectNodes()},500)},getAccountingProject:function(e){var t=this;$.ajax({type:"post",url:contextPath+"/app/financeFaChangeMode/getAccountingProject",data:{subjectId:e},success:function(e){console.log(e),t.tableList=e.data}})},selectNodes:function(){var e=$.fn.zTree.getZTreeObj(this.tid),t=e.getNodes();this.tableList=[],0<t.length&&(e.selectNode(t[0]),this.clickEvent(null,null,t[0]))},clickEvent:function(e,t,a){var i=this;i.treeNode=a,i.formData={},i.parentName="",i.formData.id=a.id,i.formData.modeCode=a.modeCode,i.formData.modeName=a.modeName,i.formData.voucherGroupId=a.voucherGroupId,i.formData.relativeSubjectId=a.subjectId,i.formData.relativeSubjectName=a.subjectName;var n=$.fn.zTree.getZTreeObj(i.inputTreeId),s=n.getNodeByParam("id",a.pId);i.formData.parentId=null!=s?(n.selectNode(s),i.parentName=s.name,s.id):(n.cancelSelectedNode(),i.parentName=""),$.ajax({type:"post",url:contextPath+"/app/financeFaChangeMode/getInfoBySubjectId",data:{subjectId:a.subjectId,relateId:a.id},success:function(e){"100100"==e.code?i.tableList=e.data:i.$Message.error(e.msg)}})}},mounted:function(){this.openTime=window.parent.params&&window.parent.params.openTime,this.init()}});