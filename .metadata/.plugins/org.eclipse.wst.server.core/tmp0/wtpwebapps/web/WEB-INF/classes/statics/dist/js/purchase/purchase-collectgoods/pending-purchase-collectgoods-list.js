"use strict";function _defineProperty(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var pendingList=new Vue({el:"#pendingReceivingList",data:function(){var e,i=this;return{openTime:"",isSearchHide:!0,isTabulationHide:!0,isShow:!1,isHide:!0,isEdit:!1,reload:!1,selected:[],categoryType:[],empList:[],commodityCategoty:[],dateArr:[],employees:[],suppliers:[],body:{businessTypeId:"",goodsGroupPath:"",salesmanName:"",supplierId:"",orderNo:"",startTime:"",endTime:""},businessTypes:[{value:"P_ORDER_01",name:"采购订单一标准采购"},{value:"P_ORDER_02",name:"采购订单一受托加工采购"}],data_config:{url:contextPath+"/tpurchaseorder/findByReceipt",colNames:["源单类型","单据编号","id","日期","供应商","业务员","商品类型","采购重量","已收货重量","待收货重量","采购数量","已收货数量","待收货数量"],colModel:[{name:"businessTypeId",index:"documentType",align:"left",width:200,formatter:function(e,t,n,o){return"P_ORDER_01"==n.businessTypeId?"采购订单一标准采购":"P_ORDER_02"==n.businessTypeId?"采购订单一受托加工采购":""}},{name:"orderNo",index:"orderNo",width:200,align:"left",formatter:function(e,t,n,o){return $(document).off("click",".detail"+e).on("click",".detail"+e,function(){i.testOrderDetailClick({value:e,grid:t,rows:n,state:o})}),'<a class="detail'+e+'">'+e+"</a>"}},{name:"id",hidden:!0},(e={name:"createTime",index:"supplier",width:140,align:"center"},_defineProperty(e,"align","left"),_defineProperty(e,"formatter",function(e,t,n,o){return e?new Date(e).format("yyyy-MM-dd"):""}),e),{name:"supplierName",index:"goods_type_path",align:"left",width:150},{name:"salesmanName",index:"businessType",align:"left",width:80},{name:"goodsTypeName",index:"certifcateType",width:80,align:"left"},{name:"purchaseWeight",index:"certifcateNumber",width:80,align:"left"},{name:"alreadyCollectWeight",index:"already_collect_weight",width:80,align:"left"},{name:"notCollectWeight",index:"deliveryDate",width:80,align:"left"},{name:"purchaseCount",index:"deliverGoodsNumber",align:"left",width:80},{name:"alreadyCollectCount",index:"alreadyCollectCount",align:"left",width:80},{name:"notCollectCount",index:"deliverWeight",align:"left",width:80}],shrinkToFit:!1}}},methods:{testOrderDetailClick:function(e){var t=e.rows.orderNo,n=e.rows;t&&this.queryOrderByOrderNo(t,!0,n)},queryOrderByOrderNo:function(e,t,n){window.parent.activeEvent({name:"查看采购订单",url:contextPath+"/purchase/purchase-order/purchase-order.html",params:{docCode:e,type:"query",basicInfo:n}})},loadData:function(){var t=this;$.ajax({type:"post",url:contextPath+"/tpurchasecollectgoods/data",dataType:"json",success:function(e){t.employees=e.data.employees},error:function(){t.$Modal.error({content:"系统异常,请联系技术人员！"})}})},search:function(){this.body.businessTypeId||(this.body.businessTypeId=""),this.body.supplierId||(this.body.supplierId=""),this.body.salesmanName||(this.body.salesmanName=""),this.body.goodsGroupPath||(this.body.goodsGroupPath=""),0<this.dateArr.length&&(this.body.startTime=this.dateArr[0]?this.dateArr[0].format("yyyy-MM-dd HH:mm:ss"):"",this.body.endTime=this.dateArr[1]?this.dateArr[1].format("yyyy-MM-dd 23:59:59"):""),this.reload=!this.reload},refresh:function(){this.clear(),this.search()},clear:function(){this.$refs.saleName.reset(),this.$refs.supplier.reset(),this.$nextTick(function(){this.body.salesmanName="",this.body.supplierId=""}),this.body={businessTypeId:"",goodsGroupPath:"",salesmanName:"",supplierId:"",orderNo:"",startTime:"",endTime:""},this.commodityCategoty=[],this.dateArr=[]},generateReport:function(){var n=this;if(0<n.selected.length){var e=[];if(1<n.selected.length)for(var t=n.selected[0],o=0;o<n.selected.length;o++){var i=n.selected[o];if(e.push(parseInt(n.selected[o].id)),0!=o){if(t.businessTypeId!=i.businessTypeId)return void n.$Modal.warning({content:"请选择相同的源单类型生成收货订单"});if(t.supplierName!=i.supplierName)return void n.$Modal.warning({content:"请选择相同的供应商生成收货订单"});if(t.goodsTypeName!=i.goodsTypeName)return void n.$Modal.warning({content:"请选择相同的商品类型生成收货订单"})}}else e.push(parseInt(n.selected[0].id));$.ajax({type:"post",url:contextPath+"/tpurchasecollectgoods/findByOrders",data:JSON.stringify(e),contentType:"application/json",success:function(e){var t=e.data;t.forEach(function(t){n.suppliers.forEach(function(e){e.id==t.supplierId&&(t.supplierCode=e.supplierCode)})}),n.goPurchaseAdd(t)},error:function(){n.$Modal.error({content:"系统出现异常,请联系管理人员"})}})}else n.$Modal.warning({content:"请选择数据生成收货订单"})},goPurchaseAdd:function(e){window.parent.activeEvent({name:"采购收货单-新增",url:contextPath+"/purchase/purchase-collectgoods/purchase-collectgoods-add.html",params:e,type:1})},cancel:function(){},loadProductType:function(){var t=this;$.ajax({type:"post",url:contextPath+"/documentController/getCategory?parentId=0",contentType:"application/json",dataType:"json",success:function(e){t.categoryType=t.initGoodCategory(e.data.cateLists)},error:function(e){t.$Modal.error({content:"系统出现异常,请联系管理人员"})}})},loadSuppliers:function(){var t=this;$.ajax({type:"post",url:contextPath+"/tpurchasecollectgoods/findSupplierByOrgId",dataType:"json",success:function(e){t.suppliers=e.data},error:function(){t.$Modal.error({content:"系统出现异常,请联系管理人员"})}})},changeCategory:function(e){this.body.goodsGroupPath=e[e.length-1]},initGoodCategory:function(e){var i=this,a=[];return e.forEach(function(e){var t=e.customCode,n=e.name,o=e.cateLists;o&&(o=i.initGoodCategory(o)),a.push({value:t,label:n,children:o})}),a.forEach(function(e){e.children||delete e.children}),a},loadEmplist:function(){var e=this;$.ajax({type:"post",url:"./empList.json",dataType:"json",success:function(e){purchaseOrderList.empList=e.data},error:function(){e.$Modal.error({content:"系统出现异常,请联系管理人员"})}})},exit:function(){window.parent.closeCurrentTab({exit:!0,openTime:this.openTime})}},created:function(){this.loadProductType(),this.loadSuppliers(),this.loadData()},mounted:function(){this.openTime=window.parent.params.openTime}});