"use strict";function _defineProperty(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}var vem=new Vue({el:"#other-payment-receipt-time-book",data:function(){return{isInit:!0,showFilter:!1,subjectVisable:!1,visible_filter:!1,confirmConfig:{showConfirm:!1,title:"提示",content:"这是内容",onlySure:!0,success:!0},dataSum:{sumAmountPaymentReceivedFor:"",sumAmountPaymentReceived:"",sumPayableAmount:""},filterBody:{timeStart:"",timeEnd:"",dateSource:"",auditStatus:"",isVoucher:"",documentNumber:""},detailDate:[{label:"今天",value:"today"},{label:"昨天",value:"yesterday"},{label:"近7天",value:"interval7"},{label:"近30天",value:"interval30"},{label:"本月",value:"thisMon"},{label:"上月",value:"lastMon"},{label:"本季度",value:"thisQuarter"},{label:"上季度",value:"lastQuarter"},{label:"本年",value:"thisYear"},{label:"去年",value:"lastYear"}],openTime:"",auditStatusList:[{label:"未审核",value:1},{label:"已审核",value:2}],isVoucherList:[{label:"未记账",value:1},{label:"已记账",value:2}],id:"",auditStatus:"",rowData:{}}},methods:_defineProperty({addVoucher:function(){var e={paramVOS:[]},t={id:vem.rowData.id};e.paramVOS.push(t);var a=rcContextPath+"/otherPaymentReceipt/createVoucher";null!=vem.rowData.id&&"Y"==vem.rowData.auditStatus&&1==vem.rowData.isVoucher?$.ajax({type:"post",async:!0,data:JSON.stringify(e),url:a,dataType:"json",contentType:"application/json;charset=utf-8",success:function(e){var t="";"100100"===e.code?(t="操作失败",0!=e.data.vses.length&&(t=e.msg,that.formData=e.data.vses.length&&e.data.vses[0],that.formData.isVoucher=2)):t=e.msg;vem.$Message.info({content:t,duration:3})}}):"Y"!=vem.rowData.auditStatus?vem.$Message.info({content:"该单据未审核,不能生成凭证",duration:3}):2==vem.rowData.isVoucher&&vem.$Message.info({content:"该单据已生成凭证",duration:3})},showVoucher:function(){var e=vem.rowData.voucherId,t=vem.rowData.sobId,a=rcContextPath+"/finance/voucher-lrt/index.html?voucherId="+e+"&sobId="+t;window.parent.activeEvent({name:"记账凭证",url:a})},refreshDisplay:function(){window.location.reload()},outHtml:function(){window.parent.closeCurrentTab({name:name,openTime:this.openTime,exit:!0})},print:function(){htPrint()},getRowData:function(e){console.log(e)},sortData:function(e,t,a,n){var o="";return(e||[]).map(function(e,t){"number"==typeof e&&(e=accounting.formatMoney(e,"",2)),o+="<div class='sumCol'>"+e+"</div>"}),o},getColSum:function(e){var t=$("td[aria-describedby='list_"+e+"']"),a=0;return(t=0!==t.children("div.sumCol").length?$("td[aria-describedby='list_"+e+"']").children("div.sumCol"):$("td[aria-describedby='list_"+e+"']:not(:last)")).each(function(e,t){a+=1e3*accounting.unformat($(t).text())}),a/=1e3,a=accounting.formatMoney(a,"",2)},pageInit:function(){var o=this,e=getUrlParam("otherTypesDocument"),t=[];1==e?t=["","","","","审核标志","日期","单据号","单据类型","结算账户","客户","币别","汇率","收款金额","收款金额(本位币)","收入类别","收款期限","应结算金额","凭证字号","摘要","部门","经手人","制单人","审核人","审核日期","打印次数","备注"]:2==e&&(t=["","","","","审核标志","日期","单据号","单据类型","结算账户","供应商","币别","汇率","付款金额","付款金额(本位币)","支出类别","付款期限","应结算金额","凭证字号","摘要","部门","经手人","制单人","审核人","审核日期","打印次数","备注"]),jQuery("#list").jqGrid({url:rcContextPath+"/otherPaymentReceipt/getPageByType",postData:{otherTypesDocuments:e},datatype:"json",colNames:t,colModel:[{name:"id",width:70,hidden:!0},{name:"voucherId",width:70,hidden:!0},{name:"isVoucher",width:70,hidden:!0},{name:"sobId",width:70,hidden:!0},{name:"auditStatus",width:70,formatter:function(e,t,a,n){return"合计"===e?e:2===e?"Y":"N"}},{name:"documentDate",index:"orderDate",width:90,formatter:function(e,t,a,n){return e.slice(0,10)}},{name:"documentNumber",width:80,align:"left"},{name:"documentTypeName",width:100,align:"left"},{name:"clearanceAccount",width:80,align:"left"},{name:"occurrenceObject",width:80,align:"right"},{name:"coinStop",width:80,align:"left"},{name:"exchangeRate",width:60,align:"left"},{name:"amountPaymentReceivedFors",width:80,align:"right",formatter:function(e,t,a,n){return o.sortData(e,t,a,n)}},{name:"amountPaymentReceiveds",width:110,align:"right",formatter:function(e,t,a,n){return o.sortData(e,t,a,n)}},{name:"genrePaymentsReceiveds",width:80,align:"left",formatter:function(e,t,a,n){return o.sortData(e,t,a,n)}},{name:"receiptPaymentPeriod",width:100,align:"right",formatter:function(e,t,a,n){return e.slice(0,10)}},{name:"payableAmount",width:80,align:"right",formatter:function(e,t,a,n){return accounting.formatMoney(e,"",2)}},{name:"voucherSize",index:"typePaymentReceived",width:80,align:"left"},{name:"summary",width:100,align:"left"},{name:"department",width:80,align:"left"},{name:"brokerage",width:100,align:"left"},{name:"createName",width:100,align:"left"},{name:"auditorName",width:100,align:"left"},{name:"auditorDate",width:100,align:"left",formatter:function(e,t,a,n){return(e||"").slice(0,10)}},{name:"printingTimes",width:70,align:"right"},{name:"remarks",width:100,align:"left",formatter:function(e,t,a,n){return o.sortData(e,t,a,n)}}],rowNum:99999999999,sortorder:"desc",mtype:"post",jsonReader:{root:"data"},sortable:!1,styleUI:"Bootstrap",height:$(window).height()-125,viewrecords:!0,footerrow:!0,userDataOnFooter:!0,gridComplete:o.completeMethod,cellEdit:!0,onCellSelect:function(e){var t=jQuery("#list").jqGrid("getRowData",e);console.log(t,"=====rowData"),vem.rowData=t},ondblClickRow:function(e){console.log(e,"====rowid");var t=getUrlParam("otherTypesDocument"),a="";"1"==t?a="其它收款单":"2"==t&&(a="其它付款单"),_url=contextPath+"/finance/otherReceipts/index.html?otherTypesDocument="+t+"&id="+e+"&action=query",window.parent.activeEvent({name:a,url:_url})}})},completeMethod:function(){$("#list").footerData("set",{auditStatus:"合计",amountPaymentReceivedFors:[0],amountPaymentReceived:[0]});var e=this.getColSum("payableAmount"),t=this.getColSum("amountPaymentReceivedFors"),a=this.getColSum("amountPaymentReceiveds");vem.dataSum.sumPayableAmount=this.getColSum("payableAmount"),vem.dataSum.sumAmountPaymentReceivedFor=this.getColSum("amountPaymentReceivedFors"),vem.dataSum.sumAmountPaymentReceived=this.getColSum("amountPaymentReceiveds"),$("#list").footerData("set",{auditStatus:"合计",payableAmount:e,amountPaymentReceivedFors:[t],amountPaymentReceiveds:[a]})},handleOpen:function(){this.visible_filter=!0},detailClick:function(e){},iconPopup:function(e){this.subjectVisable=!0},subjectClose:function(){this.subjectVisable=!1},conformCancel:function(){this.confirmConfig.showConfirm=!1},conformSure:function(){this.confirmConfig.showConfirm=!1,this.confirmConfig.onlySure=!this.confirmConfig.onlySure},subjectDate:function(e){this.search.ieSubject=e,console.log(this.search.ieSubject)},delRow:function(){console.log(vem.rowData),null!=vem.rowData.id&&"Y"!=vem.rowData.auditStatus?$.ajax({type:"POST",async:!0,data:{id:vem.rowData.id,auditStatus:1},url:rcContextPath+"/otherPaymentReceipt/deleteById",dataType:"json",success:function(e){"100100"==e.code?(vem.$Message.info({content:"数据删除成功",duration:3}),window.location.reload()):vem.$Message.info({content:"数据删除失败",duration:3})},error:function(e){console.log(e)}}):alert("请选择未审核的数据行")},sure:function(e){console.log(vem.filterBody),e&&(vem.pageInit(),jQuery("#list").jqGrid("setGridParam",{url:rcContextPath+"/otherPaymentReceipt/getPageByFilter",postData:vem.filterBody}).trigger("reloadGrid")),this.visible_filter=!1},addRow:function(){var e=getUrlParam("otherTypesDocument"),t="",a=rcContextPath+"/otherReceipts/index.html?otherTypesDocument="+e;"1"==e?t="其他收款单":"2"==e&&(t="其他付款单"),window.parent.activeEvent({name:t,url:a})},copyRow:function(){var e=getUrlParam("otherTypesDocument"),t=rcContextPath+"/otherReceipts/index.html?otherTypesDocument="+e+"&copyOtherTypesDocumentId="+vem.id,a="";"1"==e?a="其他收款单":"2"==e&&(a="其他付款单"),window.parent.activeEvent({name:a,url:t})},review:function(){var t=this;null!=vem.rowData.id&&"Y"!=vem.rowData.auditStatus?$.ajax({type:"post",async:!0,data:{id:vem.rowData.id,auditStatus:1},url:rcContextPath+"/otherPaymentReceipt/executeAudit",dataType:"json",success:function(e){"100100"==e.code?(t.$Message.info({content:"审核成功",duration:3}),$("#list").trigger("reloadGrid")):t.$Message.info({content:e.msg,duration:3})},error:function(e){console.log(e)}}):t.$Message.info({content:"已审核数据不能再进行审核！",duration:3})},reReview:function(){var t=this,e=vem.rowData.auditStatus;e="Y"==e?2:1,$.ajax({type:"post",async:!0,data:{id:vem.rowData.id,auditStatus:e},url:rcContextPath+"/otherPaymentReceipt/reverseAudit",dataType:"json",success:function(e){"100100"==e.code?(t.$Message.info({content:"反审核成功",duration:3}),$("#list").trigger("reloadGrid")):t.$Message.info({content:e.msg,duration:3})},error:function(e){console.log(e)}})},derivation:function(){var e=getUrlParam("otherTypesDocument"),t=vem.filterBody,a=vem.dataSum.sumAmountPaymentReceivedFor,n=vem.dataSum.sumAmountPaymentReceived,o=vem.dataSum.sumPayableAmount;window.frames.exportIframe.location.href=contextPath+"/otherPaymentReceipt/exportExcel?otherTypesDocuments="+e+"&sumAmountPaymentReceivedFor="+a+"&sumAmountPaymentReceived="+n+"&sumPayableAmount="+o+"&timeStart="+t.timeStart+"&timeEnd"+t.timeEnd+"&dateSource"+t.dateScore+"&auditStatus"+t.auditStatus+"&isVoucher"+t.isVoucher+"&documentNumber"+t.documentNumber}},"print",function(){console.log("打印")}),mounted:function(){this.pageInit(),this.openTime=window.parent.params&&window.parent.params.openTime}});