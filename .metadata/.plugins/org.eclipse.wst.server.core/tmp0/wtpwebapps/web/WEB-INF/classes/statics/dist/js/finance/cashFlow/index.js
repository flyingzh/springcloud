"use strict";var _ref;function _defineProperty(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}new Vue((_defineProperty(_ref={el:"#profit-statement",data:function(){return{btn:"",isEdit:!1,optionList:[{label:"月报",value:1},{label:"季报",value:2}],reload:!1,formData:"",selected:[],dateList:[],editTitle:"",fatherid:0,rowNums:0,headline:"",printModal:!1,printInfo:{},editVisable:!1,tableList:[],printTableList:{},newTableList:[],base_config:{treeGridModel:"adjacency",ExpandColumn:"username",scroll:"true",mtype:"POST",styleUI:"Bootstrap",url:"./index.json",datatype:"json",colNames:["项目","行次","本月数","本年数","computeType","isCompute","parentLine","id","rowNum","name","rowPosition","formula"],jsonReader:{root:"data",cell:"data",repeatitems:!1},sortable:!1,height:$(window).height()-140,viewrecords:!0,rowNum:999,pager:"#my_pager"},colModel:[]}},mounted:function(){},methods:{initMethod:function(){this.delTable(),this.initTable()},initTable:function(){this.jqGridInit(this)},delTable:function(){$("#my_table").empty();var e=$(".jqGrid_wrapper");e.empty(),$("<table id='my_table'></table><div id='my_pager'></div>").appendTo(e)},jqGridInit:function(i){var a=this,e=Object.assign({},this.base_config,{colModel:this.colModel,loadError:function(e,t,n){console.log("xhr,status,error",e,t,n)},loadComplete:function(e){console.log("item",e),a.printTableList=e.data||[],"-1"===e.code&&a.$Message.info({content:e.msg+",请重新刷新页面获取数据",duration:3});var t=jQuery("#my_table").jqGrid("getRowData"),n=$("#my_table").jqGrid("getDataIDs");t.push($("#my_table").jqGrid("getRowData",n[n.length-1])),i.isEdit&&(t.forEach(function(n){-1<n.amount1.indexOf("form-control")&&n.amount1.split(" ").forEach(function(e){if(!(e.indexOf("value")<0)){var t=e.substring(7,e.length-1);n.amount1=t?Number(t).toFixed(2):""}});-1<n.amount2.indexOf("form-control")&&n.amount2.split(" ").forEach(function(e){if(!(e.indexOf("value")<0)){var t=e.substring(7,e.length-1);n.amount2=t?Number(t).toFixed(2):""}})}),i.tableList=t)},gridComplete:function(){}});jQuery("#my_table").jqGrid(e)},editTable:function(){this.newTableList=[];var a=this;this.isEdit=!0;var e=a.formData.split("_");this.base_config.url=baseURL+"report/getInit?accountYear="+e[0]+"&accountPeriod="+e[1],this.colModel=[{name:"fieldName",index:"fieldName",width:400,align:"left"},{name:"lineNum",index:"lineNum",width:200,align:"center",formatter:function(e,t,n,i){var a=n.lineNum;return-1!==a?a:""}},{name:"amount1",index:"amount1",width:150,align:"center",formatter:function(e,t,i,n){$(document).off("blur",".pre"+i.id).on("blur",".pre"+i.id,function(e){var t=e.target.value?Number(e.target.value).toFixed(2):"";if(e.target.value=t,a.accountNum(t,i,"amount1","pre"),3!==i.isCompute){var n=a.newTableList.filter(function(e){return e.rowNum===i.rowNum});console.log("_f",n),i.amount1=t,n.length?n=i:a.newTableList.push(i)}console.log("that.newTableList",a.newTableList,i)});return 1!==i.isCompute?'<input value="'+i.amount1+'" disabled class="pre'+i.id+' form-control text-right" type="number"/>':'<input value="'+i.amount1+'" class="pre'+i.id+' form-control text-right" type="number"/>'}},{name:"amount2",index:"amount2",width:150,align:"center",hidden:!0,formatter:function(e,t,n,i){$(document).off("blur",".prea"+n.id).on("blur",".prea"+n.id,function(e){var t=e.target.value?Number(e.target.value).toFixed(2):"";e.target.value=t,a.accountNum(t,n,"amount2","prea")});return 1!==n.isCompute?'<input value="'+n.amount2+'" disabled class="prea'+n.id+' form-control text-right" type="number"/>':'<input value="'+n.amount2+'" class="prea'+n.id+' form-control text-right" type="number"/>'}},{name:"computeType",index:"computeType",hidden:!0},{name:"isCompute",index:"isCompute",hidden:!0},{name:"parentLine",index:"parentLine",hidden:!0},{name:"id",index:"id",hidden:!0},{name:"rowNum",index:"rowNum",hidden:!0},{name:"name",index:"name",hidden:!0},{name:"rowPosition",index:"rowPosition",hidden:!0},{name:"formula",index:"formula",hidden:!0}],this.delTable(),this.initTable()},accountNum:function(l,d,u,s){var c=this;d.parentLine.split(",").forEach(function(i){var a=[];c.tableList.forEach(function(e){e.id==d.id&&(e[u]=l);var n=Object.assign({},e);n.parentLine.split(",").forEach(function(e,t){e===i&&(c.$set(n,"computeIndex",t),c.$set(n,"computeSum",Number(e)),a.push(n))})});var n=0,o=0;a.forEach(function(e){var t=e.computeType.split(",");n+=Number(t[e.computeIndex]+c.formatNum(1*e[u],1)),o=e.computeSum});var e=c.tableList.find(function(e){return e.lineNum==o});if(e){var t=n?n.toFixed(2):"";console.log("totalVal",t,$("."+s+e.id)),e[u]=t,$("."+s+e.id)[0].value=t;var r=e.parentLine.split(",");if(1===r.length&&!r[0])return;c.accountNum(t,e,u,s)}})},formatNum:function(e,t){var n=Math.pow(1e3,t);return parseInt(e*n,10)/n},detailClick:function(e){this.editTitle="编辑公式 - "+e.fieldName,this.fatherid=e.id,this.rowNums=e.rowNum,this.headline,console.log(this.fatherid,"-----------==========-------------",e),this.editVisable=!0},editClose:function(){this.refresh(),this.editVisable=!1},save:function(){var e=JSON.parse(JSON.stringify(this.newTableList));console.log(e);var i=this;if(i.newTableList.length){var t="<p>第";i.newTableList.forEach(function(e){t=t+e.rowNum+"行,"}),t+="数据将被修改,且修改后将不做公式计算操作</p>",i.$Modal.confirm({title:"系统提示",content:t,onOk:function(){var e=i.formData.split("_"),t=contextPath+"/report/saveReport",n={accountYear:e[0],accountPeriod:e[1],reportContentEntities:i.newTableList};$.ajax({type:"post",data:JSON.stringify(n),url:t,dataType:"json",contentType:"application/json;charset=utf-8",success:function(e){console.log(e);var t="";t=(e.code,e.msg),i.$Message.info({content:t,duration:3})},error:function(e){console.log(e)}})},onCancel:function(){i.$Message.info("取消保存")}})}else i.$Message.info({content:"没有要更新的数据",duration:3})},clear:function(){this.editTable()},deleteOrve:function(){this.toBack(2)},_ajaxDateList:function(){var n=this;$.ajax({type:"get",data:"",url:"./index.json",dataType:"json",success:function(e){var t=e.data;n.dateList=t.list},error:function(e){console.log(e)}})},toBack1:function(){this.toBack()},toBack:function(e){e=e||1,this.isEdit=!1;var t=this.formData.split("_");console.log("_type=====>>>",e),console.log("arr",t),this.base_config.url=1===e?baseURL+"report/getInit?accountYear="+t[0]+"&accountPeriod="+t[1]:baseURL+"report/deleteOrve?accountYear="+t[0]+"&accountPeriod="+t[1];var a=this;this.colModel=[{name:"fieldName",index:"fieldName",width:400,align:"left",formatter:function(e,t,n,i){$(document).off("click",".detail"+n.id).on("click",".detail"+n.id,function(){a.detailClick(n)});return 1===n.isCompute?'<div class="detail'+n.id+' fieldName">'+n.fieldName+"</div>":"<div>"+n.fieldName+"</div>"}},{name:"lineNum",index:"lineNum",width:200,align:"center",formatter:function(e,t,n,i){var a=n.lineNum;return-1!==a?a:""}},{name:"amount1",index:"amount1",width:150,align:"center"},{name:"amount2",index:"amount2",width:150,align:"center",hidden:!0},{name:"computeType",index:"computeType",hidden:!0},{name:"isCompute",index:"isCompute",hidden:!0},{name:"parentLine",index:"parentLine",hidden:!0},{name:"id",index:"id",hidden:!0},{name:"rowNum",index:"rowNum",hidden:!0},{name:"name",index:"name",hidden:!0},{name:"rowPosition",index:"rowPosition",hidden:!0},{name:"formula",index:"formula",hidden:!0}],this.delTable(),this.initTable()},refresh:function(){this.reload=!0,this.toBack()},dateChange:function(){var e=this.formData.split("_");console.log("arr====>",e);var t=baseURL+"report/getInit?accountYear="+e[0]+"&accountPeriod="+e[1];$("#my_table").jqGrid("setGridParam",{url:t}).trigger("reloadGrid")},exportExcel:function(){var e=this.formData.split("_");window.open(baseURL+"report/derivedTable?accountYear="+e[0]+"&accountPeriod="+e[1])},printModalShow:function(e){this.printModal=e},print:function(){var e=this;if(console.log(e.printTableList,"=========that.printTableList"),e.printTableList&&e.printTableList.length){console.log("that.printTableList",e.printTableList);var t={title:"核算项目明细表",template:1,titleInfo:[],colNames:[{name:"项目",col:"fieldName"},{name:"行次",col:"lineNum"},{name:"本月数",col:"amount1"}],styleCss:"",colMaxLenght:9,data:e.printTableList};e.printInfo=t,e.printModalShow(!0)}else e.$Message.info({content:"无打印数据",duration:3})}}},"mounted",function(){var t=this,e=contextPath+"/report/accountPeriodList";$.ajax({type:"post",data:"",url:e,dataType:"json",analysis:!1,success:function(e){console.log(e,"获取总帐会计期间列表"),t.dateList=e.data,e.data&&e.data.length&&(t.formData=t.dateList[0].value),t.$nextTick(function(){t.toBack()})},error:function(e){console.log(e)}})}),_defineProperty(_ref,"computed",{_test:function(){var e=this.formData.split("_");return null!=e?e[0]+"年"+e[1]+"月":""}}),_ref));