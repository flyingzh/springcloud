"use strict";function _defineProperty(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var purchaseDeliver=new Vue({el:"#purchaseDeliver",data:function(){var e;return _defineProperty(e={isMyTable2:!1,deliveryName:"",goodlist:[],categoryType:[],commodityCategoty:[],suppliers:[],configList:[{documentNo:""}],cityList3:[{value:"1",label:"暂存"},{value:"2",label:"待审核"},{value:"3",label:"审核中"},{value:"4",label:"已审核"},{value:"5",label:"驳回"}],selected:[],selected2:[],openTime:"",isSearchHide:!0,isTabulationHide:!0,isFirstData:!1,isLastData:!1,isHide:!0,orgName:""},"selected",[]),_defineProperty(e,"needReload",!1),_defineProperty(e,"approveComment",!1),_defineProperty(e,"rejectComment",!1),_defineProperty(e,"approvement",{receiptsId:"",approvalResult:"1",approvalInfo:""}),_defineProperty(e,"rejectement",{receiptsId:"",approvalResult:"0",approvalInfo:""}),_defineProperty(e,"isEditDisable",!1),_defineProperty(e,"isShow",!1),_defineProperty(e,"isEdit",!1),_defineProperty(e,"docType",[]),_defineProperty(e,"dataValue",[]),_defineProperty(e,"categoryType",[]),_defineProperty(e,"commodityCategoty",[]),_defineProperty(e,"reload",!1),_defineProperty(e,"testBusinessType",null),_defineProperty(e,"testSupplierId",null),_defineProperty(e,"testGoodsTypeId",null),_defineProperty(e,"confirmConfig",{showConfirm:!1,title:"提示",content:"请点击确认",onlySure:!0,success:!0}),_defineProperty(e,"body",{goodsTypeId:null,documentNo:"",goodsTypeName:"",goodsType:"",supplierId:null,supplierName:"",startTime:null,endTime:null,orderStatus:null,orderNo:""}),_defineProperty(e,"data_config1",{url:"/web/purchaseDeliverController/firstlist?organizationId="+window.parent.userInfo.organId,colNames:["源单类型","日期","单据编号","供应商","商品类型","送料重量","送料数量"],colModel:[{name:"businessType",index:"businessType",align:"left",width:330,formatter:function(e){return"调拨单-采购送料"}},{name:"transferTime",index:"transferTime",width:280,align:"left",formatter:function(e){var t=new Date(e);return t.getFullYear()+"/"+(t.getMonth()+1)+"/"+t.getDate()}},{name:"documentNo",index:"documentNo",align:"left",width:280},{name:"supplierName",index:"supplierName",align:"left",width:320},{name:"goodsTypeId",index:"goodsTypeId",width:280,align:"left",formatter:function(e){return 1==e?"金料":2==e?"石料":3==e?"配件":""}},{name:"totalTransferWeigh",index:"totalTransferWeigh",width:280,align:"left"},{name:"totalTransferNum",index:"totalTransferNum",width:280,align:"left"}]}),_defineProperty(e,"data_config3",{url:"/web/purchaseDeliverController/list?organizationId="+window.parent.userInfo.organId,colNames:["单据编号","日期","供应商","单据状态","商品类型","送料重量","送料数量"],colModel:[{name:"orderNo",index:"orderNo",width:300,align:"left",formatter:function(e,t,r,a){return $(document).off("click",".detail"+e).on("click",".detail"+e,function(){purchaseDeliver.testOrderDetailClick({value:e,grid:t,rows:r,state:a})}),'<a class="detail'+e+'">'+e+"</a>"},unformat:function(e,t,r){return e.replace(/(<\/?a.*?>)/g,"")}},{name:"deliveryDate",index:"deliveryDate",width:230,align:"left",formatter:function(e){var t=new Date(e);return t.getFullYear()+"/"+(t.getMonth()+1)+"/"+t.getDate()}},{name:"supplierName",index:"supplierName",align:"left",width:320},{name:"orderStatus",index:"orderStatus",width:280,align:"left",formatter:function(e){return 1==e?"暂存":2==e?"待审核":3==e?"审核中":4==e?"已审核":5==e?"驳回":""}},{name:"goodsTypeName",index:"goodsTypeName",align:"left",width:280},{name:"deliverWeight",index:"deliverWeight",width:280,align:"left"},{name:"deliverCount",index:"deliverCount",width:280,align:"left"}]}),_defineProperty(e,"data_config_approval",{url:"",colNames:["操作类型","开始级次","目的级次","审批人","审批意见","审批时间"],colModel:[{name:"approvalResult",width:200,align:"left",formatter:function(e,t,r,a){return 1==e?"审核":"驳回"}},{name:"currentLevel",width:200,align:"left",formatter:function(e,t,r,a){return 0===e?"开始":1===e?"一级审核":2===e?"二级审核":3===e?"三级审核":4===e?"四级审核":5===e?"五级审核":6===e?"六级审核":"结束"}},{name:"nextLevel",width:200,align:"left",formatter:function(e,t,r,a){return-1===r.approvalResult||0===r.approvalResult&&void 0===r.nextLevel?"开始":"0"===e?"开始":"1"===e?"一级审核":"2"===e?"二级审核":"3"===e?"三级审核":"4"===e?"四级审核":"5"===e?"五级审核":"6"===e?"六级审核":"结束"}},{name:"createName",width:200,align:"left"},{name:"approvalInfo",width:220,align:"left"},{name:"createTime",width:250,align:"left"}],jsonReader:{root:"data.data"},multiselect:!1}),_defineProperty(e,"steplist",[]),_defineProperty(e,"stepData",[{currentLevel:0,subtitle:"开始"},{currentLevel:1,subtitle:"一级审批"},{currentLevel:2,subtitle:"二级审批"},{currentLevel:3,subtitle:"三级审批"},{currentLevel:4,subtitle:"四级审批"},{currentLevel:5,subtitle:"五级审批"},{currentLevel:6,subtitle:"六级审批"},{currentLevel:7,subtitle:"结束"}]),_defineProperty(e,"currentStep",""),_defineProperty(e,"nextStep",""),e},methods:{testOrderDetailClick:function(e){console.log(e);var t=e.rows.id,r=e.rows;t&&this.queryOrderByOrderNo(t,!0,r)},queryOrderByOrderNo:function(e,t,r){var a={id:e,orderNo:r.orderNo,isRead:!0};window.parent.activeEvent({name:"查看采购送料单详情",url:contextPath+"/purchase/purchaseDeliver/purchaseDeliver.html",params:a})},isEdit2:function(e){eventHub.$emit("isEdit",e)},saveAccess:function(e,t){eventHub.$emit("saveFile",e,t)},getAccess:function(e,t){eventHub.$emit("queryFile",e,t)},build:function(){var e=[];if(purchaseDeliver.selected.length<1)return layer.alert("请先选择一条记录!"),!1;if(1<=purchaseDeliver.selected.length){for(var t=0;t<purchaseDeliver.selected.length;t++){var r=jQuery("#myTable1").jqGrid("getRowData",purchaseDeliver.selected[t]),a={};a.documentNo=r.documentNo,e.push(a),testBusinessType=jQuery("#myTable1").jqGrid("getRowData",this.selected[0]).businessType,testSupplierId=jQuery("#myTable1").jqGrid("getRowData",this.selected[0]).supplierId,testGoodsTypeId=jQuery("#myTable1").jqGrid("getRowData",this.selected[0]).goodsTypeId}for(var i=0;i<this.selected.length;i++){r=jQuery("#myTable1").jqGrid("getRowData",this.selected[i]);if(testBusinessType!=r.businessType)return layer.alert("源单类型不一致，不能多选生成采购送料单!!"),!1;if(testSupplierId!=r.supplierId)return layer.alert("供应商不一致，不能多选生成采购送料单!!"),!1;if(testGoodsTypeId!=r.goodsTypeId)return layer.alert("商品类型不一致，不能多选生成采购送料单!!"),!1}this.configList=[]}this.isMyTable2=!0;var n=e;window.parent.activeEvent({name:"采购送料单",url:contextPath+"/purchase/purchaseDeliver/purchaseDeliver.html",params:n}),console.log(this.isMyTable2)},refresh:function(){window.location.reload()},search:function(){0<this.commodityCategoty.length?this.body.goodsTypeName=this.commodityCategoty[this.commodityCategoty.length-1]:this.body.goodsTypeName="",console.log(this.body),this.reload=!this.reload},clear:function(){this.commodityCategoty=[],this.dataValue=[],this.body=Object.assign({},{goodsTypeId:null,documentNo:"",goodsTypeName:"",goodsType:"",supplierId:null,supplierName:null,startTime:"",endTime:"",orderStatus:null,orderNo:"",dataValue:null})},search3:function(){console.log(this.body),this.reload=!this.reload,console.log(this.body)},clear3:function(){console.log(this.body),this.body={goodsType:"",supplierId:null,startTime:"",endTime:"",orderStatus:null,orderNo:""},console.log(this.body)},deleteData:function(){if(purchaseDeliver.selected2.length<1&&layer.alert("请至少选择一条数据！"),1<=purchaseDeliver.selected2.length)for(var e=purchaseDeliver.selected2,t=0;t<e.length;t++){if("暂存"!=jQuery("#myTable3").jqGrid("getRowData",e[t]).orderStatus)return void layer.alert("您选择的第"+(t+1)+"行的单据状态不是暂存，不能删除！")}this.$Modal.confirm({title:"提示信息",content:"<p>是否要删除信息？</p>",onOk:function(){console.log(JSON.stringify(purchaseDeliver.selected2));jQuery("#myTable3").jqGrid("getRowData",purchaseDeliver.selected2);$.ajax({type:"POST",url:"/web/purchaseDeliverController/delete",contentType:"application/json",data:JSON.stringify(purchaseDeliver.selected2),dataType:"json",success:function(e){"100100"==e.code?(layer.alert("删除数据成功",{icon:1}),purchaseDeliver.selected2.length=0,window.location.reload()):layer.alert("删除数据失败",{icon:0})},error:function(e){layer.alert(e)}})},onCancel:function(){}})},changeDate:function(e){this.body.startTime=e[0].replace(/\//g,"-")+" 00:00:00",this.body.endTime=e[1].replace(/\//g,"-")+" 23:59:59"},changeDeliveryDate:function(e){this.body.startTime=e[0].replace(/\//g,"-")+" 00:00:00",this.body.endTime=e[1].replace(/\//g,"-")+" 23:59:59"},hideSearch:function(){this.isHide=!this.isHide,this.isSearchHide=!this.isSearchHide,$(".chevron").css("top","")},hidTabulation:function(){this.isHide=!this.isHide,this.isTabulationHide=!this.isTabulationHide,this.isTabulationHide?$(".chevron").css("top",""):$(".chevron").css("top","83%")},initApproval:function(e){var o=this;$.ajax({type:"post",data:{},dataType:"json",success:function(e){for(var t=e.data.list,r=0;r<t.length;r++)switch(t[r].processLevel){case 1:t[r].processLevel="一级审核";break;case 2:t[r].processLevel="二级审核";break;case 3:t[r].processLevel="三级审核";break;case 4:t[r].processLevel="四级审核";break;case 5:t[r].processLevel="五级审核";break;case 6:t[r].processLevel="六级审核"}if(t.unshift({processLevel:"开始"}),t.push({processLevel:"结束"}),(o.steplist=t)[1].currentLevel===e.data.levelLength){for(var a=0;a<t.length;a++)t[a].currentLevel=t.length-1;return!1}for(var i=t[1].currentLevel,n=0;n<o.stepData.length;n++)i===o.stepData[n].currentLevel&&(o.currentStep=o.stepData[n+1].subtitle,o.stepData[n+1].currentLevel===e.data.levelLength?o.nextStep=o.stepData[o.stepData.length-1].subtitle:o.nextStep=o.stepData[n+2].subtitle)}})},add3:function(){window.parent.activeEvent({name:"采购送料单",url:contextPath+"/purchase/purchaseDeliver/purchaseDeliver-add.html",params:!0})},update3:function(){if(0!=purchaseDeliver.selected2.length)if(1==purchaseDeliver.selected2.length)if("已审核"!=(a=jQuery("#myTable3").jqGrid("getRowData",purchaseDeliver.selected2)).orderStatus){var a,i=0,e=(a=jQuery("#myTable3").jqGrid("getRowData",purchaseDeliver.selected2)).orderNo,n=null;0==i&&$.ajax({type:"POST",url:"/web/purchaseDeliverController/queryByOrderNo",contentType:"application/json",data:JSON.stringify(e),success:function(e){if(n=e.data.data.dataSource,(i=1)==i)if(1==n){var t={id:purchaseDeliver.selected2[0],orderNo:a.orderNo};window.parent.activeEvent({name:"采购送料单",url:contextPath+"/purchase/purchaseDeliver/purchaseDeliver.html",params:t})}else{var r={id:purchaseDeliver.selected2[0],orderNo:a.orderNo};window.parent.activeEvent({name:"采购送料单",url:contextPath+"/purchase/purchaseDeliver/purchaseDeliver.html",params:r})}},error:function(e){alert(e)}})}else layer.alert("该条数据状态为已审核,不能修改");else layer.alert("只能选择一条数据！");else layer.alert("请先选择一条数据！")},saveClick:function(e){console.log(e)},approval:function(){},reject:function(){},loadProductType:function(){var t=this;$.ajax({type:"post",url:contextPath+"/documentController/getCategory?parentId=0",contentType:"application/json",dataType:"json",success:function(e){t.categoryType=t.initGoodCategory(e.data.cateLists)},error:function(e){console.log("服务器出错")}})},initGoodCategory:function(e){var i=this,n=[];return e.forEach(function(e){var t=e.name,r=e.name,a=e.cateLists;a&&(a=i.initGoodCategory(a)),n.push({value:t,label:r,children:a})}),n.forEach(function(e){e.children||delete e.children}),n},loadSuppliers:function(){var t=this;$.ajax({type:"post",url:contextPath+"/tpurchasecollectgoods/findSupplierByOrgId",dataType:"json",success:function(e){t.suppliers=e.data},error:function(){console.log("服务器出错啦")}})},exit1:function(){window.parent.closeCurrentTab({name:"采购待送料列表",exit:!0,openTime:this.openTime})},exit2:function(){window.parent.closeCurrentTab({name:"采购送料单",exit:!0,openTime:this.openTime})},exit3:function(){window.parent.closeCurrentTab({name:"采购送料单列表",exit:!0,openTime:this.openTime})},getApproveInfo:function(){},getRejectInfo:function(){}},watch:{},created:function(){this.loadProductType(),this.initApproval(),this.loadSuppliers()},mounted:function(){this.openTime=window.parent.params.openTime,this.orgName=window.parent.userInfo.organization.orgName}});