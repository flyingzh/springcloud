"use strict";var parvm=new Vue({el:"#paraLevel",data:function(){return{isEdit:!1,isView:!1,reload:!1,disabledFlag:!1,codeFlag:!1,excelShow:!1,bodyShow:!0,nameFlag:!0,buttonFlag:!0,isSearchHide:!0,query:"",openTime:"",itemList:[],selected:[],styles:[],optionStyle:{},body:{styleCode:"",styleName:"",startQualifiedRatio:"",endQualifiedRatio:"",startLaborRateRatio:"",endLaborRateRatio:"",startKossFateRatio:"",endKossFateRatio:"",startDeliveryCycleRatio:"",endDeliveryCycleRatio:"",startUpdateTime:"",endUpdateTime:"",updateName:""},paramWeight:{id:"",styleCode:"",styleName:"",qualifiedRatio:"",laborRateRatio:"",kossFateRatio:"",deliveryCycleRatio:"",otherRatio:"",remark:"",createId:"",createName:"",updateId:"",updateName:""},data_config:{url:contextPath+"/tbaseparamweight/list",colNames:["商品代码","商品名称","质量合格率占比","工费率占比","损耗率占比","交货周期占比","其它占比","备注"],colModel:[{name:"styleCode",width:250,align:"left",formatter:function(e,a){return $(document).off("click",".detail"+e).on("click",".detail"+e,function(){parvm.paramWeight.styleCode=e,parvm.detailClick()}),'<a class="detail'+e+'">'+e+"</a>"}},{name:"styleName",index:"invdate",width:250,align:"left",formatter:function(e){return e}},{name:"qualifiedRatio",index:"",width:140,align:"right"},{name:"laborRateRatio",index:"",width:140,align:"right"},{name:"kossFateRatio",index:"",width:140,sortable:!1,align:"right"},{name:"deliveryCycleRatio",index:"",width:140,align:"right"},{name:"otherRatio",index:"",width:140,sortable:!1,align:"right"},{name:"remark",index:"",width:200,sortable:!1,align:"left"}]}}},methods:{searchItemCode:function(e){this.query=e,this.getOption()},getOption:function(){var e={mainType:"",field:""};e.field=this.query;var a=this;$.ajax({url:contextPath+"/tbasecommodity/findByCommodity",type:"post",data:e,dataType:"json",success:function(e){a.itemList=e.data,a.query=""},error:function(){alert("服务器出错")}})},add_click:function(){console.log(this.isEdit),parvm.paramWeightClear(),parvm.codeFlag=!1,parvm.disabledFlag=!1,parvm.buttonFlag=!0,this.isEdit=!0,this.searchItemCode("")},del_click:function(){var t=this,i=t.selected;if(console.log(i),!ht.util.hasValue(i,"array"))return layer.alert("请先选择一条记录!"),!1;layer.confirm("当前数据有可能被引用，会影响数据准确性，确认是否删除？",{btn:["确定","取消"]},function(e,a){$.ajax({type:"POST",url:contextPath+"/tbaseparamweight/delete",contentType:"application/json",data:JSON.stringify(i),dataType:"json",success:function(e){"100100"==e.code?(layer.closeAll("dialog"),layer.alert(e.data),t.selected=[],t.reload=!t.reload):layer.alert(e.msg)},error:function(e){console.log("error")}})})},sure:function(){this.reload=!this.reload},clear:function(){this.body={styleCode:"",styleName:"",startQualifiedRatio:"",endQualifiedRatio:"",startLaborRateRatio:"",endLaborRateRatio:"",startKossFateRatio:"",endKossFateRatio:"",startDeliveryCycleRatio:"",endDeliveryCycleRatio:"",startUpdateTime:"",endUpdateTime:"",updateName:""},this.$refs.startUpdateTime.date="",this.$refs.endUpdateTime.date="",this.reload=!this.reload},parvnInit:function(){this.body={styleCode:"",styleName:"",startQualifiedRatio:"",endQualifiedRatio:"",startLaborRateRatio:"",endLaborRateRatio:"",startKossFateRatio:"",endKossFateRatio:"",startDeliveryCycleRatio:"",endDeliveryCycleRatio:"",startUpdateTime:"",endUpdateTime:"",updateName:""}},paramWeightClear:function(){this.paramWeight={id:"",styleCode:"",styleName:"",qualifiedRatio:"",laborRateRatio:"",kossFateRatio:"",deliveryCycleRatio:"",otherRatio:"",remark:"",createId:"",createName:"",updateId:"",updateName:""}},modify:function(){var e=this.selected;if(parvm.buttonFlag=!0,!ht.util.hasValue(e,"array"))return layer.alert("请先选择一条记录!"),!1;this.paramWeight.id=this.selected[0],parvm.queryParamWeight(),parvm.disabledFlag=!1,this.isEdit=!0},hideSearch:function(){this.isSearchHide=!this.isSearchHide,$(".chevron").css("top","")},myImport:function(){console.log("金导入了。。。"),parvm.bodyShow=!1,parvm.excelShow=!0,layui.use("upload",function(){layui.upload.render({elem:"#upload",url:contextPath+"/tbaseparamweight/import",method:"POST",accept:"file",size:10720,before:function(e){layer.load()},done:function(e){layer.alert(e.msg),layer.closeAll("loading");for(var a="",t=0;t<e.length;t++)a=a+e[t].nsrsbh+"="+e[t].container+"\n";$("#result").html(a)},error:function(){layer.closeAll("loading"),layer.msg("网络异常，请稍后重试！")}})})},myExport:function(){console.log("进到出了。。。")},signOut:function(){parvm.bodyShow=!0,parvm.excelShow=!1,this.reload=!this.reload},exit:function(){console.log("仅推出了。。。"),window.parent.closeCurrentTab({exit:!0,openTime:this.openTime})},copy:function(){console.log("进复制了。。。");if(parvm.buttonFlag=!0,1!=this.selected.length)return layer.alert("请选择一条记录!"),!1;$.ajax({type:"POST",url:contextPath+"/tbaseparamweight/info",data:{id:this.selected[0]},success:function(e){console.log(e),parvm.paramWeight.qualifiedRatio=e.data.qualifiedRatio,parvm.paramWeight.laborRateRatio=e.data.laborRateRatio,parvm.paramWeight.kossFateRatio=e.data.kossFateRatio,parvm.paramWeight.deliveryCycleRatio=e.data.deliveryCycleRatio,parvm.paramWeight.otherRatio=e.data.otherRatio,parvm.paramWeight.remark=e.data.remark}}),this.isEdit=!0},queryParamWeight:function(){console.log("金查询了。。。。。");$.ajax({type:"POST",url:contextPath+"/tbaseparamweight/info",data:{id:parvm.paramWeight.id},success:function(e){parvm.paramWeight=e.data,parvm.paramWeight.styleCode=e.data.styleCode}}),parvm.codeFlag=!0,parvm.disabledFlag=!0},save:function(){var a=this;console.log($("#my_from").valid()),$("#my_from").valid()&&(a.buttonFlag=!1,""===a.paramWeight.id?(console.log("进新增了。。。"),$.ajax({type:"POST",url:contextPath+"/tbaseparamweight/save",contentType:"application/json",data:JSON.stringify(a.paramWeight),success:function(e){a.buttonFlag=!0,"100100"===e.code?(layer.alert(e.msg,{icon:1,end:function(){parvm.parvnInit(),a.reload=!a.reload,a.isEdit=!1}}),console.log(e.msg)):layer.alert(e.msg)},error:function(e){console.log("服务器出错")}})):(console.log("进修改了。。。"),$.ajax({type:"POST",url:contextPath+"/tbaseparamweight/update",contentType:"application/json",data:JSON.stringify(a.paramWeight),success:function(e){"100100"===e.code?layer.alert(e.msg,{icon:1,end:function(){a.reload=!a.reload,a.isEdit=!1,a.buttonFlag=!0}}):console.log(e.msg)}})))},initFormValidate:function(){var e={errorPlacement:function(e,a){$(a).closest("div").append(e)},rules:{code:{required:!0,max:20,remote:{url:contextPath+"/tbaseparamweight/infoByCodeOrName",type:"post",dataType:"json",data:{styleCode:function(){return parvm.body.styleCode}},dataFilter:function(e,a){return"100100"===JSON.parse(e).code}}},name:{required:!0,max:20},qualifiedRatio:{validField:!0,required:!0,range:[0,100],digits:!0},laborRateRatio:{validField:!0,required:!0,range:[0,100],digits:!0},kossFateRatio:{validField:!0,required:!0,range:[0,100],digits:!0},deliveryCycleRatio:{validField:!0,required:!0,range:[0,100],digits:!0},otherRatio:{validField:!0,required:!0,range:[0,100],digits:!0}},messages:{code:{required:"请填写编码!",max:"最大长度不得大于20位",remote:"商品代码已存在!"},name:{required:"请填写名称!"},qualifiedRatio:{required:"请填写质量合格率占比!",range:"请输入0 到100 位数字"},laborRateRatio:{required:"请填写工费率占比!",range:"请输入0 到100 位数字"},kossFateRatio:{required:"请填写损耗费率占比!",range:"请输入0 到100 位数字"},deliveryCycleRatio:{required:"请填写交货周期占比!",range:"请输入0 到100 位数字"},otherRatio:{required:"请填写其他占比!",range:"请输入0 到100 位数字"},remark:{maxlength:"备注最大长度为500!"}}};$("#my_from").validate(e)},cancel:function(){$("#my_from").validate().resetForm(),parvm.parvnInit(),this.isEdit=!1,this.buttonFlag=!0,this.selected=[],this.reload=!this.reload},forStyle:function(e){var a=!0,t=!1,i=void 0;try{for(var o,r=parvm.itemList[Symbol.iterator]();!(a=(o=r.next()).done);a=!0){var l=o.value;l.code==e&&(parvm.paramWeight.styleName=l.name)}}catch(e){t=!0,i=e}finally{try{!a&&r.return&&r.return()}finally{if(t)throw i}}},getUser:function(){$.ajax({type:"POST",url:contextPath+"/tbaseunit/findUser",success:function(e){console.log(e),parvm.paramWeight.createName=e.data.username,parvm.paramWeight.createId=e.data.createId}})},detailClick:function(){$.ajax({type:"POST",url:contextPath+"/tbaseparamweight/infoByCodeOrName",data:{styleCode:parvm.paramWeight.styleCode},success:function(e){parvm.paramWeight=e.data,parvm.paramWeight.styleName=e.data.styleName,console.log(e)}}),parvm.codeFlag=!0,parvm.disabledFlag=!0,this.isEdit=!0}},watch:{isEdit:function(e){}},created:function(){$.ajax({type:"POST",url:contextPath+"/tbasestylecategory/list",success:function(e){parvm.styles=e.data,console.log("初始化。。。",e)}})},mounted:function(){this.initFormValidate(),jQuery.validator.addMethod("validField",function(e,a){return/^(0|100|[1-9]{1}\d?)$/.test(e)},"请输入0-100之间的数值，支持小数"),this.openTime=window.parent.params.openTime}});