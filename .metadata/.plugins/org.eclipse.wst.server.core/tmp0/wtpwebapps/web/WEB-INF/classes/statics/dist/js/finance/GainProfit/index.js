"use strict";var ve=new Vue({el:"#gainProfit",data:function(){var t=this;return{currentYear:0,currentMonth:0,currentLastDay:0,voucher:"",voucherVisible:!1,voucherStatus:1,editData:{datetime:"2018-9-12",pzNumber:"",remark:""},pzNumberList:[{lable:"test",id:1}],remarkVisable:!1,remarklist:[],selectListId:[],lastSelection:"",base_config:{mtype:"POST",styleUI:"Bootstrap",url:contextPath+"/transferprofitloss/listprofitlosssubject",ajaxGridOptions:{contentType:"application/json;charset=utf-8"},datatype:"json",rownumbers:!0,jsonReader:{root:"data"},viewrecords:!0,rowNum:999999999,beforeRequest:function(){t.selectListId=[]},onCellSelect:function(t){var e=jQuery("#list").jqGrid("getRowData",t);console.log(e,"选中单行数据---------=>")},onSelectAll:function(t,e){},ondblClickRow:function(t){}}}},methods:{getYear:function(){var e=this;$.ajax({url:contextPath+"/transferprofitloss/year",type:"post",dataType:"json",async:!1,success:function(t){e.currentYear=t.data}})},getMonth:function(){var e=this;$.ajax({url:contextPath+"/transferprofitloss/month",type:"post",dataType:"json",async:!1,success:function(t){e.currentMonth=t.data}})},getLastDay:function(t,e){var a=new Date(t,e,1);return cdt=new Date(a.getTime()-864e5),cdt.getDate()},lastday:function(){var t=this;t.currentLastDay=t.getLastDay(t.currentYear,t.currentMonth)},transfer:function(){var e=this,t={};t.voucherDate=this.editData.datetime.getFullYear()+"-"+(this.editData.datetime.getMonth()+1)+"-"+this.editData.datetime.getDate(),t.voucherWordId=this.editData.pzNumber,t.explains=this.editData.remark,$.ajax({url:contextPath+"/transferprofitloss/transfer",type:"post",dataType:"json",contentType:"application/json",data:JSON.stringify(t),success:function(t){"100100"==t.code&&0<t.data.count?e.$Message.info({content:"已经生成一张转账凭证，凭证字号分别为"+t.data.voucherEntity.voucherGroupName+"-"+t.data.voucherEntity.voucherNumber,duration:3}):"100100"==t.code&&0==t.data.count?e.$Message.info({content:"各损益科目余额为零，不需要结转！",duration:3}):e.$Message.info({content:"服务器正在维护，请稍后再试！",duration:3}),setTimeout(function(){window.parent.closeCurrentTab({openTime:e.openTime,exit:!0})},2e3)}})},quit:function(){window.parent.closeCurrentTab({openTime:this.openTime,exit:!0})},saveVoucher:function(){1==this.voucherStatus?$.ajax({url:contextPath+"/transferprofitloss/posttransfervoucher",type:"post",dataType:"json",success:function(t){}}):$.ajax({url:contextPath+"/transferprofitloss/deletetransfervoucher",type:"post",dataType:"json",success:function(t){}}),this.voucherVisible=!1},cancelVoucher:function(){window.parent.closeCurrentTab({openTime:this.openTime,exit:!0})},clickDigest:function(){this.remarkVisable=!0},onDblclickRemarkRow:function(t){this.editData.remark=t.content,this.remarkVisable=!1},onRemarkModalChange:function(t){this.remarkVisable=t},onRemarkListChange:function(t){this.remarklist=t},initPage:function(){this.colNames=["id","科目代码","科目名称","结转科目名称"],this.colModel=[{name:"id",width:30,hidden:!0},{name:"subjectCode"},{name:"subjectName"},{name:"transferSubjectName"}],this.tableHeaders=[],this.base_config.height=$(window).height()-120,this.jqGridInit(this.colNames,this.colModel,this.tableHeaders)},jqGridInit:function(t,e,a){console.log(t,e,a);var n=Object.assign({},this.base_config,{colNames:t,colModel:e,postData:JSON.stringify({createId:63,currencyId:1,currencyName:"人民币",endCreditFor:"",endDate:"2018-08-31",endDebitFor:"",endPeriod:8,endYear:"2018",explains:"",isCheck:-1,isCheckList:[{id:-1,name:"全部"},{id:1,name:"未勾对"},{id:2,name:"已勾对"}],openCurrencyList:[{currencyName:"人民币",exchangeRate:1,currencyId:1,currencyCode:"RMB"}],relateSubjectId:"",showDaySum:!0,showDetailRecord:!0,showInitBalance:!0,showPeriodSum:!0,showTotalSum:!0,showYearSum:!0,sobId:"",startCreditFor:"",startDate:"2018-08-01",startDebitFor:"",startPeriod:8,startYear:"2018",subjectCode:"",subjectId:229,subjectName:"银行存款",type:1}),loadComplete:function(t){"100100"==t.code||layer.alert(t.msg)},onSelectRow:function(t,e){jQuery("#list").editRow(t,!0)},gridComplete:function(){$("#list").jqGrid("getDataIDs").forEach(function(t){jQuery("#list").editRow(t,!0)})}});jQuery("#list").jqGrid(n)},listVoucherWord:function(){var e=this;$.ajax({url:contextPath+"/transferprofitloss/listvoucherword",type:"post",dataType:"json",success:function(t){e.pzNumberList=t.data,e.editData.pzNumber=t.data[0].id}})},listTransferNotPost:function(){var e=this;$.ajax({url:contextPath+"/transferprofitloss/listtransfernotpost",type:"post",dataType:"json",async:!1,success:function(t){0<t.data.length&&(e.voucherVisible=!0,e.voucher=t.data[0].voucherWord)}})}},mounted:function(){this.getYear(),this.getMonth(),this.lastday(),this.editData.datetime=this.currentYear+"-"+this.currentMonth+"-"+this.currentLastDay,this.listVoucherWord(),this.listTransferNotPost(),this.initPage(),this.openTime=window.parent.params&&window.parent.params.openTime},watch:{}});