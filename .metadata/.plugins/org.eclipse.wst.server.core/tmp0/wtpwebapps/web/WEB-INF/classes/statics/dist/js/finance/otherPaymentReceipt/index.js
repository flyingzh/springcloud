"use strict";var _methods,_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};function _defineProperty(t,e,a){return e in t?Object.defineProperty(t,e,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[e]=a,t}var vm=new Vue({el:"#otherReceipts",data:{deleteVisible:!1,deleteLoading:!0,openTime:"",formData:{id:0,otherTypesDocuments:getUrlParam("otherTypesDocument"),documentType:null,documentTypeName:"",documentDate:"",documentNumber:"",idForPrepayment:"",occurrenceObjectId:null,occurrenceObjectCode:"",occurrenceObject:"",coinStopId:null,coinStop:"",exchangeRate:"",clearanceAccountId:"",clearanceAccount:"",receiptPaymentPeriod:"",settledAmount:"",payableAmountFor:"",summary:"",voucherId:"",voucherSize:"",brokerageId:null,brokerageCode:"",brokerage:"",departmentId:null,departmentCode:"",department:"",createId:null,createName:"",createTime:"",updateId:"",updateName:"",auditorNameId:"",auditorName:"",auditorDate:"",auditStatus:0,isVoucher:0,printingTimes:"",accountYear:"",accountPeriod:"",sobId:null,currPage:null,totalCount:null,occurrenceCode:""},formDataInit:{incomeCategorys:[],clearanceAccounts:[]},tableList:[],tabAddNo:"-1",ishttpOK:!1,isSaveAdd:!1,dateDisabled:!1,currentSelectRow:"",floatNumber:2,writeIsChange:!0,addData:{lineNumber:-1,incomeCategoryId:0,subjectId:"",incomeCategoryCode:"",incomeCategoryName:"",amountPaymentReceivedFor:"",amountPaymentReceived:"",remark:""},a111:"",dataList:[{name:"收款结算",id:1},{name:"其他应收",id:2}],subjectVisable:!1},created:function(){if("query"==getUrlParam("action")){var t=Number.parseFloat(getUrlParam("id"));if(null!=t)return void this.getInfo(t)}this._ajaxGetFormData()},watch:{},methods:(_methods={selectChange:function(e,t){var a=this.formDataInit.incomeCategorys.find(function(t){return t.incomeCategoryId==e});a&&(t.subjectId=a.subjectId)},showSubjectVisable:function(){this.subjectVisable=!0},subjectClose:function(){this.subjectVisable=!1},subjectData:function(t){this.formData.clearanceAccountId=t.id,this.formData.clearanceAccount=t.subjectName},_clearUser:function(){this.$refs.sel1.reset(),this.$refs.sel2.reset(),this.$refs.sel4.reset(),this.$refs.sel6.reset(),this.$refs.sel7.reset()},getInfo:function(t){var e=this,a={otherId:t},o=rcContextPath+"/otherPaymentReceipt/info";$.ajax({type:"post",async:!0,data:a,url:o,dataType:"json",success:function(t){e.formDataInit=t.data.initList,e.$nextTick(function(){e.formData=t.data.otherPaymentReceipt,e.tableList=t.data.opaymentReceiptList})},error:function(t){setTimeout(function(){e.ishttpOK=!1},1e3)}})},copyOther:function(t){var e=this;$.ajax({type:"post",async:!0,data:t,url:"",dataType:"json",success:function(t){},error:function(t){setTimeout(function(){e.ishttpOK=!1},1e3)}})},outHtml:function(){window.parent.closeCurrentTab({name:name,openTime:this.openTime,exit:!0})},print:function(){htPrint()},dbClick:function(){},filterMethod:function(t,e){return-1!==e.toUpperCase().indexOf(t.toUpperCase())},beforeOrLast:function(t){var o=this;if(1!=o.ishttpOK){var e=rcContextPath+"/otherPaymentReceipt/selectInfoByOne",a=o.formData.currPage;if(null==a?a=0:1==t?a-=1:2==t&&(a+=1),a!=o.formData.totalCount)if(a<0)o.$Message.info({content:"当前单据已为最新单",duration:3});else{o.ishttpOK=!0;var n={otherTypesDocuments:o.formData.otherTypesDocuments,id:o.formData.id,currPage:a};$.ajax({type:"post",async:!0,data:n,url:e,dataType:"json",success:function(e){var a="";"100100"===e.code?(a=e.msg,o.$nextTick(function(){var t=JSON.parse(e.data);console.log(t),null!=t?(o.formData=t.otherPaymentReceipt,o.tableList=t.opaymentReceiptList):a="暂无单据"})):a=e.msg,o.$Message.info({content:a,duration:3}),setTimeout(function(){o.ishttpOK=!1},1e3)},error:function(t){setTimeout(function(){o.ishttpOK=!1},1e3)}})}else o.$Message.info({content:"当前单据为第一单",duration:3})}},operateData:function(e,t){var a=this,o=this.formDataInit[t].find(function(t){return a.formData[e+"Id"]===t[e+"Id"]});if(o)return this.formData[e]=o[e],this.formData[e+"Id"]=o[e+"Id"],void(this.formData[e+"Code"]=o[e+"Code"]);this.formData[e]="",this.formData[e+"Id"]="",this.formData[e+"Code"]=""},operateData1:function(e){var a=this;console.log(this.formData);var t=this.formDataInit.clearanceAccounts.find(function(t){return a.formData[e]===t.subjectId});if(t)return this.formData.clearanceAccount=t.subjectName,void(this.formData.clearanceAccountId=t.subjectId);this.formData.clearanceAccountId=""},preserve:function(){var a=this;if(this.writeIsChange){var o=this,n=!1,r="请填写必填项。";if(this.formData.occurrenceObjectId?this.formData.documentDate?this.formData.documentNumber?this.formData.clearanceAccountId||(n=!0,r="请选择结算账户"):(n=!0,r="请选择单据号"):(n=!0,r="请选择单据日期"):(n=!0,r="请选择"+(1==this.formData.otherTypesDocuments?"客户":"供应商")),console.log(this.tableList,"=== this.tableList"),this.tableList.map(function(e){e.incomeCategoryId?e.amountPaymentReceivedFor&&"0"!==e.amountPaymentReceivedFor&&"0.00"!==e.amountPaymentReceivedFor?e.subjectId==a.formData.clearanceAccountId&&(n=!0,r="表格第"+e.lineNumber+"行"+(1==a.formData.otherTypesDocuments?"收入类别":"支出类别")+"与结算账户相同"):(n=!0,r="表格第"+e.lineNumber+"行未输入收款金额"):(n=!0,r="表格第"+e.lineNumber+"行"+(1==a.formData.otherTypesDocuments?"收入类别":"支出类别")+"未选择");var t=o.formDataInit.incomeCategorys.find(function(t){return t.incomeCategoryId==e.incomeCategoryId});t&&(e.subjectId=t.subjectId,e.genrePaymentsReceived=t.genrePaymentsReceived,e.incomeCategoryName=t.incomeCategoryName,e.incomeCategoryCode=t.incomeCategoryCode)}),n)this.$Message.info({content:r,duration:3});else{var t=o.formData.id,e=getUrlParam("otherTypesDocument"),i=o.formData.documentType,s="",c="";console.log(accounting.unformat(o.formData.payableAmountFor),"====that.formData.payableAmountFor"),o.formData.payableAmountFor=accounting.unformat(o.formData.payableAmountFor),"1"==e?s=1==i?"其他应收":"收款结算":"2"==e&&(s=1==i?"其他应付":"付款结算"),o.formData.documentTypeName=s;var u={otherPaymentReceipt:o.formData,opaymentReceiptList:o.tableList};c=null==t||0==t?rcContextPath+"/otherPaymentReceipt/save":rcContextPath+"/otherPaymentReceipt/update",1!=o.ishttpOK&&(o.ishttpOK=!0,$.ajax({type:"post",async:!0,data:JSON.stringify(u),url:c,dataType:"json",contentType:"application/json;charset=utf-8",success:function(t){var e="";if("100100"===t.code){e=t.msg,console.log(t,"=== save d");var a=JSON.parse(t.data);o.formData=a.otherPaymentReceipt,o.tableList=a.opaymentReceiptList,o.ishttpOK=!1,o.writeIsChange=!1}else e=t.msg;o.tableList.length;o.$Message.info({content:e,duration:3}),o.isSaveAdd&&(o._clearUser(),o._ajaxGetFormData(),o.writeIsChange=!0),setTimeout(function(){o.ishttpOK=!1},1e3)},error:function(t){setTimeout(function(){o.ishttpOK=!0},1e3)}}))}}else this.$Message.info({content:"请点击修改。",duration:3})}},_defineProperty(_methods,"filterMethod",function(t,e){return-1!==e.toUpperCase().indexOf(t.toUpperCase())}),_defineProperty(_methods,"receivedNum",function(t){var e=formatNum(t.amountPaymentReceivedFor,1)*this.formData.exchangeRate;return t.amountPaymentReceived=e.toFixed(this.floatNumber),"0.00"==(e=accounting.formatMoney(e,"",this.floatNumber))?"":e}),_defineProperty(_methods,"AddreceivedNum",function(){var t=formatNum(this.addData.amountPaymentReceivedFor,1)*this.formData.exchangeRate;return this.addData.amountPaymentReceived=t.toFixed(this.floatNumber),"0.00"==(t=accounting.formatMoney(t,"",this.floatNumber))?"":t}),_defineProperty(_methods,"addDataMethod",function(){var e=this;this.addData.lineNumber=this.tableList.length+1;var t=this.formDataInit.incomeCategorys.find(function(t){return t.incomeCategoryId===e.addData.incomeCategoryId});t&&Object.assign(this.addData,t),this.tableList.push(this.addData),this.addData={lineNumber:-1,incomeCategoryId:0,subjectId:"",incomeCategoryCode:"",incomeCategoryName:"",amountPaymentReceivedFor:0,amountPaymentReceived:"",remark:""}}),_defineProperty(_methods,"del",function(t){this.tableList.splice(t,1)}),_defineProperty(_methods,"_ajaxGetFormData",function(){var o=this,t=rcContextPath+"/otherPaymentReceipt/initPage",e={otherTypesDocuments:getUrlParam("otherTypesDocument")};$.ajax({type:"POST",async:!0,data:e,url:t,dataType:"json",success:function(t){var e=t.data;if(null!=e){var a=JSON.parse(e);new Date;o.formDataInit=a.initList,console.log(a),o.$nextTick(function(){o.formData=a.otherPaymentReceipt,o.tableList=a.opaymentReceiptList,o.tableList[0].lineNumber=1,o.formData.otherTypesDocuments=getUrlParam("otherTypesDocument"),o.formData.id=0,o.formData.auditStatus=1,o.$refs.selTable0&&o.$refs.selTable0[0].reset()})}},error:function(t){console.log(t)}})}),_defineProperty(_methods,"receivedForChange",function(t){var e=formatNum(t.amountPaymentReceivedFor,1);t.amountPaymentReceivedFor=e.toFixed(this.floatNumber)}),_defineProperty(_methods,"addreceivedForChange",function(){var t=formatNum(this.addData.amountPaymentReceivedFor,1);this.addData.amountPaymentReceivedFor=t.toFixed(this.floatNumber)}),_defineProperty(_methods,"clickTr",function(t){this.currentSelectRow=t.lineNumber}),_defineProperty(_methods,"actionBtnMth",function(t){var e=this,a=e.formData.id,o="",n={};switch(t){case"addNew":e.writeIsChange=!0,e._clearUser(),e._ajaxGetFormData();break;case"delete":if(0==a||null==a)return void e.$Message.info({content:"新增页面,不能执行删除操作",duration:3});this.deleteVisible=!0;break;case"examine":var r=this.formData.id;if(null==r||""==r)return void e.$Message.info({content:"没有单据不能执行审核",duration:3});o=rcContextPath+"/otherPaymentReceipt/executeAudit",n={id:this.formData.id,auditStatus:this.formData.auditStatus},this.auditAction(o,n,2);break;case"edit":if(0==a||null==a)return void e.$Message.info({content:"新增页面,不能执行修改操作",duration:3});this.writeIsChange=!0;break;case"noexamine":o=rcContextPath+"/otherPaymentReceipt/reverseAudit",n={id:this.formData.id,auditStatus:this.formData.auditStatus},this.auditAction(o,n,1)}}),_defineProperty(_methods,"auditAction",function(t,e,n){var r=this;$.ajax({type:"post",async:!0,data:e,url:t,dataType:"json",success:function(t){var e=r.formData.currPage,a=r.formData.totalCount;if("100100"===t.code){r.formData=t.data.otherPaymentReceipt,r.formData.currPage=e,r.formData.totalCount=a,r.tableList=t.data.opaymentReceiptList;var o=r.formData.auditorDate;r.formData.auditStatus=n,null!=o&&(r.formData.auditorDate=o.slice(0,10))}r.$Message.info({content:t.msg,duration:3})}})}),_defineProperty(_methods,"deleteOK",function(){var e=this;if(2==e.formData.auditStatus)return e.deleteVisible=!1,void e.$Message.info({content:"已审核不能删除该单据",duration:3});_url=rcContextPath+"/otherPaymentReceipt/deleteById",_parame={id:this.formData.id,auditStatus:this.formData.auditStatus},$.ajax({type:"post",async:!0,data:_parame,url:_url,dataType:"json",success:function(t){"100100"===t.code?(setTimeout(function(){this.tableList=this.tableList.filter(function(t){return t.tab1!==e.currentSelectRow}),e.currentSelectRow="",e.$Message.info({content:"删除成功",duration:3})},2e3),e.$nextTick(function(){e.deleteVisible=!1,e.writeIsChange=!1,e.beforeOrLast()})):setTimeout(function(){this.tableList=this.tableList.filter(function(t){return t.tab1!==e.currentSelectRow}),e.currentSelectRow="",e.deleteVisible=!1,e.$Message.info({content:"删除失败",duration:3})},2e3)},error:function(t){setTimeout(function(){e.ishttpOK=!0},1e3)}})}),_defineProperty(_methods,"clearFormData",function(){this.formData={},this.formDataInit={},this.tableList=[];var t=new Date;this.formData.documentDate=t,this.formData.receiptPaymentPeriod=t,this.writeIsChange=!0,this.ishttpOK=!1}),_defineProperty(_methods,"voucherAction",function(t){var a=this,e=a.formData.voucherId,o=a.formData.sobId,n="",r={paramVOS:[]},i={id:a.formData.id};if(r.paramVOS.push(i),"showVoucher"===t){n=rcContextPath+"/finance/voucher-lrt/index.html?voucherId="+e+"&sobId="+o,window.parent.activeEvent({name:"记账凭证",url:n})}else"addVoucher"===t&&(n=rcContextPath+"/otherPaymentReceipt/createVoucher?handle=false");$.ajax({type:"post",async:!0,data:JSON.stringify(r),url:n,dataType:"json",contentType:"application/json;charset=utf-8",success:function(t){var e="";"100100"===t.code?(e="操作失败",0!=t.data.vses.length&&(e=t.msg,a.formData=t.data.vses.length&&t.data.vses[0],a.formData.isVoucher=2)):e=t.msg;a.$Message.info({content:e,duration:3})}})}),_defineProperty(_methods,"changeCurrency",function(e,t){var a=this,o=this.formDataInit.currencys.find(function(t){return t.coinStopId===a.formData[e+"Id"]});o&&(this.formData.exchangeRate=o.exchangeRate),this.operateData(e,t)}),_defineProperty(_methods,"optionAction",function(t){"saveAdd"===t&&(this.isSaveAdd=!this.isSaveAdd)}),_methods),computed:{totalReceivedFor:function(){var e=0;return this.tableList.forEach(function(t){e+=formatNum(t.amountPaymentReceivedFor,1)}),e=accounting.formatMoney(e,"",this.floatNumber),(this.formData.payableAmountFor=e)||0},totalReceived:function(){var e=0;return this.tableList.forEach(function(t){e+=formatNum(t.amountPaymentReceived,1)}),(e=accounting.formatMoney(e,"",this.floatNumber))||0},deleteisDisabled:function(){return 2===this.formData.isVoucher||2===this.formData.auditStatus},editisDisabled:function(){return 2===this.formData.isVoucher||2===this.formData.auditStatus},voucherisDisabled:function(){return 0===this.formData.id||1===this.formData.auditStatus||0===this.formData.isVoucher||2===this.formData.isVoucher},showVoucherDisabled:function(){return 0===this.formData.id||1===this.formData.auditStatus||0===this.formData.isVoucher||1===this.formData.isVoucher},examineisDisabled:function(){return 0===this.formData.id||0===this.formData.auditStatus||2===this.formData.auditStatus},noexamineisDisabled:function(){return 0===this.formData.id||0===this.formData.auditStatus||1===this.formData.auditStatus||2===this.formData.isVoucher},selecteBefore:function(){return this.formData.currPage===this.formData.totalCount-1},selecteAfter:function(){return this.formData.currPage>this.formData.totalCount-1},isDisabled:function(){var t=!1;return this.writeIsChange&&2!==this.formData.auditStatus||(t=!0),t},list:function(){var e=[];return this.dataList.forEach(function(t){"object"===(void 0===t?"undefined":_typeof(t))?e.push(t.name):e.push(t)}),e},documentTypeList:function(){return 1===Number(this.formData.otherTypesDocuments)?[{label:"收款结算",value:2},{label:"其他应收",value:1}]:[{label:"付款结算",value:2},{label:"其他应付",value:1}]}},filters:{filterMoney:function(t){return accounting.formatMoney(t,"",this.floatNumber)},filterTitle:function(t){return 1===Number(t)?"其他收款单":"其他付款单"}},mounted:function(){this.openTime=window.parent.params&&window.parent.params.openTime}});