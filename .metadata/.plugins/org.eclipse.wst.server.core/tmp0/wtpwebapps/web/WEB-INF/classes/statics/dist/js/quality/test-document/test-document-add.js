"use strict";var _extends=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(t[a]=n[a])}return t};function _defineProperty(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var testDocumentVm=new Vue({el:"#imcomingReport",data:function(){var t;return _defineProperty(t={parentParams:null,examineVerifyName:"",examineVerifyTime:"",isHide:!0,isSearchHide:!0,isTabulationHide:!0,openTime:"",isStampShow:!1,approveComment:!1,rejectComment:!1,approvement:{receiptsId:"",approvalResult:1,approvalInfo:""},rejectement:{receiptsId:"",approvalResult:"0",approvalInfo:""},receiptsId:"",documentStatus:"",testDocumentId:"",documentCode:"",reload:!1,steplist:[],stepData:[{currentLevel:1,subtitle:"一级审批"},{currentLevel:2,subtitle:"二级审批"},{currentLevel:3,subtitle:"三级审批"},{currentLevel:4,subtitle:"四级审批"},{currentLevel:5,subtitle:"五级审批"},{currentLevel:6,subtitle:"六级审批"},{currentLevel:7,subtitle:"结束"}],currentStep:"",nextStep:"",isLook:!0,isEdit:!1},"reload",!1),_defineProperty(t,"firstLoad",!0),_defineProperty(t,"showSourceModal",!1),_defineProperty(t,"testMessagePane","first"),_defineProperty(t,"showHighSearch",!1),_defineProperty(t,"resultSelectedIndex",1),_defineProperty(t,"showDepartment",!1),_defineProperty(t,"otherSearch",[]),_defineProperty(t,"styleResultArray",[]),_defineProperty(t,"sendTestPeoples",[]),_defineProperty(t,"testEmps",[]),_defineProperty(t,"testWayDisabled",!1),_defineProperty(t,"sourceCodeDisabled",!1),_defineProperty(t,"sendTestDisabled",!1),_defineProperty(t,"generateDisabled",!1),_defineProperty(t,"canInput",!0),_defineProperty(t,"body",{report_type:"",report_code:"",date_start:"",date_end:""}),_defineProperty(t,"badResons",[]),_defineProperty(t,"treeSetting",{callback:{onClick:this.treeClickCallBack,beforeClick:this.treeBeforeClick}}),_defineProperty(t,"upstreamSourceCode",""),_defineProperty(t,"imcoming",{tQcTestDocumentEntity:{id:"",sourceDocumentType:"",sourceDocumentCode:"",sourceDepartmentName:"",sendTestName:"",sendTestId:"",sendTestTime:"",testTotalAmount:"",qualifiedPercent:"",documentCode:"",documentType:"",businessType:"",documentTime:"",documentStatus:"",qualifiedTotalAmount:"",testResult:"",testOrganizationId:"",testOrganizationName:"",testDepartmentName:"",testDepartmentId:"",inspectorId:"",testFinishTime:"",unqualifiedTotalAmount:"",totalTestConclusion:"",supplierOrCustomerCode:"",createName:"",createTime:"",updateName:"",updateTime:"",productTypeId:"",sysFile:{fileId:"",fileType:6,fileDetails:[]}},sourceCodeDisabled:!1,styleInput:{id:"",sourceDetailId:"",productStyleId:"",productTypeId:"",testWay:"",qualifiedAmount:"",testAmount:"",qualifiedPercent:"",unqualifiedAmount:"",testResult:"",resultDescribeSuggest:"",sourceDocumentProductStyle:{productCode:"",productName:""},styleTestItems:[]}}),_defineProperty(t,"testWays",[]),_defineProperty(t,"testStatusArr",[]),_defineProperty(t,"testResultArr",[]),_defineProperty(t,"sourceTypeArr",[]),_defineProperty(t,"approval_config",{url:contextPath+"/testDocument/queryReceiptsById",colNames:["操作类型","开始级次","目的级次","审批人","审批意见","审批时间"],requestData:{receiptsId:""},colModel:[{name:"approvalResult",index:"lotSize",width:215,align:"center",formatter:function(t,e,n,a){return 1==t?"审核":"驳回"}},{name:"currentLevel",index:"samplingRatio",width:215,align:"center",formatter:function(t,e,n,a){return 1===t?"一级审核":2===t?"二级审核":3===t?"三级审核":4===t?"四级审核":5===t?"五级审核":6===t?"六级审核":""}},{name:"nextLevel",index:"acceptance",width:210,align:"center",formatter:function(t,e,n,a){return-1===n.approvalResult||0===n.approvalResult&&!t?"开始":"1"===t?"一级审核":"2"===t?"二级审核":"3"===t?"三级审核":"4"===t?"四级审核":"5"===t?"五级审核":"6"===t?"六级审核":"结束"}},{name:"createName",index:"rejected asc, invdate",width:215,align:"center"},{name:"approvalInfo",index:"rejected asc, invdate",width:215,align:"center"},{name:"createTime",index:"rejected asc, invdate",width:215,align:"center"}],jsonReader:{root:"data"},multiselect:!1}),_defineProperty(t,"selectSourceDoc",""),_defineProperty(t,"showUpload",!1),t},methods:{delFile:function(t){layer.confirm("是否要删除这条信息!",{btn:["确定","取消"]},function(){t.del=!0,layer.closeAll("dialog")})},download:function(e){if(!e.fdUrl)return layer.alert("文件地址为空!请先上传文件!"),!1;var n=[];Object.keys(e).forEach(function(t){return n.push(t+"="+e[t])});var t=contextPath+"/testDocument/download?"+n.join("&");location.href=encodeURI(t)},addAttachment:function(t,e){var n={fdName:t.name,fdSize:(t.size/1024).toFixed(2)+"kb",uploadTime:e.uploadTime,uploadUser:e.uploadUser,fdUrl:e.fdUrl,fdType:e.fdType,del:!1};this.imcoming.tQcTestDocumentEntity.sysFile.fileDetails.push(n)},handleMaxSize:function(t){this.$Notice.warning({title:"文件大小超出限制!",desc:"【"+t.name+"】的大小超过2M"})},handleSuccess:function(t,e){"100100"===t.code?this.addAttachment(e,t.data):layer.alert("上传失败")},getApproveInfo:function(){var e=this;e.approvement.receiptsId=e.receiptsId,$.ajax({type:"POST",url:contextPath+"/testDocument/submitapproval",contentType:"application/json",data:JSON.stringify(e.approvement),dataType:"json",success:function(t){"100100"===t.code?(layer.alert("审核成功"),0==t.data.approvalStatus&&(e.documentStatus="checking"),1==t.data.approvalStatus&&(e.documentStatus="auditing"),-2==t.data.approvalStatus&&(e.documentStatus="temporary_save"),e._ajaxUpdateDocumentStatus(e.testDocumentId,e.documentStatus),e.approvement={receiptsId:"",approvalResult:1,approvalInfo:""},"checking"===e.documentStatus?(e.imcoming.tQcTestDocumentEntity.documentStatusName="审核中",e.imcoming.tQcTestDocumentEntity.documentStatus="checking",e.sendTestDisabled=!0,e.testWayDisabled=!0):"auditing"===e.documentStatus?(e.imcoming.tQcTestDocumentEntity.documentStatusName="已审核",e.imcoming.tQcTestDocumentEntity.documentStatus="auditing",e.imcoming.tQcTestDocumentEntity.testFinishTime=(new Date).format("yyyy-MM-dd hh:mm:ss"),e.sendTestDisabled=!0,e.examineVerifyName=layui.data("user").username,e.examineVerifyTime=(new Date).format("yyyy-MM-dd hh:mm:ss"),e.testWayDisabled=!0):"temporary_save"===e.documentStatus&&(e.imcoming.tQcTestDocumentEntity.documentStatusName="暂存",e.imcoming.tQcTestDocumentEntity.documentStatus="temporary_save",e.imcoming.tQcTestDocumentEntity.testFinishTime=""),e.$forceUpdate(),e.reload=!e.reload,e.initApproval()):layer.alert("审核失败")},error:function(t){layer.alert("服务器出错")}})},approval:function(){var n=this,t=[];return"await_check"!=n.documentStatus&&"checking"!=n.documentStatus&&"reject"!=n.documentStatus&&t.push(n.documentCode),0<t.length?(layer.alert("编号为"+t.join(",")+"的单据，当前状态不可以审核!"),!1):""===n.documentCode||"temporary_save"===n.documentStatus?(layer.alert("请提交检验单!"),!1):void $.ajax({type:"POST",url:contextPath+"/testDocument/findUserOperation",contentType:"application/json",data:JSON.stringify({receiptsId:n.receiptsId,docTypeCode:n.imcoming.tQcTestDocumentEntity.documentType+"_code"}),dataType:"json",success:function(t){if("100515"===t.code&&(layer.alert("审核成功"),n._ajaxUpdateDocumentStatus(n.testDocumentId,"auditing")),"100514"===t.code){var e=1===t.data?"【一级审核】":2===t.data?"【二级审核】":3===t.data?"【三级审核】":4===t.data?"【四级审核】":5===t.data?"【五级审核】":6===t.data?"【六级审核】":t.msg;layer.alert(0===t.data?"该单据已被驳回到申请人，待申请人提交!":"您没有"+e+"的审核权限")}if("100100"===t.code){if("auditing"===status)return layer.alert("检验单已审核"),!1;n.initApproval(),n.approveComment=!0}},error:function(t){layer.alert("服务器出错")}})},reject:function(){var n=this,t=[];return"temporary_save"!=n.documentStatus&&""!==n.documentStatus&&"auditing"!==n.documentStatus||t.push(n.documentCode),0<t.length?(layer.alert("编号为"+t.join(",")+"的单据，当前状态不可以驳回!"),!1):""===n.documentStatus||"temporary_save"===n.documentStatus?(layer.alert("请提交检验单!"),!1):void $.ajax({type:"POST",url:contextPath+"/testDocument/isReject",data:{testDocumentId:n.imcoming.tQcTestDocumentEntity.id,testDocumentCode:n.imcoming.tQcTestDocumentEntity.documentCode},dataType:"json",success:function(t){"100100"===t.code&&(t.data?$.ajax({type:"POST",url:contextPath+"/testDocument/findUserOperation",contentType:"application/json",data:JSON.stringify({receiptsId:n.receiptsId,docTypeCode:n.imcoming.tQcTestDocumentEntity.documentType+"_code"}),dataType:"json",success:function(t){if("100100"===t.code&&(n.rejectComment=!0),"100514"===t.code){var e=1===t.data?"【一级审核】":2===t.data?"【二级审核】":3===t.data?"【三级审核】":4===t.data?"【四级审核】":5===t.data?"【五级审核】":6===t.data?"【六级审核】":t.msg;layer.alert(0===t.data?"该单据已被驳回到申请人，待申请人提交!":"您没有"+e+"的驳回权限")}"100515"===t.code&&(layer.alert("驳回成功"),n.documentStatus="reject",n._ajaxUpdateDocumentStatus(n.testDocumentId,n.documentStatus),n.reload=!n.reload)},error:function(t){layer.alert("服务器出错")}}):layer.alert("该检验单有生成子单，请勿驳回"))},error:function(t){layer.alert("服务器出错")}})},getRejectInfo:function(){var e=this;e.rejectement.receiptsId=e.receiptsId,$.ajax({type:"POST",url:contextPath+"/testDocument/submitapproval",contentType:"application/json",data:JSON.stringify(e.rejectement),dataType:"json",success:function(t){"100100"===t.code?(layer.alert("驳回成功"),e.documentStatus="reject",console.log(t.data.approvalStatus),-1==t.data.approvalStatus&&(e.imcoming.tQcTestDocumentEntity.documentStatusName="驳回",e.imcoming.tQcTestDocumentEntity.documentStatus="reject",e.imcoming.tQcTestDocumentEntity.testFinishTime="",e.examineVerifyName="",e.examineVerifyTime=""),-2==t.data.approvalStatus&&(e.imcoming.tQcTestDocumentEntity.documentStatusName="暂存",e.imcoming.tQcTestDocumentEntity.documentStatus="temporary_save",e.documentStatus="temporary_save",e.imcoming.tQcTestDocumentEntity.testFinishTime="",e.sendTestDisabled=!1,e.testWayDisabled=!1),e._ajaxUpdateDocumentStatus(e.testDocumentId,e.documentStatus)):layer.alert("驳回失败"),e.rejectement={receiptsId:"",approvalResult:"0",approvalInfo:""},e.$forceUpdate(),e.reload=!this.reload,e.initApproval()},error:function(t){layer.alert("服务器出错")}})},initApproval:function(){var o=this;$.ajax({type:"post",url:contextPath+"/testDocument/queryProcessByReceiptsId",data:{receiptsId:o.receiptsId},dataType:"json",success:function(t){for(var e=t.data.list,n=0;n<e.length;n++)switch(e[n].processLevel){case 1:e[n].processLevel="一级审核";break;case 2:e[n].processLevel="二级审核";break;case 3:e[n].processLevel="三级审核";break;case 4:e[n].processLevel="四级审核";break;case 5:e[n].processLevel="五级审核";break;case 6:e[n].processLevel="六级审核"}if(e.unshift({processLevel:"开始"}),e.push({processLevel:"结束"}),e[1].currentLevel===t.data.levelLength)for(var a=0;a<e.length;a++)e[a].currentLevel=e.length-1;for(var s=(o.steplist=e)[1].currentLevel,i=0;i<o.stepData.length;i++){if(s===o.stepData[i].currentLevel){o.currentStep=o.stepData[i+1].subtitle,o.nextStep=o.stepData[i+2].subtitle,o.stepData[i+1].currentLevel===e.length-2&&(o.nextStep=o.stepData[o.stepData.length-1].subtitle);break}s+1===o.stepData[i].currentLevel&&(o.currentStep=o.stepData[i].subtitle,o.nextStep=o.stepData[i+1].subtitle)}console.log(o.currentStep,o.nextStep)},error:function(){alert("服务器出错啦")}})},_ajaxUpdateDocumentStatus:function(t,e){if(!t||!e)return!1;$.ajax({type:"POST",url:contextPath+"/testDocument/updateByTestDocumentIdAndStatus",dataType:"json",async:!1,data:{testDocumentId:t,documentStatus:e},success:function(t){},error:function(t){console.log("服务器出错")}})},unformatDocumentType:function(t){return t?this.documentTypeArr.length<1?t:this.documentTypeArr[this.documentTypeArr.map(function(t){return t.name}).indexOf(t)]?this.documentTypeArr[this.documentTypeArr.map(function(t){return t.name}).indexOf(t)].value:t:""},formatterDocumentType:function(t){return t?this.documentTypeArr.length<1?t:this.documentTypeArr[this.documentTypeArr.map(function(t){return t.value}).indexOf(t)]?this.documentTypeArr[this.documentTypeArr.map(function(t){return t.value}).indexOf(t)].name:t:""},showDepartmentTree:function(t){console.log(this.showSourceModal),!0!==this.showDepartment?this.showDepartment=t:this.showDepartment=!1},highSearch:function(){this.showHighSearch=!this.showHighSearch},addSearch:function(){this.otherSearch.push({name:"",include:"",key:""})},deleteSearch:function(t){this.otherSearch.splice(t,1)},treeClickCallBack:function(t,e,n){this.imcoming.tQcTestDocumentEntity.testDepartmentName=n.name,this.imcoming.tQcTestDocumentEntity.testDepartmentId=n.id,this.showDepartment=!1,this.loadTestEmp(n.id)},treeBeforeClick:function(t,e,n){return!e.isParent},getSendTestPeople:function(){var r=this;$.ajax({type:"POST",url:contextPath+"/testDocument/getCurrentUserOrgEmployees",contentType:"application/json",dataType:"json",success:function(t){if(r.sendTestPeoples=[],"100100"===t.code&&0<t.data.length){var e=!0,n=!1,a=void 0;try{for(var s,i=t.data[Symbol.iterator]();!(e=(s=i.next()).done);e=!0){var o=s.value;r.sendTestPeoples.push({label:o.empName,value:o.id,code:o.empCode})}}catch(t){n=!0,a=t}finally{try{!e&&i.return&&i.return()}finally{if(n)throw a}}}},error:function(t){}})},fetchOrg:function(){$.ajax({type:"POST",url:contextPath+"/testDocument/getCurrentUserOrgInfo",contentType:"application/json",dataType:"json",success:function(t){},error:function(t){}})},save:function(t){this.styleResultArray[this.resultSelectedIndex-1]&&Object.assign(this.styleResultArray[this.resultSelectedIndex-1],this.imcoming.styleInput),this.reInitStyleResult();var e=this;if("await_check"===e.documentStatus||"待审核"===e.imcoming.tQcTestDocumentEntity.documentStatusName)return layer.alert("该单在审核中，请勿修改！"),!1;if("auditing"===e.documentStatus||"已审核"===e.imcoming.tQcTestDocumentEntity.documentStatusName)return layer.alert("该单已审核，请勿修改！"),!1;var n=!0,a=!1,s=void 0;try{for(var i,o=e.sendTestPeoples[Symbol.iterator]();!(n=(i=o.next()).done);n=!0){var r=i.value;r.value==e.imcoming.tQcTestDocumentEntity.sendTestId&&(e.imcoming.tQcTestDocumentEntity.sendTestName=r.label)}}catch(t){a=!0,s=t}finally{try{!n&&o.return&&o.return()}finally{if(a)throw s}}var c=!0,u=!1,l=void 0;try{for(var m,d=e.testEmps[Symbol.iterator]();!(c=(m=d.next()).done);c=!0){var y=m.value;y.value==e.imcoming.tQcTestDocumentEntity.inspectorId&&(e.imcoming.tQcTestDocumentEntity.inspectorName=y.label)}}catch(t){u=!0,l=t}finally{try{!c&&d.return&&d.return()}finally{if(u)throw l}}var p=[],h=!0,f=!1,g=void 0;try{for(var T,S=e.styleResultArray[Symbol.iterator]();!(h=(T=S.next()).done);h=!0){var D=T.value;p=p.concat(D.styleTestItems)}}catch(t){f=!0,g=t}finally{try{!h&&S.return&&S.return()}finally{if(f)throw g}}var I=!0,v=!1,j=void 0;try{for(var b,A=p[Symbol.iterator]();!(I=(b=A.next()).done);I=!0){var R=b.value,x=!0,E=!1,P=void 0;try{for(var w,N=this.badResons[Symbol.iterator]();!(x=(w=N.next()).done);x=!0){var Q=w.value;if(R.badReasonId==Q.value){R.badReasonName=Q.name;break}}}catch(t){E=!0,P=t}finally{try{!x&&N.return&&N.return()}finally{if(E)throw P}}}}catch(t){v=!0,j=t}finally{try{!I&&A.return&&A.return()}finally{if(v)throw j}}var C={type:t},O=window.parent.params.params;if(""!==O&&void 0!==O||(O={type:"save"}),!this.imcoming.styleInput.showStyleItems)return layer.alert("该单没有对应的检验项目，请添加检验项目后再提交！"),!1;if("update"===O.type){if("已审核"===e.imcoming.tQcTestDocumentEntity.documentStatusName)return layer.alert("单据已审核，不能提交!"),!1;if("驳回"===e.imcoming.tQcTestDocumentEntity.documentStatusName)return layer.alert("单据未驳回到提交人，不能提交修改!"),!1;var q=Object.assign({},e.imcoming,{tqcStyleTestInfoVo:e.styleResultArray},C);if("submit"===t){if(!e.varifyRequire())return!1;if(!1===e.validaRequired())return!1}$.ajax({type:"POST",url:contextPath+"/testDocument/update",contentType:"application/json;charset=UTF-8",dataType:"json",data:JSON.stringify(q),success:function(t){-1==t.code?layer.alert(t.msg):"submit"===C.type?(e.imcoming.tQcTestDocumentEntity.documentStatusName="待审核",e.imcoming.tQcTestDocumentEntity.documentStatus="await_check",e.documentStatus="await_check",e.testDocumentId=t.data,layer.alert("提交"+t.msg),e.sendTestDisabled=!0,e.testWayDisabled=!0,e.imcoming.tQcTestDocumentEntity.updateName=layui.data("user").username,e.imcoming.tQcTestDocumentEntity.updateTime=(new Date).format("yyyy-MM-dd hh:mm:ss"),e.$forceUpdate()):(layer.alert("暂存"+t.msg),e.imcoming.tQcTestDocumentEntity.updateName=layui.data("user").username,e.imcoming.tQcTestDocumentEntity.updateTime=(new Date).format("yyyy-MM-dd hh:mm:ss"),e.testDocumentId=t.data)},error:function(t){console.log("服务器出错")}})}else{var _;if(_=Object.assign({},e.imcoming,{tqcStyleTestInfoVo:e.styleResultArray},C),console.log(_),"submit"===t){if(!e.varifyRequire())return!1;if(!1===e.validaRequired())return!1}$.ajax({type:"POST",url:contextPath+"/testDocument/save",contentType:"application/json; charset=utf-8",dataType:"json",data:JSON.stringify(_),success:function(t){-1==t.code?layer.alert(t.msg):("submit"===C.type?(e.imcoming.tQcTestDocumentEntity.documentStatusName="待审核",e.imcoming.tQcTestDocumentEntity.documentStatus="await_check",e.documentStatus="await_check",isNaN(t.data)?(e.testDocumentId=t.data.tQcTestDocumentEntity.id,e.imcoming.tQcTestDocumentEntity.id=t.data.tQcTestDocumentEntity.id,e.styleResultArray=t.data.tqcStyleTestInfoVo,e.imcoming.styleInput=Object.assign({},e.styleResultArray[e.resultSelectedIndex-1])):(e.testDocumentId=t.data,e.imcoming.tQcTestDocumentEntity.id=t.data),e.imcoming.tQcTestDocumentEntity.createTime=(new Date).format("yyyy-MM-dd hh:mm:ss"),console.log("提交的id：",e.testDocumentId),layer.alert("提交"+t.msg),e.sendTestDisabled=!0,e.testWayDisabled=!0,e.$forceUpdate()):isNaN(t.data)?(layer.alert("暂存"+t.msg),e.styleResultArray=t.data.tqcStyleTestInfoVo,e.imcoming.tQcTestDocumentEntity.id=t.data.tQcTestDocumentEntity.id,e.imcoming.tQcTestDocumentEntity.createTime=(new Date).format("yyyy-MM-dd hh:mm:ss"),e.imcoming.styleInput.showStyleItems&&(e.imcoming.styleInput=Object.assign({},e.styleResultArray[e.resultSelectedIndex-1])),console.log(e.styleResultArray)):(layer.alert("暂存"+t.msg),e.imcoming.tQcTestDocumentEntity.id=t.data,e.testDocumentId=t.data,e.imcoming.tQcTestDocumentEntity.createTime=(new Date).format("yyyy-MM-dd hh:mm:ss")),e.imcoming.styleInput.showStyleItems=!0,e.parentParams.type="update",Object.assign(e.imcoming.styleInput,e.styleResultArray[e.resultSelectedIndex-1],{index:e.resultSelectedIndex}),e.$forceUpdate())},error:function(t){console.log("服务器出错")}})}},varifyRequire:function(){var t=!0,e={"源单类型":this.imcoming.tQcTestDocumentEntity.sourceDocumentType,"送检人":this.imcoming.tQcTestDocumentEntity.sendTestId,"单据编号":this.imcoming.tQcTestDocumentEntity.documentCode,"业务类型":this.imcoming.tQcTestDocumentEntity.businessTypeName,"单据日期":this.imcoming.tQcTestDocumentEntity.documentTime,"质检组织":this.imcoming.tQcTestDocumentEntity.testOrganizationName,"质检部门":this.imcoming.tQcTestDocumentEntity.testDepartmentName,"质检员":this.imcoming.tQcTestDocumentEntity.inspectorId,"整单检验结论":this.imcoming.tQcTestDocumentEntity.totalTestConclusion};for(var n in e)if(!e[n]){this.$Modal.warning({content:"您还没有填写基本信息中的"+n}),t=!1;break}return t},validaRequired:function(){for(var t=this.styleResultArray.length,e=0;e<t;e++){if(!this.styleResultArray[e].testWay)return this.$Message.info({content:this.styleResultArray[e].sourceDocumentProductStyle.productName+"检验方式必填",duration:3}),!1;if(isNaN(this.styleResultArray[e].unqualifiedAmount))return this.$Message.info({content:this.styleResultArray[e].sourceDocumentProductStyle.productName+"不合格数必填",duration:3}),!1;if(!this.styleResultArray[e].testResult)return this.$Message.info({content:this.styleResultArray[e].sourceDocumentProductStyle.productName+"检验结果检验方式必填",duration:3}),!1;if(!this.styleResultArray[e].resultDescribeSuggest)return this.$Message.info({content:this.styleResultArray[e].sourceDocumentProductStyle.productName+"结果描述/建议检验方式必填",duration:3}),!1}},doSelectSource:function(){this.sourceCodeDisabled||(this.showSourceModal=!this.showSourceModal)},closeSourceModal:function(){this.showSourceModal=!1,this.loadData("")},loadUpdate:function(t,e){this.generateDisabled=!0,this.sourceCodeDisabled=!0;var n=this;$.ajax({type:"POST",url:contextPath+"/testDocument/info/"+t,contentType:"application/json",dataType:"json",success:function(t){if("100100"===t.code){if(n.loadTestEmp(t.data.tQcTestDocumentEntity.testDepartmentId),t.data.tQcTestDocumentEntity.sysFile)n.imcoming.tQcTestDocumentEntity=Object.assign({},t.data.tQcTestDocumentEntity);else{var e=Object.assign({},{sysFile:{fileId:"",fileType:6,fileDetails:[]}});n.imcoming.tQcTestDocumentEntity=Object.assign({},t.data.tQcTestDocumentEntity,e)}n.upstreamSourceCode=t.data.tQcTestDocumentEntity.upstreamSourceCode,n.receiptsId=n.imcoming.tQcTestDocumentEntity.documentCode,n.documentStatus=n.imcoming.tQcTestDocumentEntity.documentStatus,n.documentCode=n.imcoming.tQcTestDocumentEntity.documentCode,n.testDocumentId=n.imcoming.tQcTestDocumentEntity.id,n.styleResultArray=t.data.tqcStyleTestInfoVo,n.examineVerifyName=t.data.tQcTestDocumentEntity.examineVerifyName,n.examineVerifyTime=t.data.tQcTestDocumentEntity.examineVerifyTime,n.imcoming.tQcTestDocumentEntity.documentTime=new Date(n.imcoming.tQcTestDocumentEntity.documentTime).format("yyyy-MM-dd"),n.initStyleResult(),n.editTestResult(),"temporary_save"!=n.documentStatus&&n.initApproval(),"await_check"!==n.imcoming.tQcTestDocumentEntity.documentStatus&&"auditing"!==n.imcoming.tQcTestDocumentEntity.documentStatus&&"reject"!==n.imcoming.tQcTestDocumentEntity.documentStatus||(n.sendTestDisabled=!0,n.$forceUpdate())}},error:function(t){console.log("服务器出错")}})},loadData:function(t,e){var n=this,a=null;console.log(t,e),console.log(n.selectSourceDoc),t?(a=Object.assign({},{tQcTestDocumentEntity:{sourceDocumentCode:t,productTypeId:e}}),n.sourceCodeDisabled=!0,n.generateDisabled=!0):(n.imcoming.tQcTestDocumentEntity.sourceDocumentCode=n.selectSourceDoc.documentCode,n.upstreamSourceCode=n.selectSourceDoc.upstreamSourceCode,n.imcoming.tQcTestDocumentEntity.productTypeId=n.selectSourceDoc.productTypeId,a=n.imcoming),console.log(a),$.ajax({type:"POST",url:contextPath+"/testDocument/selectSource",contentType:"application/json",dataType:"json",data:JSON.stringify(a),success:function(t){if("100100"===t.code){if(t.data.tQcTestDocumentEntity.sysFile)n.imcoming.tQcTestDocumentEntity=Object.assign({},t.data.tQcTestDocumentEntity);else{var e=Object.assign({},{sysFile:{fileId:"",fileType:6,fileDetails:[]}});n.imcoming.tQcTestDocumentEntity=Object.assign({},t.data.tQcTestDocumentEntity,e)}n.upstreamSourceCode=t.data.tQcSourceDocumentEntity.upstreamSourceCode,n.imcoming.tQcTestDocumentEntity.testResult="jyjghg",n.receiptsId=n.imcoming.tQcTestDocumentEntity.documentCode,n.documentStatus=n.imcoming.tQcTestDocumentEntity.documentStatus,n.documentCode=n.imcoming.tQcTestDocumentEntity.documentCode,n.testDocumentId=n.imcoming.tQcTestDocumentEntity.id,n.imcoming.tQcTestDocumentEntity.documentTime=new Date(n.imcoming.tQcTestDocumentEntity.documentTime).format("yyyy-MM-dd"),n.styleResultArray=t.data.tqcStyleTestInfoVo,n.firstLoad?(n.initStyleResult(),n.firstLoad=!1):n.reInitStyleResult(),t.data.tqcStyleTestInfoVo.map(function(e){e.allTestName="",e.styleTestItems.map(function(t){t.testItemEntity?(t.sampleAmount=parseInt((t.testItemEntity.randomTestProportion/100||0)*e.testAmount,10),t.sampleUnqualifiedAmount=t.testItemEntity.sampleUnqualifiedAmount,t.sampleQualifiedAmount=t.testItemEntity.sampleQualifiedAmount,t.rejectNumber=t.testItemEntity.rejectNumber,t.allowNumber=t.testItemEntity.allowNumber,t.randomTestProportion=t.testItemEntity.randomTestProportion?t.testItemEntity.randomTestProportion:t.defaultDomTestProportion,e.showStyleItems=!0):(e.showStyleItems=!1,e.allTestName+=t.testItemName+" , ")}),0<e.allTestName.length&&(e.allTestName=e.allTestName.substring(0,e.allTestName.length-2))}),n.editTestResult(),n.imcoming.styleInput.styleTestItems.map(function(t,e){t.testResult="jyjghg"})}},error:function(t){console.log("服务器出错")}})},add:function(){this.isEdit=!0,this.isLook=!1},testWayChange:function(t){var n=this;setTimeout(function(){"qj"===t?(n.canInput=!0,n.imcoming.styleInput.styleTestItems.map(function(t,e){t.testResult="jyjghg",t.randomTestProportion="100",n.testWayChangeRecordQj&&(t.testValue=n.testWayChangeRecordQj.styleTestItems[e].testValue,t.sampleAmount=n.testWayChangeRecordQj.testAmount,t.sampleUnqualifiedAmount=0,t.sampleQualifiedAmount=parseInt(t.sampleAmount,10)-(parseInt(t.sampleUnqualifiedAmount,10)||0),$(".sampleQualifiedAmount"+e).html(t.sampleQualifiedAmount),t.badReasonId=n.testWayChangeRecordQj.styleTestItems[e].badReasonId,t.remark=n.testWayChangeRecordQj.styleTestItems[e].remark,t.allowNumber=0,t.rejectNumber=0,n.$forceUpdate())})):"mj"===t?(n.canInput=!0,n.imcoming.styleInput.styleTestItems.map(function(t,e){t.testResult="jyjghg",t.randomTestProportion="100",t.sampleUnqualifiedAmount=0,n.testWayChangeRecordMj&&(t.allowNumber=0,t.rejectNumber=0,t.testValue=n.testWayChangeRecordMj.styleTestItems[e].testValue,t.sampleAmount=n.testWayChangeRecordQj.testAmount,t.sampleQualifiedAmount=parseInt(n.testWayChangeRecordMj.testAmount,10),$(".sampleQualifiedAmount"+e).html(t.sampleQualifiedAmount),t.badReasonId="",t.remark=n.testWayChangeRecordMj.styleTestItems[e].remark)})):"cj"===t&&(n.imcoming.styleInput.styleTestItems.map(function(t,e){n.testWayChangeRecordCj&&(t.testResult="jyjghg",t.testValue=n.testWayChangeRecordCj.styleTestItems[e].testValue,t.randomTestProportion=n.testWayChangeRecordCj.styleTestItems[e].randomTestProportion,t.sampleAmount=n.testWayChangeRecordCj.styleTestItems[e].sampleAmount,t.sampleUnqualifiedAmount="",t.sampleQualifiedAmount=0,t.remark=n.testWayChangeRecordCj.styleTestItems[e].remark,t.allowNumber=n.testWayChangeRecordCj.styleTestItems[e].testItemEntity.allowNumber,t.rejectNumber=n.testWayChangeRecordCj.styleTestItems[e].testItemEntity.rejectNumber)}),n.canInput=!0)},30)},genReportPaper:function(){var t=this.imcoming.tQcTestDocumentEntity;if(null===t.id||void 0===t.id)return layer.alert("检验单未审核，请提交审核!"),!1;window.parent.activeEvent({name:"生成报告单",url:contextPath+"/quality/inspection-report.html",params:{testDocumentId:t.id,code:t.sourceDocumentCode}})},editTestResult:function(){var t=this.resultSelectedIndex;this.testMessagePane="first";var e=this.styleResultArray[this.resultSelectedIndex-1];!e||"cj"!==e.testWay&&"qj"!==e.testWay&&"mj"!==e.testWay?this.testWayDisabled=!1:this.testWayDisabled=!0,this.imcoming.styleInput=Object.assign({},this.imcoming.styleInput,{index:t},_extends({},this.styleResultArray[this.resultSelectedIndex-1])),this.imcoming.styleInput.testResul||(this.imcoming.styleInput=Object.assign(this.imcoming.styleInput,{testResult:"jyjghg"})),this.notStyleItemsTip()},changeStyleName:function(t){this.testMessagePane=t},rowClick:function(t){if(console.log(this.styleResultArray[this.resultSelectedIndex-1].styleTestItems),null!==this.resultSelectedIndex){if(this.styleResultArray[this.resultSelectedIndex-1]=JSON.parse(JSON.stringify(Object.assign({},this.styleResultArray[this.resultSelectedIndex-1],_extends({},this.imcoming.styleInput)))),1===this.styleResultArray.length)return this.reInitStyleResult(),void("previous"===t?layer.alert("已是第一条"):"next"===t&&layer.alert("已是最后一条"));"first"===t?(this.calculateQualifiedAmount(this.resultSelectedIndex-1),this.resultSelectedIndex=1,this.editTestResult(),this.imcoming.styleInput.styleTestItems.map(function(t,e){t.testResult="jyjghg"})):"previous"===t?(this.calculateQualifiedAmount(this.resultSelectedIndex-1),1==this.resultSelectedIndex?(this.resultSelectedIndex=1,layer.alert("已是第一条")):this.resultSelectedIndex--,this.editTestResult(),this.imcoming.styleInput.styleTestItems.map(function(t,e){t.testResult="jyjghg"})):"next"===t?(this.calculateQualifiedAmount(this.resultSelectedIndex-1),this.resultSelectedIndex==this.styleResultArray.length?(this.resultSelectedIndex=this.styleResultArray.length,layer.alert("已是最后一条")):this.resultSelectedIndex++,this.editTestResult(),this.imcoming.styleInput.styleTestItems.map(function(t,e){t.testResult="jyjghg"})):"last"===t&&(this.calculateQualifiedAmount(this.resultSelectedIndex),this.resultSelectedIndex=this.styleResultArray.length,this.editTestResult(),this.imcoming.styleInput.styleTestItems.map(function(t,e){t.testResult="jyjghg"})),this.imcoming.styleInput=JSON.parse(JSON.stringify(Object.assign({},_extends({},this.styleResultArray[this.resultSelectedIndex-1])))),this.notStyleItemsTip(),this.reInitStyleResult(),this.imcoming.styleInput.index=this.resultSelectedIndex}},notStyleItemsTip:function(){console.log(this.parentParams),this.parentParams&&"update"===this.parentParams.type?this.imcoming.styleInput.showStyleItems=!0:this.imcoming.styleInput.showStyleItems||(this.imcoming.styleInput.allTestName.length<=0?layer.alert("该商品类型没有对应的检验项目，请添加检验项目！"):layer.alert("请先维护 [ "+this.imcoming.styleInput.allTestName+" ] 检验项目对应检验数量："+this.imcoming.styleInput.testAmount+" 的抽检比例 ！"))},calculateQualifiedAmount:function(){this.imcoming.styleInput.unqualifiedAmount=parseInt(this.imcoming.styleInput.unqualifiedAmount,10)?parseInt(this.imcoming.styleInput.unqualifiedAmount,10):0,this.imcoming.styleInput.qualifiedAmount=parseInt(this.imcoming.styleInput.testAmount,10)-this.imcoming.styleInput.unqualifiedAmount,this.imcoming.styleInput.qualifiedPercent=(parseInt(this.imcoming.styleInput.qualifiedAmount,10)/parseInt(this.imcoming.styleInput.testAmount,10)*100).toFixed(2)+"%";var t={testAmount:parseInt(this.imcoming.styleInput.testAmount,10),qualifiedAmount:this.imcoming.styleInput.qualifiedAmount,unqualifiedAmount:parseInt(this.imcoming.styleInput.unqualifiedAmount,10),qualifiedPercent:this.imcoming.styleInput.qualifiedPercent};this.styleResultArray[this.resultSelectedIndex-1]&&(this.styleResultArray[this.resultSelectedIndex-1]=Object.assign({},this.styleResultArray[this.resultSelectedIndex-1],_extends({},t))),this.calculateTotal()},calculateTotal:function(){this.imcoming.tQcTestDocumentEntity.testTotalAmount=0,this.imcoming.tQcTestDocumentEntity.unqualifiedTotalAmount=0;for(var t=this.styleResultArray.length,e=0;e<t;e++)console.log(this.styleResultArray[e].testTotalAmount),isNaN(parseInt(this.styleResultArray[e].testAmount,10))||(this.imcoming.tQcTestDocumentEntity.testTotalAmount+=Number(this.styleResultArray[e].testAmount)),isNaN(parseInt(this.styleResultArray[e].unqualifiedAmount,10))||(this.imcoming.tQcTestDocumentEntity.unqualifiedTotalAmount+=Number(this.styleResultArray[e].unqualifiedAmount));this.imcoming.tQcTestDocumentEntity.qualifiedTotalAmount=this.imcoming.tQcTestDocumentEntity.testTotalAmount-this.imcoming.tQcTestDocumentEntity.unqualifiedTotalAmount,this.imcoming.tQcTestDocumentEntity.qualifiedPercent=(this.imcoming.tQcTestDocumentEntity.qualifiedTotalAmount/this.imcoming.tQcTestDocumentEntity.testTotalAmount*100).toFixed(2)+"%"},testValueBlur:function(t){console.log(t);var e=void 0,n=isNaN(t.testItemEntity.goalValue),a=isNaN(t.testItemEntity.goalValueName);e=!n&&a?t.testItemEntity.goalValueName:parseInt(t.testItemEntity.goalValue,10);var s=void 0;s=isNaN(t.testValue)?t.testValue:parseInt(t.testValue);var i=parseInt(t.testItemEntity.upperLimitValue),o=parseInt(t.testItemEntity.lowerLimitValue);console.log("target: "+e,"test: "+s,"upperLimitValue: "+i,"lowerLimitValue: "+o),"="===t.testItemEntity.compareSymbolName&&(t.testResult=e===s?"jyjghg":"jyjgbhg"),"between"===t.testItemEntity.compareSymbolName&&(t.testResult=s<=i&&o<=s?"jyjghg":"jyjgbhg"),">="===t.testItemEntity.compareSymbolName&&(t.testResult=e<=s?"jyjghg":"jyjgbhg"),"<="===t.testItemEntity.compareSymbolName&&(t.testResult=s<=e?"jyjghg":"jyjgbhg"),"<>"===t.testItemEntity.compareSymbolName&&(t.testResult=s!==e?"jyjghg":"jyjgbhg"),">"===t.testItemEntity.compareSymbolName&&(t.testResult=e<s?"jyjghg":"jyjgbhg"),"<"===t.testItemEntity.compareSymbolName&&(t.testResult=s<e?"jyjghg":"jyjgbhg"),this.$forceUpdate()},randomTestProportionBlur:function(t,e,n){parseFloat(t.randomTestProportion)<parseFloat(t.defaultDomTestProportion)?(layer.alert("不能低于默认值"),t.randomTestProportion=parseFloat(t.defaultDomTestProportion)):t.sampleAmount=parseInt(parseInt(t.randomTestProportion,10)*this.imcoming.styleInput.testAmount/100,10),this.$forceUpdate()},sampleUnqualifiedAmountBlur:function(t,e){if(parseInt(t.sampleAmount)<parseInt(t.sampleUnqualifiedAmount))return layer.alert("取样不合格数不能大于取样数"),!1;Vue.set(t,"sampleQualifiedAmount",parseInt(t.sampleAmount)-parseInt(t.sampleUnqualifiedAmount)),parseInt(t.sampleUnqualifiedAmount,10)<parseInt(t.allowNumber,10)?t.testResult="jyjghg":parseInt(t.sampleUnqualifiedAmount,10)>parseInt(t.rejectNumber,10)&&(t.testResult="jyjgbhg"),this.$forceUpdate()},hideMirror:function(t){$(".select"+t+" .mirror").hide()},showMirror:function(t){var e=$(".select"+t).offset().top-$(document).scrollTop()-65,n=$(".select"+t).offset().left+150;$(".select"+t+" .mirror").css("top",e),$(".select"+t+" .mirror").css("left",n),$(".select"+t+" .mirror").show()},initStyleResult:function(){var s=this;$("#styleResult_table").jqGrid({dataType:"local",styleUI:"Bootstrap",rownumbers:!0,multiselect:!0,colNames:["检验结果","结果描述/建议","图片","商品编码","商品名称","批号","检验数量","计数单位","总重","计重单位","质检方式","合格数","不合格数","合格率","质检状态"],colModel:[{name:"testResult",index:"testResult",width:100,align:"center",formatter:function(t,e,n,a){return"jyjghg"===t?"合格":"jyjgtbfx"===t?"特别放行":"jyjgbhg"===t?"不合格":""}},{name:"resultDescribeSuggest",index:"resultDescribeSuggest",width:140,align:"center"},{name:"sourceDocumentProductStyle.pictureUrl",width:80,align:"center",formatter:function(t,e,n){$(document).on("mouseout",".can",function(){s.hideMirror(parseFloat(e.rowId))}),$(document).on("mouseenter",".select"+parseFloat(e.rowId),function(){console.log(parseFloat(e.rowId)),s.showMirror(parseFloat(e.rowId))});var a=void 0;return a=t||"http://"+window.location.host+contextPath+"/images/no_pic.png",'<div class="select'+parseFloat(e.rowId)+' can">\n                                    <img width="50px" height="50px" src="'+a+'"/>\n                                    <div class="mirror"><img width="180px" src="'+a+'"></div>\n                                </div>'}},{name:"sourceDocumentProductStyle.productCode",width:80,align:"center",formatter:function(t,e,n,a){return $(document).on("click",".detail"+t,function(){this.toProductDetail({value:t,grid:e,rows:n,state:a})}),'<a type="primary" class="detail'+t+'">'+t+"</a>"}},{name:"sourceDocumentProductStyle.productName",width:100,align:"center"},{name:"sourceDocumentProductStyle.lotNumber",width:140,align:"center"},{name:"testAmount",width:80,align:"center"},{name:"sourceDocumentProductStyle.countingUnit",width:80,align:"center"},{name:"sourceDocumentProductStyle.weight",width:80,align:"center"},{name:"sourceDocumentProductStyle.weightUnit",width:80,align:"center"},{name:"testWay",index:"testWay",width:80,align:"center",formatter:function(t,e,n,a){return testDocumentVm.formatterTestWay(t)}},{name:"qualifiedAmount",width:80,align:"center"},{name:"unqualifiedAmount",width:80,align:"center"},{name:"qualifiedPercent",width:80,align:"center"},{name:"testStatus",width:80,align:"center",formatter:function(t,e,n,a){return testDocumentVm.formatterTestStatus(t)}}],pager:!1,autoHeight:!0,onSelectRow:function(t,e){s.resultSelectedIndex=""===t||"null"===t?1:t},beforeSelectRow:function(){$("#styleResult_table").jqGrid("resetSelection")},gridComplete:function(){var t=$("#styleResult_table");$("#cb_"+t[0].id).hide()}});for(var t=s.styleResultArray.length,e=0;e<t;e++)$("#styleResult_table").jqGrid("addRowData",e+1,s.styleResultArray[e])},reInitStyleResult:function(){var t=$("#jqGrid_wrapper");t.empty();$("<table id=styleResult_table></table>").appendTo(t),this.initStyleResult()},fetchTestWay:function(){var r=this;$.ajax({type:"POST",url:contextPath+"/codeController/getChildNodesByMark",dataType:"json",data:{mark:"zj_zjfs"},success:function(t){if(r.testWays=[],"100100"===t.code&&0<t.data.length){var e=!0,n=!1,a=void 0;try{for(var s,i=t.data[Symbol.iterator]();!(e=(s=i.next()).done);e=!0){var o=s.value;r.testWays.push({name:o.name,value:o.value})}}catch(t){n=!0,a=t}finally{try{!e&&i.return&&i.return()}finally{if(n)throw a}}}},error:function(t){console.log("服务器出错")}})},fetchTestStatus:function(){var r=this;$.ajax({type:"POST",url:contextPath+"/codeController/getChildNodesByMark",dataType:"json",data:{mark:"zj_zhijianzhuangtai"},success:function(t){if(r.testStatusArr=[],"100100"===t.code&&0<t.data.length){var e=!0,n=!1,a=void 0;try{for(var s,i=t.data[Symbol.iterator]();!(e=(s=i.next()).done);e=!0){var o=s.value;r.testStatusArr.push({name:o.name,value:o.value})}}catch(t){n=!0,a=t}finally{try{!e&&i.return&&i.return()}finally{if(n)throw a}}}},error:function(t){}})},getSourceType:function(){var r=this;$.ajax({type:"POST",url:contextPath+"/testDocument/querySourceType",dataType:"json",data:{},success:function(t){if(r.sourceTypeArr=[],"100100"===t.code){var e=!0,n=!1,a=void 0;try{for(var s,i=t.data[Symbol.iterator]();!(e=(s=i.next()).done);e=!0){var o=s.value;r.sourceTypeArr.push({name:o.name,value:o.value})}}catch(t){n=!0,a=t}finally{try{!e&&i.return&&i.return()}finally{if(n)throw a}}}}})},fetchTestResult:function(){var r=this;$.ajax({type:"POST",url:contextPath+"/codeController/getChildNodesByMark",dataType:"json",data:{mark:"zj_jyjg"},success:function(t){if(console.log(t),r.testResultArr=[],"100100"===t.code&&0<t.data.length){var e=!0,n=!1,a=void 0;try{for(var s,i=t.data[Symbol.iterator]();!(e=(s=i.next()).done);e=!0){var o=s.value;r.testResultArr.push({name:o.name,value:o.value})}}catch(t){n=!0,a=t}finally{try{!e&&i.return&&i.return()}finally{if(n)throw a}}}},error:function(t){}})},formatterTestWay:function(t){return t?this.testWays.length<1?"":this.testWays[this.testWays.map(function(t){return t.value}).indexOf(t)]?this.testWays[this.testWays.map(function(t){return t.value}).indexOf(t)].name:t:""},formatterTestStatus:function(t){return t?this.testStatusArr.length<1?"":this.testStatusArr[this.testStatusArr.map(function(t){return t.value}).indexOf(t)]?this.testStatusArr[this.testStatusArr.map(function(t){return t.value}).indexOf(t)].name:t:""},loadTestEmp:function(t){if(!t)return!1;var r=this;$.ajax({type:"POST",url:contextPath+"/testDocument/getEmployeesByDeptId",dataType:"json",data:{deptId:t},success:function(t){if(r.testEmps=[],"100100"===t.code&&0<t.data.length){var e=!0,n=!1,a=void 0;try{for(var s,i=t.data[Symbol.iterator]();!(e=(s=i.next()).done);e=!0){var o=s.value;r.testEmps.push({label:o.empName,value:o.id,code:o.empCode})}}catch(t){n=!0,a=t}finally{try{!e&&i.return&&i.return()}finally{if(n)throw a}}}},error:function(t){}})},createReport:function(){var t=this.documentStatus;if(console.log(t),"auditing"==t){var e=this.imcoming.tQcTestDocumentEntity.documentCode,n=this.imcoming.tQcTestDocumentEntity.id;null!=n&&null!=n||(n=this.testDocumentId),window.parent.activeEvent({name:"生成报告单",url:contextPath+"/quality/quality/inspection-report.html",params:{testDocumentId:n,code:e}})}else layer.alert("检验单未审核，请审核!")},loadBadResons:function(){var r=this;$.ajax({type:"POST",url:contextPath+"/documentAllController/queryBaseDataList",data:JSON.stringify({datatypeId:5}),contentType:"application/json",dataType:"json",success:function(t){if(r.badResons=[],"100100"===t.code&&0<t.data.length){var e=!0,n=!1,a=void 0;try{for(var s,i=t.data[Symbol.iterator]();!(e=(s=i.next()).done);e=!0){var o=s.value;r.badResons.push({name:o.name,value:o.id})}}catch(t){n=!0,a=t}finally{try{!e&&i.return&&i.return()}finally{if(n)throw a}}}},error:function(t){}})},addNew:function(){this.sourceCodeDisabled=!1,this.sendTestDisabled=!1,this.generateDisabled=!1,this.examineVerifyName="",this.examineVerifyTime="",this.documentStatus="",this.upstreamSourceCode="",this.imcoming={tQcTestDocumentEntity:{id:"",sourceDocumentType:"",sourceDocumentCode:"",sourceDepartmentName:"",informerName:"",sendTestName:"",sendTestId:"",sendTestTime:"",testTotalAmount:"",qualifiedPercent:"",documentCode:"",documentType:"",businessType:"",documentTime:"",documentStatus:"",qualifiedTotalAmount:"",testResult:"",testOrganizationId:"",testOrganizationName:"",testDepartmentName:"",inspectorId:"",inspectorName:"",testFinishTime:"",unqualifiedTotalAmount:"",totalTestConclusion:"",supplierOrCustomerCode:"",createName:"",createTime:"",updateName:"",updateTime:"",sysFile:{fileId:"",fileType:6,fileDetails:[]}},styleInput:{productStyleId:"",productTypeId:"",testWay:"",qualifiedAmount:"",testAmount:"",qualifiedPercent:"",unqualifiedAmount:"",testResult:"",resultDescribeSuggest:"",sourceDocumentProductStyle:{productCode:"",productName:""},styleTestItems:[]}},this.styleResultArray=[],this.reInitStyleResult(),this.$forceUpdate(),this.reload=!this.reload,$("#approvalList").jqGrid("clearGridData"),$("#approvalList").jqGrid("setGridParam",{postData:{receiptsId:""}}).trigger("reloadGrid")},genSpecialRelease:function(){var n=this;"auditing"==n.documentStatus?$.ajax({type:"POST",url:contextPath+"/testDocument/isSpecialOrComfirm",data:{testDocumentId:n.imcoming.tQcTestDocumentEntity.id,type:"spercial"},dataType:"json",success:function(t){if("specialAcross"===t.data){var e=n.imcoming.tQcTestDocumentEntity.sourceDocumentCode;window.parent.activeEvent({name:"生成特别放行单",url:contextPath+"/quality/quality/specialReleaseDocumentInfo.html?type=1&code="+e})}else layer.alert(t.data)},error:function(t){layer.alert(res.data)}}):layer.alert("检验单未审核，请审核!")},confirmResult:function(){"auditing"==this.documentStatus?$.ajax({type:"POST",url:contextPath+"/testDocument/isSpecialOrComfirm",data:{testDocumentId:this.imcoming.tQcTestDocumentEntity.id,type:"comfirm"},dataType:"json",success:function(t){"comfirmAcross"===t.data?layer.alert("已确认检验结果"):layer.alert(t.data)},error:function(t){layer.alert(res.data)}}):layer.alert("检验单未审核，请审核!")},hideSearch:function(){this.isHide=!this.isHide,this.isSearchHide=!this.isSearchHide,$(".chevron").css("top","")},exit:function(){console.log(this.openTime),window.parent.closeCurrentTab({openTime:this.openTime,exit:!0})},returnSource:function(){var t=void 0;console.log(this.imcoming.tQcTestDocumentEntity.documentTypeName),"来料检验单"==this.imcoming.tQcTestDocumentEntity.documentTypeName?(t="lljyd",window.parent.activeEvent({name:"来料检验单",url:contextPath+"/quality/test-document/test-document-list-lljyd.html?documentType="+t})):"调拨检验单"==this.imcoming.tQcTestDocumentEntity.documentTypeName?(t="tbjyd",window.parent.activeEvent({name:"调拨检验单",url:contextPath+"/quality/test-document/test-document-list-dbjyd.html?documentType="+t})):(t="fhjyd",window.parent.activeEvent({name:"发货检验单",url:contextPath+"/quality/test-document/test-document-list-fhjyd.html?documentType="+t}))}},watch:{documentCode:function(){var t=this.documentCode;t&&($("#approvalList").jqGrid("clearGridData"),$("#approvalList").jqGrid("setGridParam",{postData:{receiptsId:t}}).trigger("reloadGrid"))},documentStatus:function(){"auditing"===this.documentStatus?this.isStampShow=!0:this.isStampShow=!1,this.$forceUpdate()},reload:function(){var t=this.documentCode;t&&($("#approvalList").jqGrid("clearGridData"),$("#approvalList").jqGrid("setGridParam",{postData:{receiptsId:t}}).trigger("reloadGrid"))},"imcoming.styleInput.testWay":function(t,e){console.log(this.imcoming.styleInput.testWay,e,t),e?"qj"===e?this.testWayChangeRecordQj=JSON.parse(JSON.stringify(this.imcoming.styleInput)):"cj"===e?this.testWayChangeRecordCj=JSON.parse(JSON.stringify(this.imcoming.styleInput)):"mj"===e&&(this.testWayChangeRecordMj=JSON.parse(JSON.stringify(this.imcoming.styleInput))):(this.testWayChangeRecordQj=JSON.parse(JSON.stringify(this.imcoming.styleInput)),this.testWayChangeRecordCj=JSON.parse(JSON.stringify(this.imcoming.styleInput)),this.testWayChangeRecordMj=JSON.parse(JSON.stringify(this.imcoming.styleInput)))}},filters:{formatPercent:function(t){return t?(Math.round(1e4*t)/100).toFixed(2)+"%":""}},created:function(){this.parentParams=window.parent.params.params},mounted:function(){this.initStyleResult(),console.log("parentParams：",this.parentParams);var t=layui.data("user");console.log("user: ",t),this.openTime=window.parent.params.openTime,this.fetchOrg(),this.getSendTestPeople(),this.fetchTestWay(),this.fetchTestStatus(),this.fetchTestResult(),this.getSourceType(),this.loadBadResons(),$.isEmptyObject(this.parentParams)||($.isEmptyObject(this.parentParams.type)?(console.log("走新增"),"all"==this.parentParams.ger&&this.loadData(this.parentParams.rowData.documentCode,this.parentParams.rowData.productTypeId)):(console.log("走修改"),this.loadUpdate(this.parentParams.code,this.parentParams.type)))}});