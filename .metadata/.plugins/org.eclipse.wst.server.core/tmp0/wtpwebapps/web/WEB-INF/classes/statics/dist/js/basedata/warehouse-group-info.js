"use strict";load_group=function(){$.ajax({url:contextPath+"/tbaserepertorypositiongroup/list",type:"POST",datatype:"JSON",success:function(e){vm.groups=e.data}})};var vm=new Vue({el:"#unit-info",data:function(){var n=this;return{username:"",title:"",action:0,positionInfo:{code:"",name:""},groupId:0,groupName:"",groups:[],isEdit:!1,isView:!1,reload:!1,activeStyle:"",selected:[],body:{name:"",code:"",status:"",groupIds:""},belongs:[{label:"华东区普通仓1",value:1},{label:"华东区普通仓2",value:2},{label:"华南区普通仓1",value:3}],repertoryPosition:{code:"",name:"",groupId:"",groupName:"",remark:"",createTime:"",updateTime:"",createName:"",updateName:""},data_config:{url:contextPath+"/tbaserepertoryposition/list",colNames:["id","库位编码","库位名称","所属库位组id","所属库位组","备注","创建人","创建时间","最新修改人","最新修改时间"],colModel:[{name:"id",index:"id",width:100,align:"center",hidden:!0},{name:"code",index:"code",width:210,align:"center",formatter:function(e,t,o,a){var r=".detail"+e;$(document).off("click",r).on("click",r,function(){n.detailClick({value:e,grid:t,rows:o,state:a})});var i='<a class="detail'+e+'">'+e+"</a>";return console.log(e,t,o,a),i}},{name:"name",index:"name",width:100,align:"center"},{name:"groupId",index:"groupId",width:80,align:"center",hidden:!0},{name:"groupName",index:"groupName",width:80,align:"center"},{name:"remark",index:"remark",width:80,align:"center"},{name:"createName",index:"createName",width:80,align:"center"},{name:"createTime",index:"createTime",width:150,sortable:!1},{name:"updateName",index:"updateName",width:80,align:"center"},{name:"updateTime",index:"updateTime",width:150,sortable:!1,align:"center"}],shrinkToFit:!1},nodeData:[{id:1,pId:0,name:"库位组1",open:!0},{id:11,pId:1,name:"库位1"},{id:12,pId:1,name:"库位2"},{id:2,pId:0,name:"库位组2",open:!0},{id:21,pId:2,name:"库位3"},{id:22,pId:2,name:"库位4"}],setting1:{data:{simpleData:{enable:!0}},callback:{onClick:"clickEvent"}},tmpWhouse:"",addRepertoryGroup:"",modifyRepertoryGroup:"",showModal:!1,selectOrginId:[],isSearchHide:!0,columns:[{type:"selection",width:60,align:"center"},{title:"组织名称",key:"orgName"}],colContent:[],organId:0}},created:function(){},methods:{get_user:function(){var t=this;$.ajax({url:contextPath+"/tbaserepertorypositiongroup/getusername",type:"POST",datatype:"JSON",success:function(e){t.username=e.data}})},load_group:function(){$.ajax({url:contextPath+"/tbaserepertorypositiongroup/list",type:"POST",datatype:"JSON",success:function(e){vm.groups=e.data}})},add_click:function(){vm.title="新增库位";var e=new Date,t=e.getFullYear()+"-"+(e.getMonth()+1)+"-"+e.getDate()+" "+e.getHours()+":"+e.getMinutes()+":"+e.getSeconds();if(vm.repertoryPosition.createTime=t,vm.repertoryPosition.updateTime=t,0===vm.groupId)return layer.alert("请选择库位组",{icon:2,title:"信息"}),!1;vm.action=1,this.repertoryPosition.groupId=vm.groupId,this.isEdit=!0;vm.groupId;this.areaInit={isInit:!1,province:"",city:"",county:"",detail:"",disabled:!1},$.ajax({url:contextPath+"/tbaserepertorypositiongroup/list",type:"POST",dataType:"JSON",success:function(e){vm.groups=e.data}})},save:function(){if(vm.repertoryPosition.code="",vm.repertoryPosition.name="",vm.repertoryPosition.groupId="",vm.repertoryPosition.remark="",vm.repertoryPosition.createName="",vm.repertoryPosition.createTime="",vm.repertoryPosition.updateName="",vm.repertoryPosition.updateTime="",(1==vm.action||4==vm.action)&&$("form").valid()){var e=$("form").serializeArray();(o={}).code=e[0].value,o.name=e[1].value,o.groupId=e[2].value,o.remark=e[3].value;var t=JSON.stringify(o);$.ajax({url:contextPath+"/tbaserepertoryposition/save",type:"POST",dataType:"JSON",data:t,contentType:"application/json",success:function(e){"100100"==e.code?layer.alert("保存成功",{icon:1,title:"信息"}):layer.alert("保存失败",{icon:2,title:"信息"}),vm.isEdit=!vm.isEdit}})}if(2==vm.action&&$("form").valid()){console.log(this.$data);var o;e=$("form").serializeArray();console.log(e),(o={}).id=vm.selected[0],o.code=e[0].value,o.name=e[1].value,o.groupId=e[2].value,o.remark=e[3].value;t=JSON.stringify(o);$.ajax({url:contextPath+"/tbaserepertoryposition/update",type:"POST",dataType:"JSON",data:t,contentType:"application/json",success:function(e){"100100"==e.code?layer.alert("更新成功",{icon:1,title:"信息"}):layer.alert("更新失败",{icon:2,title:"信息"}),vm.isEdit=!vm.isEdit,vm.selected=[]}})}if(3==vm.action)return alert("详情"),!1},search:function(){var e={};e.name=vm.body.name,e.code=vm.body.code,e.groupIds=vm.body.groupIds;JSON.stringify(e);""!==vm.body.groupIds&&(vm.body.groupIds=vm.body.groupIds.join(",")),this.reload=!this.reload},clear:function(){vm.groupId=0,vm.body.code="",vm.body.name="",vm.body.groupIds=[],vm.body.status="",vm.activeStyle="",this.reload=!this.reload},delg:function(){if(0===vm.groupId)return layer.alert("请选择需要删除的库位组",{icon:2,title:"信息"}),!1;layer.confirm("确认删除？",{btn:["确认","取消"]},function(){$.ajax({url:contextPath+"/tbaserepertorypositiongroup/delete/"+vm.groupId,type:"POST",async:!1,success:function(e){"100100"==e.code?layer.alert("删除成功",{icon:1,title:"信息"}):layer.alert("删除失败",{icon:2,title:"信息"}),load_group()}})})},delo:function(){if(vm.selected.length<1)return layer.alert("请选择需要删除的库位",{icon:2,title:"信息"}),!1;layer.confirm("当前数据有可能被引用，会影响数据准确性，确认是否删除？",{btn:["确认","取消"]},function(){var e=JSON.stringify(vm.selected);$.ajax({url:contextPath+"/tbaserepertoryposition/delete",type:"POST",dataType:"JSON",contentType:"application/json",data:e,success:function(e){layer.alert("删除成功",{icon:1,title:"信息"}),vm.reload=!vm.reload}}),vm.selected=[]})},modify:function(e){if(vm.title="修改库位",vm.selected.length<1)return layer.alert("请选择库位",{icon:2,title:"信息"}),!1;if(1<vm.selected.length)return layer.alert("只能选择一个库位",{icon:2,title:"信息"}),!1;vm.action=2,vm.isEdit=!vm.isEdit;var t=vm.selected[0];$.ajax({url:contextPath+"/tbaserepertoryposition/info/"+t,type:"POST",dataType:"JSON",contentType:"application/json",async:!1,success:function(e){vm.repertoryPosition.code=e.data.code,vm.repertoryPosition.name=e.data.name,vm.repertoryPosition.groupId=e.data.groupId,vm.repertoryPosition.remark=e.data.remark,vm.repertoryPosition.createTime=e.data.createTime,vm.repertoryPosition.updateTime=e.data.updateTime,vm.repertoryPosition.createName=e.data.createName,vm.repertoryPosition.updateName=e.data.updateName}})},copy:function(e){if(vm.title="复制库位",vm.selected.length<1)return layer.alert("请选择库位",{icon:2,title:"信息"}),!1;if(1<vm.selected.length)return layer.alert("只能选择一个库位",{icon:2,title:"信息"}),!1;vm.action=4,vm.isEdit=!vm.isEdit;var t=vm.selected[0];$.ajax({url:contextPath+"/tbaserepertoryposition/info/"+t,type:"POST",dataType:"JSON",contentType:"application/json",async:!1,success:function(e){vm.repertoryPosition.groupId=e.data.groupId,vm.repertoryPosition.remark=e.data.remark,vm.repertoryPosition.createTime=e.data.createTime,vm.repertoryPosition.updateTime=e.data.updateTime,vm.repertoryPosition.createName=e.data.createName,vm.repertoryPosition.updateName=e.data.updateName}})},exit:function(){vm.repertoryPosition.code="",vm.repertoryPosition.name="",vm.repertoryPosition.groupId="",vm.repertoryPosition.remark="",vm.repertoryPosition.createName="",vm.repertoryPosition.createTime="",vm.repertoryPosition.updateName="",vm.repertoryPosition.updateTime="",vm.selected=[],this.areaInit={isInit:!1,province:"",city:"",county:"",detail:"",disabled:!1},this.isEdit=!1},addWarehouseGroup:function(){var o=this,a=layer.open({type:1,title:"新增库位组",content:$("#addUnitGroup"),btn:["保存","取消"],area:"400px",btn1:function(){var e={};e.name=o.addRepertoryGroup;var t=JSON.stringify(e);$.ajax({url:contextPath+"/tbaserepertorypositiongroup/save",async:!1,data:t,type:"POST",dataType:"JSON",contentType:"application/json",success:function(e){layer.alert("保存成功",{icon:1,title:"信息"})}}),layer.close(a),o.addRepertoryGroup="",load_group()}})},modifyWarehouseGroup:function(){if(0!==vm.groupId)var o=layer.open({type:1,title:"修改库位组",content:$("#modifyUnitGroup"),btn:["保存","取消"],area:"400px",btn1:function(){var e={};e.id=vm.groupId,e.name=vm.modifyRepertoryGroup;var t=JSON.stringify(e);vm.groupId=0,$.ajax({url:contextPath+"/tbaserepertorypositiongroup/update",async:!1,type:"POST",dataType:"JSON",contentType:"application/json",data:t,success:function(e){layer.alert("更新成功",{icon:1,title:"信息"})}}),layer.close(o),load_group()}});else layer.alert("请先选择库位组",{icon:2,title:"信息"})},clickEvent:function(e,t,o){var a=this.$ztree.getSelectedNodes();console.log(a),this.tmpWhouse=a[0].name},detailClick:function(e){vm.isView=!0,vm.action=3,vm.title="库位详情";var t=e.rows.id;vm.isEdit=!0;var o=jQuery("#list").jqGrid("getRowData",t).code;/<a.*?>(.*?)<\/a>/gi.exec(o);vm.selected=[],$.ajax({url:contextPath+"/tbaserepertoryposition/info/"+t,type:"POST",dataType:"JSON",contentType:"application/json",async:!1,success:function(e){console.log(e),vm.repertoryPosition.code=e.data.code,vm.repertoryPosition.name=e.data.name,vm.repertoryPosition.groupId=e.data.groupId,vm.repertoryPosition.remark=e.data.remark,vm.repertoryPosition.createTime=e.data.createTime,vm.repertoryPosition.updateTime=e.data.updateTime,vm.repertoryPosition.createName=e.data.createName,vm.repertoryPosition.updateName=e.data.updateName}})},selectGroup:function(e,t){vm.groupId=e.id,vm.body.groupIds=e.id,vm.modifyRepertoryGroup=e.name,this.activeStyle=t,this.reload=!this.reload},showOrgin:function(){0!=this.selected.length?this.showModal=!0:layer.alert("请选择库位")},okModel:function(){if(0!=this.selectOrginId.length){var e={ids:{},orginIds:{}};e.ids=this.selected.join(","),e.orginIds=this.selectOrginId.join(","),this.cancelModel();var t=this;$.ajax({type:"POST",url:contextPath+"/tbaserepertoryposition/allot",traditional:!0,datatype:"json",data:e,success:function(e){"100100"===e.code?(layer.alert("分配成功",{icon:1}),t.selectOrginId=[]):layer.alert("分配成功",{icon:1})},error:function(e){layer.alert("系统错误",{icon:2})}})}else layer.alert("请选择分配组织!")},cancelModel:function(){this.selectOrginId=[],this.$refs.test.selectAll(!1),this.showModal=!1},changeselect:function(e){for(var t=0;t<e.length;t++)this.selectOrginId.push(e[t].id)},getOrganizations:function(){var i=this;$.ajax({url:contextPath+"/tbaserepertorypositiongroup/getorganizations",type:"POST",dataType:"json",success:function(e){if(100100==e.code){for(var t=e.data.organizationList,o=e.data.organId,a=-1,r=0;r<t.length;r++)if(o==t[r].id){a=r;break}t.splice(a,1),i.colContent=t}},error:function(){layer.alert("网络异常，请重试！",{icon:0})}})},hideSearch:function(){this.isSearchHide=!this.isSearchHide,$(".chevron").css("top","")},quit:function(){window.parent.closeCurrentTab({exit:!0,openTime:this.openTime})}},mounted:function(){window.parent.userInfo.organId;load_group(),this.get_user(),this.getOrganizations(),this.openTime=window.parent.params.openTime}});