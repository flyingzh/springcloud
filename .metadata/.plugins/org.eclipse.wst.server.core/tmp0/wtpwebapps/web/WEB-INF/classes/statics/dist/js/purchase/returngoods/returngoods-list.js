"use strict";function _defineProperty(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var reportList=new Vue({el:"#reportList",data:function(){var e,n=this;return{openTime:"",isSearchHide:!0,isTabulationHide:!0,isShow:!1,isHide:!0,reload:!1,selected:[],categoryType:[],commodityCategoty:[],returnGoods:{},suppliers:[],dateArr:[],body:{goodsTypePath:"",supplierId:"",startTime:"",endTime:"",orderStatus:"",orderNo:""},orderStatusMap:{1:"暂存",2:"待审核",3:"审核中",4:"已审核",5:"驳回"},data_config:{url:contextPath+"/rurchaseReturnGoods/returnGoodsPage",colNames:["单据编号","id","businessType","商品类型","日期","供应商","单据状态","业务员","退货数量","退货重量"],colModel:[{name:"orderNo",index:"orderNo",width:180,align:"left",formatter:function(e,t,r,o){return $(document).off("click",".detail"+e).on("click",".detail"+e,function(){console.log({value:e,grid:t,rows:r,state:o}),n.selectByOrderDetail(r.id,r.businessType)}),'<a class="detail'+e+'">'+e+"</a>"},unformat:function(e,t,r){return e.replace(/(<\/?a.*?>)/g,"")}},{name:"id",hidden:!0},{name:"businessType",hidden:!0},{name:"goodsTypeName",index:"goodsTypeName",align:"left",width:180},(e={name:"createTime",index:"createTime",width:180,align:"center"},_defineProperty(e,"align","left"),_defineProperty(e,"formatter",function(e,t,r,o){return new Date(e).format("yyyy-MM-dd")}),e),{name:"supplierName",index:"supplierName",align:"left",width:180},{name:"orderStatus",index:"orderStatus",align:"left",width:180,formatter:function(e,t,r,o){return reportList.orderStatusMap[e]}},{name:"salesmanName",index:"salesmanName",align:"left",width:180},{name:"returnCount",index:"returnCount",align:"left",width:180},{name:"returnWeight",index:"returnWeight",width:180,align:"left"}]}}},methods:{loadSuppliers:function(){var t=this;$.ajax({type:"post",url:contextPath+"/tpurchasecollectgoods/findSupplierByOrgId",dataType:"json",success:function(e){t.suppliers=e.data},error:function(){t.$Modal.error({context:"系统出现异常,请联系管理人员"})}})},changeProductType:function(e,t){var r=t[t.length-1];this.body.goodsTypePath=r.value},search:function(){null==this.body.orderStatus&&(this.body.orderStatus=null),0<this.dateArr.length&&this.dateArr[0]&&this.dateArr[1]?(this.body.startTime=this.dateArr[0].format("yyyy-MM-dd")+" 00:00:00",this.body.endTime=this.dateArr[1].format("yyyy-MM-dd")+" 23:00:00"):(this.body.startTime="",this.body.endTime=""),this.reload=!this.reload},modify:function(){if(this.selected.length<1)this.$Modal.warning({title:"提示信息",content:"<p>请先选择至少一笔数据！</p>"});else if(1<this.selected.length)this.$Modal.warning({title:"提示信息",content:"<p>只能选择一笔数据进行修改！</p>"});else{var e=this.selected;$.ajax({url:contextPath+"/rurchaseReturnGoods/queryByOrderInfo/"+e[0].id+"/"+e[0].businessType,method:"post",dataType:"json",success:function(e){"100100"==e.code?window.parent.activeEvent({name:"采购退库单-详情",url:contextPath+"/purchase/returngoods/returngoods-add.html",params:{type:"detail",goodsData:e.data,activeType:"detail"}}):layer.alert(e.msg,{icon:0})},error:function(){layer.alert("服务器异常，请稍后再试！",{icon:0})}})}},selectByOrderDetail:function(e,t){$.ajax({url:contextPath+"/rurchaseReturnGoods/queryByOrderInfo/"+e+"/"+t,method:"post",dataType:"json",success:function(e){"100100"==e.code?window.parent.activeEvent({name:"采购退库单详情",url:contextPath+"/purchase/returngoods/returngoods-add.html",params:{type:"detail",goodsData:e.data,activeType:"detail"}}):layer.alert(e.msg,{icon:0})},error:function(){layer.alert("服务器异常，请稍后再试！",{icon:0})}})},loadProductType:function(){var t=this;$.ajax({type:"post",url:contextPath+"/documentController/getCategory?parentId=0",contentType:"application/json",dataType:"json",success:function(e){t.categoryType=t.initGoodCategory(e.data.cateLists)},error:function(e){console.log("服务器出错")}})},initGoodCategory:function(e){var n=this,a=[];return e.forEach(function(e){var t=e.customCode,r=e.name,o=e.cateLists;o&&(o=n.initGoodCategory(o)),a.push({value:t,label:r,children:o})}),a.forEach(function(e){e.children||delete e.children}),a},clear:function(){this.$refs.supplier.reset(),this.$nextTick(function(){this.body.supplierId=""}),this.commodityCategoty=[],this.dateArr=[],this.body.goodsTypePath="",this.body.supplierId="",this.body.startTime="",this.body.endTime="",this.body.orderStatus="",this.body.orderNo=""},refresh:function(){this.clear(),this.reload=!this.reload},add:function(){var e=this;e.returnGoods={};var t=layui.data("user");e.returnGoods.orgName=t.currentOrganization.orgName,e.returnGoods.organizationId=t.userCurrentOrganId,e.returnGoods.createName=t.username,e.returnGoods.createId=t.id,e.returnGoods.orderStatus=1,e.returnGoods.dataSource=1,e.returnGoods.goodList=[],e.returnGoods.createTime=(new Date).format("yyyy-MM-dd"),e.returnGoods.returnDate=(new Date).format("yyyy-MM-dd"),window.parent.activeEvent({name:"采购退库单-新增",url:contextPath+"/purchase/returngoods/returngoods-add.html",params:{type:"add",goodsData:e.returnGoods,activeType:"handworkAdd"}})},del:function(){var t=this,e=[];for(var r in this.selected)e.push(this.selected[r].id);this.selected.length<1?this.$Modal.warning({title:"提示信息",content:"<p>请先选择至少一条数据！</p>"}):1<=this.selected.length&&this.$Modal.confirm({title:"提示信息",content:"<p>是否删除信息？</p>",onOk:function(){$.ajax({url:contextPath+"/rurchaseReturnGoods/delete",method:"post",dataType:"json",data:JSON.stringify(e),contentType:"application/json;charset=utf-8",success:function(e){"100100"===e.code?setTimeout(function(){t.$Modal.success({title:"提示信息",content:"删除成功！"}),t.selected=[],t.refresh()},300):layer.alert(e.msg,{icon:0})},error:function(e){layer.alert("删除失败！",{icon:0})}})}})},cancel:function(){window.parent.closeCurrentTab({exit:!0,openTime:this.openTime})}},created:function(){this.loadProductType(),this.loadSuppliers()},watch:{},mounted:function(){this.openTime=window.parent.params.openTime}});