"use strict";var ve=new Vue({el:"#incomeExpenditure",data:function(){return{addModal:!1,reload:!1,searchModal:!1,subjectVisiable:!1,nodeSelected:!1,isDisabled:!0,subjectEnd:!1,selected:[],subjectcode:"",modifyIsDisabled:!1,isSaveOrUpdata:!1,subjectList:[],subjectVisable:!1,openTime:"",body:{id:"",code:"",incomeCategory:"1",name:"",fullName:"",subjectId:"",subjectCode:"",subjectName:""},nodes:[{id:3,pId:0,name:"收支类别",open:!0},{id:1,pId:3,name:"收入类别"},{id:2,pId:3,name:"支出类别"}],setting:{callback:{onClick:this.clickEvent}},data_config:{url:rcContextPath+"/incomeCategory/queryListPage",colNames:["代码","名称","全名","科目"],colModel:[{name:"code",index:"code",width:200,align:"center"},{name:"name",index:"name asc, invdate",width:200,align:"center"},{name:"fullName",index:"fullName",width:200,align:"center"},{name:"subjectName",index:"subjectName",width:200,align:"center"}]}}},methods:{showSubjectVisable:function(){this.subjectVisable=!0},subjectClose:function(){this.subjectVisable=!1},subjectData:function(e){console.log(e,"====treeNode"),this.body.subjectId=e.id,this.body.subjectCode=e.subjectCode,this.body.subjectName=e.subjectName,this.subjectClose()},outHtml:function(){window.parent.closeCurrentTab({name:name,openTime:this.openTime,exit:!0})},iesubjectInit:function(){Object.assign(this.body,{id:"",code:"",name:"",fullName:"",subjectId:"",subjectCode:"",subjectName:""})},modify:function(){var e=this.selected.length;if(console.log(this.selected),1<e)layer.alert("修改只能对单条数据进行操作");else if(e<=0)layer.alert("请选择需要修改操作的数据");else{console.log(this.body);var t=this.selected[0];$.ajax({type:"post",async:!0,data:{id:t},url:contextPath+"/incomeCategory/queryListPage",dataType:"json",success:function(e){var t=e.data.list;for(var a in t)ve.body={id:t[a].id,code:t[a].code,incomeCategory:t[a].incomeCategory,name:t[a].name,fullName:t[a].fullName,subjectId:t[a].subjectId,subjectCode:t[a].subjectCode,subjectName:t[a].subjectName},ve.isSaveOrUpdata=!0},error:function(e){console.log(e)}}),console.log(this.body),this.addModal=!0}},deleteBatch1:function(){var e=this.selected;$.ajax({url:contextPath+"/incomeCategory/deleteBatch",method:"post",dataType:"json",data:JSON.stringify(e),contentType:"application/json;charset=utf-8",success:function(e){ve.reload=!ve.reload},error:function(e){console.log(e)}})},saveData:function saveData(){console.log(this.body);var that=this;this.body.fullName=this.body.name;var _iteratorNormalCompletion=!0,_didIteratorError=!1,_iteratorError=void 0,Category;try{for(var _iterator=ve.subjectList[Symbol.iterator](),_step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=!0){var subj=_step.value;if(subj.value==ve.body.subjectId){var arr=subj.label.split(",");this.body.subjectCode=arr[0],this.body.subjectName=arr[1]}}}catch(e){_didIteratorError=!0,_iteratorError=e}finally{try{!_iteratorNormalCompletion&&_iterator.return&&_iterator.return()}finally{if(_didIteratorError)throw _iteratorError}}ve.isSaveOrUpdata?$.ajax({type:"POST",async:!1,contentType:"application/text",data:JSON.stringify(this.body),url:contextPath+"/incomeCategory/update",dataType:"text",success:function success(d){that.isSaveOrUpdata=!1;var data=eval("("+d+")");"codeNo"==data.data?alert("code已经存在，请重新填写。"):"nameNo"==data.data?alert("同级目录不允许名字相同，请重新填写"):(ve.iesubjectInit(),ve.reload=!ve.reload),this.isSaveOrUpdata=!1,that.selected=[]},error:function(e){console.log(e)}}):$.ajax({type:"Post",async:!0,contentType:"application/text",data:JSON.stringify(this.body),url:contextPath+"/incomeCategory/save",dataType:"text",success:function success(d){var data=eval("("+d+")");"codeNo"==data.data?alert("code已经存在，请重新填写。"):"nameNo"==data.data?alert("同级目录不允许名字相同，请重新填写"):(ve.reload=!ve.reload,ve.iesubjectInit())},error:function(e){console.log(e)}})},canceldata:function(){this.iesubjectInit()},clickEvent:function(e,t,a){if(null!=a.children)this.isDisabled=!0,this.nodeSelected=!1;else{this.isDisabled=!1;var o=this.$ztree.getSelectedNodes();console.log(o),this.body.ietypeNode=o[0].id,console.log(this.body.ietypeNode),this.body.incomeCategory=this.body.ietypeNode,this.reload=!this.reload,this.nodeSelected=!0}}},mounted:function(){this.openTime=window.parent.params&&window.parent.params.openTime,$.ajax({type:"post",async:!0,data:"",url:contextPath+"/incomeCategory/getAccountSubjectList",dataType:"json",success:function(e){for(var t=e.data,a=[],o=0;o<t.length;o++)a.push({label:t[o].subjectCode+","+t[o].subjectName,value:t[o].id});JSON.stringify(a);ve.subjectList=a},error:function(e){console.log(e)}})}});