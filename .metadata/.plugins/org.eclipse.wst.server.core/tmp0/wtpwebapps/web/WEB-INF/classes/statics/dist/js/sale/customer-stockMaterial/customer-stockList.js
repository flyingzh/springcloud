"use strict";var customerStockList=new Vue({el:"#customer-stockMaterial",data:function(){return{saleGold:"",isHideSearch:!0,isHideList:!0,openTime:"",openName:"",body:{goodsType:"",sourceOrder:"",custName:"",dateTime:""},CustomerStockMateriaQueryVo:{queryList:[]},dataValue:[],myTable:"myTable",data_user_list:{url:contextPath+"/customerStockMaterial/selectLists",colNames:["commodityId","goodsId","源单类型","源单编号","日期","客户","商品主类型","商品编码","商品名称","计重单位","重量","来料性质"],colModel:[{name:"commodityId",width:"120",align:"left",fixed:"true",hidden:!0},{name:"goodsId",width:"120",align:"left",fixed:"true",hidden:!0},{name:"businessType",index:"businessType",width:100,align:"center",formatter:function(e,t,o,a){return'<span type="primary" class="select'+o.id+'">客户来料单</span>'}},{name:"materialOrderNo",index:"materialOrderNo",width:150,align:"center",formatter:function(e,t,o,a){return $(document).off("click",".updateDetail"+e).on("click",".updateDetail"+e,function(){customerStockList.updateDetailClick({value:e,grid:t,rows:o,state:a})}),'<a class="updateDetail'+e+'">'+e+"</a>"}},{name:"inTime",index:"inTime",width:100,align:"center",formatter:function(e,t,o,a){return e.split(" ")[0]}},{name:"custName",index:"custName",width:100,align:"center"},{name:"goodsMainType",index:"goodsMainType",width:100,align:"center",formatter:function(e,t,o,a){return'<span type="primary" class="select'+o.id+'">金料</span>'}},{name:"goodsCode",index:"goodsCode",width:100,align:"center",formatter:function(e,t,o,a){return $(document).on("click",".detail"+e,function(){customerStockList.showGoodsInfo({value:e,grid:t,rows:o,state:a})}),'<a class="detail'+e+'">'+e+"</a>"}},{name:"goodsName",index:"goodsName",width:100,align:"center"},{name:"weightUnit",index:"weightUnit",width:50,align:"center"},{name:"totalWeight",index:"totalWeight",width:50,align:"center"},{name:"processNature",index:"processNature",width:50,align:"center",formatter:function(e,t,o,a){return 1==e?'<span type="primary" class="select'+o.id+'">锁价</span>':2==e?'<span type="primary" class="select'+o.id+'">预付款</span>':void 0}}],multiselect:!0},reload:!0,selected:[]}},methods:{custAdd:function(){for(var e=arguments.length,t=Array(e),o=0;o<e;o++)t[o]=arguments[o];console.log(t)},search:function(){this.reload=!this.reload},showGoodsInfo:function(e){window.parent.activeEvent({name:"商品",url:contextPath+"/base-data/commodity/commodity-info.html",params:{id:e.rows.commodityId,type:"skip"}})},productOrder:function(){if(this.selected.length<1&&this.$Modal.info({content:"请选择需要生成的单据"}),1<=this.selected.length){for(var e=this.selected[0],t=0;t<this.selected.length;t++){if(this.selected[t].custName!=e.custName)return void this.$Modal.info({content:"客户不一致"});if(this.selected[t].processNature!=e.processNature)return void this.$Modal.info({content:"来料性质不一致"})}var a=this;console.log(this.selected);for(var o=0;o<this.selected.length;o++){var i={};i.materialOrderNo=this.selected[o].materialOrderNo,i.goodsId=this.selected[o].goodsId,this.CustomerStockMateriaQueryVo.queryList.push(i)}console.log(i),console.log(this.CustomerStockMateriaQueryVo),$.ajax({type:"post",url:contextPath+"/customerStockMaterial/quaryAllCustomerStockMateria",contentType:"application/json",data:JSON.stringify(a.CustomerStockMateriaQueryVo),dataType:"json",success:function(e){if("100100"===e.code)if(console.log(e),0<e.data.length){for(var t in a.saleGold)for(var o=0;o<e.data.length;o++)e.data[o].goodList.map(function(e){t===e.goldColor&&(e.goldPrice=a.saleGold[t],e.goldAmount=a.saleGold[t]*e.totalWeight)});window.parent.activeEvent({name:"存料结价单新增",url:contextPath+"/sale/customer-stockMaterial/customer-countAdd.html",params:{allInfo:e,type:"addInfo"}})}else a.$Modal.error({title:"提示",content:"已有单据生成存料结价单了！请刷新页面重新选择！"})},error:function(e){console.log("服务器出错啦")}})}},changeDate:function(e){this.body.startTime=""==e[0]?"":e[0].replace(/\//g,"-")+" 00:00:00",this.body.endTime=""==e[1]?"":e[1].replace(/\//g,"-")+" 23:59:59"},refresh:function(){this.clear(),this.reload=!this.reload,this.selected=[],this.CustomerStockMateriaQueryVo.queryList=[]},clear:function(){this.$refs.mType.reset(),this.$nextTick(function(){this.body.processNature=""}),this.body={materialOrderNo:"",custName:"",startTime:"",endTime:"",processNature:"",isDel:1},this.dataValue=[],console.log(this.body)},cancel:function(){console.log(1),window.parent.closeCurrentTab({name:this.openName,exit:!0,openTime:customerStockList.openTime})},updateDetailClick:function(e){var t=e.value;console.log(t),$.ajax({type:"POST",url:contextPath+"/tsaleMaterialOrder/quaryAllInformation",data:{materialOrderNo:t},success:function(e){console.log(e),window.parent.activeEvent({name:"客户来料单-查看",url:contextPath+"/sale/material-order/sale-material-add.html",params:{allInfo:e,type:"query"}})},error:function(){console.log("请求失败")}})},initGoldPrice:function(e){var t=this;$.ajax({type:"post",url:contextPath+"/tbasetodygoldprice/queryPrice",data:{type:e},dataType:"json",success:function(e){t.saleGold=e.data},error:function(){t.$Message.warning("服务器报错")}})}},mounted:function(){this.initGoldPrice(1),this.refresh(),this.openTime=window.parent.params.openTime,this.openName=window.parent.params.name}});