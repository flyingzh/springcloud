"use strict";function _defineProperty(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}var vmCommodity=new Vue({el:"#product-info",data:function(){var t,e;return _defineProperty(e={tempId:"",saveDisable:!0,isSearchHide:!0,openTime:"",showName:!1,showModal:!1,selectOrginId:[],styleOnes:[],goldCondition:[],certificateType:[],columns:[{type:"selection",width:60,align:"center"},{title:"组织名称",key:"orgName"}],colContent:[],showAttribate:!0,showOn:!0,showIsDefault:!1,showIsType:!1,user:{},logUrl:contextPath+"/tbasecustomer/changeLog?type=commodity&id=-1",off:!1,isAdd:!1,reload:!1,reload_list:!1,showSupplier:!1,showStyleList:!0,categoryName1:"",styleName1:"",organizationName:"",supplierUrl:"",unitWeightGroup:[],unitCountGroup:[],unitWeight:[],unitCount:[],selected:[],url:"",newStatus:[],newSeries:[],newCustomCode:[],selected_list:[],isShowMaterial:!1,showDepartmentModal:!1,department_selected:[],body:{name:"",code:"",beforetime:"",aftertime:"",styleCode:"",customCode:"",series:[]},commodityseries:[],categoryList:[],setting1:{data:{simpleData:{enable:!0,idKey:"id",pIdKey:"parentId"},key:{name:"name"}},callback:{onClick:this.clickEvent}},setting2:{data:{simpleData:{enable:!0,idKey:"id",pIdKey:"parentId"},key:{name:"depName"}},callback:{beforeClick:function(t,e,i){return!e.isParent},beforeDblClick:function(t,e){return!e.isParent},onClick:this.clickEvent1}},tree:{id:"",name:"",customCode:""},suppliernames:"",supplierReload:!1,supplySearch:{supplierType:[],supplierLevel:[],mainProd:[],siShortName:""},mainProduct:[],supplierLevel:[],supplier_selected:[],supplierType:"",formType:[{name:"副石",value:0},{name:"主石",value:1}],weightWayArr:[{name:"固定值",value:0},{name:"范围值",value:1}],suppType:[{name:"战略型",code:"1"},{name:"重点型",value:"2"},{name:"常规型",code:"3"},{name:"一般型",code:"4"}],mainType1:"",showMainType:!0,commodityCategoty:[],commodity:{id:"",code:"",name:"",mainType:"",createOrganizationId:"",commodityCategotyInfoId:"",styleCategoryId:"",specification:"",series:"",status:"",supplierId:"",weight:"",pricingType:"",weightGroupId:"",weightUnitId:"",countGroupId:"",countUnitId:"",certificateType:"",remark:"",buyDepartment:"",buyer:"",accuracy:"",priceMethod:"",warehouseInfoId:"",repertoryPositionId:"",isDefBatch:"",isDefStock:"",materiaMethod:"qj",salesBackMethod:"qj",stockMethod:"qj",shipMethod:"qj",maintainMethod:"qj",otherMethod:"qj",costPrice:"",lablePrice:"",sellingPrice:"",certificatePrice:"",laborCharges:"",otherFee:"",salesRate:"",pictureId:"",isDel:1,categoryCustomCode:"",styleCustomCode:"",organizationId:"",assistAttrs:[],tBaseBomEntity:(t={countUnitId:"",code:"",createOrganizationId:"",updateTime:"",commodityId:"",goldBoms:"",partBoms:"",type:"",checkStatus:"",createTime:"",createId:"",commodityCode:"",id:"",stonesBoms:"",isDel:"",commodityName:""},_defineProperty(t,"goldBoms",[]),_defineProperty(t,"partBoms",[]),_defineProperty(t,"stonesBoms",[]),t),frontPic:{},sidePic:{},downPic:{},tryPics:[],threeDPics:[],videos:[],delFiles:[]},frontData:{type:3},sideData:{type:4},topData:{type:5},tryData:{type:6},threeDData:{type:7},videoData:{type:8},supplier_list:{url:contextPath+"/tbasecommodity/findBySupplier",colNames:["id","编码","简称","主营商品","商品名称"],colModel:[{name:"id",index:"",width:0,align:"left",hidden:!0},{name:"supplierCode",index:"",width:130,align:"left"},{name:"siShortName",index:"",width:200,align:"left"},{name:"mainProd",index:"",width:250,align:"left"},{name:"supplierName",index:"",width:0,align:"left",hidden:!0}]},change_log:{colNames:["变更信息","变更前","变更后","变更日期","变更人"],colModel:[{name:"changeInfo",index:"",width:150,align:"left"},{name:"operationBefore",index:"",width:150,align:"left"},{name:"operationAfter",index:"",width:150,align:"left"},{name:"operationTime",index:"",width:150,align:"left"},{name:"userName",index:"",width:150,align:"left"}]},type:[{value:1,label:"原料"},{value:"attr_ranges_goods",label:"成品"},{value:"attr_ranges_other",label:"其他"},{value:"attr_ranges_assets",label:"资产"}],mainType:"",materialType:[{value:"attr_ranges_gold",label:"金料"},{value:"attr_ranges_stone",label:"石料"},{value:"attr_ranges_part",label:"配件"}],buyers:[],treeNode1:"",buyDepartment:"",value1:0,styleListData:[],productType:[],categoryType:[],styleList:[],weightUnit:[],weightDetail:[],quantityUnit:[{name:"数量组",value:11,children:[{value:1,label:"个"},{value:2,label:"件"}]},{name:"重量组",value:12,children:[{value:1,label:"克"},{value:2,label:"克拉"}]}],quantityDetail:[],isWeightUnit:!1,isQuantityUnit:!1,baseBody:{productType:"",styleType:"",spec:"",productSet:"",productStatus:"",supplier:"",weight:"",weightUnit:"",weightDetail:"",quantityUnit:"",quantityDetail:"",remark:""},qualityCheckBody:{incoming:"",stock:"",maintain:"",returnGoods:"",delivery:"",other:""},qualityCheckWays:[],financeBody:{costPrice:"",salePrice:"",tagPrice:"",certificationFee:""},natureTable:[{title:"编号",key:"code",align:"center"},{title:"辅助属性",key:"name",align:"center"},{title:"启用",type:"selection",width:60,align:"center"}],natureTableCol:[],detailsNatureData:[],targetDetailsNature:[],inputcontent:"",isCheckedAll:!1,isCheckedAllStone:!1,isCheckedAllPart:!1,loadingItem:!1,checkGold:[],checkStone:[],checkPart:[],goldTableHeader:[],stonesTableHeader:[],partTableHeader:[],itemList:[],itemStoneList:[],itemPartList:[],goldBoms:[],goldRow:{isPush:"",commodityCode:"",commodityName:"",weightUnitId:"",weightReference:"",weightFloor:"",weightUpper:"",lose:"",processCost:"",pureWeight:"",assistAttrList:[]},goldAssistAttr:[],goldAssistAttrAll:[],stonesAssistAttr:[],stonesAssistAttrAll:[],stonesBoms:[],stonesRow:{isPush:"",partName:"",commodityCode:"",commodityName:"",countUnitId:"",count:"",weightWay:"",weightUnitId:"",weightReference:"",weightFloor:"",weightUpper:"",lose:"",assistAttrList:[]},partAssistAttr:[],partAssistAttrAll:[],partBoms:[],partRow:{id:"",bomId:"",organizationId:"",commodityCode:"",commodityName:"",commodityId:"",weightGroupId:"",countGroupId:"",countUnitId:"",weightUnitId:"",weightReference:"",count:"",assistAttrList:[]}},"partAssistAttr",[]),_defineProperty(e,"partAssistAttrAll",[]),_defineProperty(e,"data_config_list",{url:contextPath+"/tbasecommodity/list",colNames:["图片","商品编码","商品名称","商品类型","款式类别","规格","状态"],colModel:[{name:"url",index:"remark",width:200,align:"center",formatter:function(t,e,i){$(".list-area").off("mouseout",".can").on("mouseout",".can",function(t){$(".bigimg").css({left:"-99999px"}).attr("src","").hide()}),$(".list-area").off("mouseover",".can img").on("mouseover",".can img",function(t){var e=$(t.target),i=$(window).scrollTop(),o=e.offset().left+100+"px",a=e.offset().top-i+"px",s=e.attr("src");$(".bigimg").css({top:a,left:o}).attr("src",s).show()});var o="";i.frontPic&&(o=i.frontPic.fdUrl),!o&&i.downPic&&(o=i.downPic.fdUrl),!o&&i.downPic&&(o=i.downPic.fdUrl);var a="http://"+window.location.host+contextPath+"/images/no_pic.png";return o?'<div class="select'+i.id+' can">\n                                    <img height="50px" width="50px" src="'+o+'"/>\n                                </div>':'<div class="select'+i.id+' can"><img height="50px" width="50px" src="'+a+'"/></div>'}},{name:"code",index:"invdate",width:150,align:"left",formatter:function(t,e,i,o){i.code;var a=".detail"+t;return $(document).off("click",a).on("click",a,function(){vmCommodity.view(i)}),'<a class="detail'+t+'">'+t+"</a>"}},{name:"name",index:"name",width:150,align:"left"},{name:"categoryName",index:"exchangeRate",width:200,align:"left"},{name:"styleName",index:"status",width:200,align:"left"},{name:"specification",index:"precisions",width:200,align:"left"},{name:"status",index:"remark",width:250,sortable:!1,align:"left",formatter:function(t,e,i){for(var o="",a=0;a<vmCommodity.newStatus.length;a++)if(i.status==vmCommodity.newStatus[a].value){o=vmCommodity.newStatus[a].name;break}return o}}]}),_defineProperty(e,"treeSetting",{callback:{onClick:this.treeClick}}),_defineProperty(e,"costMethod",[]),_defineProperty(e,"locatorList",[]),_defineProperty(e,"storageList",[]),_defineProperty(e,"logisticsBody",{purchaseDep:"",purchaseAgent:"",precision:"",locator:"",costMethod:"",storage:"",isBatch:"",storageAge:""}),e},created:function(){this.init(),this.loadSytleCategory(),this.loadCommodityCategory(),this.loadStyleList(),this.loadData(),this.loadCategoryList()},methods:{isSkip:function(){var t=window.parent.params.params;t&&"skip"==t.type&&t.id&&this.view(t,1)},handleFormatError:function(t){this.$Modal.error({content:"文件格式不正确,请重新选择"})},handleMaxSize:function(t){this.$Modal.error({content:"文件过大,请重新选择"})},hideSearch:function(){this.isSearchHide=!this.isSearchHide,$(".chevron").css("top","")},showOrgin:function(){0!=this.selected.length?this.showModal=!0:layer.alert("请选择行!")},okModel:function(){if(0!=this.selectOrginId.length){var t={ids:{},orginIds:{}};t.ids=this.selected.join(","),t.orginIds=this.selectOrginId.join(","),this.cancelModel();var e=this;$.ajax({type:"POST",url:contextPath+"/tbasecommodity/allot",traditional:!0,datatype:"json",data:t,success:function(t){"100100"===t.code?(layer.alert("分配成功",{icon:1}),e.selectOrginId=[]):layer.alert(t.msg,{icon:0})},error:function(t){layer.alert("服务器出错",{icon:0})}})}else layer.alert("请选择分配组织!")},cancelModel:function(){this.selectOrginId=[],this.$refs.test.selectAll(!1),this.showModal=!1},changeselect:function(t){for(var e=0;e<t.length;e++)this.selectOrginId.push(t[e].id)},initBom:function(t,e,i){for(var o=0;o<t.length;o++){var a=t[o].assistAttrList,s=a.length;i.push(a);for(var n=0;n<e.length;n++){e[n].data[o];for(var r=0;r<s;r++)a[r].id===e[n].id&&e[n].data.splice(o,1,a[r].tBaseAssistAttrValuess)}}},allTable:function(i,o,t){var a=this;t.map(function(t,e){a.initTableData(i,o)})},showSelectOption:function(t,o){t.map(function(t,e){t.assistAttrList.map(function(i,t){o[e].map(function(t,e){t.id===i.id&&(t.attrValueIds=i.attrValueIds)})})})},itemGoldList:function(t,s){t.map(function(t,e){var i=t.commodityCode,o=t.commodityName,a=t.commodityId;s.push([{code:i,name:o,id:a}])})},itemListStone:function(t,s){t.map(function(t,e){var i=t.commodityCode,o=t.commodityName,a=t.commodityId;s.push([{code:i,name:o,id:a}])})},frontHandleSuccess:function(t){"100100"===t.code&&(this.commodity.frontPic=t.data)},sideHandleSuccess:function(t){"100100"===t.code&&(this.commodity.sidePic=t.data)},topHandleSuccess:function(t){"100100"===t.code&&(this.commodity.downPic=t.data)},tryHandleSuccess:function(t){"100100"===t.code&&this.commodity.tryPics.push(t.data)},threeDHandleSuccess:function(t){"100100"===t.code&&this.commodity.threeDPics.push(t.data)},videoHandleSuccess:function(t){"100100"===t.code&&this.commodity.videos.push(t.data)},delFile:function(t,e){if(this.commodity.delFiles||(this.commodity.delFiles=[]),null==e){var i={};3==t?(i=this.commodity.frontPic,this.commodity.frontPic={}):4==t?(i=this.commodity.sidePic,this.commodity.sidePic={}):5==t&&(i=this.commodity.downPic,this.commodity.downPic={}),this.commodity.delFiles.push(i)}else{var o=e[t];e.splice(t,1),this.commodity.delFiles.push(o)}},validateGoldBoms:function(){var t=this.goldBoms;if(0==t.length)return!0;var i=!0;return $.each(t,function(t,e){return e.commodityId?e.weightGroupId||e.weightUnitId?e.weightReference?e.lose&&(isNaN(e.lose)||e.lose<0||100<e.lose)?(layer.alert("金料bom第"+(t+1)+"行的损耗值不合法 ，必须在0-100之间",{icon:0}),i=!1):void 0:(layer.alert("金料bom第"+(t+1)+"行数据重量参考值不能为空",{icon:0}),i=!1):(layer.alert("金料bom第"+(t+1)+"行计量单位未选择",{icon:0}),i=!1):(layer.alert("金料bom第"+(t+1)+"行数据未选择商品",{icon:0}),i=!1)}),i},validateStoneBoms:function validateStoneBoms(){var stonesBomsTemp=this.stonesBoms;if(0==stonesBomsTemp.length)return!0;var flag=!0,num=0;return $.each(stonesBomsTemp,function(i,item){return num+=eval(item.partName),1<num?(layer.alert("石料bom只能存在一个主石",{icon:0}),flag=!1,!1):item.commodityId?item.weightGroupId||item.weightUnitId?item.countGroupId||item.countUnitId?0!==item.weightWay||item.weightReference?1!==item.weightWay||item.weightUpper||item.weightUpper?item.count?item.lose&&(isNaN(item.lose)||item.lose<0||100<item.lose)?(layer.alert("石料bom第"+(i+1)+"行的损耗值不合法 ，必须在0-100之间",{icon:0}),flag=!1,!1):void 0:(layer.alert("石料bom第"+(i+1)+"行数据【数量】不能为空",{icon:0}),flag=!1,!1):(layer.alert("石料bom第"+(i+1)+"行数【重量上下限】不能为空",{icon:0}),flag=!1,!1):(layer.alert("石料bom第"+(i+1)+"行数 【重量参考值】不能为空",{icon:0}),flag=!1,!1):(layer.alert("石料bom第"+(i+1)+"行【计数单位】未选择",{icon:0}),flag=!1,!1):(layer.alert("石料bom第"+(i+1)+"行【计重单位】未选择",{icon:0}),flag=!1,!1):(layer.alert("石料bom第"+(i+1)+"行数据未选择商品",{icon:0}),flag=!1,!1)}),flag},validatePartBoms:function(){var t=this.partBoms;if(0==t.length)return!0;var i=!0;return $.each(t,function(t,e){return e.commodityId?0!==e.weightWay||e.weightReference?e.count?void 0:(layer.alert("配件bom第"+(t+1)+"行数据【数量】不能为空",{icon:0}),i=!1):(layer.alert("配件bom第"+(t+1)+"行数 【重量参考值】不能为空",{icon:0}),i=!1):(layer.alert("配件bom第"+(t+1)+"行数据未选择商品",{icon:0}),i=!1)}),i},loadData:function(){var s=this;s.certificateType=getCodeList("base_Condition"),s.costMethod=getCodeList("root_base_priceType");var t=getCodeList("zj_zjfs");$.each(t,function(t,e){s.qualityCheckWays.unshift(e)}),s.newStatus=getCodeList("root_base_goodsState"),s.newSeries=getCodeList("root_base_goodsSeries"),$.ajax({url:contextPath+"/tbasecommodity/data",type:"POST",dataType:"json",success:function(t){if(100100==t.code){s.mainProduct=t.data.mainProduct,s.supplierLevel=t.data.supplierLevel,s.locatorList=t.data.locatorList,s.organizationName=t.data.orgName,s.commodity.organizationId=t.data.organId;for(var e=t.data.organList,i=t.data.organId,o=-1,a=0;a<e.length;a++)if(i==e[a].id){o=a;break}e.splice(o,1),s.colContent=e}},error:function(){layer.alert("网络异常，请重试！",{icon:0})}})},initStyleListData:function(){this.styleListData.push({data:""})},loadStyleList:function(){var e=this;$.ajax({url:contextPath+"/tbasestylecategory/list?parentId=1",type:"POST",dataType:"json",success:function(t){e.styleOnes=t.data,e.styleList.push(t.data),e.initStyleListData()},error:function(){layer.alert("网络异常，请重试！",{icon:0})}})},getStaff:function(){},loadCategoryList:function(){var e=this;$.ajax({url:contextPath+"/tbasecommoditycategory/queryAllList",type:"POST",dataType:"json",success:function(t){e.categoryList=t.data,e.$refs.my_tree.nodeData=e.categoryList,e.$refs.my_tree.loadData()},error:function(){layer.alert("网络异常，请重试！",{icon:0})}})},loadCommodityCategory:function(){var e=this;$.ajax({url:contextPath+"/tbasecommoditycategory/listByAll?parentId=0",type:"POST",dataType:"json",success:function(t){e.categoryType=e.initGoodCategory(t.data.cateLists)},error:function(){layer.alert("网络异常，请重试！",{icon:0})}})},loadSytleCategory:function(){var e=this;$.ajax({url:contextPath+"/tbasestylecategory/listByAll?customCode=0.",type:"POST",dataType:"json",success:function(t){e.productType=e.initGoodStyle(t.data.styles)},error:function(){layer.alert("网络异常，请重试！",{icon:0})}})},getTreeData:function(t){},searchSupplier:function(){var t=this,e=[].concat(t.supplySearch.supplierLevel),i=[].concat(t.supplySearch.supplierType),o=[].concat(t.supplySearch.mainProd);this.supplySearch.supplierType=0<this.supplySearch.supplierType.length?this.supplySearch.supplierType.join(","):"",this.supplySearch.supplierLevel=0<this.supplySearch.supplierLevel.length?this.supplySearch.supplierLevel.join(","):"",this.supplySearch.mainProd=0<this.supplySearch.mainProd.length?this.supplySearch.mainProd.join(","):"",this.supplierReload=!this.supplierReload,setTimeout(function(){t.supplySearch.supplierLevel=e,t.supplySearch.supplierType=i,t.supplySearch.mainProd=o},10)},clearSupplier:function(){this.supplySearch={supplierType:[],supplierLevel:[],mainProd:[],siShortName:""}},openSupplier:function(){this.showIsDefault||(this.clearSupplier(),this.supplierReload=!this.supplierReload,this.showSupplier=!0)},ok:function(){for(var t=[],e=[],i=0;i<this.supplier_selected.length;i++)if("string"===$.type(this.supplier_selected[i])){var o=JSON.parse(this.supplier_selected[i]);t.push(o.id),e.push(o.supplierName)}else"object"===$.type(this.supplier_selected[i])&&(t.push(this.supplier_selected[i].id),e.push(this.supplier_selected[i].supplierName));this.commodity.supplierId=0<t.length?JSON.stringify(t):"",this.suppliernames=0<e.length?e.join(","):""},ok1:function(){this.commodity.buyer="";var t=this.treeNode1;if(null!=t){this.buyDepartment=t.depName;var e=t.id;this.commodity.buyDepartment=e,this.getbuyers(e)}},getbuyers:function(t){var e=this;$.ajax({type:"post",url:contextPath+"/tbasecommodity/queryAllEmpByDeptId?id="+t,contentType:"application/json",dataType:"json",async:!1,success:function(t){if("100100"===t.code){t.data;e.buyers=t.data}else layer.alert("服务层错误,请联系技术人员！",{icon:0})},error:function(t){layer.alert("服务层错误,请联系技术人员！",{icon:0})}})},cancel:function(){},changeStyleList:function(i,o){if(i){var a=this;if("attr_ranges_goods"==a.commodity.mainType&&0<a.styleList.length){for(var t=0;t<a.styleList[0].length;t++)if(a.styleList[0][t].id==i){var e=a.commodity.name.split(" ");a.commodity.name=e[0]+" "+a.styleList[0][t].styleName}if(o<3&&0<a.styleList[o].length)for(t=0;t<a.styleList[o].length;t++)if(a.styleList[o][t].id==i)if(a.styleList[o][t].codingCodeRules,0==o){var s=a.commodity.code.substring(0,1);a.commodity.code=s+a.styleList[o][t].codingCodeRules;s=a.commodity.code.substring(0,1)}else if(1==o){var n=a.commodity.code.substring(0,2);a.commodity.code=n+a.styleList[o][t].codingCodeRules}else if(2==o){var r=a.commodity.code.substring(0,3);a.commodity.code=r+a.styleList[o][t].codingCodeRules}}var c=this.styleList.length-1;a.styleList.splice(o+1,c),a.styleListData.splice(o+1,c),$.ajax({url:contextPath+"/tbasestylecategory/list?parentId="+i,type:"POST",async:!1,dataType:"json",success:function(t){if(null!=t.data)if(0<t.data.length)a.styleList.push(t.data),a.initStyleListData();else for(var e=0;e<a.styleList[o].length;e++)a.styleList[o][e].id==i&&(a.commodity.styleCategoryId=a.styleList[o][e].id,a.commodity.styleCustomCode=a.styleList[o][e].customCode,"attr_ranges_goods"==a.commodity.mainType&&a.getCode(a.commodity.code))},error:function(){layer.alert("网络异常，请重试！",{icon:0})}})}},getCode:function(t){var e=this;if(!t||4!=t.length)return e.commodity.styleCategoryId="",e.commodity.styleCustomCode="",void layer.alert("商品款式类别必须选择三级",{icon:0});$.ajax({url:contextPath+"/tbasecommodity/getCode",type:"POST",dataType:"json",data:{code:t,mainType:e.commodity.mainType},success:function(t){null!=t.data&&(e.commodity.code=t.data)},error:function(){layer.alert("网络异常，请重试！",{icon:0})}})},search:function(){var t=this;0<t.newCustomCode.length?t.body.styleCode=t.newCustomCode[this.newCustomCode.length-1]:t.body.styleCode="";var e=[].concat(t.body.series);t.body.series=0<t.body.series.length?t.body.series.join(","):"",t.reload=!this.reload,setTimeout(function(){t.body.series=e},10)},clickEvent:function(t,e,i){vmCommodity.body.customCode=i.customCode,vmCommodity.search()},clickEvent1:function(t,e,i){this.treeNode1=i},changeSeries:function(){vmCommodity.commodity.series=JSON.stringify(vmCommodity.commodityseries)},init:function(){var e=this;$.ajax({type:"POST",url:contextPath+"/tbaseunitgroup/listByNoPage",success:function(t){"100100"==t.code?(vmCommodity.weightUnit=t.data,vmCommodity.quantityUnit=t.data):layer.alert(t.message,{icon:0})}}),$.ajax({url:contextPath+"/tBaseAssistAttr/queryAll?rangeUse=attr_ranges_gold",type:"POST",dataType:"json",success:function(t){e.goldTableHeader=e.sortTabalHeader(t.data)},error:function(){layer.alert("网络异常，请重试！",{icon:0})}}),$.ajax({url:contextPath+"/tBaseAssistAttr/queryAll?rangeUse=attr_ranges_stone",type:"POST",dataType:"json",success:function(t){e.stonesTableHeader=e.sortTabalHeader(t.data)},error:function(){layer.alert("网络异常，请重试！",{icon:0})}}),$.ajax({url:contextPath+"/tBaseAssistAttr/queryAll?rangeUse=attr_ranges_part",type:"POST",dataType:"json",success:function(t){e.partTableHeader=e.sortTabalHeader(t.data)},error:function(){layer.alert("网络异常，请重试！",{icon:0})}})},getNextOption:function(t){},initGoodCategory:function(t){var a=this,s=[];return t.forEach(function(t){var e=t.customCode,i=t.name,o=t.cateLists;o&&(o=a.initGoodCategory(o)),s.push({value:e,label:i,children:o})}),s.forEach(function(t){t.children||delete t.children}),s},initGoodStyle:function(t){var a=this,s=[];return t.forEach(function(t){var e=t.customCode,i=t.styleName,o=t.styles;o&&(o=a.initGoodStyle(o)),s.push({value:e,label:i,children:o})}),s.forEach(function(t){t.children||delete t.children}),s},del:function(){var e=this;0!=e.selected.length?layer.confirm("当前数据有可能被引用，会影响数据准确性，确认是否删除？",{btn:["确定","取消"],btn1:function(t){0<e.selected.length&&$.ajax({type:"post",url:contextPath+"/tbasecommodity/delete",data:JSON.stringify(e.selected),contentType:"application/json",success:function(t){e.selected=[],"100100"==t.code?(layer.alert("删除成功",{icon:1}),e.selected=[],e.reload=!e.reload):layer.alert(t.message,{icon:0})}}),layer.close(t)},btn2:function(t){layer.close(t)}}):layer.alert("请选择要删除的数据")},update:function(){},changeType:function(t){var e=t,i=this.styleList.length-1;"attr_ranges_goods"==t?(this.mainType="",this.showName=!0,this.showAttribate=!1,this.showMainType=!0,this.isShowMaterial=!1,this.commodity.mainType=e,this.commodity.name="",this.commodity.code="",this.commodityCategoty=[],this.styleListData.splice(1,i),this.styleList.splice(1,i),this.styleListData[0]={data:""}):(this.mainType="",this.showAttribate=!0,this.showName=!1,this.commodity.code="",this.commodity.name="",1==t?(this.commodity.mainType="",this.isShowMaterial=!0):(this.isShowMaterial=!1,this.commodity.mainType=e),this.showMainType=!1)},changeCategory:function(t){var a=this;a.showStyleList=!0,a.commodity.categoryCustomCode=t[t.length-1],$.ajax({type:"POST",url:contextPath+"/tbasecommoditycategotyinfo/infoByCustomCode?customCode="+a.commodity.categoryCustomCode,dataType:"json",async:!1,success:function(o){if("100100"===o.code){if(null==o.data)return a.commodityCategoty=[],void layer.alert("请选择商品类型明细",{icon:0});a.$nextTick(function(){if(!o.data.codingCodeRules)return a.commodityCategoty=[],void layer.alert("请选择商品类型明细",{icon:0});if("attr_ranges_goods"==a.commodity.mainType){if(a.commodity.code){var t=a.commodity.code.substring(1);if(!o.data.codingCodeRules){a.commodity.code="",a.commodity.name="",a.commodityCategoty=[];var e=a.styleList.length-1;return a.styleListData.splice(1,e),a.styleList.splice(1,e),a.styleListData[0]={data:""},void layer.alert("请选择商品类型明细",{icon:0})}a.commodity.code=o.data.codingCodeRules+t}else{if(!o.data.codingCodeRules)return a.commodityCategoty=[],a.commodity.name="",void layer.alert("请选择商品类型明细",{icon:0});a.commodity.code=o.data.codingCodeRules}if(a.commodity.name){var i=a.commodity.name.split(" ");i[1]?a.commodity.name=o.data.name+i[1]:a.commodity.name=o.data.name}else a.commodity.name=o.data.name}else o.data.codingCodeRules||(a.commodityCategoty=[],layer.alert("请选择商品类型明细",{icon:0}));console.log(o.data),a.commodity.pricingType=o.data.pricingType,a.commodity.categoryCustomCode=o.data.customCode,a.commodity.commodityCategotyInfoId=o.data.id,o.data.weightGroupId&&(a.commodity.weightGroupId=o.data.weightGroupId,a.chooseUnit(a.commodity.weightGroupId),a.commodity.weightUnitId=o.data.weightUnitId),o.data.countGroupId&&(a.commodity.countGroupId=o.data.countGroupId,a.chooseQuantityUnit(a.commodity.countGroupId),a.commodity.countUnitId=o.data.countUnitId)})}else layer.alert("服务层错误,请联系技术人员！",{icon:0})},error:function(t){layer.alert("服务层错误,请联系技术人员！",{icon:0})}})},chooseUnit:function(t){var e=this;e.commodity.weightUnitId="";for(var i=0;i<e.weightUnit.length;i++)if(e.weightUnit[i].id===t){e.weightDetail=e.weightUnit[i].tBaseUnits;break}},chooseQuantityUnit:function(t){var e=this;e.commodity.countUnitId="";for(var i=0;i<e.quantityUnit.length;i++)if(e.quantityUnit[i].id===t){e.quantityDetail=e.quantityUnit[i].tBaseUnits;break}},changeList:function(i){var t=this.tempId;if(t){var o=this;$.ajax({url:contextPath+"/tbasecommodity/info/"+t,type:"POST",dataType:"json",success:function(t){var e=t.data;o.goldBoms[i].weightGroupId=e.weightGroupId,o.goldBoms[i].weightUnitId=e.weightUnitId,o.goldBoms[i].commodityId=e.id,o.goldBoms[i].commodityCode=e.code,o.goldBoms[i].commodityName=e.name,o.goldBoms[i].condition=e.certificateType,o.initOneBom(e.assistAttrs,o.goldTableHeader,o.goldAssistAttrAll,i,o.goldAssistAttr)},error:function(){layer.alert("网络异常，请重试！",{icon:0})}})}},valdateCommodityId:function(t,e,i){for(var o=0;o<t.length;o++)if(o!=e&&t[o].commodityId==i)return layer.alert("该商品已存在，请重新选择！",{icon:0}),!1;return!0},changePartList:function(i){var t=this.tempId;if(t){var o=this;$.ajax({url:contextPath+"/tbasecommodity/info/"+t,type:"POST",dataType:"json",success:function(t){var e=t.data;o.partBoms[i].weightGroupId=e.weightGroupId,o.partBoms[i].weightUnitId=e.weightUnitId,o.partBoms[i].countGroupId=e.countGroupId,o.partBoms[i].countUnitId=e.countUnitId,o.partBoms[i].commodityId=e.id,o.partBoms[i].commodityCode=e.code,o.partBoms[i].commodityName=e.name,o.initOneBom(e.assistAttrs,o.partTableHeader,o.partAssistAttrAll,i,o.partAssistAttr)},error:function(){layer.alert("网络异常，请重试！",{icon:0})}})}},changeStoneList:function(i){var t=this.tempId;if(t){var o=this;$.ajax({url:contextPath+"/tbasecommodity/info/"+t,type:"POST",dataType:"json",success:function(t){var e=t.data;o.stonesBoms[i].weightGroupId=e.weightGroupId,o.stonesBoms[i].weightUnitId=e.weightUnitId,o.stonesBoms[i].countGroupId=e.countGroupId,o.stonesBoms[i].countUnitId=e.countUnitId,o.stonesBoms[i].commodityId=e.id,o.stonesBoms[i].commodityCode=e.code,o.stonesBoms[i].commodityName=e.name,o.initOneBom(e.assistAttrs,o.stonesTableHeader,o.stonesAssistAttrAll,i,o.stonesAssistAttr)},error:function(){layer.alert("网络异常，请重试！",{icon:0})}})}},initBomBack:function(t){var e=t.tBaseBomEntity;if(e){var i=this;i.itemList=[],i.goldBoms=[],i.itemStoneList=[],i.stonesBoms=[],i.itemPartList=[],i.partBoms=[],i.goldBoms=e.goldBoms,i.allTable(i.goldTableHeader,i.goldAssistAttr,i.goldBoms),i.itemGoldList(i.goldBoms,i.itemList),i.showSelectOption(i.goldBoms,i.goldAssistAttr),i.initBom(i.goldBoms,i.goldTableHeader,i.goldAssistAttrAll),i.backPush(i.goldBoms,i.goldTableHeader),i.stonesBoms=e.stonesBoms,i.allTable(i.stonesTableHeader,i.stonesAssistAttr,i.stonesBoms),i.itemListStone(i.stonesBoms,i.itemStoneList),i.showSelectOption(i.stonesBoms,i.stonesAssistAttr),i.initBom(i.stonesBoms,i.stonesTableHeader,i.stonesAssistAttrAll),i.backPush(i.stonesBoms,i.stonesTableHeader),i.partBoms=e.partBoms,i.allTable(i.partTableHeader,i.partAssistAttr,i.partBoms),i.itemGoldList(i.partBoms,i.itemPartList),i.showSelectOption(i.partBoms,i.partAssistAttr),i.initBom(i.partBoms,i.partTableHeader,i.partAssistAttrAll),i.backPush(i.partBoms,i.partTableHeader)}},backPush:function(t,e){if(t&&e)for(var i=0;i<e.length;i++)for(var o=0;o<t.length;o++){for(var a=!1,s=0;s<t[o].assistAttrList.length;s++)if(e[i].id===t[o].assistAttrList[s].id&&1===t[o].assistAttrList[s].isPush){a=e[i].isPush=!0;break}if(a)break}},view:function(t){var e=this;e.showIsDefault=!0,e.showMainType=!0,e.showIsType=!0,e.saveDisable=!1,e.isAdd=!0,e.showName=!0,e.infoById(t.id,1)},modify:function(t){var e=this;1==e.selected.length?(e.showIsDefault=!1,e.showMainType=!0,this.showIsType=!0,e.isAdd=!0,e.infoById(e.selected[0],2)):layer.alert("请选择一条数据",{icon:2})},infoById:function(t,c){var d=this;d.logUrl=contextPath+"/tbasecustomer/changeLog?type=commodity&id="+t+"&nd="+(new Date).getTime(),$.ajax({type:"post",url:contextPath+"/tbasecommodity/info/"+t,contentType:"application/json",success:function(t){if("100100"==t.code){if("attr_ranges_goods"==t.data.mainType)d.initBomBack(t.data);else{d.initAttr(t.data.mainType);var e=t.data.assistAttrs,o=[];e&&e.map(function(e){if(d.natureTableCol.map(function(t){e.id===t.id&&(t._checked=!0)}),e&&e.attrValueIds){var i=e.id;e.attrValueIds.map(function(t){var e=i+"-"+t;o.push(e)})}}),d.targetDetailsNature=o}if("attr_ranges_goods"!=t.data.mainType?("attr_ranges_gold"==t.data.mainType||"attr_ranges_stone"==t.data.mainType||"attr_ranges_part"==t.data.mainType?(d.mainType1=1,d.mainType=t.data.mainType,d.isShowMaterial=!0):(d.mainType1=t.data.mainType,d.isShowMaterial=!1),1!=c&&(d.showName=!1)):(d.mainType1=t.data.mainType,d.isShowMaterial=!1,d.showName=!0),d.showMainType=!0,d.showIsType=!0,t.data.departmentName&&(d.buyDepartment=t.data.departmentName,d.getbuyers(t.data.buyDepartment)),d.categoryName1=t.data.categoryName,d.styleName1=t.data.styleName,t.data.series){var i=JSON.parse(t.data.series);d.commodityseries=i}if(t.data.supplierName&&(d.suppliernames=t.data.supplierName),t.data.warehouseInfoId&&d.locatorChange(t.data.warehouseInfoId),t.data.repertoryPositionId&&(d.commodity.repertoryPositionId=t.data.repertoryPositionId),t.data.weightGroupId&&d.chooseUnit(t.data.weightGroupId),t.data.countGroupId&&d.chooseQuantityUnit(t.data.countGroupId),d.commodity=t.data,t.data.buyer){var a=t.data.buyer.replace("[","").replace("]","");if(a){for(var s=a.replace('/"',"").split(","),n=[],r=0;r<s.length;r++)parseInt(s[r])&&n.push(parseInt(s[r]));0<n.length&&(d.commodity.buyer=n)}}}}})},copy:function(){var m=this;m.showIsDefault=!1,1==m.selected.length?(m.showMainType=!1,m.showIsType=!1,m.showIsDefault=!1,m.isAdd=!0,$.ajax({type:"post",url:contextPath+"/tbasecommodity/info/"+m.selected[0],contentType:"application/json",success:function(t){if("100100"==t.code){if("attr_ranges_goods"==t.data.mainType)m.initBomBack(t.data);else{m.initAttr();var e=t.data.assistAttrs,o=[];e&&e.map(function(t){if(t&&t.attrValueIds){var i=t.id;t.attrValueIds.map(function(t){var e=i+"-"+t;o.push(e)})}}),m.targetDetailsNature=o}if("attr_ranges_goods"!=t.data.mainType?("attr_ranges_gold"==t.data.mainType||"attr_ranges_stone"==t.data.mainType||"attr_ranges_part"==t.data.mainType?(m.mainType1=1,m.mainType=t.data.mainType,m.isShowMaterial=!0):(m.mainType1=t.data.mainType,m.isShowMaterial=!1),m.showName=!1):(m.mainType1=t.data.mainType,m.showMainType=!0,m.isShowMaterial=!1,m.showName=!0),m.buyDepartment=t.data.departmentName,m.getbuyers(t.data.buyDepartment),m.categoryName1=t.data.categoryName,m.styleName1=t.data.styleName,t.data.series){var i=JSON.parse(t.data.series);m.commodityseries=i}if(t.data.supplierName&&(m.suppliernames=t.data.supplierName),t.data.warehouseInfoId&&m.locatorChange(t.data.warehouseInfoId),t.data.repertoryPositionId&&(m.commodity.repertoryPositionId=t.data.repertoryPositionId),t.data.weightGroupId&&m.chooseUnit(t.data.weightGroupId),t.data.countGroupId&&m.chooseQuantityUnit(t.data.countGroupId),m.commodity=t.data,m.commodity.styleCustomCode="",m.commodity.styleCategoryId="",m.commodity.categoryCustomCode="",m.commodity.commodityCategotyInfoId="",m.commodity.id="",m.commodity.name="",m.commodity.code="",m.commodity.frontPic={},m.commodity.sidePic={},m.commodity.downPic={},m.commodity.tryPics=[],m.commodity.threeDPics=[],m.commodity.videos=[],m.commodity.delFiles=[],t.data.buyer&&t.data.buyer){var a=t.data.buyer.replace("[","").replace("]","");if(a){for(var s=a.replace('/"',"").split(","),n=[],r=0;r<s.length;r++)parseInt(s[r])&&n.push(parseInt(s[r]));0<n.length&&(m.commodity.buyer=n)}}if(m.commodity.pictureId){if(m.commodity.pictureId="",m.commodity.frontPic&&(m.commodity.frontPic.fdId=""),m.commodity.sidePic&&(m.commodity.sidePic.fdId=""),m.commodity.downPic&&(m.commodity.downPic.fdId=""),m.commodity.tryPics&&0<m.commodity.tryPics.length)for(var c in m.commodity.tryPics)c&&(c.fdId="");if(m.commodity.threeDPics&&0<m.commodity.threeDPics.length)for(var d in m.commodity.tryPics)d&&(d.fdId="");if(m.commodity.videos&&0<m.commodity.videos.length)for(var l in m.commodity.tryPics)l&&(l.fdId="")}}}})):layer.alert("请选择一条数据进行复制",{icon:2})},searchItemCode:function(t){this.inputcontent=t},clearSelect:function(t,e){t[e].length=0},sortTabalHeader:function(t){return t.map(function(t){t.data=[],t.isPush=!1}),t},initTableData:function(t,e){for(var i=[],o=0;o<t.length;o++)i.push({attrValueIds:"",id:t[o].id,isPush:""});e.push(i)},initOneBom:function(t,e,i,o,a){for(var s=0;s<e.length;s++){e[s].data[o]=[];for(var n=0;n<t.length;n++)(i[o]=t)[n].id===e[s].id&&(a[o][s].attrValueIds=["-1"],e[s].data.splice(o,1,t[n].tBaseAssistAttrValuess))}},backBom:function(e,t,i,o){for(var a=0;a<t.length;a++){var s=t[a];e[a].assistAttrList=[];for(var n=0;n<s.length;n++)if(-1<s[n].attrValueIds.indexOf("-1"))for(var r=0;r<i[a].length;r++)i[a][r].id===s[n].id&&e[a].assistAttrList.push(i[a][r]);else e[a].assistAttrList.push(s[n])}e.map(function(t,e){for(var i=t.assistAttrList.length-1;0<=i;i--)""===t.assistAttrList[i].attrValueIds&&t.assistAttrList.splice(i,1)}),o.map(function(i,t){e.map(function(t,e){t.assistAttrList.map(function(t,e){i.id===t.id&&(t.isPush=i.isPush?1:0)})})})},addGoldRow:function(){this.validateGoldBoms()&&(this.goldBoms.push({isPush:"",commodityCode:"",condition:"",commodityName:"",commodityId:"",weightUnitId:"",weightReference:"",weightFloor:"",weightUpper:"",lose:"",processCost:"",pureWeight:"",assistAttrList:[]}),this.itemList.push([]),this.initTableData(this.goldTableHeader,this.goldAssistAttr),this.getOption(this.itemList.length-1,1))},delGoldRow:function(){var e=this;this.checkGold.sort().reverse().map(function(i,t){e.goldBoms.splice(i,1),e.goldAssistAttr.splice(i,1),e.goldTableHeader.map(function(t,e){t.data.splice(i,1)}),e.itemList.splice(i,1)}),this.checkGold=[]},delStoneRow:function(){var e=this;this.checkStone.sort().reverse().map(function(i,t){e.stonesBoms.splice(i,1),e.stonesAssistAttr.splice(i,1),e.stonesTableHeader.map(function(t,e){t.data.splice(i,1)}),e.itemStoneList.splice(i,1)}),this.checkStone=[]},delPartRow:function(){var e=this;this.checkPart.sort().reverse().map(function(i,t){e.partBoms.splice(i,1),e.partAssistAttr.splice(i,1),e.partTableHeader.map(function(t,e){t.data.splice(i,1)}),e.itemPartList.splice(i,1)}),this.checkPart=[]},addStoneRow:function(){this.validateStoneBoms()&&(this.itemStoneList.push([]),this.stonesBoms.push({bomId:"",isPush:"",partName:0,commodityCode:"",commodityName:"",countUnitId:"",countGroupId:"",weightGroupId:"",count:"",weightWay:0,weightUnitId:"",weightReference:"",weightFloor:"",weightUpper:"",lose:"",assistAttrList:[]}),this.initTableData(this.stonesTableHeader,this.stonesAssistAttr),this.getOption(this.itemStoneList.length-1,2))},cancle:function(){window.parent.closeCurrentTab({exit:!0,openTime:this.openTime})},addPartRow:function(){this.validatePartBoms()&&(this.itemPartList.push([]),this.partBoms.push({id:"",bomId:"",organizationId:"",commodityCode:"",commodityName:"",commodityId:"",weightGroupId:"",countGroupId:"",countUnitId:"",weightUnitId:"",weightReference:"",count:"",assistAttrList:[]}),this.initTableData(this.partTableHeader,this.partAssistAttr),this.getOption(this.itemPartList.length-1,3))},getItem:function(t){this.tempId=t.id},getOption:function(e,t,i){var o={mainType:"",field:""};null==i&&(o.field=this.inputcontent);var a=[],s=this;1===t?(o.mainType="attr_ranges_gold",a=this.itemList):2===t?(o.mainType="attr_ranges_stone",a=this.itemStoneList):3===t&&(o.mainType="attr_ranges_part",a=this.itemPartList),$.ajax({url:contextPath+"/tbasecommodity/findByCommodity",type:"post",data:o,dataType:"json",success:function(t){a.splice(e,1,t.data),s.inputcontent=""},error:function(){layer.alert("网络异常，请重试！",{icon:0})}})},findUnit:function(){},test:function(){var e=this;$.ajax({url:"",type:"POST",dataType:"json",success:function(t){e.initBom(t.data.goldBoms,e.goldTableHeader,e.goldAssistAttrAll),e.initBom(t.data.stonesBoms,e.stonesTableHeader,e.stonesAssistAttrAll)},error:function(){layer.alert("网络异常，请重试！",{icon:0})}})},test2:function(){var e=this;$.ajax({url:"./bomdata2.json",type:"POST",dataType:"json",success:function(t){e.initBom(t.data.goldBoms,e.goldTableHeader,e.goldAssistAttrAll),e.initBom(t.data.stonesBoms,e.stonesTableHeader,e.stonesAssistAttrAll)},error:function(){layer.alert("网络异常，请重试！",{icon:0})}})},changeMainType:function(){this.mainType&&(this.commodity.mainType=this.mainType),"attr_ranges_gold"!=this.commodity.mainType&&"attr_ranges_stone"!=this.commodity.mainType&&"attr_ranges_part"!=this.commodity.mainType&&"attr_ranges_other"!=this.commodity.mainType||this.initAttr()},initAttr:function(t){var i=this;i.assistAttr=[];var e=this.commodity.mainType||t;$.ajax({url:contextPath+"/tBaseAssistAttr/queryAll?rangeUse="+e,type:"POST",dataType:"json",async:!1,success:function(t){var e=t.data;e.map(function(t){t._checked=!1,t._disabled=!0}),i.natureTableCol=e},error:function(){layer.alert("网络异常，请重试！",{icon:0})}})},clickOne:function(t){if(-1<this.checkGold.indexOf(t)){var e=this.checkGold.indexOf(t);this.checkGold.splice(e,1)}else this.checkGold.push(t);this.goldBoms.length===this.checkGold.length?this.isCheckedAll=!0:this.isCheckedAll=!1},clickOneStone:function(t){if(-1<this.checkStone.indexOf(t)){var e=this.checkStone.indexOf(t);this.checkStone.splice(e,1)}else this.checkStone.push(t);this.stonesBoms.length===this.checkStone.length?this.isCheckedAllStone=!0:this.isCheckedAllStone=!1},clickOnePart:function(t){if(-1<this.checkPart.indexOf(t)){var e=this.checkPart.indexOf(t);this.checkPart.splice(e,1)}else this.checkPart.push(t);this.partBoms.length===this.checkPart.length?this.isCheckedAllPart=!0:this.isCheckedAllPart=!1},checkAllGold:function(){var i=this;this.isCheckedAll?this.checkGold=[]:(this.checkGold=[],this.goldBoms.forEach(function(t,e){i.checkGold.push(e)}))},checkAllStone:function(){var i=this;this.isCheckedAllStone?this.checkStone=[]:(this.checkStone=[],this.stonesBoms.forEach(function(t,e){i.checkStone.push(e)}))},checkAllPart:function(){var i=this;this.isCheckedAllPart?this.checkPart=[]:(this.checkPart=[],this.partBoms.forEach(function(t,e){i.checkPart.push(e)}))},vWeight:function(){if(this.commodity.weight){var t=this.commodity.weight;this.vDouble(t)}},vCostPrice:function(){if(this.commodity.costPrice){var t=this.commodity.costPrice;this.vDouble(t)}},vSelling:function(){if(this.commodity.sellingPrice){var t=this.commodity.sellingPrice;this.vDouble(t)}},vLablePrice:function(){if(this.commodity.lablePrice){var t=this.commodity.lablePrice;this.vDouble(t)}},vCertificate:function(){if(this.commodity.certificatePrice){var t=this.commodity.certificatePrice;this.vDouble(t)}},votherFee:function(){if(this.commodity.otherFee){var t=this.commodity.otherFee;this.vDouble(t)}},vlaborCharges:function(){if(this.commodity.laborCharges){var t=this.commodity.laborCharges;this.vDouble(t)}},vsalesRate:function(){if(this.commodity.salesRate){var t=this.commodity.salesRate;this.vDouble(t)}},vDouble:function(t){/^[0-9]+([.]{1}[0-9]+){0,1}$/.test(t)||layer.alert("请输入正确的数字",{icon:0})},vInteger:function(){var t=this.commodity.accuracy;!t||/^-?\d+$/.test(t)||layer.alert("请输入整数",{icon:0})},locatorChange:function(t){var e=this;e.commodity.repertoryPositionId="",$.ajax({type:"POST",url:contextPath+"/tbasecommodity/queryByWareHouse?id="+t,contentType:"application/json",dataType:"json",async:!1,success:function(t){"100100"===t.code?e.storageList=t.data:layer.alert("服务层错误,请联系技术人员！",{icon:0})},error:function(t){layer.alert("服务层错误,请联系技术人员！",{icon:0})}})},vCode:function(){var e=!0;return $.ajax({type:"POST",url:contextPath+"/tbasecommodity/validateCode?code="+this.commodity.code,contentType:"application/json",dataType:"json",async:!1,success:function(t){e="100100"===t.code&&(layer.alert("商品编码重复，请重新填写",{icon:0}),!0)},error:function(t){layer.alert("服务层错误,请联系技术人员！",{icon:0})}}),e},keyDown:function(){},clearbody:function(){this.newCustomCode=[],this.$refs.start.date="",this.$refs.end.date="",this.body={name:"",code:"",beforetime:"",aftertime:"",styleCode:"",customCode:"",series:[]}},clearNoNum:function(t,e){t[e]=t[e].replace(/[^\d.]/g,""),t[e]=t[e].replace(/^\./g,""),t[e]=t[e].replace(/\.{2,}/g,"."),t[e]=t[e].replace(".","$#$").replace(/\./g,"").replace("$#$","."),this.$forceUpdate()},validateGoldType:function(){return!("attr_ranges_gold"==this.commodity.mainType&&!this.commodity.certificateType)||(layer.alert("未选择金料成色，请选择！",{icon:0}),!1)},save:function(){if(!this.validateGoldBoms()||!this.validateStoneBoms()||!this.validatePartBoms())return!1;if(!this.validateGoldType())return!1;"attr_ranges_goods"==this.commodity.mainType&&(this.backBom(this.goldBoms,this.goldAssistAttr,this.goldAssistAttrAll,this.goldTableHeader),this.backBom(this.stonesBoms,this.stonesAssistAttr,this.stonesAssistAttrAll,this.stonesTableHeader),this.backBom(this.partBoms,this.partAssistAttr,this.partAssistAttrAll,this.partTableHeader),!this.commodity.tBaseBomEntity&&(0<this.goldBoms.length||0<this.stonesBoms.length||0<this.partBoms.length)&&(this.commodity.tBaseBomEntity={goldBoms:[],partBoms:[],stonesBoms:[]}),this.commodity.tBaseBomEntity&&(this.commodity.tBaseBomEntity.goldBoms=this.goldBoms,this.commodity.tBaseBomEntity.partBoms=this.partBoms,this.commodity.tBaseBomEntity.stonesBoms=this.stonesBoms));var s=[];this.targetDetailsNature.map(function(t,e){var i=t.split("-"),o={};if(0===e)o.id=i[0],o.attrValueIds=[i[1]],s.push(o);else{var a=!0;s.map(function(t,e){t.id==i[0]&&(t.attrValueIds.push(i[1]),a=!1)}),a&&(o.id=i[0],o.attrValueIds=[i[1]],s.push(o))}});var e=this;if(e.commodity.assistAttrs=s,e.commodity.isDefBatch?e.commodity.isDefBatch=1:e.commodity.isDefBatch=0,e.commodity.isDefStock?e.commodity.isDefStock=1:e.commodity.isDefStock=0,e.commodity.code){if(e.commodity.id||!e.vCode())if(e.mainType1)if(1!=e.mainType1||e.mainType){if("attr_ranges_goods"==e.commodity.mainType){if(!e.commodity.styleCategoryId)return void layer.alert("请选择款式类别",{icon:0});if(7!=e.commodity.code.length)return void layer.alert("请选择最底层的款式类别来生成所对应的成品编码",{icon:0})}if("attr_ranges_gold"!=e.commodity.mainType||1==e.commodity.pricingType)if(e.commodity.commodityCategotyInfoId)if(e.commodity.name)if(e.commodity.pricingType){if(1==e.commodity.pricingType){if(!e.commodity.weightGroupId)return void layer.alert("请选择计重组",{icon:0});if(!e.commodity.weightUnitId)return void layer.alert("请选择计重单位",{icon:0})}else{if(!e.commodity.countGroupId)return void layer.alert("请选择计数组",{icon:0});if(!e.commodity.countUnitId)return void layer.alert("请选择计数单位",{icon:0})}if(e.commodity.priceMethod){var t=/^[0-9]+([.]{1}[0-9]+){0,1}$/,i=this.commodity.weight;if(!i||t.test(i)){var o=e.commodity.accuracy;if(!o||/^-?\d+$/.test(o)){var a=this.commodity.costPrice;if(!a||t.test(a)){var n=this.commodity.sellingPrice;if(!n||t.test(n)){var r=this.commodity.lablePrice;if(!r||t.test(r)){var c=this.commodity.certificatePrice;if(!c||t.test(c)){var d=this.commodity.laborCharges;if(!d||t.test(d)){var l=this.commodity.otherFee;if(!l||t.test(l)){var m=this.commodity.salesRate;if(!m||t.test(m)){var h="";if(h=""!=e.commodity.id?contextPath+"/tbasecommodity/update":contextPath+"/tbasecommodity/save",!this.saveDisable)return!1;this.saveDisable=!1,$.ajax({type:"post",url:h,data:JSON.stringify(e.commodity),contentType:"application/json",success:function(t){"100100"==t.code?layer.alert(t.data,{icon:1,end:function(){e.saveDisable=!0,e.quit(),e.search()}}):(e.saveDisable=!0,layer.alert(t.msg,{icon:0}))},error:function(t){e.saveDisable=!0,layer.alert("网络异常，请重试！",{icon:0})}})}else layer.alert("请输入正确的销售倍率",{icon:0})}else layer.alert("请输入正确的其他费用",{icon:0})}else layer.alert("请输入正确的工费",{icon:0})}else layer.alert("请输入正确的证书费",{icon:0})}else layer.alert("请输入正确的销售价格",{icon:0})}else layer.alert("请输入正确的标签价格",{icon:0})}else layer.alert("请输入正确的成本价格",{icon:0})}else layer.alert("请输入正确单价精度",{icon:0})}else layer.alert("请输入正确的参考重量",{icon:0})}else layer.alert("请选择计价方法",{icon:0})}else layer.alert("请选择计价方式",{icon:0});else layer.alert("请填写商品名称",{icon:0});else layer.alert("请填写商品类型",{icon:0});else layer.alert("商品主类型是金料,请选择计重单位",{icon:0})}else layer.alert("请选择主类型",{icon:0});else layer.alert("请选择主类型",{icon:0})}else layer.alert("请填写商品编码",{icon:0})},tableDbClick:function(t,e){for(var i=t.tBaseAssistAttrValuess,o=[],a=0;a<i.length;a++){var s={};s.key=t.id+"-"+i[a].id,s.label=i[a].value,s.code=i[a].code,o.push(s)}this.detailsNatureData=o},renderTranferContent:function(t){return t.code+" - "+t.label},handleTranfer:function(t,e,i){this.targetDetailsNature=t},iconPopup:function(){this.showDepartmentModal=!0},getWrapperHeight:function(t){if("bom"===t){var e=$(window).height();setTimeout(function(){$("#wrapper").height(e-$("#wrapper").offset().top-20)},200)}},add:function(){this.isAdd=!0,this.showIsDefault=!1,this.showMainType=!1,this.showIsType=!1},quit:function(){this.saveDisable=!0,this.isAdd=!1,this.saveDisable=!0,this.clear()},clear:function(){this.showMainType=!1,this.selected=[],this.itemList=[],this.goldBoms=[],this.goldAssistAttr=[],this.showName=!1,this.itemStoneList=[],this.stonesBoms=[],this.stonesAssistAttr=[],this.suppliernames="",this.itemPartList=[],this.partBoms=[],this.partAssistAttr=[],this.assistAttr=[],this.natureTableCol=[],this.detailsNatureData=[],this.targetDetailsNature=[];var t=this.styleList.length-1;this.styleListData.splice(1,t),this.styleList.splice(1,t),this.styleListData[0]={data:""},this.commodityCategoty=[],this.buyers=[],this.commodityseries=[],this.buyDepartment="",this.mainType1="",this.mainType="",this.commodity={id:"",code:"",name:"",mainType:"",createOrganizationId:"",commodityCategotyInfoId:"",styleCategoryId:"",specification:"",series:"",status:"",supplierId:"",weight:"",pricingType:"",weightGroupId:"",weightUnitId:"",countGroupId:"",countUnitId:"",remark:"",buyDepartment:"",buyer:[],accuracy:"",priceMethod:"",warehouseInfoId:"",repertoryPositionId:"",isDefBatch:"",isDefStock:"",materiaMethod:"qj",salesBackMethod:"qj",stockMethod:"qj",shipMethod:"qj",maintainMethod:"qj",otherMethod:"qj",costPrice:"",lablePrice:"",sellingPrice:"",certificatePrice:"",laborCharges:"",otherFee:"",salesRate:"",pictureId:"",isDel:1,categoryCustomCode:"",styleCustomCode:"",organizationId:"",assistAttrs:[],tBaseBomEntity:{},frontPic:{},sidePic:{},downPic:{},tryPics:[],threeDPics:[],videos:[],delFiles:[]}},departmentOk:function(){this.showDepartmentModal=!1},getUnitWeightByGroupId:function(){var e=this;$.ajax({type:"POST",url:contextPath+"/tbaseunit/list",data:{groupId:e.commodity.weightGroupId},success:function(t){e.commodity.weightUnitId="",e.unitWeight=[],e.unitWeight=t.data}})},getUnitCountByGroupId:function(){var e=this;$.ajax({type:"POST",url:contextPath+"/tbaseunit/list",data:{groupId:e.commodity.countGroupId},success:function(t){e.commodity.countUnitId="",e.unitCount=[],e.unitCount=t.data}})},aaaaaa:function(t){},getInput:function(t){this.inputcontent=t}},mounted:function(){this.init(),this.openTime=window.parent.params.openTime,this.isSkip()},computed:{carouselList:function(){var t=[];return this.commodity.frontPic&&this.commodity.frontPic.fdUrl&&t.push({url:this.commodity.frontPic.fdUrl,name:"正面图"}),this.commodity.sidePic&&this.commodity.sidePic.fdUrl&&t.push({url:this.commodity.sidePic.fdUrl,name:"侧面图"}),this.commodity.downPic&&this.commodity.downPic.fdUrl&&t.push({url:this.commodity.downPic.fdUrl,name:"俯视图"}),t}},updated:function(){},watch:{targetDetailsNature:function(t,e){this.natureTableCol.map(function(i){var o=!1;t.map(function(t){var e=t.split("-")[0];if(i.id==e)return i._checked=!0,void(o=!0)}),o||(i._checked=!1)})}}});