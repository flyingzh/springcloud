"use strict";Vue.component("ht-input-voucher",{data:function(){return{inputValue:"",valueId:"",show:!1,newOptions:[],oldOptions:[],opts:[],optsVal:{},isOptValid:!0}},methods:{operate_arr:function(){var e=this;this.oldOptions=JSON.parse(this.options),this.oldOptions.forEach(function(t){e.$set(t,"active",!1),e.showValue}),this.newOptions=[].concat(this.oldOptions)},focus:function(){if($(".ht-input-voucher .extra-opt").is(":visible"))return vm.$Message.error({content:"亲，请处理完当前这一个先！",duration:3}),!1;"subject"==this.type&&0==this.opts.length?this.show=!1:this.show=!0,this.$emit("on-focus")},blur:function(){var t=this;setTimeout(function(){!$.isEmptyObject(t.opts)&&0<t.opts.length||(t.show=!1)},150)},keyup:function(){var t=this;""==$.trim(t.value[t.type])&&(t.opts=[])},input:function(t){var e=t.target.value;this.$emit("change",e)},query:function(t,e){for(var n=[],o=t.charAt(0),a=t.length,s=0;s<e.length;s++){var i=e[s],u=!1;for(var l in i)if("function"==typeof i[l])i[l]();else{var r="";null!=i[l]&&(r=i[l]);for(var c=0;c<r.length;c++)if(r.charAt(c)==o&&r.substring(c).substring(0,a)==t){u=!0;break}}u&&n.push(i)}return n},add:function(){this.$emit("add")},select_li:function(t){var o=this,e=o.type;if(o.newOptions.forEach(function(t){t.active=!1}),o.value[e+"Value"]=t.value,o.value[e+"Label"]=t.label,"explains"==o.type?o.value[e]=t.label:o.value[e]=t.value+t.label,"subject"==o.type){o.value[e+"Id"]=t.id;var n=t.id;$.ajax({type:"post",url:contextPath+"/voucherController/getListBySubjectId",data:{id:n},success:function(t){var n;console.log(t),o.row.opts={},$.isEmptyObject(t.data.opts)||(o.row.opts=(n={},$.each(t.data.opts,function(t,e){n[e]=""}),n),o.opts=t.data.opts,o.show=!0),$.isEmptyObject(t.data.unitId)||(o.row.unitId=t.data.unitId,o.row.hasQuantity=!0);var e={foreignCurrencyId:t.data.foreignCurrencyId||-2,balanceDirection:t.data.balanceDirection};console.log(e),o.$emit("currency",e)}})}},selectOpt:function(t){var o=this,n=!0;if($.each(o.value.opts,function(t,e){if($.isEmptyObject(e))return n=!1,o.$Message.error({content:"亲，请做出您正确的选择先！",duration:3}),!1}),1==n){var a=[];$.each(o.value.opts,function(t,e){var n=o.subjectOpts[t];a.push(e+" "+n.list[e])}),o.value.subject=o.value.subjectValue+" "+o.value.subjectLabel+"_"+a.join("_"),o.show=!1}return n},chk:function(t){var e=!0;return/^\d+(\.\d+)?$/.exec(t)||(e=!1),e},subjectInput:function(t,e){13!=e.keyCode&&108!=e.keyCode||this.enterGetSubject(t)},enterGetSubject:function(t){console.log(t,"============code================");var a=this;if(a.chk(t)){for(var s={},e=0;e<a.subjects.length;e++)if(a.subjects[e].value==t){s=a.subjects[e];break}if($.isEmptyObject(s))a.$Message.error("科目不存在");else{var n=contextPath+"/voucherController/getListBySubjectId";$.ajax({type:"POST",data:{id:s.id},url:n,success:function(t){if("100100"==t.code){var n;console.log(t),a.row.opts={},$.isEmptyObject(t.data.opts)||(a.row.opts=(n={},$.each(t.data.opts,function(t,e){n[e]=""}),n),a.opts=t.data.opts,a.show=!0),$.isEmptyObject(t.data.unitId)||(a.row.unitId=t.data.unitId,a.row.hasQuantity=!0);var e={foreignCurrencyId:t.data.foreignCurrencyId||-2,balanceDirection:t.data.balanceDirection};console.log(e),a.$emit("currency",e);var o=a.type;a.value[o+"Value"]=s.value,a.value[o+"Label"]=s.label,a.value[o]=s.value+s.label,a.value[o+"Id"]=s.id}else layer.alert(t.msg)},error:function(t){console.log(t)}})}}else a.$Message.error("请输入正确的科目编码，科目编码只能为[0-9]和' . '组成")}},props:{options:{default:function(){return[]}},oldValue:{},disabled:{default:function(){return!1}},showValue:{default:function(){return!1}},title:{},getValue:{default:function(){return!0}},value:{default:function(){return{}}},subjectOpts:{default:function(){return{}}},row:{default:function(){return{}}},type:{default:function(){return"subject"}},subjects:[]},watch:{options:function(){this.operate_arr()}},created:function(){},mounted:function(){this.operate_arr()},template:'\n    <div class="ht-input-voucher">\n        <input v-model="value[type]"\n            class="ht-voucher-input form-control tableDatasExplains"\n            placeholder=""\n            @input="input"\n            @blur="blur"\n            @focus="focus"\n            @keyup="keyup"\n            @keydown="subjectInput(value[type], $event)"\n            ></input> \n\t\t<div v-if="opts.length && show" class="ht-search extra-opt form-horizontal pd10 panel panel-default">\n\t\t\t<div v-for="_opt in opts" class="form-group form-group-sm">\n\n\t\t\t\t<label class="col-sm-4 control-label text-left pl0">{{subjectOpts[_opt].label}}</label>\n\t\t\t\t<div class="col-sm-8 pr0">\n\t\t\t\t  <select v-model="value.opts[_opt]" class="form-control input-sm width-full">\n\t\t\t\t\t<option v-for="(text, val) in subjectOpts[_opt].list" :value="val">{{val + \' \' + text}}</option>\n\t\t\t\t  </select>\n\t\t\t\t</div>\n\n\t\t\t</div>\n\t\t\t<div class="text-center">\n\t\t\t\t<button type="button" @click="selectOpt(optsVal)" class="btn btn-sm">确定</button>\n\t\t\t</div>\n\t\t</div>\n        <div class="ht-search panel panel-default" v-if="show && newOptions.length && opts.length == 0">\n            <ul>\n                <li v-for="item in newOptions" :key="item.value"\n                    @click="select_li(item)"\n                    :class="[item.active ? \'active\' : \'\']">\n                    {{((type == \'subject\')? item.value + \' \' : \'\') + item.label}}\n                </li>\n            </ul>\n            <p @click="add" class="pl10 hide"><i class="glyphicon glyphicon-plus"></i> 新增{{title}}</p>\n        </div>\n    </div>\n    '});