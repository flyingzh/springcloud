"use strict";function _defineProperty(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var correctPreventDocument=new Vue({el:"#correctPreventDocument",data:function(){var e,a=this;return{openTime:"",isSearchHide:!0,isTabulationHide:!0,isShow:!1,isHide:!0,isEdit:!1,reload:!1,selected:[],selectDateArr:[],DocumentTypeList:[],empList:[],conclusionList:[],documentStatusList:[],businessFlowDirectionList:[],confirmConfig:{showConfirm:!1,title:"提示",content:"请点击确认",onlySure:!0,success:!0},statusMap:{tmp_save:"temporary_save",await_check:"await_check",checking:"checking",auditing:"auditing",reject:"reject"},approvalTableData:[],canRejectWhenAudit:!0,modalTrigger:!1,modalType:"",documentCode:"",documentStatus:"",stepList:[],body:{documentType:"",documentCode:"",startDocDate:"",endDocDate:"",documentStatus:"",sourceDocumentType:"",sourceDocumentCode:"",issuePersonId:"",followConclusion:""},data_config:{url:contextPath+"/tQcCorrectPreventDocument/queryCorrectPreventListPage",colNames:["单据编号","id","单据日期","单据状态","业务流向","源单类型","源单单号","发出部门","发出人","发出日期","接收部门","要求回复日期","分析部门","分析员","责任部门","责任人","检验部门","验证员","验证结果","跟踪结论"],colModel:[{name:"documentCode",index:"documentCode",width:180,align:"left",formatter:function(e,t,n,o){return $(document).off("click",".detail"+e).on("click",".detail"+e,function(){a.testDocumentDetailClick({value:e,grid:t,rows:n,state:o})}),'<a class="detail'+e+'">'+e+"</a>"},unformat:function(e,t,n){return e.replace(/(<\/?a.*?>)/g,"")}},{name:"id",hidden:!0},(e={name:"documentDate",index:"documentDate",width:90,align:"center"},_defineProperty(e,"align","left"),_defineProperty(e,"formatter",function(e,t,n,o){return new Date(e).format("yyyy-MM-dd")}),e),{name:"documentStatus",index:"documentStatus",align:"left",width:75,formatter:function(e,t,n,o){return"temporary_save"===e?"暂存":"await_check"===e?"待审核":"checking"===e?"审核中":"auditing"===e?"已审核":"reject"===e?"驳回":""},unformat:function(e,t,n){return"暂存"===e?"temporary_save":"待审核"===e?"await_check":"审核中"===e?"checking":"已审核"===e?"auditing":"驳回"===e?"reject":""}},{name:"businessFlowDirection",index:"businessFlowDirection",align:"left",width:75,formatter:function(e,t,n,o){return"wtfb"===e?"问题发布":"wtfx"===e?"问题分析":"csyz"===e?"措施验证":"jzyf"===e?"纠正预防":"yzwc"===e?"验证完成":""},unformat:function(e,t,n,o){return"问题发布"===e?"wtfb":"问题分析"===e?"wtfx":"纠正预防"===e?"jzyf":"措施验证"===e?"csyz":"验证完成"===e?"yzwc":void 0}},{name:"sourceDocumentType",index:"sourceDocumentType",align:"left",width:100,formatter:function(e,t,n,o){return"lljyd"===e?"来料检验单":"kcjyd"===e?"库存检验单":"tbjyd"===e?"调拨检验单":"mdjyd"===e?"门店检验单":"fhjyd"===e?"发货检验单":""}},{name:"sourceDocumentCode",index:"sourceDocumentCode",align:"left",width:150},{name:"issueDepartmentName",index:"issueDepartmentName",align:"left",width:90},{name:"issuePersonName",index:"issuePersonName",width:70,align:"left"},{name:"issueDate",index:"issueDate",align:"left",width:95,formatter:function(e,t,n,o){return new Date(e).format("yyyy-MM-dd")}},{name:"receiveDepartmentName",index:"receiveDepartmentName",align:"left",width:90},{name:"demandReplyDate",index:"demandReplyDate",align:"left",width:100,formatter:function(e,t,n,o){return new Date(e).format("yyyy-MM-dd")}},{name:"analyseDepartmentName",index:"analyseDepartmentName",align:"left",width:90},{name:"analysePersonnelName",index:"analysePersonnelName",align:"left",width:70},{name:"dutyDepartmentName",index:"dutyDepartmentName",align:"left",width:95},{name:"dutyPersonnelName",index:"dutyPersonnelName",align:"left",width:70},{name:"validateDepartmentName",index:"validateDepartmentName",align:"left",width:70},{name:"validatePersonnelName",index:"validatePersonnelName",align:"left",width:70},{name:"validateResult",index:"validateResult",align:"left",width:90,formatter:function(e,t,n,o){return"wx"===e?"无效":"yx"===e?"有效":""}},{name:"followConclusion",index:"followConclusion",align:"left",width:70,formatter:function(e,t,n,o){return"jzhg"===e?"合格":"jzbhg"===e?"不合格":""}}]}}},methods:{hideSearch:function(){correctPreventDocument.isHide=!correctPreventDocument.isHide,correctPreventDocument.isSearchHide=!correctPreventDocument.isSearchHide,console.log(correctPreventDocument.isTabulationHide),$(".chevron").css("top","")},hidTabulation:function(){correctPreventDocument.isHide=!correctPreventDocument.isHide,correctPreventDocument.isTabulationHide=!correctPreventDocument.isTabulationHide,correctPreventDocument.isTabulationHide?$(".chevron").css("top",""):$(".chevron").css("top","83%")},search:function(){console.log(this.body),0<this.selectDateArr.length&&this.selectDateArr[0]&&this.selectDateArr[1]?(correctPreventDocument.body.startDocDate=this.selectDateArr[0].format("yyyy-MM-dd"),correctPreventDocument.body.endDocDate=this.selectDateArr[1].format("yyyy-MM-dd")):(correctPreventDocument.body.startDocDate="",correctPreventDocument.body.endDocDate=""),this.reload=!this.reload},testDocumentDetailClick:function(e){var t=e.rows.documentCode;t&&this.queryTestDocumentByQcDocumentCode(t,!0)},queryTestDocumentByQcDocumentCode:function(e,t){window.parent.activeEvent({name:"查看纠正预防单",url:contextPath+"/quality/quality/corrective-prevention-sheet--1.html",params:{docCode:e,type:"query"}})},clear:function(){var e=this;this.body.documentCode="",this.body.documentType="",this.body.documentStatus="",this.body.sourceDocumentType="",this.body.sourceDocumentCode="",this.body.businessFlowDirection="",this.body.followConclusion="",this.body.alreadyTest=2,this.body.issuePersonId&&(this.$refs.sendOut.reset(),this.$nextTick(function(){e.body.issuePersonId=""})),this.selectDateArr="",console.log(this.body)},update:function(){var e=this.selected;e.length<1?alert("请至少选择一条数据"):1<e.length?alert("只能选择一条数据"):(console.log("传出的参数："+e[0].id),window.parent.activeEvent({name:"修改纠正预防单",url:contextPath+"/quality/quality/corrective-prevention-sheet--1.html",params:{id:e[0].id,type:"update"}}))},add:function(){window.parent.activeEvent({name:"新增纠正预防单",url:contextPath+"/quality/quality/corrective-prevention-sheet--1.html",params:{type:"add"}})},del:function(){var o=this,e=this.selected;0!=this.selected.length?1<=e.length&&$.ajax({url:contextPath+"/tQcCorrectPreventDocument/updateBatch",method:"post",dataType:"json",data:JSON.stringify(e),contentType:"application/json;charset=utf-8",success:function(e){if(o.reloadAgain(),"100100"===e.code)if($.isEmptyObject(e.data))layer.alert("删除成功！");else{for(var t="单据",n=0;n<e.data.length;n++)t+="["+e.data[n].documentCode+"]、",n===e.data.length&&(t+="["+e.data[n].documentCode+"]");t+="删除失败（单据已启用审批流，无法删除！）",layer.alert(t)}},error:function(e){console.log(e)}}):alert("请选择至少一条数据!")},modify:function(){},view:function(){},save:function(e,t){var n=this;$.ajax({type:"POST",url:contextPath+"/tQcCorrectPreventDocument/update",contentType:"application/json",data:JSON.stringify({id:e,documentStatus:t}),dataType:"json",success:function(e){"100100"===e.code&&n.reloadAgain()},error:function(e){layer.alert("服务器出错")}})},reloadAgain:function(){correctPreventDocument.isShow=!1,this.reload=!this.reload},cancel:function(){window.parent.closeCurrentTab({name:"纠正预防单",openTime:this.openTime,exit:!0})},submit:function(){var e=this.selected;e.length<1?layer.alert("至少选择一条数据"):$.ajax({url:contextPath+"/tQcCorrectPreventDocument/submitBatch",method:"post",dataType:"json",data:JSON.stringify(e),contentType:"application/json;charset=utf-8",success:function(e){if("100100"===e.code)if(correctPreventDocument.reload=!correctPreventDocument.reload,$.isEmptyObject(e.data))layer.alert("提交成功！");else{for(var t="单据",n=0;n<e.data.length;n++)t+="["+e.data[n].documentCode+"]、";t+="提交失败（单据业务流向不为验证完成或者状态不为暂存！）",layer.alert(t)}}})},approvalOrRejectCallBack:function(e){"100100"==e.result.code&&this.reloadAgain()},autoSubmitOrReject:function(e){var t=this;$.ajax({url:contextPath+"/tQcCorrectPreventDocument/submitapproval?submitType=1",method:"post",contentType:"application/json;charset=utf-8",data:JSON.stringify({receiptsId:t.documentCode,approvalResult:"reject"==t.modalType?1:0}),success:function(e){"100100"!=e.code&&t.$Modal.warning({content:e.msg}),t.reloadAgain()}})},approval:function(){var e=this,t=this.selected;1<t.length?layer.alert("只能选择一条数据！"):t.length<1?layer.alert("请至少选择一条数据！"):"temporary_save"!==t[0].documentStatus?"auditing"!==t[0].documentStatus?(e.documentCode=t[0].documentCode,e.documentStatus=t[0].documentStatus,e.modalType="approve",e.modalTrigger=!e.modalTrigger):layer.alert("该单已审核完成！不能重复审核！"):layer.alert("请提交纠正预防单！")},reject:function(){var e=this,t=this.selected;1<t.length?layer.alert("只能选择一条数据！"):t.length<1?layer.alert("请至少选择一条数据！"):"temporary_save"!=t[0].documentStatus?(e.documentCode=t[0].documentCode,e.documentStatus=t[0].documentStatus,e.modalType="reject",e.modalTrigger=!e.modalTrigger):layer.alert("该单状态不能驳回!")},initDocumentStatus:function(){this.documentStatusList=getCodeList("zj_document_status"),console.log(this.documentStatusList)},initBusinessFlowDirection:function(){this.businessFlowDirectionList=getCodeList("zj_jzyfddjzt")},initDocumentType:function(){this.DocumentTypeList=getCodeList("zj_jzyfdydlx")},initconclusionList:function(){this.conclusionList=getCodeList("zj_jzyfdgzjl")}},watch:{"body.businessFlowDirection":function(e){void 0===e&&(this.body.businessFlowDirection="")},"body.sourceDocumentType":function(e){void 0===e&&(this.body.sourceDocumentType="")},"body.documentStatus":function(e){void 0===e&&(this.body.documentStatus="")}},mounted:function(){this.openTime=window.parent.params.openTime,this.initDocumentStatus(),this.initBusinessFlowDirection(),this.initDocumentType(),this.initconclusionList(),$.ajax({type:"post",url:contextPath+"/tQcCorrectPreventDocument/queryallempbyorganid",dataType:"json",success:function(e){correctPreventDocument.empList=e.data},error:function(){alert("服务器出错啦")}})}});