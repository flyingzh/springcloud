"use strict";var _methods;function _defineProperty(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var vm=new Vue({el:"#app",data:{isShow:!1,isEdit:!1,reload:!1,isSearchHide:!0,isTabulationHide:!0,isHide:!0,selected:[],stepList:[],approvalTableData:[],modalTrigger:!1,openTime:"",modalType:"",documentNo:"",documentStatus:"",selectBusinessType:[{value:"W_REQUISITION_01",label:"销售出仓"},{value:"W_REQUISITION_02",label:"采购送料"},{value:"W_REQUISITION_03",label:"采购退库"},{value:"W_REQUISITION_04",label:"受托加工送料"},{value:"W_REQUISITION_05",label:"受托加工退料"},{value:"W_REQUISITION_06",label:"采购料结"}],body:{documentNo:"",startTime:"",endTime:"",salesmanName:"",businessType:""},data_config:{url:contextPath+"/requisition/list",datatype:"json",colNames:["id","日期","单据编号","单据状态","业务类型","员工","备注","商品类型","调拨总数量","调拨总重量"],colModel:[{name:"id",width:210,align:"left",hidden:!0},{name:"transferTime",width:210,align:"left",formatter:function(t,e,n,o){return null!=t?new Date(t).format("yyyy-MM-dd"):""}},{name:"documentNo",width:210,align:"left",formatter:function(t,e,n,o){return $(document).on("click",".detail"+t,function(){vm.detailClick({value:t,grid:e,rows:n,state:o})}),'<a class="detail'+t+'">'+t+"</a>"},unformat:function(t,e,n){return t.replace(/(<\/?a.*?>)/g,"")}},{name:"documentStatus",width:210,align:"left",formatter:function(t,e,n,o){return 1===t?"暂存":2===t?"待审核":3===t?"审核中":4===t?"已审核":5===t?"驳回":void 0},unformat:function(t,e,n,o){return"暂存"===t?1:"待审核"===t?2:"审核中"===t?3:"已审核"===t?4:"驳回"===t?5:void 0}},{name:"businessType",width:210,align:"left",formatter:function(t,e,n,o){return"W_REQUISITION_01"===t?"销售出仓":"W_REQUISITION_02"===t?"采购送料":"W_REQUISITION_03"===t?"采购退库":"W_REQUISITION_04"===t?"受托加工送料":"W_REQUISITION_05"===t?"受托加工退料":"W_REQUISITION_06"===t?"采购料结":""}},{name:"salesmanName",align:"left",width:210},{name:"remark",align:";left",width:210},{name:"goodsTypeName",align:";left",width:210},{name:"totalTransferNum",align:";left",width:210,formatter:function(t,e,n,o){return null==t?0:t}},{name:"totalTransferWeigh",align:";left",width:210,formatter:function(t,e,n,o){return null==t?0:t}}],rowNum:5,rowList:[10,20,30],mtype:"post",viewrecords:!0}},methods:(_methods={clear:function(){this.body={documentNo:"",startTime:"",endTime:"",salesmanName:"",businessType:""},this.dataValue=[]},changeDate:function(t){this.body.startTime=t[0].replace(/\//g,"-")+" 00:00:00",this.body.endTime=t[1].replace(/\//g,"-")+" 23:59:59"},search:function(){this.reload=!this.reload},refresh:function(){this.clear(),this.reload=!this.reload},exit:function(){window.parent.closeCurrentTab({openTime:this.openTime,exit:!0})},DeleteOneRow:function(){var e=this;if(e.selected.length<1)e.$Modal.warning({title:"提示信息",content:"请先选择至少一笔数据！"});else{var t=!0,n=!(e.selectRowData=[]),o=void 0;try{for(var a,i=e.selected[Symbol.iterator]();!(t=(a=i.next()).done);t=!0){var l=a.value,r=$("#myTable").jqGrid("getRowData",l);e.selectRowData.push(r)}}catch(t){n=!0,o=t}finally{try{!t&&i.return&&i.return()}finally{if(n)throw o}}var s="",c=!0,d=!1,u=void 0;try{for(var m,h=e.selectRowData[Symbol.iterator]();!(c=(m=h.next()).done);c=!0){var f=m.value;1!==f.documentStatus&&(s+="单据[ "+f.documentNo+" ]<br>",console.log(s,f.documentStatus,f.documentNo))}}catch(t){d=!0,u=t}finally{try{!c&&h.return&&h.return()}finally{if(d)throw u}}s?e.$Modal.warning({title:"提示信息",content:s+" 单据状态不为暂存，不能删除"}):this.$Modal.confirm({title:"提示信息",content:"是否要删除这条信息？",onOk:function(){$.ajax({type:"POST",url:contextPath+"/requisition/deleteBatch",contentType:"application/json",data:JSON.stringify(e.selected),dataType:"json",success:function(t){e.selected="","100100"==t.code?(e.refresh(),$.isEmptyObject(t.data)&&e.$Modal.success({title:"提示信息",content:"删除成功！"})):e.$Modal.warning({title:"提示信息",content:"删除失败！"})}})},onCancel:function(){}})}},detailClick:function(t){console.log(t),console.log("detailClick------data.rows.id",t.rows.documentNo),window.parent.activeEvent({name:"调拨单-查看",url:contextPath+"/warehouse/requisition/requisition-info.html",params:{activeType:"listQuery",documentNo:t.rows.documentNo}})},add:function(){console.log("add"),window.parent.activeEvent({name:"调拨单-新增",url:contextPath+"/warehouse/requisition/requisition-info.html",params:{activeType:"handworkAdd"}})},update:function(){this.selected.length<1?this.$Modal.warning({title:"提示信息",content:"请先选择至少一笔数据！"}):1<this.selected.length?this.$Modal.warning({title:"提示信息",content:"只能选择一笔数据！"}):(console.log(this.selected[0],233),1<this.selected.length?this.$Modal.warning({title:"提示信息",content:"只能选择一笔数据！"}):(console.log(this.selected[0].id,233),window.parent.activeEvent({name:"调拨单-修改",url:contextPath+"/warehouse/requisition/requisition-info.html",params:{activeType:"listUpdate",documentNo:this.selected[0].documentNo}})))}},_defineProperty(_methods,"DeleteOneRow",function(){var e=this;if(console.log("DeleteOneRow---This.selected",e.selected),e.selected.length<1)e.$Modal.warning({title:"提示信息",content:"请先选择至少一笔数据！"});else{var t="",n=!0,o=!1,a=void 0;try{for(var i,l=e.selected[Symbol.iterator]();!(n=(i=l.next()).done);n=!0){var r=i.value;1!==r.documentStatus&&(t+="单据[ "+r.documentNo+" ]<br>")}}catch(t){o=!0,a=t}finally{try{!n&&l.return&&l.return()}finally{if(o)throw a}}if(t)e.$Modal.warning({title:"提示信息",content:t+" 单据状态不为暂存，不能删除"});else{var s=[],c=!0,d=!1,u=void 0;try{for(var m,h=e.selected[Symbol.iterator]();!(c=(m=h.next()).done);c=!0){var f=m.value;s.push(f.id)}}catch(t){d=!0,u=t}finally{try{!c&&h.return&&h.return()}finally{if(d)throw u}}this.$Modal.confirm({title:"提示信息",content:"是否删除？",onOk:function(){$.ajax({type:"POST",url:contextPath+"/requisition/delete",contentType:"application/json",data:JSON.stringify(s),dataType:"json",success:function(t){e.selected="","100100"==t.code?(e.refresh(),$.isEmptyObject(t.data)&&e.$Modal.success({title:"提示信息",content:"删除成功！"})):e.$Modal.warning({title:"提示信息",content:"删除失败！"})}})},onCancel:function(){}})}}}),_defineProperty(_methods,"submit",function(){var e=this.selected;if(console.log("document",e),e.length<1)layer.alert("请至少选择一条数据");else if(1<e.length)layer.alert("只能选择一条数据");else{var n=this;1===e[0].documentStatus?$.ajax({type:"POST",url:contextPath+"/requisition/submit",dataType:"json",data:{id:e[0].id,organizationId:e[0].organizationId},success:function(t){console.log(t),"100100"===t.code?(e[0].documentStatus=2,n.refresh(),n.$Modal.success({title:"提示信息",content:"提交成功！"})):(e[0].documentStatus=1,n.$Modal.warning({title:"提示信息",content:t.msg}))},error:function(t){n.$Spin.hide(),console.log("服务器出错")}}):layer.alert("单据状态不为暂存不能提交！")}}),_defineProperty(_methods,"approval",function(){var t=this,e=this.selected;if(console.log(e,4958934),1<e.length)this.$Modal.warning({title:"提示信息",content:"只能选择一条数据！"});else if(e.length<1)this.$Modal.warning({title:"提示信息",content:"请至少选择一条数据！"});else if(2===e[0].documentStatus||3===e[0].documentStatus||5===e[0].documentStatus)t.id=e[0].id,t.documentStatus=e[0].documentStatus,t.documentNo=e[0].documentNo,t.modalType="approve",t.modalTrigger=!t.modalTrigger,console.log(e[0].documentStatus,e[0].documentNo,77);else{if(1===e[0].documentStatus)return void this.$Modal.warning({title:"提示信息",content:"请提交单据！"});if(4===e[0].documentStatus)return void this.$Modal.warning({title:"提示信息",content:"该单已审核,不能重复审核！"})}}),_defineProperty(_methods,"reject",function(){var t=this,e=this.selected;1<e.length?t.$Modal.warning({title:"提示信息",content:"请至少选择一条数据！"}):e.length<1?t.$Modal.warning({title:"提示信息",content:"请至少选择一条数据！"}):2===e[0].documentStatus||3===e[0].documentStatus||5===e[0].documentStatus?(t.id=e[0].id,t.documentStatus=e[0].documentStatus,t.documentNo=e[0].documentNo,t.modalType="reject",t.modalTrigger=!t.modalTrigger):t.$Modal.warning({title:"提示信息",content:"该单状态不能驳回！"})}),_defineProperty(_methods,"approvalOrRejectCallBack",function(t){console.log(t,9988788),"100100"===t.result.code&&this.refresh()}),_defineProperty(_methods,"autoSubmitOrReject",function(t){var e=this;$.ajax({url:contextPath+"/requisition/submitapproval?submitType=1",method:"post",contentType:"application/json;charset=utf-8",data:JSON.stringify({receiptsId:e.documentCode,approvalResult:"reject"==e.modalType?1:0}),success:function(t){"100100"===t.code||e.$Modal.warning({content:t.msg})}})}),_defineProperty(_methods,"ajaxUpdateDocStatusById",function(t,e){var n=this;$.ajax({url:contextPath+"/requisition/updateDocumentStatusByid",method:"POST",dataType:"json",contentType:"application/json;charset=utf-8",data:JSON.stringify({id:t,documentStatus:e}),success:function(t){"100100"==t.code&&(n.body.documentStatus=e,n.refresh())}})}),_methods),mounted:function(){this.openTime=window.parent.params.openTime}});