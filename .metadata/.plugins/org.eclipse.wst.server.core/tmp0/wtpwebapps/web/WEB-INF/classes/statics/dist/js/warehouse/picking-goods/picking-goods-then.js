"use strict";var $layer=parent.layer;function alertMsg(e,t){$layer.alert(e,{title:"提示",shade:.6,icon:t||1,closeBtn:0,btn:["确定"],yes:function(e,t){$layer.close(e)}})}var getResult1=$.ajax({cache:!1,url:"/web/js/warehouse/picking-goods/result1.json"}),getResult2=getResult1.then(function(e){return console.log(e.data),$.ajax({cache:!1,url:"/web/js/warehouse/picking-goods/result2.json"})}),getResult3=getResult2.then(function(e){return console.log(e.data),$.ajax({cache:!1,url:"/web/js/warehouse/picking-goods/result3.json"})});getResult3.done(function(e){console.log(e.data)}).fail(function(e){console.log("Error: "),console.log(e)}).always(function(e){console.log("Always: "),console.log(e)});var vm=new Vue({el:"#app",data:function(){return{isShow:!1,isEdit:!1,reload_unpicked:!1,reload_picked:!1,isSearchHide:!0,frameTab:!1,isTabulationHide:!0,checkedAllData:!1,openTime:"",dataValue:[],isHide:!0,selectedPicked:[],selectedUnpicked:[],selectedRow:{},selectedRowNum:0,checkData:[],barcodeProduct:[],selectType:[{value:"客户订单",label:"客户订单"},{value:"原料领用申请单",label:"原料领用申请单"}],body:{goodsType:"",saleOrderNo:"",goodsCode:"",goodsName:"",startTime:"",endTime:"",productTypeName:"",alreadyTest:2,hasCreateTestDocument:0},data:[{value:"shiliao",label:"石料",children:[{value:"shiliaoyihao",label:"石料一号"},{value:"shiliaoerhao",label:"石料二号"},{value:"shiliaosanhao",label:"石料三号"}]},{value:"kjin",label:"k金"},{value:"suzhou",label:"苏州"}],data_config_unpicked:{url:contextPath+"/examineGoodsController/queryList",datatype:"json",colNames:["客户订单编号","商品类型","商品图片","商品编码","商品名称","计数单位","订单数量","订单入库数量","拣货数量","未拣货数量","字印内容","字印确认","完成数量"],colModel:[{name:"saleOrderNo",index:"saleOrderNo",width:210,align:"left"},{name:"goodsType",index:"goodsType",width:210,align:"left"},{name:"pictureUrl",index:"pictureUrl",width:210,align:"left"},{name:"goodsCode",index:"goodsCode",width:210,align:"left"},{name:"goodsName",index:"goodsName",align:"left",width:210},{name:"countingUnit",index:"countingUnit",align:"left",width:210},{name:"goodsNum",index:"goodsNum",align:"left",width:210},{name:"totalPurchaseStorageNum",index:"totalPurchaseStorageNum",align:";left",width:210},{name:"totalPickNum",index:"totalPickNum",align:";left",width:210},{name:"noPickNum",index:"noPickNum",align:";left",width:210},{name:"printedContent",index:"printedContent",align:";left",width:210},{name:"printStatus",index:"printStatus",align:";left",width:210},{name:"sentQualiyNum",index:"sentQualiyNum",align:";left",width:210}],rowNum:5,rowList:[10,20,30],mtype:"post",viewrecords:!0,postData:this.body},data_config_picked:{url:contextPath+"/examineGoodsController/querySentList",datatype:"json",colNames:["客户订单编号","商品类型","商品图片","商品编码","商品名称","计数单位","订单数量","订单入库数量","拣货数量","未拣货数量","字印内容","字印确认","完成数量"],colModel:[{name:"saleOrderNo",index:"saleOrderNo",width:210,align:"left"},{name:"goodsType",index:"goodsType",width:210,align:"left"},{name:"pictureUrl",index:"pictureUrl",width:210,align:"left"},{name:"goodsCode",index:"goodsCode",width:210,align:"left"},{name:"goodsName",index:"goodsName",align:"left",width:210},{name:"countingUnit",index:"countingUnit",align:"left",width:210},{name:"goodsNum",index:"goodsNum",align:"left",width:210},{name:"totalPurchaseStorageNum",index:"totalPurchaseStorageNum",align:";left",width:210},{name:"totalPickNum",index:"totalPickNum",align:";left",width:210},{name:"noPickNum",index:"noPickNum",align:";left",width:210},{name:"printedContent",index:"printedContent",align:";left",width:210},{name:"printStatus",index:"printStatus",align:";left",width:210},{name:"sentQualiyNum",index:"sentQualiyNum",align:";left",width:210}],rowNum:5,rowList:[10,20,30],mtype:"post",viewrecords:!0,postData:this.body}}},watch:{checkData:{handler:function(){2==this.checkData.length?document.querySelector("#quan").checked=!0:document.querySelector("#quan").checked=!1},deep:!0}},methods:{search:function(){this.reload_unpicked=!this.reload_unpicked},clear:function(){this.body={goodsType:"",saleOrderNo:"",goodsCode:"",startTime:"",endTime:"",productTypeName:"",goodsName:"",alreadyTest:2,hasCreateTestDocument:0},this.dataValue=[]},productPickConfirm:function(){var t=this;if(console.log(t),0==t.selectedUnpicked.length)return alertMsg("请选择“一个”未拣货的订单"),!1;if(1<t.selectedUnpicked.length)return alertMsg("只能针对单个商品进行拣货！"),!1;var e=$("#tblUnpicked"),o=e.jqGrid("getGridParam","selrow"),a=e.jqGrid("getRowData",o);console.log(a),t.selectedRow=a,t.selectedRowNum=o,$.ajax({url:contextPath+"/examineGoodsController/totalPurchaseStorageNum",type:"post",data:{goodsCode:a.goodsCode},dataType:"json",success:function(e){if(console.log(e),100100==e.code){if(null==e.data)return alertMsg("订单对应商品未入库，不能进行拣货"),!1}else alertMsg(e.msg)},error:function(e){console.log(e)}}),$.ajax({url:contextPath+"/examineGoodsController/queryQualityAffirmList",type:"post",data:{goodsCode:a.goodsCode},dataType:"json",success:function(e){console.log(e),100100==e.code?t.barcodeProduct=e.data:alertMsg(e.msg)},error:function(e){console.log(e)}}),t.frameTab=!0},print:function(){var e=$("#tblUnpicked"),t=e.jqGrid("getGridParam","selrow");e.jqGrid("getRowData",t);$.ajax({url:contextPath+"/examineGoodsController/goodsContent",type:"post",data:JSON.stringify(vm.selectedUnpicked),dataType:"json",contentType:"application/json",success:function(e){if(console.log(e),100100==e.code){for(var t="",o=0;o<e.data.length;o++)t+=e.data[o].goods_code+",";return 0!=e.data.length&&alertMsg("商品编码：（"+t+"）该订单商品不需要字印!"),!1}alertMsg(e.msg)},error:function(e){console.log(e)}}),$.ajax({url:contextPath+"/examineGoodsController/printStatus",type:"post",data:JSON.stringify(vm.selectedUnpicked),dataType:"json",contentType:"application/json",success:function(e){if(console.log(e),100100==e.code){for(var t="",o=0;o<e.data.length;o++)t+=e.data[o].goods_code+",";return 0!=e.data.length&&alertMsg("商品编码：（"+t+"）该订单商品不需要字印!"),!1}alertMsg(e.msg)},error:function(e){console.log(e)}}),$.ajax({url:contextPath+"/examineGoodsController/printAffirm",type:"post",data:JSON.stringify(vm.selectedUnpicked),dataType:"json",contentType:"application/json",success:function(e){console.log(e),100100==e.code||alertMsg(e.msg)},error:function(e){console.log(e)}}),alertMsg("拣货确认完成!")},checkedAll:function(e){var t=document.querySelectorAll(".checkItem");if(e.target.checked)for(var o=0;o<t.length;o++)t[o].checked=!0;else for(o=0;o<t.length;o++)t[o].checked=!1},modalPickDone:function(){var e=$("#barcodeList").find(".checkItem:checked");$("#tblUnpicked").jqGrid("setRowData",this.selectedRowNum,{pickNumber:e.length});for(var t=new Array,o=0;o<e.length;o++)t[o]=$("#barcodeList").find(".checkItem:checked")[o].value,console.log(t[o]);$.ajax({url:contextPath+"/examineGoodsController/qualityAffirm",type:"post",data:JSON.stringify(t),dataType:"json",contentType:"application/json",success:function(e){console.log(e),e.code,alertMsg(e.msg)},error:function(e){console.log(e)}}),this.search()},modalPickCancel:function(){console.log("Cancel pick")}}});