"use strict";var _methods;function _defineProperty(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}var vm=new Vue({el:"#app",data:function(){return{codesUsed:{},warehouseInfoList:[],productDetailModal:{showModal:!1,ids:{goodsId:"",commodityId:"",documentType:"W_REQUISITION"}},productTypeList:[],requisitionOrder:{documentNo:"",documentStatus:1,businessType:"",salesmanId:"",salesmanName:"",goodsTypeId:"",goodsTypePath:"",goodsTypeName:"",remark:"",totalTransferNum:"",totalTransferWeigh:"",organizationId:"",organizationName:"",transferTime:"",createId:"",createName:"",createTime:"",updateId:"",updateName:"",updateTime:"",isDel:"",custId:"",custCode:"",supplierId:"",supplierCode:"",goodsMainType:"",goodList:[],examineVerifyName:"",examineVerifyTime:""},isShow:!1,reload:!1,isSearchHide:!0,unitMap:{},isTabulationHide:!0,isGoodsBarcode:!1,showMainType:!0,showAdd:!1,showBody:!1,showProductType:!1,showProduct:!1,showAll:!1,showWeight:!1,showProductProperty:!1,selectTab:!0,tabValid:!1,ctrlMark:!0,modalTrigger:!1,isClick:!1,isStampShow:!1,isGoodsBarcodeShow:!1,isHideOutWarehouse:!0,showWarehouse:!1,isReadonly:!1,isDelClick:!0,isBusinessType:!0,tabVal:"name1",businessType:"",orderStatus:"",goodsMainType:"",goodsValue:[],stepList:[],modalType:"",approvalTableData:[],goodsDescription:[],rawInfo:[{}],selectedIndex:0,selectedIndex1:0,categoryType:[],salesmanList:[],warehouseList:[],warehouseArr:[],businessTypeTemp:"",sourceType:"",qualifiedNum:"",openTime:"",allTransferNum:"",nature:"",selectBusinessType:[{value:"W_REQUISITION_01",label:"销售出仓"},{value:"W_REQUISITION_02",label:"采购送料"},{value:"W_REQUISITION_03",label:"采购退库"},{value:"W_REQUISITION_04",label:"受托加工送料"},{value:"W_REQUISITION_05",label:"受托加工退料"},{value:"W_REQUISITION_06",label:"采购料结"}],data_config_approval:{url:"",colNames:["操作类型","开始级次","目的级次","审批人","审批意见","审批时间"],colModel:[{name:"approvalResult",width:200,align:"left",formatter:function(e,t,i,o){return 1==e?"审核":"驳回"}},{name:"currentLevel",width:200,align:"left",formatter:function(e,t,i,o){return 0===e?"开始":1===e?"一级审核":2===e?"二级审核":3===e?"三级审核":4===e?"四级审核":5===e?"五级审核":6===e?"六级审核":"结束"}},{name:"nextLevel",width:200,align:"left",formatter:function(e,t,i,o){return-1===i.approvalResult||0===i.approvalResult&&void 0===i.nextLevel?"开始":"0"===e?"开始":"1"===e?"一级审核":"2"===e?"二级审核":"3"===e?"三级审核":"4"===e?"四级审核":"5"===e?"五级审核":"6"===e?"六级审核":"结束"}},{name:"createName",width:200,align:"left"},{name:"approvalInfo",width:220,align:"left"},{name:"createTime",width:250,align:"left"}],jsonReader:{root:"data.data"},multiselect:!1},options:[],productDetailList:[],productDetailListTemp:{}}},methods:(_methods={getSelect:function(e,t){return repositionDropdownOnSroll(e,t)},clear:function(){this.requisitionOrder={documentCode:"",startTime:"",endTime:"",productTypeName:"",alreadyTest:2,hasCreateTestDocument:0},this.dataValue=[]},htPrint:function(e){function t(){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}(function(){htPrint()}),loadProductType:function(){var t=this;$.ajax({type:"post",url:contextPath+"/requisition/queryStyleCategory?parentId=0",contentType:"application/json",dataType:"json",success:function(e){"100100"===e.code&&(t.categoryType=t.initGoodCategory(e.data.cateLists))},error:function(){alert("服务器出错啦")}})},initGoodCategory:function(e){var r=this,n=[];return e.forEach(function(e){var t=e.customCode,i=e.name,o=e.cateLists,s=e.code;o&&(o=r.initGoodCategory(o)),n.push({value:t,label:i,children:o,code:s})}),n.forEach(function(e){e.children||delete e.children}),n},changeProductType:function(e,t){var i=this,o=this;if(!o.requisitionOrder.goodsTypePath)return o.requisitionOrder.goodsTypePath=t[t.length-1].value,o.requisitionOrder.goodsTypeName=t[t.length-1].label,void(o.selectedProductType=e);o.$Modal.confirm({title:"提示信息",content:"修改商品类型会清空商品简述和商品明细列表的所有数据，是否确定修改？",onOk:function(){o.requisitionOrder.goodsTypePath=t[t.length-1].value,o.requisitionOrder.goodsTypeName=t[t.length-1].label,o.selectedProductType=e,o.$nextTick(function(){o.productDetailList=[],o.productDetailListTemp.goodsEntities=[],o.warehouseList=[],i.tabVal="name1"}),o.$forceUpdate()},onCancel:function(){o.productDetailList=[],o.warehouseList=[],o.productDetailList.push({}),o.goodsValue=o.selectedProductType,o.$forceUpdate()}})},rowClick:function(e){var t=this;if(0!==this.goodsValue.length){if("add"===e){if(!this.requisitionOrder.businessType)return void this.$Modal.warning({content:"请先选择业务类型",title:"警告"});var i=this.productDetailList.length;this.productDetailList.push({}),vm.getInputValue("",i),this.$nextTick(function(){t.getSelect("table-responsive","goods")})}else if("copy"===e)if(null===this.selectedIndex)layer.alert("请选择一条数据！");else{var o=Object.assign({},this.productDetailList[this.selectedIndex],{goodsEntities:[]});this.productDetailList.push(o),this.selectedIndex=null}this.$nextTick(function(){t.getSelect("table-responsive","goods"),t.getWareHouseGroup()})}else this.$Modal.warning({content:"请先选择商品类型",title:"警告"})},action2:function(){null===this.selectedIndex?layer.alert("请选择一条数据！"):(this.productDetailList.splice(this.selectedIndex,1),this.$forceUpdate(),this.updateCodesUsed()),this.selectedIndex=null},action3:function(){null===this.selectedIndex1?layer.alert("请选择一条数据！"):(this.productDetailListTemp.goodsEntities.length>this.allTransferNum?(this.productDetailListTemp.goodsEntities.splice(this.selectedIndex1,1),this.productDetailList[this.selectedIndex].goodsEntities.splice(this.selectedIndex1,1)):this.isDelClick=!0,this.$forceUpdate()),this.selectedIndex1=null},getInputValue:function(e,t){var i=this;if(i.requisitionOrder.goodsTypePath){var o={categoryCustomCode:i.requisitionOrder.goodsTypePath,field:e,limit:""};$.ajax({type:"post",url:contextPath+"/tbasecommodity/findByType",data:o,dataType:"json",success:function(e){"100100"===e.code&&(Object.assign(i.productDetailList[t],{options:e.data}),i.$forceUpdate())},error:function(){layer.alert("服务器出错啦")}})}else i.$Message.info("请先选择商品类型！")},getSelectedItem:function(e,i){var o=this;$.ajax({type:"post",url:contextPath+"/tbasecommodity/getBriefById/"+e.id,dataType:"json",success:function(e){if("100100"===e.code){o.productDetailList[i]=[];var t=e.data;t.countUnit=o.unitMap[t.countUnitId],t.weightUnit=o.unitMap[t.weightUnitId],Object.assign(o.productDetailList[i],{goodsCode:t.code,goodsName:t.name,commodityId:t.id,goodsMainType:t.mainType,pictureUrl:t.frontPic&&t.frontPic.fdUrl,goodsNorm:t.specification,weightUnitId:t.weightUnitId,countingUnitId:t.countUnitId,weightUnit:t.weightUnit,countingUnit:t.countUnit,pricingUnitId:t.pricingType,styleCategoryId:t.styleCategoryId,certificateType:t.certificateType}),o.isHideOutWarehouse=!0,"attr_ranges_gold"===t.mainType&&(o.productDetailList[i].certificateType=t.certificateType,o.isHideOutWarehouse=!1,o.showWeight=!1),o.productDetailList[i].transferOutWarehouse="",o.productDetailList[i].transferInWarehouse="",o.productDetailList[i].totalWeight=0,Vue.set(o.productDetailList,i,o.productDetailList[i]),o.$forceUpdate()}},error:function(){layer.alert("服务器出错啦")}})},getSalesman:function(){var t=this;$.ajax({type:"post",url:contextPath+"/requisition/queryallempbyorganid",contentType:"application/json",dataType:"json",success:function(e){"100100"===e.code&&(t.salesmanList=e.data)},error:function(){alert("服务器出错啦")}})},showProductDetail:function(e){var t=this;if(t.detailType="CODING",t.productDetailList[0].sourceType?t.orderStatus=2:1!=t.requisitionOrder.documentStatus?t.orderStatus=2:t.orderStatus=1,t.goodsMainType=t.productDetailList[e].goodsMainType,t.selectedIndex=e,t.productDetailList[e].commodityId){if(!t.productDetailList[e].transferGoodsNum){if(t.productDetailList[e].sourceNo)i={goodsId:t.productDetailList[e].goodsLineNo,commodityId:t.productDetailList[e].commodityId,documentType:t.productDetailList[e].sourceType};else var i={goodsId:t.productDetailList[e].id,commodityId:t.productDetailList[e].commodityId,documentType:"W_REQUISITION"};Object.assign(t.productDetailModal,{showModal:!0,ids:i}),t.$nextTick(function(){t.$refs.modalRef.getProductDetail()})}}else t.$Modal.warning({title:"提示信息",content:"请先选择商品"})},showBarcodeDetail:function(e){var t=this;if(!t.productDetailListTemp.goodsEntities[e].id)return t.$Modal.warning({content:"请先选择商品条码！"}),!1;t.detailType="BARCODE",t.orderStatus=2,t.goodsMainType=t.productDetailListTemp.goodsEntities[e].goodsMainType;var i={goodsId:t.productDetailListTemp.goodsEntities[e].id,commodityId:"",documentType:"W_STOCK_IN"};Object.assign(t.productDetailModal,{showModal:!0,ids:i}),t.$nextTick(function(){t.$refs.modalRef.getProductDetail()})},modalSure:function(e){"CODING"===this.detailType?this.productDetailModalClick(e):"BARCODE"===this.detailType&&(this.productDetailList[selectedIndex].overEdit=!1)},validateProduct:function(){var i=!0,o=this;return $.each(o.productDetailList,function(e,t){if(t.goodsId)return!0;if(t.sourceNo)return!0;if("attr_ranges_goods"==t.goodsMainType){if(!t.tBaseBomEntity)return i=!1,o.$Modal.error({content:"第"+(e+1)+"行商品明细未选择，请先选择商品明细！"}),!1}else if(!t.assistAttrs)return i=!1,o.$Modal.error({content:"第"+(e+1)+"行商品明细未选择，请先选择商品明细！"}),!1}),i},modalOk:function(){},modalCancel:function(){}},_defineProperty(_methods,"modalSure",function(e){this.productDetailModalClick(e)}),_defineProperty(_methods,"modalCancel",function(e){}),_defineProperty(_methods,"productDetailModalClick",function(e){"attr_ranges_goods"===this.productDetailList[this.selectedIndex].goodsMainType?Object.assign(this.productDetailList[this.selectedIndex],{tBaseBomEntity:e,assistAttrs:null,overEdit:!0}):Object.assign(this.productDetailList[this.selectedIndex],{assistAttrs:e,tBaseBomEntity:null,overEdit:!0})}),_defineProperty(_methods,"getGoodsBarcodeValue",function(t,i){console.log(i,"另一个index！！！");var o=this;"W_REQUISITION_04"==this.requisitionOrder.businessType||"W_REQUISITION_05"==this.requisitionOrder.businessType?o.nature=0:o.nature=1;var e={goodsBarcode:t,commodityId:o.productDetailListTemp.commodityId,goodsNo:o.productDetailListTemp.goodsCode,isInStock:1,nature:o.nature,warehouseArr:o.warehouseArr,stockInNo:"",limit:""};$.ajax({type:"post",url:contextPath+"/goodsController/queryGoodsDetail",data:JSON.stringify(e),contentType:"application/json",dataType:"json",success:function(e){"100100"===e.code&&(o.options=e.data.map(function(e){return $.extend(!0,{},{code:e.goodsBarcode,name:e.goodsName,id:e.id})}),o.$forceUpdate(),o.updateCodesUsed(t,i))},error:function(){layer.alert("服务器出错啦")}})}),_defineProperty(_methods,"getGoodsItem",function(e,i){var o=this,t={id:e.id};$.ajax({type:"post",url:contextPath+"/goodsController/queryGoodsDetail",data:JSON.stringify(t),contentType:"application/json",dataType:"json",success:function(e){if("100100"===e.code){var t=$.extend(!0,{},e.data[0],{options:o.productDetailListTemp.goodsEntities[i].options});o.productDetailListTemp.goodsEntities.splice(i,1,t),o.$forceUpdate(),o.updateCodesUsed()}},error:function(){layer.alert("服务器出错啦")}})}),_defineProperty(_methods,"initUnit",function(){var o=this;$.ajax({type:"post",url:contextPath+"/tbaseunit/list",contentType:"application/json",dataType:"json",async:!1,success:function(e){"100100"===e.code?e.data.map(function(e){var t=e.id,i=e.name;o.unitMap[t]=i}):layer.alert("服务器异常,请联系技术人员！",{icon:0})},error:function(e){layer.alert("网络异常,请联系技术人员！",{icon:0})}})}),_defineProperty(_methods,"businessTypeChange",function(e){var t=this;if(t.isBusinessType)return t.isBusinessType=!1,t.businessTypeTemp=t.requisitionOrder.businessType,t.getWareHouseGroup(),!0;t.$Modal.confirm({title:"提示信息",content:"修改业务类型会清空商品简述和商品明细列表的所有数据，是否确定修改？",onOk:function(){t.businessTypeTemp=t.requisitionOrder.businessType,t.getWareHouseGroup(),t.productDetailList=[],t.productDetailListTemp.goodsEntities=[],t.tabVal="name1"},onCancel:function(){t.requisitionOrder.businessType=t.businessTypeTemp}})}),_defineProperty(_methods,"getWareHouseGroup",function(){if(!this.requisitionOrder.businessType)return this.$Message.info("请选择业务类型"),!1;"W_REQUISITION_04"==this.requisitionOrder.businessType||"W_REQUISITION_05"==this.requisitionOrder.businessType?data={type:4}:data={type:1};var a=this;$.ajax({type:"post",url:contextPath+"/wareHouse/listByTypeAndOrganizationId",data:data,dataType:"json",success:function(e){if("100100"===e.code){a.warehouseList=e.data;var t=!0,i=!(a.warehouseArr=[]),o=void 0;try{for(var s,r=a.warehouseList[Symbol.iterator]();!(t=(s=r.next()).done);t=!0){var n=s.value;a.warehouseArr.push(n.id)}}catch(e){i=!0,o=e}finally{try{!t&&r.return&&r.return()}finally{if(i)throw o}}}},error:function(){layer.alert("服务器出错啦")}})}),_defineProperty(_methods,"getRepertoryPositionGroup",function(e){var t=this;$.ajax({type:"post",url:contextPath+"/tbaserepertoryposition/listbygroup/"+e,dataType:"json",success:function(e){"100100"===e.code&&(t.reservoirPositionList=[],t.reservoirPositionList=e.data)},error:function(){layer.alert("服务器出错啦")}})}),_defineProperty(_methods,"tabsClose",function(){}),_defineProperty(_methods,"selectProductDetail",function(e){this.selectedIndex=e}),_defineProperty(_methods,"selectBarCodeDetail",function(e){this.selectedIndex1=e}),_defineProperty(_methods,"detailAction",function(e){var i=this;if(this.selectedIndex=e,"attr_ranges_gold"===this.productDetailList[e].goodsMainType)return this.$Message.info("商品主类型为金料，不存在条码明细！"),!1;if(!this.productDetailList[e].sourceNo){if(!this.productDetailList[e].goodsCode)return void this.$Message.info("请先选择商品编码！");if(!this.productDetailList[e].transferGoodsNum)return void this.$Message.info("请先输入数量！")}if(this.productDetailList[e].transferInWarehouse){this.tabVal="name2";var t=Number(this.productDetailList[e].transferGoodsNum);if(t){this.productDetailList[e].businessType&&this.productDetailList[e].goodsEntities&&(t=this.productDetailList[e].goodsEntities.length),this.productDetailListTemp.goodsEntities=new Array(t).fill({options:[]});var o=$.extend(!0,{},this.productDetailList[e]);o&&o.goodsEntities&&o.goodsEntities.forEach(function(t){i.warehouseInfoList.forEach(function(e){e.id===t.warehouseId&&(t.warehouse=e.name)})}),"W_MATERIAL_USED"!=this.productDetailList[e].sourceType||this.productDetailList[e].goodsEntities||delete o.goodsEntities;var s=void 0;if(o.goodsEntities&&(s=t-o.goodsEntities.length),0<s)o.goodsEntities.concat(this.productDetailListTemp.goodsEntities);else{var r=Math.abs(s);if(0<r)for(var n=0;n<r;n++)o.goodsEntities.pop()}this.productDetailListTemp=$.extend(!0,{},this.productDetailListTemp,o),this.getGoodsBarcodeValue(""),this.$nextTick(function(){i.getSelect("table-responsive","goods-child")})}}else this.$Message.info("请先选择调入仓库！")}),_defineProperty(_methods,"crolMark",function(e){var t=this;this.tabVal=e,this.productDetailList[this.selectedIndex]=$.extend(!0,{},this.productDetailList[this.selectedIndex],{goodsEntities:this.productDetailListTemp.goodsEntities});var i=0,o=0,s=0;this.productDetailList[this.selectedIndex].goodsEntities.forEach(function(e){isNaN(Number(e.purchaseCost))||(i+=Number(e.purchaseCost)),isNaN(Number(e.netGoldWeight))||(o+=Number(e.netGoldWeight)),isNaN(Number(e.totalWeight))||(s+=Number(e.totalWeight))}),this.productDetailList[this.selectedIndex].totalCost=i,this.productDetailList[this.selectedIndex].goldWeight=o,this.productDetailList[this.selectedIndex].totalWeight=s,this.productDetailListTemp.goodsEntities=[],this.productDetailListTemp.goodsEntities=[],this.$nextTick(function(){t.getSelect("table-responsive","goods")})}),_defineProperty(_methods,"commonTransferData",function(){var e=!0,t=!1,i=void 0;try{for(var o,s=this.salesmanList[Symbol.iterator]();!(e=(o=s.next()).done);e=!0){var r=o.value;if(r.id===this.requisitionOrder.salesmanId){this.requisitionOrder.salesmanName=r.empName;break}}}catch(e){t=!0,i=e}finally{try{!e&&s.return&&s.return()}finally{if(t)throw i}}this.requisitionOrder.transferTime||(this.requisitionOrder.transferTime=(new Date).format("yyyy-MM-dd")||"")}),_defineProperty(_methods,"getNumAction",function(e){var t=Number(this.productDetailList[e].transferGoodsNum);this.showWeight=!!t}),_defineProperty(_methods,"add",function(){window.parent.activeEvent({name:"调拨单-新增",url:contextPath+"/warehouse/requisition/requisition-info.html",params:{data:"Y",activeType:"handworkAdd"}})}),_defineProperty(_methods,"approval",function(){var e=this;if(1===e.requisitionOrder.documentStatus||!e.requisitionOrder.documentNo)return e.$Modal.error({title:"警告!",content:"请先提交单据!"}),!1;e.modalType="approve",e.modalTrigger=!e.modalTrigger}),_defineProperty(_methods,"reject",function(){var e=this;if(1===e.requisitionOrder.documentStatus||!e.requisitionOrder.documentNo)return e.$Modal.error({title:"警告!",content:"请先提交单据!"}),!1;e.modalType="reject",e.modalTrigger=!e.modalTrigger}),_defineProperty(_methods,"approvalOrRejectCallBack",function(e){var t=this;if("100100"==e.result.code)if(t.requisitionOrder.documentStatus=e.result.data,1==t.requisitionOrder.documentStatus)t.isStampShow=!1,t.requisitionOrder.examineVerifyName="",t.requisitionOrder.examineVerifyTime="",$(".is-submit-disabled").css({"pointer-events":"auto "}).css({color:"#495060"}),$(".is-htPrint").css("pointer-events","none").css({color:"#bbbec4"}),$(".is-submit-disabled").css({"pointer-events":"auto "}).css({color:"#666"}),t.productDetailList&&0<t.productDetailList.length&&t.productDetailList[0].sourceNo?(t.showBody=!0,t.isClick=!0,t.showProduct=!0):(t.showAll=!1,t.showBody=!1,t.isClick=!1,t.showProduct=!1),t.showWarehouse=!1,t.isEdit("Y"),t.showAll=!1;else if(2==t.requisitionOrder.documentStatus);else if(3==t.requisitionOrder.documentStatus);else if(4==t.requisitionOrder.documentStatus)t.isStampShow=!0,t.isGoodsBarcodeShow=!0,t.requisitionOrder.examineVerifyName=layui.data("user").username,t.requisitionOrder.examineVerifyTime=(new Date).format("yyyy-MM-dd HH:mm:ss")||"",$(".is-htPrint").css({"pointer-events":"auto "}).css({color:"#495060"});else{if(5!=t.requisitionOrder.documentStatus)return t.$Modal.warning({content:"审核异常!",title:"警告"}),!1;t.isStampShow=!1,t.requisitionOrder.examineVerifyName="",t.requisitionOrder.examineVerifyTime=""}}),_defineProperty(_methods,"autoApproveOrReject",function(){var t=this;$.ajax({url:contextPath+"/requisition/submitapproval?submitType=1",method:"post",contentType:"application/json;charset=utf-8",data:JSON.stringify({receiptsId:t.requisitionOrder.documentNo,approvalResult:"reject"==t.modalType?1:0}),success:function(e){"100100"===e.code?(t.requisitionOrder.documentStatus=parseInt(e.data),t.getApprovalHistory(t.requisitionOrder.documentNo)):t.$Modal.warning({content:e.msg})}})}),_defineProperty(_methods,"ajaxUpdateDocStatusById",function(e,t){var i=this;$.ajax({url:contextPath+"/requisition/updateDocumentStatusByid",method:"POST",dataType:"json",contentType:"application/json;charset=utf-8",data:JSON.stringify({id:e,documentStatus:t}),success:function(e){"100100"==e.code&&(i.requisitionOrder.documentStatus=t)}})}),_defineProperty(_methods,"isEdit",function(e){eventHub.$emit("isEdit",e)}),_defineProperty(_methods,"saveAccess",function(e,t){eventHub.$emit("saveFile",e,t)}),_defineProperty(_methods,"getAccess",function(e,t){eventHub.$emit("queryFile",e,t)}),_defineProperty(_methods,"cancel",function(){}),_defineProperty(_methods,"getApproveInfo",function(){}),_defineProperty(_methods,"getRejectInfo",function(){}),_defineProperty(_methods,"handlerDataToPost",function(){var e,i=this,t=(_defineProperty(e={id:"",commodityId:"",pictureUrl:"",goodsCode:""},"commodityId",""),_defineProperty(e,"goodsName",""),_defineProperty(e,"goodsNorm",""),_defineProperty(e,"countingUnit",""),_defineProperty(e,"countingUnitId",""),_defineProperty(e,"transferGoodsNum",""),_defineProperty(e,"weightUnit",""),_defineProperty(e,"weightUnitId",""),_defineProperty(e,"totalCost",""),_defineProperty(e,"totalWeight",""),_defineProperty(e,"goldWeight",""),_defineProperty(e,"transferOutWarehouse",""),_defineProperty(e,"transferOutPositionId",""),_defineProperty(e,"transferInWarehouse",""),_defineProperty(e,"transferInPositionId",""),_defineProperty(e,"pricingUnit",""),_defineProperty(e,"pricingUnitId",""),_defineProperty(e,"goodsMainType",""),_defineProperty(e,"goodsLineNo",""),_defineProperty(e,"styleCategoryId",""),_defineProperty(e,"sourceNo",""),_defineProperty(e,"sourceType",""),_defineProperty(e,"certificateType",""),_defineProperty(e,"stonesParts",[]),_defineProperty(e,"materialParts",[]),_defineProperty(e,"partParts",[]),_defineProperty(e,"goldParts",[]),e),o=i.requisitionOrder;o.goodList=[JSON.parse(JSON.stringify(t))];htHandlerProductDetail(i.productDetailList,o,t);return i.productDetailList.map(function(e,t){o.goodList[t]||(o.goodList[t]={}),Object.assign(o.goodList[t],{id:e.id,pictureUrl:e.pictureUrl,goodsCode:e.goodsCode,commodityId:e.commodityId,goodsName:e.goodsName,goodsNorm:e.goodsNorm,countingUnit:e.countingUnit,countingUnitId:e.countingUnitId,transferGoodsNum:e.transferGoodsNum,weightUnit:e.weightUnit,weightUnitId:e.weightUnitId,totalWeight:e.totalWeight,totalCost:e.totalCost,goldWeight:e.goldWeight,transferOutWarehouse:e.transferOutWarehouse,transferOutPositionId:e.transferOutPositionId,transferInWarehouse:e.transferInWarehouse,transferInPositionId:e.transferInPositionId,pricingUnitId:e.pricingUnitId,pricingUnit:e.priceMethod,goodsMainType:e.goodsMainType,goodsEntities:e.goodsEntities,goodsLineNo:e.goodsLineNo,styleCategoryId:e.styleCategoryId,sourceNo:e.sourceNo,sourceType:e.sourceType,certificateType:e.certificateType,organizationId:i.requisitionOrder.organizationId})}),o}),_defineProperty(_methods,"tableValidate",function(){return htValidateRow(this.productDetailList,{commodityId:{name:"商品编码",type:"string"},transferGoodsNum:{name:"数量",type:"number",empty:!0},totalWeight:{name:"总重",type:"number",floor:3},transferInWarehouse:{name:"调入仓库",type:"string"}})}),_defineProperty(_methods,"clearNoNumber",function(e,t,i){return htInputNumber(e,t,i)}),_defineProperty(_methods,"save",function(i){this.tabValid=!1;var o=this;if(1!==o.requisitionOrder.documentStatus)return o.$Message.warning("单据状态不为暂存不能进行此操作！"),!1;if("name2"===o.tabVal&&o.crolMark("name1"),"submit"===i&&!$("form").valid()||o.tableValidate())return!1;if(o.productDetailList&&0<o.productDetailList.length)for(var e=0;e<o.productDetailList.length;e++){if("S_CUST_ORDER"==o.productDetailList[e].sourceType&&o.productDetailList[e].goodsEntities.length>o.productDetailList[e].transferPassNum)return o.$Modal.warning({title:"提示！",content:"请删除"+(Number(o.productDetailList[e].goodsEntities.length)-Number(o.allTransferNum))+"条检验不合格条码行"}),!1;if("S_CUST_ORDER"==o.productDetailList[e].sourceType&&o.productDetailList[e].goodsEntities.length==o.productDetailList[e].transferPassNum&&(o.productDetailList[e].transferGoodsNum=o.productDetailList[e].transferPassNum,o.isDelClick=!0),"attr_ranges_gold"!==o.productDetailList[e].goodsMainType){if(!o.productDetailList[e].transferGoodsNum||!o.productDetailList[e].goodsEntities)return o.$Modal.warning({title:"提示！",content:"第"+(e+1)+"行商品简述列表里的数量与商品明细列表的长度不一致，请补全数据!"}),!1;if(o.productDetailList[e].transferGoodsNum&&o.productDetailList[e].goodsEntities&&o.productDetailList[e].transferGoodsNum!=o.productDetailList[e].goodsEntities.length)return o.$Modal.warning({title:"提示！",content:"第"+(e+1)+"行商品简述列表里的数量与商品明细列表的长度不一致，请补全数据!"}),!1}else if(!this.productDetailList[e].transferOutWarehouse)return o.$Modal.warning({title:"提示！",content:"第"+(e+1)+"行商品简述列表里请先选择调出仓库！"}),!1}else if("submit"===i)return o.$Modal.warning({title:"提示！",content:"请添加商品简述列表数据!"}),!1;for(var t=0;t<o.productDetailList.length;t++)if("attr_ranges_gold"!==o.productDetailList[t].goodsMainType){for(var s=0;s<o.productDetailList[t].goodsEntities.length;s++)if(!o.productDetailList[t].goodsEntities[s].goodsBarcode)return o.$Modal.warning({title:"提示！",content:"第"+(t+1)+"行商品简述列表里的商品明细列表的第"+(s+1)+"行内容为空!"}),!1}else if(!o.productDetailList[t].sourceNo&&!o.productDetailList[t].assistAttrs)return o.$Modal.error({content:"第"+(t+1)+"行商品明细未选择，请先选择商品明细！"}),!1;"save"==i?o.requisitionOrder.documentStatus=1:"submit"==i&&(o.requisitionOrder.documentStatus=2,o.isGoodsBarcodeShow=!0,o.showMainType=!0),o.commonTransferData();var r=o.handlerDataToPost();window.top.home.loading("show"),$.ajax({type:"post",url:contextPath+"/requisition/save",contentType:"application/json;charset=utf-8",data:JSON.stringify(r),dataType:"json",success:function(e){var t="save"===i?"保存":"提交";if("100100"===e.code)return o.$Modal.success({title:"提示！",content:t+"成功"}),o.requisitionOrder=e.data,o.productDetailList=e.data.goodList,o.getOrganName(o.requisitionOrder.organizationId),"save"===i||"submit"===i&&($(".is-submit-disabled").css("pointer-events","none").css({color:"#bbbec4"}),o.BannedClick(),o.showWarehouse=!0,o.isEdit("N")),o.saveAccess(o.requisitionOrder.documentNo,"W_REQUISITION"),window.top.home.loading("hide"),!1;o.requisitionOrder.documentStatus=1,window.top.home.loading("hide"),o.$Modal.warning({title:"提示！",content:t+"失败"})},error:function(){window.top.home.loading("hide"),o.body.documentStatus=1,alert("服务器出错啦")}})}),_defineProperty(_methods,"BannedClick",function(){var e=this;e.showBody=!0,e.showProduct=!0,e.showWeight=!0,e.isClick=!0,e.showAll=!0,e.isReadonly=!0}),_defineProperty(_methods,"allowClick",function(){this.showBody=!1,this.showProduct=!1,this.showWeight=!1,this.showAll=!1}),_defineProperty(_methods,"exit",function(){window.parent.closeCurrentTab({openTime:this.openTime,exit:!0})}),_defineProperty(_methods,"sourcrEcho",function(r){var n=this;$.ajax({type:"post",url:contextPath+"/requisition/querySourceInfo",data:JSON.stringify(r),contentType:"application/json",dataType:"json",success:function(e){if("100100"===e.code){if(n.requisitionOrder=e.data[0],"S_CUST_ORDER_01"===n.requisitionOrder.businessType?n.requisitionOrder.businessType="W_REQUISITION_01":"S_CUST_ORDER_02"===n.requisitionOrder.businessType?n.requisitionOrder.businessType="W_CMATERIAL_OUT_01":"W_MATERIAL_USED_01"===n.requisitionOrder.businessType?n.requisitionOrder.businessType="W_REQUISITION_02":"W_MATERIAL_USED_02"===n.requisitionOrder.businessType?n.requisitionOrder.businessType="W_REQUISITION_06":"W_MATERIAL_USED_03"===n.requisitionOrder.businessType?n.requisitionOrder.businessType="W_REQUISITION_04":"W_MATERIAL_USED_04"===n.requisitionOrder.businessType&&(n.requisitionOrder.businessType="W_REQUISITION_05"),n.goodsValue=n.splitCustemCode(n.requisitionOrder.goodsTypePath,0),n.productDetailList=e.data,n.showBody=!0,n.showProductType=!0,n.showProduct=!0,"attr_ranges_gold"==n.requisitionOrder.goodsMainType&&(n.showMainType=!1),n.isClick=!0,n.showWeight=!0,n.isGoodsBarcodeShow=!0,n.getOrgan(),n.requisitionOrder.documentStatus=1,n.requisitionOrder.documentNo="","W_MATERIAL_USED"==n.requisitionOrder.sourceType&&(n.isGoodsBarcodeShow=!1),n.allTransferNum=r[0].allTransferNum,n.getWareHouseGroup(),"S_CUST_ORDER"==n.requisitionOrder.sourceType){n.isDelClick=!1;for(var t=0,i=0,o=0,s=0;s<n.productDetailList.length;s++)n.productDetailList[s].goodsEntities&&0<n.productDetailList[s].goodsEntities.length&&(n.productDetailList[s].goodsEntities.forEach(function(e){t+=Number(e.purchaseCost),i+=Number(e.goldWeight),o+=Number(e.totalWeight)}),n.productDetailList[s].totalCost=t,n.productDetailList[s].goldWeight=i,n.productDetailList[s].totalWeight=o)}n.requisitionOrder.transferTime=new Date}n.isEdit("Y")},error:function(){layer.alert("服务器出错啦")}})}),_defineProperty(_methods,"listEcho",function(e){var t=this,i={documentNo:e};$.ajax({type:"post",url:contextPath+"/requisition/queryDetail",data:JSON.stringify(i),contentType:"application/json",dataType:"json",success:function(e){"100100"===e.code&&(t.requisitionOrder=e.data.requisitionEntity,t.goodsValue=t.splitCustemCode(t.requisitionOrder.goodsTypePath,0),t.productDetailList=e.data.requisitionGoodsList,t.productDetailList&&t.productDetailList.filter(function(e){return"attr_ranges_gold"===e.goodsMainType}).forEach(function(e){return e.transferGoodsNum=""}),1!==t.requisitionOrder.documentStatus?(t.BannedClick(),t.showWarehouse=!0,t.isGoodsBarcodeShow=!0):(t.isGoodsBarcodeShow=!1,t.showWarehouse=!1),t.productDetailList&&0<t.productDetailList.length&&t.productDetailList[0].sourceNo&&(t.showBody=!0,t.isClick=!0,t.showProduct=!0,t.showWeight=!0),4===t.requisitionOrder.documentStatus?(t.isStampShow=!0,$(".is-htPrint").css({"pointer-events":"auto "}).css({color:"#495060"})):(t.isStampShow=!1,$(".is-htPrint").css("pointer-events","none").css({color:"#bbbec4"})),t.isEdit("Y"),"listQuery"===t.params.activeType&&($(".is-disabled").css("pointer-events","none").css({color:"#bbbec4"}),$(".is-submit-disabled").css("pointer-events","none").css({color:"#bbbec4"}),t.BannedClick(),t.isEdit("N")),1!==t.requisitionOrder.documentStatus&&($(".is-submit-disabled").css("pointer-events","none").css({color:"#bbbec4"}),t.BannedClick(),t.isEdit("N")),t.getAccess(t.requisitionOrder.documentNo,"W_REQUISITION"),t.getWareHouseGroup(),t.isBusinessType=!1,t.businessTypeTemp=t.requisitionOrder.businessType),t.$forceUpdate()},error:function(){layer.alert("服务器出错啦")}})}),_defineProperty(_methods,"splitCustemCode",function(e,t){for(var i=[],o=0;o<e.length;o++){var s=e.indexOf(".",t);if(-1===s)break;i.push(s),t=s+1}for(var r=1;r<i.length;r++)this.goodsValue.push(e.substring(0,i[r])+".");return this.goodsValue}),_defineProperty(_methods,"getOrganName",function(e){window.top.home.loading("show");var t=this;$.ajax({type:"post",url:contextPath+"/logisticsdispatching/queryOrgByOrganId",dataType:"json",data:{orgId:e},success:function(e){window.top.home.loading("hide"),"100100"===e.code&&t.$set(t.requisitionOrder,"organizationName",e.data.orgName),"-1"!==e.code?"100101"!==e.code||vm.$Modal.warning({title:"提示信息",content:e.msg}):vm.$Modal.warning({title:"提示信息",content:"服务器出错啦!"})},error:function(){window.top.home.loading("hide"),alert("服务器出错啦")}})}),_defineProperty(_methods,"getOrgan",function(){var t=this;$.ajax({type:"post",url:contextPath+"/entrustOut/getOrgName",dataType:"json",success:function(e){"100100"===e.code&&(t.requisitionOrder.organizationName=e.data.name,t.requisitionOrder.organizationId=e.data.id)},error:function(){alert("服务器出错啦")}})}),_defineProperty(_methods,"list",function(){window.parent.activeEvent({name:"调拨单-列表",url:contextPath+"/warehouse/requisition/requisition-list.html",params:{data:"Y",activeType:"listQuery"}})}),_defineProperty(_methods,"getWareHouse",function(){var t=this;$.ajax({type:"post",url:contextPath+"/wareHouse/queryAll",dataType:"json",success:function(e){"100100"===e.code&&(t.warehouseInfoList=e.data.map(function(e){return $.extend(!0,{},{id:e.id,name:e.name})}))},error:function(){layer.alert("服务器出错啦")}})}),_defineProperty(_methods,"onSelectedDrug",function(e,t,i){var o=this;t==i&&null!=t&&(o.$Modal.warning({title:"提示信息",content:"调出仓库和调入仓库不能一样！"}),o.$nextTick(function(){o.productDetailList[e].transferOutWarehouse="",o.productDetailList[e].transferInWarehouse="",o.$refs["transferOutWarehouse"+e][0].reset(),o.$refs["transferInWarehouse"+e][0].reset()}))}),_defineProperty(_methods,"updateCodesUsed",function(e,t){console.log(t,"我是index！！！！");var i,o={},s={},r=this.productDetailListTemp.goodsEntities||[];void 0!==e&&void 0!==t&&(console.log(String(e).length,"我是length！"),8!=String(e).length&&(r[t].goodsBarcode="")),$.each(this.productDetailList,function(e,t){console.log(e,t,"这是idx和ele！！！"),$.isArray(t.goodsEntities)&&0<t.goodsEntities.length&&$.each(t.goodsEntities,function(e,t){o[Number(t.goodsBarcode)]=""})}),$.isArray(r)&&0<r.length&&$.each(r,function(e,t){s[Number(t.goodsBarcode)]=""}),i=$.extend(!0,{},o,s),this.codesUsed=i,console.log(this.productDetailList,"我是列表！！！！")}),_methods),created:function(){this.loadProductType(),this.initUnit(),this.getOrgan(),this.getSalesman(),this.getWareHouse(),this.params=window.parent.params.params,this.openTime=window.parent.params.openTime,this.requisitionOrder.transferTime=new Date,"handworkAdd"===this.params.activeType?this.isEdit("Y"):"sourceAdd"===this.params.activeType?(this.sourceType=this.params.documentNoArr.sourceType,this.sourcrEcho(this.params.documentNoArr)):"listUpdate"===this.params.activeType?this.listEcho(this.params.documentNo):"listQuery"===this.params.activeType&&(this.listEcho(this.params.documentNo),this.showWarehouse=!0)},mounted:function(){this.getOrgan(),$("form").validate(),this.getSelect("table-responsive","goods"),$(".is-htPrint").css("pointer-events","none").css({color:"#bbbec4"})}});