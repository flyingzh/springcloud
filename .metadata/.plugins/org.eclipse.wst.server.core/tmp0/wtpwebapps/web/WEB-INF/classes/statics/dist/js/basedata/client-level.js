"use strict";var currencyVm=new Vue({el:"#paraLevel",data:function(){var n=this;return{saveDisable:!0,username:"",isSearchHide:!0,isShow:!1,isLock:!1,isAdd:!1,reload:!1,selected:[],openTime:"",body:{order:"",code:"",status:"",name:"",createName:"",createTimeStart:"",createTimeEnd:""},status:[{value:1,label:"有效"},{value:0,label:"无效"}],type:[{value:1,label:"供应商"},{value:0,label:"客户"}],add:{},data_config:{url:contextPath+"/tclientlevel/list",colNames:["等级类型","应用类型","编码","状态","备注","创建人","创建时间"],colModel:[{name:"name",index:"name",width:90,align:"left",formatter:function(e,t,a,i){return $(document).off("click",".detail"+e).on("click",".detail"+e,function(){n.detailClick({value:e,grid:t,rows:a,state:i})}),'<a class="detail'+e+'">'+e+"</a>"}},{name:"apply",index:"",width:90,align:"left",formatter:function(e,t,a,i){return 1==e?"供应商":"客户"}},{name:"code",index:"",width:100,align:"left"},{name:"status",index:"",width:80,align:"left",formatter:function(e,t,a,i){return 1==e?"有效":"无效"}},{name:"remark",index:"",width:80,align:"left"},{name:"createName",index:"",width:80,align:"left"},{name:"createTime",index:"",width:150,align:"left",sortable:!1}]}}},methods:{hideSearch:function(){this.isSearchHide=!this.isSearchHide,$(".chevron").css("top","")},search:function(){this.reload=!this.reload},add_click:function(){this.isShow=!0,this.isAdd=!0,this.isLock=!1},copy:function(){if(1===this.selected.length){var e=this.selected[0];e&&this.info(e,!1,!0)}else layer.alert("只能对单行数据操作!")},cancel:function(){this.saveDisable=!0,this.isShow=!1,this.isLock=!1,this.isAdd=!1,this.initAddBody(),$("#detailForm").validate().resetForm()},clear:function(){this.$refs.start.date="",this.$refs.end.date="",this.body={order:"",code:"",status:"",name:"",createName:"",createTimeStart:"",createTimeEnd:""}},modify:function(){if(1===this.selected.length){var e=this.selected[0];e&&this.info(e,!1,!1)}else layer.alert("只能对单行数据操作!")},save:function(){var e=contextPath+"/tclientlevel/save";this.add.id&&(e=contextPath+"/tclientlevel/update");if($("#detailForm").valid()){if(!this.saveDisable)return!1;this.saveDisable=!1;var t=this;$.ajax({type:"POST",url:e,contentType:"application/json",data:JSON.stringify(this.add),dataType:"json",success:function(e){"100100"===e.code?layer.alert("操作成功",{icon:1,end:function(){t.saveDisable=!0,t.cancel(),t.reload=!t.reload}}):(t.saveDisable=!0,layer.alert(e.msg,{icon:0}))},error:function(e){t.saveDisable=!0,layer.alert("网络异常，请稍后重试！",{icon:0})}})}},exit:function(){window.parent.closeCurrentTab({exit:!0,openTime:this.openTime})},del:function(){0!=this.selected.length?layer.confirm("当前数据有可能被引用，会影响数据准确性，确认是否删除？",{btn:["确认","取消"],btn1:function(){$.ajax({type:"POST",url:contextPath+"/tclientlevel/delete",contentType:"application/json",data:JSON.stringify(currencyVm.selected),dataType:"json",success:function(e){"100100"==e.code?(layer.alert(e.data,{icon:1}),currencyVm.selected=[],currencyVm.reload=!currencyVm.reload):layer.alert(e.msg,{icon:0})},error:function(e){layer.alert("网络异常，请重试！",{icon:0})}})}}):layer.alert("请选择行!")},detailClick:function(e){var t=e.rows.id;t&&this.info(t,!0,!1)},info:function(e,t,a){e&&$.ajax({type:"POST",url:contextPath+"/tclientlevel/info/"+e,contentType:"application/json",dataType:"json",async:!1,success:function(e){if("100100"===e.code){e=e.data;a?(currencyVm.add.status=e.status,currencyVm.add.remark=e.remark,currencyVm.add.apply=e.apply,currencyVm.add.createTime=(new Date).Format("yyyy-MM-dd hh:mm:ss"),currencyVm.isAdd=!0):currencyVm.add=e,currencyVm.isLock=t,currencyVm.isShow=!0}else layer.alert("操作失败",{icon:0})},error:function(e){layer.alert("操作失败",{icon:0})}})},initAddBody:function(){this.add={id:"",code:"",name:"",apply:1,status:1,createName:"",createTime:(new Date).Format("yyyy-MM-dd hh:mm:ss"),updateName:"",updateTime:"",remark:""},this.add.createName=this.username},initFormValidate:function(){var e={onfocusout:function(e){$(e).valid()},onkeyup:!1,rules:{code:{isChar:!0,required:!0,maxlength:30,remote:{url:contextPath+"/tclientlevel/validateCode",type:"post",dataType:"json",data:{id:function(){return currencyVm.add.id}},dataFilter:function(e,t){var a=JSON.parse(e);return"100100"===a.code?a.data:(layer.alert(a.msg),!1)}}},name:{required:!0,maxlength:30,remote:{url:contextPath+"/tclientlevel/validateCode",type:"post",dataType:"json",data:{id:function(){return currencyVm.add.id}},dataFilter:function(e,t){var a=JSON.parse(e);return"100100"===a.code?a.data:(layer.alert(a.msg),!1)}}},remark:{maxlength:255}},messages:{code:{required:"请填写编码!",maxlength:"编码最大长度为30！",remote:"该编码已存在!"},name:{required:"请填写名称!",maxlength:"编码最大长度为30！",remote:"该名称已存在!"},remark:{maxlength:"备注最大长度为255!"}}};$("#detailForm").validate(e)}},mounted:function(){this.initFormValidate(),this.username=layui.data("user").username,this.initAddBody(),jQuery.validator.addMethod("isChar",function(e,t){return/^([a-zA-Z0-9]+)$/.test(e)},"编码格式错误!"),this.openTime=window.parent.params.openTime}});