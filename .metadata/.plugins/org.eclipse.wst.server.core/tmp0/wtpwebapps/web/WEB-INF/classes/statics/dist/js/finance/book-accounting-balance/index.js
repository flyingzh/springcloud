"use strict";var vm=new Vue({el:"#app",data:function(){return{openTime:"",formData:{currencyId:-1,accountYear:0,accountPeriod:0,accountYearEnd:0,accountPeriodEnd:0,subjectIds:[],projectId:0,itemIds:[],includeVoucher:0,balanceZeroBlank:0,showAccruaZero:0},formDate:{subjectCode:"",accountYearPeriodStrat:"",accountYearPeriodEnd:"",subjectTypeName:"",projectTypeName:"",currencytypeName:"",currencyName:""},sumBeginBalance:"",sumBeginBalance1:"",sumDebit:"",sumCredit:"",sumYtdDebit:"",sumYtdCredit:"",sumEndBalance:"",sumEndBalance1:"",sumBeginBalanceFor:"",sumBeginBalanceFor1:"",sumDebitFor:"",sumCreditFor:"",sumYtdDebitFor:"",sumYtdCreditFor:"",sumEndBalanceFor:"",sumEndBalanceFor1:"",isFilterVisible:!1,subjectVisible:!1,accountingPeriod:[],accountingYear:[],currencyList:[],subjectList1:[],subjectList2:[],projectList:[],projectCodeList:[],baseData:{standardCurrencyId:0},base_config:{ExpandColumn:"username",styleUI:"Bootstrap",url:contextPath+"/financeBalance/accountingProjectBalances",ajaxGridOptions:{contentType:"application/json;charset=utf-8"},datatype:"json",postData:JSON.stringify(this.formData),jsonReader:{root:"data",cell:"data",userdata:"userdata",repeatitems:!1},treeReader:{level_field:"level",parent_id_field:"parent",leaf_field:"isLeaf",expanded_field:"expanded"},viewrecords:!0,rowNum:999,mtype:"POST",footerrow:!0,height:$(window).height()-230},colNames:[],colModel:[],colunm_config:[{startColumnName:"balanceDebit",numberOfColumns:2,titleText:"期初余额"},{startColumnName:"accrualDebit",numberOfColumns:2,titleText:"本期发生额"},{startColumnName:"grandTotalAccrualDebit",numberOfColumns:2,titleText:"本年累计发生额"},{startColumnName:"endingBalanceDebit",numberOfColumns:2,titleText:"期末余额"}],colunm_comfig1:[{startColumnName:"balanceDebit",numberOfColumns:4,titleText:"期初余额"},{startColumnName:"accrualDebit",numberOfColumns:4,titleText:"本期发生额"},{startColumnName:"grandTotalAccrualDebit",numberOfColumns:4,titleText:"本年累计发生额"},{startColumnName:"endingBalanceDebit",numberOfColumns:4,titleText:"期末余额"}],lodoPList:[]}},methods:{resetting:function(){this.formData.subjectIds=[],this.formDate.subjectCode=[]},renovate:function(){this.save()},getColSum:function(t){var e=$("td[aria-describedby='my_report_"+t+"']"),a=0;return e.each(function(t,e){a+=1e3*accounting.unformat($(e).text())}),a/=1e3,a=accounting.formatMoney(a,"",2)},subjectClose:function(){this.isFilterVisible=!0,this.$refs.filter.visible=!0,this.subjectVisible=!1},saveSubjectData:function(t){this.formData.subjectIds;this.formData.subjectIds.push(t.id),this.formDate.subjectCode+=(""==$.trim(this.formDate.subjectCode)?"":",")+t.subjectCode,console.log("this.formData.subjectIds",this.formData.subjectIds)},openModalSubject:function(){this.$refs.filter.visible=!0,this.subjectVisible=!0},formatNum:function(t){return accounting.formatMoney(t)},initMethod:function(){this.delTable(),this.colNames1=["项目代码","项目名称","借方","贷方","借方","贷方","借方","贷方","借方","贷方"],this.colModel=[{name:"itemCode",index:"itemCode",width:100,sortable:!1},{name:"itemName",index:"itemName",width:200,sortable:!1},{name:"balanceDebit",index:"balanceDebit",width:80,formatter:function(t,e,a,n){return null==t||0==t?"":accounting.formatNumber(t,2,",")}},{name:"balanceCredit",index:"balanceCredit",width:80,formatter:function(t,e,a,n){return null==t||0==t?"":accounting.formatNumber(t,2,",")}},{name:"accrualDebit",index:"accrualDebit",width:80,formatter:function(t,e,a,n){return null==t||0==t?"":accounting.formatNumber(t,2,",")}},{name:"accrualCredit",index:"accrualCredit",width:80,formatter:function(t,e,a,n){return null==t||0==t?"":accounting.formatNumber(t,2,",")}},{name:"grandTotalAccrualDebit",index:"grandTotalAccrualDebit",align:"right",width:90,formatter:function(t,e,a,n){return null==t||0==t?"":accounting.formatNumber(t,2,",")}},{name:"grandTotalAccrualCredit",index:"grandTotalAccrualCredit",align:"right",width:90,formatter:function(t,e,a,n){return null==t||0==t?"":accounting.formatNumber(t,2,",")}},{name:"endingBalanceDebit",index:"endingBalanceDebit",width:80,formatter:function(t,e,a,n){return null==t||0==t?"":accounting.formatNumber(t,2,",")}},{name:"endingBalanceCredit",index:"endingBalanceCredit",width:80,formatter:function(t,e,a,n){return null==t||0==t?"":accounting.formatNumber(t,2,",")}}],this.jqGridInit(this.colNames1,this.colModel,this.colunm_config)},initMethod1:function(){this.delTable(),this.colNames1=["项目代码","项目名称","借方原币","借方本位币","贷方原币","贷方本位币","借方原币","借方本位币","贷方原币","贷方本位币","借方原币","借方本位币","贷方原币","贷方本位币","借方原币","借方本位币","贷方原币","贷方本位币"],this.colModel=[{name:"itemCode",index:"itemCode",width:100,sortable:!1},{name:"itemName",index:"itemName",width:200,sortable:!1},{name:"balanceDebit",index:"balanceDebit",width:80,formatter:function(t,e,a,n){return null==t||0==t?"":accounting.formatNumber(t,2,",")}},{name:"balanceDebitFor",index:"balanceDebitFor",width:80,formatter:function(t,e,a,n){return null==t||0==t?"":accounting.formatNumber(t,2,",")}},{name:"balanceCredit",index:"balanceCredit",width:80,formatter:function(t,e,a,n){return null==t||0==t?"":accounting.formatNumber(t,2,",")}},{name:"balanceCreditFor",index:"balanceCreditFor",width:80,formatter:function(t,e,a,n){return null==t||0==t?"":accounting.formatNumber(t,2,",")}},{name:"accrualDebit",index:"accrualDebit",width:80,formatter:function(t,e,a,n){return null==t||0==t?"":accounting.formatNumber(t,2,",")}},{name:"accrualDebitFor",index:"accrualDebitFor",width:80,formatter:function(t,e,a,n){return null==t||0==t?"":accounting.formatNumber(t,2,",")}},{name:"accrualCredit",index:"accrualCredit",width:80,formatter:function(t,e,a,n){return null==t||0==t?"":accounting.formatNumber(t,2,",")}},{name:"accrualCreditFor",index:"accrualCreditFor",width:80,formatter:function(t,e,a,n){return null==t||0==t?"":accounting.formatNumber(t,2,",")}},{name:"grandTotalAccrualDebit",index:"grandTotalAccrualDebit",align:"right",width:90,formatter:function(t,e,a,n){return null==t||0==t?"":accounting.formatNumber(t,2,",")}},{name:"grandTotalAccrualDebitFor",index:"grandTotalAccrualDebitFor",align:"right",width:90,formatter:function(t,e,a,n){return null==t||0==t?"":accounting.formatNumber(t,2,",")}},{name:"grandTotalAccrualCredit",index:"grandTotalAccrualCredit",align:"right",width:90,formatter:function(t,e,a,n){return null==t||0==t?"":accounting.formatNumber(t,2,",")}},{name:"grandTotalAccrualCreditFor",index:"grandTotalAccrualCreditFor",align:"right",width:90,formatter:function(t,e,a,n){return null==t||0==t?"":accounting.formatNumber(t,2,",")}},{name:"endingBalanceDebit",index:"endingBalanceDebit",width:80,formatter:function(t,e,a,n){return null==t||0==t?"":accounting.formatNumber(t,2,",")}},{name:"endingBalanceDebitFor",index:"endingBalanceDebitFor",width:80,formatter:function(t,e,a,n){return null==t||0==t?"":accounting.formatNumber(t,2,",")}},{name:"endingBalanceCredit",index:"endingBalanceCredit",width:80,formatter:function(t,e,a,n){return null==t||0==t?"":accounting.formatNumber(t,2,",")}},{name:"endingBalanceCredit",index:"endingBalanceCreditFor",width:80,formatter:function(t,e,a,n){return null==t||0==t?"":accounting.formatNumber(t,2,",")}}],this.jqGridInit(this.colNames1,this.colModel,this.colunm_comfig1,this)},delTable:function(){$("#my_report").empty();var t=$(".jqGrid_wrapper");t.empty(),$("<table id='my_report'></table>").appendTo(t),$("<div id='my_pager'></div>").appendTo(t)},jqGridInit:function(t,e,a){var i=this,n=Object.assign({},this.base_config,{colNames:t,colModel:e,pager:"#my_pager",gridComplete:function(){jQuery("#my_report").jqGrid("destroyGroupHeader"),jQuery("#my_report").jqGrid("setGroupHeaders",{useColSpanStyle:!0,groupHeaders:a}),$(".ui-jqgrid-sortable").removeClass("ui-jqgrid-sortable"),window.top.home.loading("hide")},loadComplete:function(t){console.log(t,"===========xhr="),i.lodoPList=t.data||[],jQuery("#my_report").getGridParam("userData");var e=jQuery("#my_report").jqGrid("getGridParam","userData"),a="";"100100"===t.code?(a=t.msg,i.formDate.accountingPeriod=e.accountingPeriod,i.formDate.currencyName=e.currencyName,i.formDate.subject=e.subject):a=t.msg,i.$Message.info({content:a,duration:3})},onCellSelect:function(t,e,a,n){console.log(t,e,a,n,"===="),console.log("rowid",t,e,"null"===t,t<=0);var r=$("#my_report").jqGrid("getRowData",t);console.log("this.formDate.subjectCode",i.formData.balanceZeroBlank,i.formData.showAccruaZero);var o={name:"核算项目明细表",url:rcContextPath+"/finance/book-accounting-ledger/index.html?currency="+i.formData.currencyId+"&accountingYear="+i.formData.accountYear+"&accountingPeriod="+i.formData.accountPeriod+"&accountingYearEnd="+i.formData.accountYearEnd+"&accountingPeriodEnd="+i.formData.accountPeriodEnd+"&auxiliaryLists="+r.itemCode.toString()+"&subject="+i.formDate.subjectCode.toString()+"&accountingLevel="+i.formData.projectId+"&opt1="+i.formData.balanceZeroBlank+"&opt2="+i.formData.showAccruaZero};window.parent.activeEvent(o)}});jQuery("#my_report").jqGrid(n)},save:function(){var e=this;this.base_config.url=contextPath+"/financeBalance/accountingProjectBalances",this.base_config.postData=JSON.stringify(this.formData),this.formDate.accountYearPeriodStrat=this.formData.accountYear+"年第"+this.formData.accountPeriod+"期",this.formDate.accountYearPeriodEnd=this.formData.accountYearEnd+"年第"+this.formData.accountPeriodEnd+"期",this.formDate.subjectTypeName=this.formDate.subjectCode;var t=this.projectList.find(function(t){return t.id===e.formData.projectId});t&&(this.formDate.projectTypeName=t.projectAccountName+" | "+t.projectAccountCode);var a=this.currencyList.find(function(t){return t.value===e.formData.currencyId});a&&(this.formDate.currencytypeName=a.label);var n=this.formData.currencyId;-1==n||n===this.baseData.standardCurrencyId?this.initMethod():this.initMethod1(),this.cancel()},cancel:function(){this.$refs.filter.visible=!1,this.isFilterVisible=!1},more:function(t){console.log(t)},_currencyShow:function(){var e=this;$.ajax({type:"post",async:!0,data:"",url:contextPath+"/balance/currencyList",dataType:"json",success:function(t){"100100"===t.code&&(e.currencyList=t.data,e.baseData.standardCurrencyId=t.data[0].value,console.log("_this.currencyList",e.currencyList),e.accountShow())},error:function(t){console.log(t)}})},print:function(){if(vm.lodoPList&&vm.lodoPList.length){var t=vm.lodoPList,e="",a="",n="";-1===this.formData.currencyId||this.formData.currencyId===this.baseData.standardCurrencyId?(e='\n                <tr class=\'thCs\'>\n                    <th rowspan="2" style="width: 10%">项目编码</th>\n                    <th rowspan="2" style="width: 18%">项目名称</th>\n                    <th colspan="2" style="width: 12%">初期余额</th>\n                    <th colspan="2" style="width: 12%">本期发生额</th>\n                    <th colspan="2" style="width: 12%">本年累计发生额</th>\n                    <th colspan="2" style="width: 12%">期末余额</th>\n                </tr>\n                <tr class=\'thCs\'>\n                    <th style="width: 6%">借方</th>\n                    <th style="width: 6%">贷方</th>\n                    <th style="width: 6%">借方</th>\n                    <th style="width: 6%">贷方</th>\n                    <th style="width: 6%">借方</th>\n                    <th style="width: 6%">贷方</th>\n                    <th style="width: 6%">借方</th>\n                    <th style="width: 6%">贷方</th>\n                </tr>',t.forEach(function(t){a+="\n                    <tr>\n                        <td>"+t.itemCode+"</td>\n                        <td>"+t.itemName+"</td>\n                        <td>"+(0===t.balanceDebitFor?"":t.balanceDebitFor)+"</td>\n                        <td>"+(0===t.balanceCreditFor?"":t.balanceCreditFor)+"</td>\n                        <td>"+(0===t.accrualDebitFor?"":t.accrualDebitFor)+"</td>\n                        <td>"+(0===t.accrualCreditFor?"":t.accrualCreditFor)+"</td>\n                        <td>"+(0===t.grandTotalAccrualDebitFor?"":t.grandTotalAccrualDebitFor)+"</td>\n                        <td>"+(0===t.grandTotalAccrualCreditFor?"":t.grandTotalAccrualCreditFor)+"</td>\n                        <td>"+(0===t.endingBalanceDebitFor?"":t.endingBalanceDebitFor)+"</td>\n                        <td>"+(0===t.endingBalanceCreditFor?"":t.endingBalanceCreditFor)+"</td>\n                    </tr>\n                "})):(e='\n                <tr class=\'thCs\'>\n                    <th rowspan="2" style="width: 10%">项目编码</th>\n                    <th rowspan="2" style="width: 18%">项目名称</th>\n                    <th colspan="4" style="width: 12%">初期余额</th>\n                    <th colspan="4" style="width: 12%">本期发生额</th>\n                    <th colspan="4" style="width: 12%">本年累计发生额</th>\n                    <th colspan="4" style="width: 12%">期末余额</th>\n                </tr>\n                <tr class=\'thCs\'>\n                    <th style="width: 6%">借方原币</th>\n                    <th style="width: 6%">借方本位币</th>\n                    <th style="width: 6%">贷方原币</th>\n                    <th style="width: 6%">借方本位币</th>\n                    <th style="width: 6%">借方原币</th>\n                    <th style="width: 6%">借方本位币</th>\n                    <th style="width: 6%">贷方原币</th>\n                    <th style="width: 6%">借方本位币</th>\n                    <th style="width: 6%">借方原币</th>\n                    <th style="width: 6%">借方本位币</th>\n                    <th style="width: 6%">贷方原币</th>\n                    <th style="width: 6%">借方本位币</th>\n                    <th style="width: 6%">借方原币</th>\n                    <th style="width: 6%">借方本位币</th>\n                    <th style="width: 6%">贷方原币</th>\n                    <th style="width: 6%">借方本位币</th>\n                </tr>\n            ',t.forEach(function(t){a+="\n                    <tr>\n                        <td>"+t.itemCode+"</td>\n                        <td>"+t.itemName+"</td>\n                        <td>"+(0===t.balanceDebitFor?"":t.balanceDebitFor)+"</td>\n                        <td>"+(0===t.balanceDebit?"":t.balanceDebit)+"</td>\n                        <td>"+(0===t.balanceCreditFor?"":t.balanceCreditFor)+"</td>\n                        <td>"+(0===t.balanceCredit?"":t.balanceCredit)+"</td>\n                        <td>"+(0===t.accrualDebitFor?"":t.accrualDebitFor)+"</td>\n                        <td>"+(0===t.accrualDebit?"":t.accrualDebit)+"</td>\n                        <td>"+(0===t.accrualCreditFor?"":t.accrualCreditFor)+"</td>\n                        <td>"+(0===t.accrualCredit?"":t.accrualCredit)+"</td>\n                        <td>"+(0===t.grandTotalAccrualDebitFor?"":t.grandTotalAccrualDebitFor)+"</td>\n                        <td>"+(0===t.grandTotalAccrualDebit?"":t.grandTotalAccrualDebit)+"</td>\n                        <td>"+(0===t.grandTotalAccrualCreditFor?"":t.grandTotalAccrualCreditFor)+"</td>\n                        <td>"+(0===t.grandTotalAccrualCredit?"":t.grandTotalAccrualCredit)+"</td>\n                        <td>"+(0===t.endingBalanceDebitFor?"":t.endingBalanceDebitFor)+"</td>\n                        <td>"+(0===t.endingBalanceDebit?"":t.endingBalanceDebit)+"</td>\n                        <td>"+(0===t.endingBalanceCreditFor?"":t.endingBalanceCreditFor)+"</td>\n                        <td>"+(0===t.endingBalanceCredit?"":t.endingBalanceCredit)+"</td>\n                    </tr>\n                "})),n=0===t.length?'\n                    <tr class="ht-foot">\n                        <td>合计：</td>\n                        '+"<td>/td>".repeat(9)+"\n                    </tr>\n                    ":'\n                    <tr class="ht-foot">\n                        <td>合计：</td>\n                        <td></td>\n                        '+'<td tdata="SubSum" format="#,##0.00" align="right">###</td>'.repeat(8)+"\n                    </tr>\n                    ";var r={title:"核算科目余额表",template:12,titleInfo:[{name:"开始期间",val:this.formDate.accountYearPeriodStrat},{name:"结束期间",val:this.formDate.accountYearPeriodEnd},{name:"科目",val:this.formDate.subjectTypeName},{name:"项目类别",val:this.formDate.projectTypeName},{name:"币别",val:this.formDate.currencytypeName}],data:[],colMaxLenght:10,tbodyInfo:{theadTX:e,tbodyTX:a,tfootTX:n}};htPrint(r)}else vm.$Message.info({content:"无打印数据",duration:3})},accountShow:function(){var e=this;$.ajax({type:"post",async:!0,data:"",url:contextPath+"/accountBalanceSheet/getAccountYearAndPeriod",dataType:"json",success:function(t){"100100"===t.code&&(console.log(t),e.accountingPeriod=t.data.period,e.accountingYear=t.data.year,e.formData.accountYear=t.data.presents[0],e.formData.accountYearEnd=t.data.presents[0],e.formData.accountPeriod=t.data.presents[1],e.formData.accountPeriodEnd=t.data.presents[1],e.projectTypeShow())},error:function(t){console.log(t)}})},projectTypeShow:function(){var e=this;$.ajax({type:"post",async:!0,data:"",url:contextPath+"/financeBalance/getProjectList",dataType:"json",success:function(t){"100100"===t.code&&(console.log("res.data",t.data),e.projectList=t.data,e.formData.projectId=e.projectList[0].id,e.projectCodeShow())},error:function(t){console.log(t)}})},closeWindow:function(){window.parent.closeCurrentTab({name:"核算项目余额表",openTime:this.openTime,url:this.openTime,exit:!0})},projectCodeShow:function(){var e=this;console.log("_this.formData.projectId",e.formData.projectId),$.ajax({type:"post",async:!0,data:{subjectProjectId:e.formData.projectId},url:contextPath+"/accountBalanceSheet/getSubjectProject",dataType:"json",success:function(t){"100100"===t.code&&(e.projectCodeList=t.data,console.log("_this.projectCodeList",e.projectCodeList),e.save())},error:function(t){console.log(t)}})},exporting:function(){console.log("引出,导出 核算项目余额表...");var t=vm.formData;console.log(" vm.formData",vm.formData);var e="";for(var a in t)"itemIds"===a||"subjectIds"===a?0!==t[a].length&&(e+=a+"="+t[a]+"&"):e+=a+"="+t[a]+"&";e=e.slice(0,e.length-1),console.log("data",e),window.open(contextPath+"/financeBalance/derivation?"+e)},lookAtTheDetails:function(){},refresh:function(){window.top.home.loading("show"),this.save()}},mounted:function(){this.base_config.postData=JSON.stringify(this.formData),this._currencyShow(),this.openTime=window.parent.params&&window.parent.params.openTime}});