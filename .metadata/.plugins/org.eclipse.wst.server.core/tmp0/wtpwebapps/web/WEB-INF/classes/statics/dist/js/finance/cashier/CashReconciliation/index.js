"use strict";var vm=new Vue({el:"#cash-book",data:function(){return{formData:{subjectName:"",currencyName:"",periodDate:"",sobId:"",subjectId:"",currencyId:"",type:"1",dateTime:"",startYear:"",startPeriod:""},lodoPList:[],organisationList:[],filterVisible:!1,openTime:"",base_config:{mtype:"POST",styleUI:"Bootstrap",url:contextPath+"/cashier/reconciliationDetail",ajaxGridOptions:{contentType:"application/json;charset=utf-8"},datatype:"json",colNames:["项目","出纳管理系统","总账系统","差额","日期","实存金额"],colModel:[{name:"projectName",width:120},{name:"cashierMoney",width:150,align:"right",formatter:function(t,e,a){return null==t||0==t?"":accounting.formatNumber(t,2,",")}},{name:"accountMoney",width:150,align:"right",formatter:function(t,e,a){return null==t||0==t?"":accounting.formatNumber(t,2,",")}},{name:"differenceMoney",width:150,align:"right",formatter:function(t,e,a){return null==t||0==t?"":accounting.formatNumber(t,2,",")}},{name:"sheetDate",width:120,formatter:function(t,e,a){return null==t||0==t?"":t}},{name:"sheetMoney",width:150,align:"right",formatter:function(t,e,a){return null==t||0==t?"":accounting.formatNumber(t,2,",")}}],jsonReader:{root:"data.list"},height:$(window).height()-140,viewrecords:!0},currencyList:[],periodYear:[],periodList:[{name:"1",value:1},{name:"2",value:2},{name:"3",value:3},{name:"4",value:4},{name:"5",value:5},{name:"6",value:6},{name:"7",value:7},{name:"8",value:8},{name:"9",value:9},{name:"10",value:10},{name:"11",value:11},{name:"12",value:12}],subjectList:[]}},mounted:function(){this.initPage(),this.openTime=window.parent.params&&window.parent.params.openTime},methods:{initPage:function(){var r=this;$.ajax({type:"post",url:contextPath+"/cashier/reconciliationInit",dataType:"json",success:function(t){if(console.log(t),"100100"==t.code){var a=t.data;r.organisationList=a.org,r.currencyList=a.currencyList,r.subjectList=a.subjectList,r.periodYear=a.periodYear,r.formData.sobId=a.org[0].value,r.formData.subjectId=a.subjectList[0].accountId,r.formData.subjectName=a.subjectList[0].accountName,r.formData.currencyId=a.currencyList[0].id,$.each(r.currencyList,function(t,e){r.formData.currencyId==e.id&&(r.formData.currencyName=e.currencyName)}),r.formData.dateTime=a.endDate,$.each(a.periodYear,function(t,e){e.name==a.cnCurrentAccountYear&&(r.formData.startYear=e.value)}),$.each(r.periodList,function(t,e){e.name==a.cnCurrentAccountPeriod&&(r.formData.startPeriod=e.value)}),r.jqGridInit()}else layer.alert("页面初始化失败")}})},jqGridInit:function(){var e=this;e.operateData(e.formData.type);var t=Object.assign({},e.base_config,{postData:JSON.stringify(e.formData),loadComplete:function(t){e.lodoPList=t.data.list||[],jQuery("#grid").jqGrid("destroyGroupHeader"),jQuery("#grid").jqGrid("setGroupHeaders",{useColSpanStyle:!0,groupHeaders:[{startColumnName:"sheetDate",numberOfColumns:2,titleText:"现金盘点"}]})},gridComplete:function(){}});jQuery("#grid").jqGrid(t)},printV:function(){var e=this;if(console.log(e.lodoPList,"=========that.lodoPList"),e.lodoPList&&e.lodoPList.length){var t=e.lodoPList,a="";'\n                    <tr class=\'thCs\'>\n                        <th rowspan="2" style="width: 6%">项目</th>\n                        <th rowspan="2" style="width: 6%">出纳管理系统</th>\n                        <th rowspan="2" style="width: 6%">总账系统</th>\n                        <th rowspan="2" style="width: 6%">差额</th>\n                        <th colspan="2" style="width: 12%">现金盘点</th>\n                    </tr>\n                    <tr class=\'thCs\'>\n                        <th style="width: 6%">日期</th>\n                        <th style="width: 6%">实存金额</th>\n                    </tr>\n                ',t.forEach(function(t){a+="\n                        <tr>\n                            <td>"+t.projectName+"</td>\n                            <td>"+e.formartMoney(t.cashierMoney)+"</td>\n                            <td>"+e.formartMoney(t.accountMoney)+"</td>\n                            <td>"+e.formartMoney(t.differenceMoney)+"</td>\n                            <td>"+e._nullData(t.sheetDate)+"</td>\n                            <td>"+e.formartMoney(t.sheetMoney)+"</td>\n                        </tr>\n                    "}),'<tr class="ht-foot"><td>单位名称：金大祥</td></tr> ';var r={title:"现金对账",template:12,titleInfo:[{name:"科目",val:e.formData.subjectName},{name:"币别",val:e.formData.currencyName}],data:[],colMaxLenght:10,tbodyInfo:{theadTX:'\n                    <tr class=\'thCs\'>\n                        <th rowspan="2" style="width: 6%">项目</th>\n                        <th rowspan="2" style="width: 6%">出纳管理系统</th>\n                        <th rowspan="2" style="width: 6%">总账系统</th>\n                        <th rowspan="2" style="width: 6%">差额</th>\n                        <th colspan="2" style="width: 12%">现金盘点</th>\n                    </tr>\n                    <tr class=\'thCs\'>\n                        <th style="width: 6%">日期</th>\n                        <th style="width: 6%">实存金额</th>\n                    </tr>\n                ',tbodyTX:a,tfootTX:'<tr class="ht-foot"><td>单位名称：金大祥</td></tr> '}};htPrint(r)}else e.$Message.info({content:"无打印数据",duration:3})},_nullData:function(t){return t||""},formartMoney:function(t){return null==t||0==t?"":accounting.formatNumber(t,2,",")},open:function(){this.filterVisible=!0},currencyOption:function(a){var r=this;$.each(r.currencyList,function(t,e){a==e.id&&(r.formData.currencyName=e.currencyName)})},formatNum:function(t,e){var a=Math.pow(1e3,e);return parseInt(t*a,10)/a},operateData:function(t){this.formData.dateTime=new Date(this.formData.dateTime).format("yyyy-MM-dd"),1==t?this.formData.periodDate=this.formData.dateTime:2==t?this.formData.periodDate=this.formData.startYear+"年"+this.formData.startPeriod+"期":3==t&&(this.formData.periodDate=this.formData.startYear+"年"),this.formData.type=t},refresh:function(){this.operateData(this.formData.type),console.log(this.formData),$("#grid").jqGrid("clearGridData"),$("#grid").jqGrid("setGridParam",{mtype:"POST",postData:JSON.stringify(this.formData),ajaxGridOptions:{contentType:"application/json; charset=utf-8"},dataType:"json"}).trigger("reloadGrid")},save:function(){this.filterVisible=!1,this.refresh()},cancel:function(){this.filterVisible=!1},exitHtml:function(){window.parent.closeCurrentTab({name:"现金对账",openTime:this.openTime,exit:!0})}},computed:{currencyName:function(){var e=this,t=this.currencyList.find(function(t){return t.value===e.formData.currencyId});if(t)return t.label}},watch:{"formData.type":function(t){}}});