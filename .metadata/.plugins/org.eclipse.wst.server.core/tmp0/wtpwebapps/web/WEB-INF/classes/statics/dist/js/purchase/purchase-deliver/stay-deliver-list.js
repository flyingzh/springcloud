"use strict";var pendingDeliverList=new Vue({el:"#pendingDeliverList",data:function(){var a=this;return{openTime:"",isSearchHide:!0,isTabulationHide:!0,isShow:!1,isHide:!0,reload:!1,selected:[],categoryType:[],commodityCategoty:[],suppliers:[],dateArr:[],body:{supplierId:"",goodsTypePath:"",documentNo:"",startTime:"",endTime:""},data_config:{url:contextPath+"/purchaseDeliverController/firstlist",colNames:["源单类型","日期","单据编号","供应商","商品类型","送料重量","送料数量"],colModel:[{name:"businessType",index:"businessType",align:"left",width:330,formatter:function(e){return"调拨单-采购送料"}},{name:"transferTime",index:"transferTime",width:250,align:"left",formatter:function(e,t,i,o){return null==e||""==e?"":e.substring(0,10)}},{name:"documentNo",index:"documentNo",width:450,align:"left",formatter:function(e,t,i,o){return $(document).off("click",".detail"+e).on("click",".detail"+e,function(){a.testOrderDetailClick({value:e,grid:t,rows:i,state:o})}),'<a class="detail'+e+'">'+e+"</a>"}},{name:"supplierName",index:"supplierName",align:"left",width:360},{name:"goodsTypeName",index:"goodsTypeName",width:280,align:"left"},{name:"totalTransferWeigh",index:"totalTransferWeigh",width:280,align:"left"},{name:"totalTransferNum",index:"totalTransferNum",width:280,align:"left"}]}}},methods:{testOrderDetailClick:function(e){console.log(e);var t=e.rows.documentNo,i=e.rows;t&&this.queryRequisitionByDocumentNo(t,!0,i)},queryRequisitionByDocumentNo:function(e,t,i){window.parent.activeEvent({name:"查看调拨单",url:contextPath+"/warehouse/requisition/requisition-info.html",params:{activeType:"listQuery",documentNo:e}})},loadSuppliers:function(){var t=this;$.ajax({type:"post",url:contextPath+"/tpurchasecollectgoods/findSupplierByOrgId",dataType:"json",success:function(e){t.suppliers=e.data},error:function(){t.$Modal.error({context:"系统出现异常,请联系管理人员"})}})},search:function(){0<this.commodityCategoty.length?this.body.goodsTypeName=this.commodityCategoty[this.commodityCategoty.length-1]:this.body.goodsTypeName="",0<this.dateArr.length&&this.dateArr[0]&&this.dateArr[1]?(this.body.startTime=this.dateArr[0].format("yyyy-MM-dd")+" 00:00:00",this.body.endTime=this.dateArr[1].format("yyyy-MM-dd")+" 23:00:00"):(this.body.startTime="",this.body.endTime=""),this.reload=!this.reload},loadProductType:function(){var t=this;$.ajax({type:"post",url:contextPath+"/documentController/getCategory?parentId=0",contentType:"application/json",dataType:"json",success:function(e){t.categoryType=t.initGoodCategory(e.data.cateLists)},error:function(e){console.log("服务器出错")}})},changeProductType:function(e,t){var i=t[t.length-1];this.body.goodsTypePath=i.value},initGoodCategory:function(e){var a=this,n=[];return e.forEach(function(e){var t=e.customCode,i=e.name,o=e.cateLists;o&&(o=a.initGoodCategory(o)),n.push({value:t,label:i,children:o})}),n.forEach(function(e){e.children||delete e.children}),n},clear:function(){this.dateArr=[],this.body.supplierId="",this.body.goodsTypePath="",this.body.documentNo="",this.body.startTime="",this.body.endTime=""},refresh:function(){this.clear(),this.selected=[],this.reload=!this.reload},generateReport:function(){var e=!0;if(this.selected.length<1)this.$Modal.warning({title:"提示信息",content:"请先选择至少一条数据！"});else{e:for(var t in this.selected)for(var i in this.selected){if(this.selected[t].sourceType!=this.selected[i].sourceType){this.$Modal.warning({title:"提示信息",content:"源单类型不一致，请重新选择！"}),e=!1;break e}if(this.selected[t].supplierName!=this.selected[i].supplierName){this.$Modal.warning({title:"提示信息",content:"供应商不一致，请重新选择！"}),e=!1;break e}if(this.selected[t].goodsTypeName!=this.selected[i].goodsTypeName){this.$Modal.warning({title:"提示信息",content:"商品类型不一致，请重新选择！"}),e=!1;break e}}var o={ids:{}},a=[];for(var n in this.selected)a.push(this.selected[n].id);o.ids=a.join(",");var r=this.selected;e&&$.ajax({url:contextPath+"/purchaseDeliverController/generateDeliverOrder",method:"post",dataType:"json",data:o,success:function(e){"100100"===e.code?(e.data.supplierName=r[0].supplierName,e.data.supplierCode=r[0].supplierCode,window.parent.activeEvent({name:"新增采购送料单",url:contextPath+"/purchase/purchase-deliver/deliver-add.html",params:{type:"generate",goodsData:e.data}})):layer.alert(e.msg,{icon:0})},error:function(e){layer.alert("生成采购送料单失败！",{icon:0})}})}},changeCategory:function(e){console.log(e),console.log(e[e.length-1])},cancel:function(){window.parent.closeCurrentTab({name:"",openTime:this.openTime,exit:!0})}},created:function(){this.loadProductType(),this.loadSuppliers()},watch:{},mounted:function(){this.openTime=window.parent.params.openTime}});