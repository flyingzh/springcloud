"use strict";function _toConsumableArray(e){if(Array.isArray(e)){for(var t=0,a=Array(e.length);t<e.length;t++)a[t]=e[t];return a}return Array.from(e)}function _defineProperty(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}Date.prototype.format=function(e){var t={"M+":this.getMonth()+1,"d+":this.getDate(),"h+":this.getHours(),"m+":this.getMinutes(),"s+":this.getSeconds(),"q+":Math.floor((this.getMonth()+3)/3),S:this.getMilliseconds()};for(var a in/(y+)/.test(e)&&(e=e.replace(RegExp.$1,(this.getFullYear()+"").substr(4-RegExp.$1.length))),t)new RegExp("("+a+")").test(e)&&(e=e.replace(RegExp.$1,1==RegExp.$1.length?t[a]:("00"+t[a]).substr((""+t[a]).length)));return e};var releaseOrder=new Vue({el:"#releaseOrder",data:function(){var e;return _defineProperty(e={approveComment:!1,rejectComment:!1,approvement:{receiptsId:"",approvalResult:1,approvalInfo:"",boeId:""},rejectement:{receiptsId:"",approvalResult:"0",approvalInfo:"",boeId:""},isStampShow:!1,showApproval:!0,showReject:!0,boeType:"specialReleaseOrder",steplist:[],stepData:[{currentLevel:0,subtitle:"开始"},{currentLevel:1,subtitle:"一级审批"},{currentLevel:2,subtitle:"二级审批"},{currentLevel:3,subtitle:"三级审批"},{currentLevel:4,subtitle:"四级审批"},{currentLevel:5,subtitle:"五级审批"},{currentLevel:6,subtitle:"六级审批"},{currentLevel:7,subtitle:"结束"}],currentStep:"",nextStep:"",data_config_approval:{url:contextPath+"/specialReleaseDocument/queryReceiptsById",colNames:["操作类型","开始级次","目的级次","审批人","审批意见","审批时间"],colModel:[{name:"approvalResult",index:"lotSize",width:215,align:"center",formatter:function(e,t,a,o){return 1==e?"审核":"驳回"}},{name:"currentLevel",index:"samplingRatio",width:215,align:"center",formatter:function(e,t,a,o){return 1===e?"一级审核":2===e?"二级审核":3===e?"三级审核":4===e?"四级审核":5===e?"五级审核":6===e?"六级审核":""}},{name:"nextLevel",index:"acceptance",width:210,align:"center",formatter:function(e,t,a,o){return"1"===e?"一级审核":"2"===e?"二级审核":"3"===e?"三级审核":"4"===e?"四级审核":"5"===e?"五级审核":"6"===e?"六级审核":"结束"}},{name:"createName",index:"rejected asc, invdate",width:215,align:"center"},{name:"approvalInfo",index:"rejected asc, invdate",width:215,align:"center"},{name:"createTime",index:"rejected asc, invdate",width:215,align:"center"}],jsonReader:{root:"data.data"},multiselect:!1},applicationReasonsDisabled:!1,ishttpOK:!1,isSave:!1,openTime:"",showDepartment:!1,releaseDisable:!1,isConfirmer:!1,showDepartmentModal:!1,department_selected:[],formDataInit:{},formData:{id:null,code:"",documentTime:(new Date).format("yyyy/MM/dd")||"",documentStatus:"暂存",departmentName:"",departmentId:0,applicantName:"",documentType:"",sourceDocumentCode:"",qcDocumentId:"",qcDocumentCode:"",supplierCustomerCode:"",qcConclusion:"",applyReason:"",confirmer:"",riskEstimate:"",createName:"",createTime:"",updateName:"",updateTime:"",examineVerifyId:0,examineVerifyName:"",examineVerifyDate:"",examineVerifyTime:"",step:1,unqualifiedStyleVoList:[],ids:[]},uVoListSelectDelete:[],uDelete:[],documentStatusList:[],getDocumentTypeList:[],queryAllEmpByDeptIdList:[],documentTypeList:[{label:"暂存",value:"temporary_save"},{label:"待审核",value:"await_check"},{label:"审核中",value:"checking"},{label:"放行通过",value:"auditing"},{label:"驳回",value:"bohui"}],status:[{label:"有效",value:1},{label:"无效",value:0}],unqualifiedStyleVoListColumns:[{type:"selection",width:60,align:"center"},{type:"index",width:100,align:"center",title:"序号"},{title:"商品编码",key:"productCode"},{title:"商品名称",key:"productName"},{title:"商品类型",key:"productTypeName"},{title:"不合格数",key:"unqualifiedAmount",className:"ht-number-right"},{title:"合格率",key:"qualifiedPercent",className:"ht-number-right",render:function(e,t){var a=t.row.qualifiedPercent;return console.log(t.row.qualifiedPercent,"=======params.row.qualifiedPercent"),e("div",{props:{}},a+"%")}},{title:"检验结果描述/建议",key:"resultDescribeSuggest"},{title:"特别放行数量",key:"releaseCount",className:"ht-number-right",render:function(e,t){var a=releaseOrder.formData.unqualifiedStyleVoList[t.index].releaseCount,o=releaseOrder.formData.unqualifiedStyleVoList[t.index].unqualifiedAmount,n=0===a||""===a||void 0===a?o:a;return console.log(a,"====_t"),console.log(o,"====_t"),console.log(n,"====_t"),e("div",[e("i-input",{props:{type:"text",disabled:"已审核"===releaseOrder.formData.documentStatus||"待审核"===releaseOrder.formData.documentStatus||"审核中"===releaseOrder.formData.documentStatus,value:n},on:{"on-blur":function(e){releaseOrder.formData.unqualifiedStyleVoList[t.index].releaseCount=e.target.value}}})])}},{title:"申请原因",key:"aReason",render:function(e,t){return e("div",[e("i-input",{props:{type:"text",disabled:"已审核"===releaseOrder.formData.documentStatus||"待审核"===releaseOrder.formData.documentStatus||"审核中"===releaseOrder.formData.documentStatus,value:releaseOrder.formData.unqualifiedStyleVoList[t.index].aReason},on:{"on-blur":function(e){releaseOrder.formData.unqualifiedStyleVoList[t.index].aReason=e.target.value}}})])}}],unqualifiedStyleVoList:[],currentSteps:2,queryalldeptList:[],treeSetting:{callback:{onClick:this.treeClickCallBack,beforeClick:this.treeBeforeClick}}},"steplist",[]),_defineProperty(e,"stepCur",0),_defineProperty(e,"approvalValue1",""),_defineProperty(e,"approvalValue1L",""),_defineProperty(e,"approvalValue2",""),_defineProperty(e,"approval1",!1),_defineProperty(e,"approval2",!1),_defineProperty(e,"approvalRadio","1"),_defineProperty(e,"currentLevelTxt",""),_defineProperty(e,"currentLevelTxtNext",""),_defineProperty(e,"showSourceModal",!1),e},methods:{showTypeCode:function(){this.showSourceModal=!this.showSourceModal},closeSourceModal:function(){this.showSourceModal=!1},approvalIndex:function(){console.log("*************************************");var a=this;if(""===a.formData.code||"暂存"===a.formData.documentStatus)return layer.alert("请提交放行单!"),!1;a.initApproval(),$.ajax({type:"POST",url:contextPath+"/specialReleaseDocument/findUserOperation",contentType:"application/json",data:JSON.stringify({receiptsId:a.formData.code,docTypeCode:"fxd"}),dataType:"json",success:function(e){if(console.log(e),"100515"===e.code&&(layer.alert("审核成功"),a.formData.documentStatus="已审核",a.saveMethod()),"100514"===e.code){var t=1===e.data?"【一级审核】":2===e.data?"【二级审核】":3===e.data?"【三级审核】":4===e.data?"【四级审核】":5===e.data?"【五级审核】":6===e.data?"【六级审核】":e.msg;layer.alert(0===e.data?"该单据已被驳回到申请人，待申请人提交!":"您没有"+t+"的审核权限")}if("100100"===e.code){if("已审核"===a.formData.documentStatus)return layer.alert("此单已审核"),!1;a.approveComment=!0}},error:function(e){layer.alert("服务器出错")}})},reject:function(){var a=this;return""===a.formData.code||"暂存"===a.formData.documentStatus?(layer.alert("请提交放行单!"),!1):"已审核"==a.formData.documentStatus?(layer.alert(" 单据已经审核完成!"),!1):void $.ajax({type:"POST",url:contextPath+"/specialReleaseDocument/findUserOperation",contentType:"application/json",data:JSON.stringify({receiptsId:a.formData.code,docTypeCode:"fxd"}),dataType:"json",success:function(e){if("100100"===e.code&&(a.rejectComment=!0),"100514"===e.code){var t=1===e.data?"【一级审核】":2===e.data?"【二级审核】":3===e.data?"【三级审核】":4===e.data?"【四级审核】":5===e.data?"【五级审核】":6===e.data?"【六级审核】":e.msg;layer.alert(0===e.data?"该单据已被驳回到申请人，待申请人提交!":"您没有"+t+"的驳回权限")}"100515"===e.code&&(layer.alert("驳回成功"),a.formData.documentStatus="驳回",a.saveMethod())},error:function(e){layer.alert("服务器出错")}})},getApproveInfo:function(){var t=this;t.approvement.receiptsId=t.formData.code,t.approvement.boeId=t.formData.id,$.ajax({type:"POST",url:contextPath+"/specialReleaseDocument/submitapproval",contentType:"application/json",data:JSON.stringify(this.approvement),dataType:"json",success:function(e){"100100"===e.code?(layer.alert("审核成功"),0===e.data.approvalStatus&&(t.formData.documentStatus="审核中"),1===e.data.approvalStatus&&(t.formData.documentStatus="已审核",t.isStampShow=!0,t.formData.examineVerifyName=e.data.examineVerifyName,t.formData.examineVerifyTime=e.data.examineVerifyDate),t.saveMethod(),t.initApproval(),t._pageInit(t.approvement.receiptsId),t.approvement={receiptsId:"",approvalResult:1,approvalInfo:"",boeId:""}):layer.alert("审核失败")},error:function(e){layer.alert("服务器出错")}})},getRejectInfo:function(){var t=this;t.rejectement.receiptsId=t.formData.code,t.rejectement.boeId=t.formData.id,$.ajax({type:"POST",url:contextPath+"/specialReleaseDocument/submitapproval",contentType:"application/json",data:JSON.stringify(t.rejectement),dataType:"json",success:function(e){"100100"===e.code?(layer.alert("驳回成功"),-2===e.data.approvalStatus?(t.formData.documentStatus="暂存",t.releaseDisable=!1,t.applicationReasonsDisabled=!1,t.riskEstimateDisabled=!0):t.formData.documentStatus="驳回",t.saveMethod(),t.isStampShow=!1):layer.alert("驳回失败"),t.initApproval(),t._pageInit(t.approvement.receiptsId),t.rejectement={receiptsId:"",approvalResult:"0",approvalInfo:"",boeId:""}},error:function(e){layer.alert("服务器出错")}})},saveMethod:function(){var e=JSON.stringify({id:this.formData.id,documentStatus:this.formData.documentStatus});console.log(JSON.stringify({id:this.formData.id,documentStatus:this.formData.documentStatus})),$.ajax({type:"POST",url:contextPath+"/specialReleaseDocument/updateStatusByApproval",contentType:"application/json",data:e,dataType:"json",success:function(e){console.log("修改成功")},error:function(e){layer.alert("服务器出错")}})},initApproval:function(){var i=this;$.ajax({type:"post",url:contextPath+"/specialReleaseDocument/queryProcessInfoByReceiptsId",data:JSON.stringify({receiptsId:i.formData.code}),contentType:"application/json",dataType:"json",success:function(e){if($.isEmptyObject(e.data))return console.log("没有流程"),!1;for(var t=e.data.list,a=0;a<t.length;a++)switch(t[a].processLevel){case 1:t[a].processLevel="一级审核";break;case 2:t[a].processLevel="二级审核";break;case 3:t[a].processLevel="三级审核";break;case 4:t[a].processLevel="四级审核";break;case 5:t[a].processLevel="五级审核";break;case 6:t[a].processLevel="六级审核"}if(t.unshift({processLevel:"开始"}),t.push({processLevel:"结束"}),(i.steplist=t)[1].currentLevel===e.data.levelLength){for(var o=0;o<t.length;o++)t[o].currentLevel=t.length-1;return!1}for(var n=t[1].currentLevel,r=0;r<i.stepData.length;r++)n===i.stepData[r].currentLevel&&(i.currentStep=i.stepData[r+1].subtitle,i.stepData[r+1].currentLevel===e.data.levelLength?i.nextStep=i.stepData[i.stepData.length-1].subtitle:i.nextStep=i.stepData[r+2].subtitle)},error:function(){alert("服务器出错啦")}})},treeClickCallBack:function(e,t,a){this.formData.departmentName=a.name,this.formData.departmentId=a.id,this.showDepartment=!1,this.formData.applicantName="",this._ajaxqueryAllEmpByDeptId(this.formData.departmentId)},treeBeforeClick:function(e,t,a){return!t.isParent},showDepartmentTree:function(e){this.showDepartment!==e?this.showDepartment=e:this.showDepartment=""},_ajaxInitEcho:function(e,t){var a=this,o=contextPath+"/specialReleaseDocument/echo?r="+(new Date).getTime(),n="1"===t?{qcDocumentCode:e}:{id:e};$.ajax({type:"post",url:o,data:n,dataType:"json",success:function(e){if(console.log(e),"100100"===e.code)if(a.getAccess(e.data.id,a.boeType),"已审核"===e.data.documentStatus&&(a.isStampShow=!0,a.formData.examineVerifyName=e.data.examineVerifyName,a.formData.examineVerifyTime=e.data.examineVerifyDate),"1"===t)a.formDataInit.unqualifiedStyleVoList=[].concat(_toConsumableArray(e.data.unqualifiedStyleVoList)),e.data.unqualifiedStyleVoList.map(function(e,t){e.releaseCount||(e.releaseCount=e.unqualifiedAmount)}),a.formData.unqualifiedStyleVoList=[].concat(_toConsumableArray(e.data.unqualifiedStyleVoList)),a.formData.qcDocumentId=e.data.qcDocumentId,a.isEdit("Y");else{e.data.unqualifiedStyleVoList;a.formDataInit.unqualifiedStyleVoList=[].concat(_toConsumableArray(e.data.unqualifiedStyleVoList)),e.data.unqualifiedStyleVoList.map(function(e,t){e.releaseCount||(e.releaseCount=e.unqualifiedAmount)}),a.formData.unqualifiedStyleVoList=[].concat(_toConsumableArray(e.data.unqualifiedStyleVoList)),a.formDataInit=Object.assign({},e.data),a.formData=Object.assign({},e.data,{examineVerifyName:e.data.examineVerifyName,examineVerifyTime:e.data.examineVerifyDate}),a.initApproval(),a._pageInit(e.data.code),a._ajaxqueryAllEmpByDeptId(a.formData.departmentId),a.formData.applicantName=e.data.applicantName,""===a.formData.confirmer&&("待审核"!==a.formData.documentStatus&&"审核中"!==a.formData.documentStatus||a._ajaxqueryConfirmer()),"驳回"!==a.formData.documentStatus&&"待审核"!==a.formData.documentStatus&&"审核中"!==a.formData.documentStatus&&"已审核"!==a.formData.documentStatus||(a.releaseDisable=!0,a.applicationReasonsDisabled=!0),"暂存"===a.formData.documentStatus&&a.isEdit("Y")}},error:function(){alert("服务器出错啦")}})},_ajaxqueryConfirmer:function(){var t=this,e=contextPath+"/specialReleaseDocument/getConfirmer?r="+(new Date).getTime();$.ajax({type:"post",url:e,data:"",dataType:"json",success:function(e){console.log(e),"100100"===e.code&&(t.formData.confirmer=e.data)},error:function(){alert("服务器出错啦")}})},_pageInit:function(e){jQuery("#queryReceiptsByIdlist").jqGrid({url:contextPath+"/specialReleaseDocument/queryReceiptsById",postData:{receiptsId:e},datatype:"json",colNames:["操作类型","开始级次","目的级次","审批人","审批意见","审批时间"],colModel:[{name:"approvalResult",index:"lotSize",width:120,align:"center",formatter:function(e,t,a,o){return 1==e?"审核":"驳回"}},{name:"currentLevel",index:"samplingRatio",width:120,align:"center",formatter:function(e,t,a,o){return 1===e?"一级审核":2===e?"二级审核":3===e?"三级审核":4===e?"四级审核":5===e?"五级审核":6===e?"六级审核":""}},{name:"nextLevel",index:"acceptance",width:210,align:"center",formatter:function(e,t,a,o){return"1"===e?"一级审核":"2"===e?"二级审核":"3"===e?"三级审核":"4"===e?"四级审核":"5"===e?"五级审核":"6"===e?"六级审核":"结束"}},{name:"createName",index:"rejected asc, invdate",width:215,align:"center"},{name:"approvalInfo",index:"rejected asc, invdate",width:215,align:"center"},{name:"createTime",index:"rejected asc, invdate",width:215,align:"center"}],rowNum:999999999,mtype:"post",jsonReader:{root:"data"},multiselect:!1,multiselectWidth:0,styleUI:"Bootstrap",height:.7*$(window).height(),viewrecords:!0,gridComplete:function(){console.log(5555)}}).trigger("reloadGrid")},_ajaxqueryTestDocumentBySourceCode:function(e,a){var o=this,t=contextPath+"/testDocument/queryTestDocumentBySourceCode?r="+(new Date).getTime(),n={code:e};$.ajax({type:"post",url:t,data:n,dataType:"json",success:function(e){console.log(e);var t=e.data.data[0];"100100"===e.code&&(o.formData.documentType=t.sourceDocumentType,o.formData.sourceDocumentCode=t.sourceDocumentCode,o.formData.qcDocumentId=t.qcDocumentId,o.formData.qcDocumentCode=t.documentCode,o.formData.supplierCustomerCode=t.supplierOrCustomerCode,o.formData.qcConclusion=t.totalTestConclusion,o._ajaxInitEcho(o.formData.qcDocumentCode,a))},error:function(){alert("服务器出错啦")}})},_ajaxlistByPage:function(e){var t=contextPath+"/documentController/list?r="+(new Date).getTime();$.ajax({type:"post",url:t,data:{alreadyTest:1,page:1,limit:10},dataType:"json",success:function(e){console.log(e),e.code},error:function(){alert("服务器出错啦")}})},_ajaxgetFieldCode:function(){var t=this,e=contextPath+"/specialReleaseDocument/getFieldCode?r="+(new Date).getTime();$.ajax({type:"post",url:e,dataType:"json",success:function(e){console.log(e),"100100"===e.code&&(t.formData.code=e.data["t_qc_special_release_document-code"],t.$nextTick(function(){t.formData.documentStatus="暂存"}))},error:function(){alert("服务器出错啦")}})},_ajaxgetDocumentStatus:function(){var t=this,e=contextPath+"/specialReleaseDocument/getDocumentStatus?r="+(new Date).getTime();$.ajax({type:"post",url:e,dataType:"json",success:function(e){console.log(e),"100100"===e.code&&(t.documentStatusList=e.data)},error:function(){alert("服务器出错啦")}})},_ajaxgetDocumentType:function(){var t=this,e=contextPath+"/specialReleaseDocument/getDocumentType?r="+(new Date).getTime();$.ajax({type:"post",url:e,dataType:"json",success:function(e){console.log(e),"100100"===e.code&&(t.getDocumentTypeList=e.data,console.log(e.data))},error:function(){alert("服务器出错啦")}})},_ajaxqueryAllEmpByDeptId:function(e){var t=this,a=contextPath+"/specialReleaseDocument/queryAllEmpByDeptId?r="+(new Date).getTime(),o={deptId:e};$.ajax({type:"post",url:a,data:o,dataType:"json",success:function(e){console.log(e),"100100"===e.code&&(t.queryAllEmpByDeptIdList=e.data)},error:function(){alert("服务器出错啦")}})},_ajaxqueryalldept:function(){var t=this,e=contextPath+"/specialReleaseDocument/queryalldept?r="+(new Date).getTime();$.ajax({type:"post",url:e,dataType:"json",success:function(e){if(console.log(e),"100100"===e.code){var a=[];e.data.forEach(function(e){var t={id:e.id,name:e.depName,pId:e.parentId};a.push(t)}),t.queryalldeptList=a,t.$nextTick(function(){t.$refs.department.loadData()})}},error:function(){alert("服务器出错啦")}})},isSourceDocument:function(t,a){var o=this;$.ajax({type:"post",url:contextPath+"/specialReleaseDocument/isSourceDocument",data:{sourceDocumentCode:o.formData.sourceDocumentCode,code:o.formData.code},dataType:"json",success:function(e){"100100"==e.code?"submit"===t?o.submit():o.save(a):alert(e.msg)},error:function(){}})},save:function(e){var a=this;a.ishttpOK=!0;var t=contextPath+"/specialReleaseDocument/update?r="+(new Date).getTime();a.uDelete=a.uDelete.filter(function(t){return a.formDataInit.unqualifiedStyleVoList.filter(function(e){return e.productStyleId===t}).length}),null==a.formData.unqualifiedStyleVoList&&(a.formData.unqualifiedStyleVoList=[]);for(var o=a.formData.unqualifiedStyleVoList,n=0;n<o.length;n++)o[n]&&o[n].qualifiedPercent&&-1!=o[n].qualifiedPercent.toString().indexOf("%")&&(o[n].qualifiedPercent=parseInt(o[n].qualifiedPercent.replace(/%/g,"")),o[n].qualifiedPercent=o[n].qualifiedPercent/100);var r={tQcSpecialReleaseDocumentEntity:a.formData,ids:a.uDelete,detailApplyReasonList1:o,btn:e};r.detailApplyReasonList1=a.formData.unqualifiedStyleVoList.filter(function(e){return e.aReason=e.aReason||"",e.releaseCount=Number.parseInt(e.releaseCount)||0,e}),console.log(r,"===_info"),$.ajax({type:"post",url:t,data:JSON.stringify(r),contentType:"application/json;charset=utf-8",dataType:"json",success:function(e){"100100"===e.code&&(layer.alert("保存成功!"),a.formData.id=e.data.id,a.formData.createName="超级管理员",a.formData.createTime=(new Date).format("yyyy/MM/dd hh:mm:ss"),a.formData.code=e.data.code,a.saveAccess(e.data.id,a.boeType)),setTimeout(function(){a.ishttpOK=!1},1e3)},error:function(){setTimeout(function(){a.ishttpOK=!1},1e3),alert("服务器出错啦")}})},saveEV:function(e){var a=this;if(1!=a.ishttpOK||2==e){a.ishttpOK=!0;var t=contextPath+"/specialReleaseDocument/update?r="+(new Date).getTime();a.uDelete=a.uDelete.filter(function(t){return a.formDataInit.unqualifiedStyleVoList.filter(function(e){return e.productStyleId===t}).length});var o={tQcSpecialReleaseDocumentEntity:a.formData,btn:e};o.detailApplyReasonList1=a.formData.unqualifiedStyleVoList.filter(function(e){return e.aReason=e.aReason||"",e.releaseCount=Number.parseInt(e.releaseCount)||0,e}),console.log(o,"===_info"),$.ajax({type:"post",url:t,data:JSON.stringify(o),contentType:"application/json;charset=utf-8",dataType:"json",success:function(e){"100100"===e.code?layer.alert("提交成功!"):layer.alert("提交失败!")}})}},cancal:function(){var e=getUrlParam("type");console.log(e),"1"===e?window.parent.closeCurrentTab({name:"生成特别放行单",openTime:this.openTime,exit:!0}):"2"===e?window.parent.closeCurrentTab({name:"新增特别放行单",openTime:this.openTime,exit:!0}):"3"===e&&window.parent.closeCurrentTab({name:"修改特别放行单",openTime:this.openTime,exit:!0})},add:function(){window.parent.closeCurrentTab({name:"生成特别放行单",openTime:this.openTime,exit:!0}),window.parent.activeEvent({name:"新增特别放行单",url:contextPath+"/quality/quality/specialReleaseDocumentInfo.html?type=2"})},submit:function(){var a=this,e=!1,t="请填写必填项。";if(""===a.formData.documentTime?(e=!0,t="请选择单据日期"):""===a.formData.departmentName?(e=!0,t="请选择申请部门"):""===a.formData.applicantName?(e=!0,t="请选择申请人"):""===a.formData.documentType?(e=!0,t="请选择源单类型"):""===a.formData.sourceDocumentCode?(e=!0,t="请选择源单单号"):""===a.formData.qcDocumentCode?(e=!0,t="请选择检验单号"):""===a.formData.applyReason&&(e=!0,t="请填写申请原因"),"驳回"!==a.formData.documentStatus&&"待审核"!==a.formData.documentStatus&&"审核中"!==a.formData.documentStatus&&"已审核"!==a.formData.documentStatus||(e=!0,t="单据已进入审批流,不可再提交!"),e)a.$Message.info({content:t,duration:3});else{var o=contextPath+"/specialReleaseDocument/save?r="+(new Date).getTime();if(1!=a.ishttpOK){a.ishttpOK=!0,a.uDelete=a.uDelete.filter(function(t){return a.formDataInit.unqualifiedStyleVoList.filter(function(e){return e.productStyleId===t}).length});for(var n=a.formData.unqualifiedStyleVoList,r=0;r<n.length;r++)n[r]&&n[r].qualifiedPercent&&-1!=n[r].qualifiedPercent.toString().indexOf("%")&&(n[r].qualifiedPercent=parseInt(n[r].qualifiedPercent.replace(/%/g,"")),n[r].qualifiedPercent=n[r].qualifiedPercent/100);var i={tQcSpecialReleaseDocumentEntity:a.formData,ids:a.uDelete,detailApplyReasonList1:[]};i.detailApplyReasonList1=a.formData.unqualifiedStyleVoList.filter(function(e){return e.aReason=e.aReason||"",e.releaseCount=Number.parseInt(e.releaseCount)||0,e}),$.ajax({type:"post",url:o,data:JSON.stringify(i),contentType:"application/json;charset=utf-8",dataType:"json",success:function(e){"100100"===e.code?(layer.alert("提交成功!"),a.releaseDisable=!0,a.applicationReasonsDisabled=!0,a.riskEstimate=!1,a.formData.id=e.data.id,a.formData.code=e.data.code,a.formData.documentStatus="待审核",a.formData.createName="超级管理员",a.formData.createTime=(new Date).format("yyyy/MM/dd hh:mm:ss"),a.formData.updateName="超级管理员",a.formData.updateTime=(new Date).format("yyyy/MM/dd hh:mm:ss"),a.saveMethod(),a.saveAccess(e.data.id,a.boeType),a.isEdit("N"),a.initApproval(),a._pageInit(e.data.code)):layer.alert("该源单单号已存在对应的特别放行单，请重新选择!"),setTimeout(function(){a.ishttpOK=!1},1e3)},error:function(){setTimeout(function(){a.ishttpOK=!1},1e3),alert("服务器出错啦")}})}}},showlist:function(){window.parent.activeEvent({name:"特别放行单",url:contextPath+"/quality/quality/specialReleaseDocument.html"})},DeleteOneRow:function(){var a=this;a.formData.unqualifiedStyleVoList=a.formData.unqualifiedStyleVoList.filter(function(t){var e=a.uVoListSelectDelete.filter(function(e){return e.productStyleId===t.productStyleId});return e.length&&a.uDelete.push(e[0].productStyleId),!e.length})},setColumns:function(){},showDepartmentVisable:function(){},callBackInfo:function(e){(t=this).formData.sourceDocumentCode=e;var t=this,a=contextPath+"/specialReleaseDocument/echo?r="+(new Date).getTime();$.ajax({type:"post",url:a,data:{sourceDocumentCode:e},dataType:"json",success:function(e){if("100100"===e.code){e.data.unqualifiedStyleVoList;t.formDataInit.unqualifiedStyleVoList=[].concat(_toConsumableArray(e.data.unqualifiedStyleVoList)),e.data.unqualifiedStyleVoList.map(function(e,t){e.releaseCount||(e.releaseCount=e.unqualifiedAmount)}),t.formData.unqualifiedStyleVoList=[].concat(_toConsumableArray(e.data.unqualifiedStyleVoList)),t.formData.qcDocumentCode=e.data.qcDocumentCode,t.formData.qcDocumentId=e.data.qcDocumentId,t.formData.supplierCustomerCode=e.data.supplierCustomerCode,t.formData.qcConclusion=e.data.qcConclusion}},error:function(){alert("服务器出错啦")}})},departmentOk:function(){this.showDepartmentModal=!1},showDepartment:function(){this.showDepartmentModal=!0},uVSelectChange:function(e){console.log(e,"===selection"),this.uVoListSelectDelete=e},clickEvent:function(e,t,a){var o=this.$ztree.getSelectedNodes();console.log(o),this.treeNodeId=o[0].id,console.log(this.treeNodeId)},approval:function(e){1===e?this.approval1=!0:this.approval2=!0},closeApproval:function(e){1===e?this.approval1=!1:this.approval2=!1},approvalAction:function(t){var a=this,e=0,o="";o=1===t?(e=1,a.approvalValue1):(console.log(a.approvalRadio,"1"===a.approvalRadio,1===a.approvalRadio,"===that.approvalRadio"),e="1"===a.approvalRadio?0:-1,a.approvalValue2);var n=contextPath+"/ApprovalController/submitApproval?r="+(new Date).getTime(),r={testDocumentId:a.formData.code,userId:8,approvalResult:e,approvalInfo:o,boeId:a.formData.id};$.ajax({type:"post",url:n,data:r,dataType:"json",success:function(e){console.log(e),e.code,a.$Message.info({content:e.msg,duration:3}),1===t?a.approval1=!1:a.approval2=!1},error:function(){alert("服务器出错啦"),1===t?a.approval1=!1:a.approval2=!1}})},isEdit:function(e,t){eventHub.$emit("isEdit",e)},saveAccess:function(e,t,a){eventHub.$emit("saveFile",e,t)},getAccess:function(e,t,a){eventHub.$emit("queryFile",e,t)}},watch:{},mounted:function(){this.openTime=window.parent.params&&window.parent.params.openTime},created:function(){var e=getUrlParam("id"),t=getUrlParam("type"),a=getUrlParam("code");this._ajaxgetDocumentStatus(),this._ajaxgetDocumentType(),this._ajaxqueryalldept(),"1"===t?(this.formData.code="保存或提交时自动生成",this._ajaxqueryTestDocumentBySourceCode(a,t)):"2"===t?(this.formData.code="保存或提交时自动生成",this.isEdit("Y")):"3"===t&&e&&this._ajaxInitEcho(e,t)},computed:{applicationReasonsDisabled:function(){return"已审核"===this.formData.documentStatus||"待审核"===this.formData.documentStatus||"审核中"===this.formData.documentStatus},applicantNameDisable:function(){return""===this.formData.departmentName||""===this.formData.departmentId||("已审核"===this.formData.documentStatus||"待审核"===this.formData.documentStatus||"审核中"===this.formData.documentStatus)},riskEstimateDisabled:function(){return"暂存"===this.formData.documentStatus||"驳回"===this.formData.documentStatus||"已审核"===this.formData.documentStatus},documentStatusDisabled:function(){return"已审核"===this.formData.documentStatus||"待审核"===this.formData.documentStatus||"审核中"===this.formData.documentStatus},approvalDisabled:function(){return"暂存"===this.formData.documentStatus||"驳回"===this.formData.documentStatus||"已审核"===this.formData.documentStatus}}});