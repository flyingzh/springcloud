"use strict";var balance=new Vue({el:"#voucherTemplates",data:function(){return{openTime:"",objectTypeId:0,leftMenuList:[],deleteVisible:!1,deleteLoading:!0,currentRowData:{id:0,objectType:"",objectTypeId:0,templateNumber:"",templateName:"",isDefault:1,isSystem:1,voucherWordId:0,updateTime:"",createTime:"",createName:"",createId:0,updateName:"",updateId:0},columnsDataList:[{title:"模板编号",key:"templateNumber"},{title:"模板名称",key:"templateName"},{title:"更新时间",key:"createTime",width:180,render:function(e,t){return e("div",new Date(t.row.createTime).format("yyyy-MM-dd"))}},{title:"制单人",key:"createName"},{title:"默认",key:"isDefault",render:function(e,t){return e("div",1===t.row.isDefault?"否":"是")}},{title:"系统",key:"isSystem",render:function(e,t){return e("div",1===t.row.isSystem?"否":"是")}}],dataList:[],operate:{voucherWord:"",voucherWordId:0},editTitle:"凭证模板",editVisable:!1,detailCurrentSelectRow:-1,operates:[],formData:{id:0,objectType:"",objectTypeId:0,templateNumber:"",templateName:"",isDefault:1,isSystem:1,voucherWordId:0,updateTime:"",createTime:"",createName:"",createId:0,updateName:"",updateId:0,voucherWord:""},initlFormData:{id:0,objectType:"",objectTypeId:0,templateNumber:"",templateName:"",isDefault:1,isSystem:1,voucherWordId:0,updateTime:"",createTime:"",createName:"",createId:0,updateName:"",updateId:0,voucherWord:""},detailDataList:[],subjectSourceList:[],moneySourceList:[],lendingDirectionList:[],showRemarkVisable:!1,showRemarkCurData:{},showRemarkCurDataIdx:-1,remarkList:["[摘要]","[单据号]","[客户]","[日期]","[部门]","[业务员]"],remarkTxt:"",subjectVisable:!1}},filters:{filterLendingDirection:function(e){switch(e){case 1:return"借";case 2:return"贷"}}},created:function(){this._ajaxGetData()},mounted:function(){this.openTime=window.parent.params&&window.parent.params.openTime},watch:{},methods:{_queryTypeId:function(e){var a=this,t=baseURL+"VoucherTemplate/queryObjectType",i=new FormData;i.append("objectTypeId",e),http.post(t,i).then(function(e){if("100100"===e.code){a.dataList=e.data;var t=Object.assign({},a.initlFormData);a.currentRowData=t}},function(e){})},_save:function(){var a=this,e=baseURL+"VoucherTemplate/save",t=a.leftMenuList.find(function(e){return e.id==a.objectTypeId});a.formData.objectTypeId=a.objectTypeId,a.formData.objectType=t.objectType;var i=JSON.stringify({CTDEList:a.detailDataList,voucherTemplateEntity:a.formData});http.post(e,i).then(function(e){var t="";"100100"===e.code?(t=e.msg,a._queryTypeId(a.objectTypeId)):t=e.msg,a.$Message.info({content:t,duration:3})},function(e){})},_deleteById:function(e){var a=this,t=baseURL+"VoucherTemplate/deleteById";$.ajax({type:"post",async:!0,data:{id:e},url:t,dataType:"json",success:function(e){var t="";t=(e.code,e.msg),a.$Message.info({content:t,duration:3})}})},_queryId:function(e){console.log(e,"_queryId的值为");var t=this,a=baseURL+"VoucherTemplate/query",i=new FormData;i.append("id",e.id),http.post(a,i).then(function(e){"100100"===e.code?(t.editVisable=!0,t.detailDataList=e.data.cTDEList,t._getFormData(e.data.voucherTemplateEntity)):t.$Message.info({content:e.msg,duration:3})},function(e){})},renovate:function(){this._queryTypeId(this.objectTypeId)},quit:function(){window.parent.closeCurrentTab({name:"凭证模版",openTime:this.openTime,url:this.openTime,exit:!0})},_default:function(){var a=this,e=baseURL+"VoucherTemplate/setDefault",t=new FormData;t.append("id",a.currentRowData.id),t.append("objectTypeId",a.objectTypeId),http.post(e,t).then(function(e){var t="";"100100"===e.code?(t=e.msg,a._queryTypeId(a.objectTypeId)):t=e.msg,a.$Message.info({content:t,duration:3})},function(e){})},_ajaxGetData:function(){var t=this,e=baseURL+"voucherMenu/getCategorys";http.post(e,"").then(function(e){console.log(e,"==请求success"),t.leftMenuList=e.data,t.objectTypeId=e.data[0].id||1,t.$nextTick(function(){t.$refs.leftMenu.updateActiveName()}),t.menuChange(t.objectTypeId)},function(e){})},_ajaxGetInitSelectData:function(e){var t=this,a=baseURL+"voucherMenu/queryVoucherMenuById",i=new FormData;i.append("id",e),http.post(a,i).then(function(e){"100100"===e.code&&(t.subjectSourceList=e.data.subjectSource,t.moneySourceList=e.data.moneySource,t.lendingDirectionList=e.data.lendingDirection,t.operates=e.data.voucherWord)},function(e){console.log(e,"==处理请求fail")})},actionBtnMth:function(e){if("addNew"===e){this.editVisable=!0;var t=Object.assign({},this.initlFormData);this.detailDataList=[],this._getFormData(t)}else"delete"===e?this.deleteVisible=!0:"edit"===e?(this.editVisable=!0,this._getFormData(this.currentRowData)):"default"===e&&this._default()},deleteOK:function(){var i=this,e=baseURL+"VoucherTemplate/deleteById",t=new FormData;t.append("id",this.currentRowData.id),http.post(e,t).then(function(e){var t;if("100100"===e.code){i._queryTypeId(i.objectTypeId);var a=Object.assign({},i.initlFormData);i.currentRowData=a}t=e.msg,i.$Message.info({content:t,duration:3}),i.deleteVisible=!1},function(e){i.deleteVisible=!1})},menuChange:function(e){this.objectTypeId=e,this._queryTypeId(e),this._ajaxGetInitSelectData(e)},tableDblclick:function(e){this._queryId(e)},_getFormData:function(e){this.formData=e},tableCurChange:function(e,t){console.log(e,t),this.currentRowData=e},editClose:function(){this.editVisable=!1},detailClickTr:function(e,t){this.detailCurrentSelectRow=t},detailActionBtnMth:function(e,t){var a=this;if("addRow"===e){if(3<=a.detailDataList.length)return;a.detailDataList.push({voucherTemplateId:0,subjectSource:0,subject:"",voucherWord:"",voucherWordId:0,subjectCode:"",subjectId:0,lendingDirection:0,sourceOfAmount:0,remark:""})}else if("save"===e){console.log(a.detailDataList,a.formData,"==that.detailDataList"),console.log(a.operates,"that.operates"),a.formData.voucherWordId&&(a.operate=a.operates.find(function(e){return e.voucherWordId==a.formData.voucherWordId}),a.formData.voucherWord=a.operate.voucherWord);var i=!1,o="请填写必填项。";if(a.formData.templateNumber&&a.formData.templateName&&a.formData.voucherWordId||(i=!0),1<a.detailDataList.length){var r=!1,n=!1;a.detailDataList.forEach(function(e){0===e.subjectSource&&(i=!0,o="请选择科目来源。"),""===e.subject&&1===e.subjectSource&&(i=!0,o="请选择科目。"),0===e.lendingDirection&&(i=!0),0===e.sourceOfAmount&&(i=!0,o="请选择金额来源。"),""===e.remark&&(i=!0,o="请填写摘要。"),1===e.lendingDirection&&(r=!0),2===e.lendingDirection&&(n=!0),!e.remark&&!0}),r&&n||(i=!0,o="凭证模板借贷不平衡。")}else i=!0,o="模板分录数据不能少于2条。";if(i)return void a.$Message.info({content:o,duration:3});this._save()}else if("delete"===e)a.detailDataList=this.detailDataList.filter(function(e,t){return t!==a.detailCurrentSelectRow}),a.detailCurrentSelectRow=-1;else if("changeNo"===e){var s=baseURL+"VoucherTemplate/changeNo",c=JSON.stringify({id:a.formData.id,action:t});http.post(s,c).then(function(e){var t="";t=(e.code,e.msg),a.$Message.info({content:t,duration:3})},function(e){})}else"subjectVisable"===e&&1===a.detailDataList[a.detailCurrentSelectRow].subjectSource&&(a.subjectVisable=!0)},showRemark:function(e,t){console.log(e,"==showRemark"),this.remarkTxt=e.remark||"",this.showRemarkCurData=e,this.showRemarkCurDataIdx=t,this.showRemarkVisable=!0},remarkLiClick:function(e){this.remarkTxt=this.remarkTxt+""+e},okRemarkVisable:function(){var a=this;a.detailDataList=a.detailDataList.filter(function(e,t){return t===a.showRemarkCurDataIdx&&(e.remark=a.remarkTxt),e}),this.cloaseRemarkVisable()},cloaseRemarkVisable:function(){this.showRemarkVisable=!1},subjectClose:function(){this.subjectVisable=!1},subjectData:function(e){console.log(e,"====treeNode");var t=this;t.detailDataList[t.detailCurrentSelectRow].subject=e.subjectName,t.detailDataList[t.detailCurrentSelectRow].subjectId=e.id,t.detailDataList[t.detailCurrentSelectRow].subjectcode=e.subjectCode}},computed:{deatilListDeleteRow:function(){return-1===this.detailCurrentSelectRow||2===this.formData.isSystem},deleteRow:function(){return 0===this.currentRowData.id},objectTypeIdComputed:function(){var t=this,e=this.leftMenuList.find(function(e){return e.id==t.objectTypeId});return e&&e.objectType||""},isDefaultComputed:function(){return 2===this.formData.isSystem}}});