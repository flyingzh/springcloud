"use strict";function _defineProperty(e,t,o){return t in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}var pendingReturnList=new Vue({el:"#pendingReturnList",data:function(){var e;return{openTime:"",isSearchHide:!0,isTabulationHide:!0,isShow:!1,isHide:!0,reload:!1,selected:[],categoryType:[],commodityCategoty:[],suppliers:[],dateArr:[],body:{sourceType:"ALL",supplierId:"",goodsTypePath:"",orderNo:"",salesmanName:"",startTime:"",endTime:""},orderStatusMap:{1:"暂存",2:"待审核",3:"审核中",4:"已审核",5:"驳回"},qualityStatusMap:{1:"待质检",2:"不合格",3:"合格",4:"特别放行"},sourceTypeMap:{P_RECEIPT_02:"收货单一标准采购收货",W_REQUISITION_03:"调拨单-采购退库"},data_config:{url:contextPath+"/rurchaseReturnGoods/stayReturnGoodsPageInfo",colNames:["源单类型","id","单据编号","日期","供应商","质检状态","商品类型","退货数量","收货数量","入库数量"],colModel:[{name:"sourceType",index:"sourceType",align:"left",width:180,formatter:function(e,t,o,i){return pendingReturnList.sourceTypeMap[e]}},{name:"id",hidden:!0},{name:"orderNo",index:"orderNo",width:180,align:"left",key:!0,formatter:function(e,t,o,i){return $(document).off("click",".detail"+e).on("click",".detail"+e,function(){console.log({value:e,grid:t,rows:o,state:i})}),'<a class="detail'+e+'">'+e+"</a>"},unformat:function(e,t,o){return e.replace(/(<\/?a.*?>)/g,"")}},(e={name:"createTime",index:"createTime",width:180,align:"center"},_defineProperty(e,"align","left"),_defineProperty(e,"formatter",function(e,t,o,i){return new Date(e).format("yyyy-MM-dd")}),e),{name:"supplierName",index:"supplierName",align:"left",width:180},{name:"qualityStatus",index:"qualityStatus",align:"left",width:180,formatter:function(e,t,o,i){return pendingReturnList.qualityStatusMap[e]}},{name:"goodsTypeName",index:"goodsTypeName",align:"left",width:180},{name:"returnCount",index:"returnCount",align:"left",width:180},{name:"takeDeliveryCount",index:"takeDeliveryCount",width:180,align:"left"},{name:"inStorageCount",index:"inStorageCount",align:"left",width:180}]}}},methods:{loadSuppliers:function(){var t=this;$.ajax({type:"post",url:contextPath+"/tpurchasecollectgoods/findSupplierByOrgId",dataType:"json",success:function(e){t.suppliers=e.data},error:function(){t.$Modal.error({context:"系统出现异常,请联系管理人员"})}})},search:function(){0<this.commodityCategoty.length?this.body.goodsTypeName=this.commodityCategoty[this.commodityCategoty.length-1]:this.body.goodsTypeName="",0<this.dateArr.length&&this.dateArr[0]&&this.dateArr[1]?(this.body.startTime=this.dateArr[0].format("yyyy-MM-dd")+" 00:00:00",this.body.endTime=this.dateArr[1].format("yyyy-MM-dd")+" 23:00:00"):(this.body.startTime="",this.body.endTime=""),this.reload=!this.reload},loadProductType:function(){var t=this;$.ajax({type:"post",url:contextPath+"/documentController/getCategory?parentId=0",contentType:"application/json",dataType:"json",success:function(e){t.categoryType=t.initGoodCategory(e.data.cateLists)},error:function(e){console.log("服务器出错")}})},changeProductType:function(e,t){var o=t[t.length-1];this.body.goodsTypePath=o.value},initGoodCategory:function(e){var n=this,a=[];return e.forEach(function(e){var t=e.customCode,o=e.name,i=e.cateLists;i&&(i=n.initGoodCategory(i)),a.push({value:t,label:o,children:i})}),a.forEach(function(e){e.children||delete e.children}),a},clear:function(){this.$refs.supplier.reset(),this.$nextTick(function(){this.body.supplierId=""}),this.commodityCategoty=[],this.dateArr=[],this.body.sourceType="ALL",this.body.goodsTypePath="",this.body.orderNo="",this.body.salesmanName="",this.body.startTime="",this.body.endTime=""},refresh:function(){this.clear(),this.selected=[],this.reload=!this.reload},generateReport:function(){var e=!0;if(this.selected.length<1)this.$Modal.warning({title:"提示信息",content:"请先选择至少一条数据！"});else{e:for(var t in this.selected)for(var o in this.selected){if(this.selected[t].sourceType!=this.selected[o].sourceType){this.$Modal.warning({title:"提示信息",content:"源单类型不一致，请重新选择！"}),e=!1;break e}if(this.selected[t].supplierName!=this.selected[o].supplierName){this.$Modal.warning({title:"提示信息",content:"供应商不一致，请重新选择！"}),e=!1;break e}if(this.selected[t].goodsTypeName!=this.selected[o].goodsTypeName){this.$Modal.warning({title:"提示信息",content:"商品类型不一致，请重新选择！"}),e=!1;break e}}var i={ids:{},businessType:""},n=[];for(var a in this.selected)n.push(this.selected[a].id),i.businessType=this.selected[a].sourceType;i.ids=n.join(",");var r=this.selected;e&&$.ajax({url:contextPath+"/rurchaseReturnGoods/generateByReturnOrder",method:"post",dataType:"json",data:i,success:function(e){"100100"===e.code?(e.data.supplierName=r[0].supplierName,e.data.supplierCode=r[0].supplierCode,window.parent.activeEvent({name:"生成采购退库单",url:contextPath+"/purchase/returngoods/returngoods-add.html",params:{type:"generate",goodsData:e.data}})):layer.alert(e.msg,{icon:0})},error:function(e){layer.alert("生成采购退库单失败！",{icon:0})}})}},changeCategory:function(e){console.log(e),console.log(e[e.length-1])},cancel:function(){window.parent.closeCurrentTab({exit:!0,openTime:this.openTime})}},created:function(){this.loadProductType(),this.loadSuppliers()},watch:{},mounted:function(){this.openTime=window.parent.params.openTime}});