"use strict";var ztree,setting={data:{simpleData:{enable:!0,idKey:"id",pIdKey:"parentId",rootPId:0,type:"type"},key:{url:"nourl"}},check:{enable:!0},view:{fontCss:{color:"blue","font-family":"微软雅黑","font-size":"16px"}}},RoleGroupVM=new Vue({el:"#roleGroup-info",data:function(){return{isShow:!1,isEdit:!1,reload:!1,isStatus:!1,ishide:!0,islook:!1,selected:[],selectRole:[],Constant:{SUCCESS_CODE:"100100"},confirmConfig:{showConfirm:!1,title:"提示",content:"请点击确认",onlySure:!0,success:!0},status:[{label:"有效",value:1},{label:"无效",value:0}],body:{name:""},addBody:{id:"",code:"",name:"",remark:"",status:"",roleList:""},data_config:{url:contextPath+"/sysRoleGroup/roleGroupListPage",colNames:["角色组编号","角色组名称","状态"],colModel:[{name:"id",index:"id",width:200,align:"center"},{name:"name",index:"name",width:200,align:"center"},{name:"status",index:"status",width:80,align:"center",formatter:function(e,t,o,r){return 1===e?"有效":"无效"}}]}}},methods:{search:function(){this.reload=!this.reload},clear:function(){this.body={name:""}},view:function(){this.isShow=!0,this.ishide=!1,1===this.selected.length||alert("查看只能对单条数据进行操作")},add:function(){this.isShow=!0,this.initRoleTree()},initRoleTree:function(){$.get(contextPath+"/role/queryRoleTree?type=1",function(e){ztree=$.fn.zTree.init($("#roleTree"),setting,e.data)})},save:function(){if($("form").valid()){var e=RoleGroupVM.addBody,t=ztree.getCheckedNodes(),o=[];for(var r in t){var n={};n.id=t[r].id,o.push(n)}e.roleList=o;var a=String(e.id);$.isEmptyObject(a)&&null!=a?this.saveRoleGroup(e):this.update(e)}},saveRoleGroup:function(e){$.ajax({method:"post",url:contextPath+"/sysRoleGroup/add",dataType:"json",data:JSON.stringify(e),contentType:"application/json;charset=utf-8",success:function(e){e.code===RoleGroupVM.Constant.SUCCESS_CODE?(layer.alert("添加角色组成功"),this.cancel(),RoleGroupVM.reload=!RoleGroupVM.reload):layer.alert(e.msg)},error:function(){}})},modify:function(){if(!ht.util.hasValue(this.selected,"array"))return layer.alert("请先选择一条记录!"),!1;if(1<this.selected.length)return layer.alert("最多只能选择一条记录!"),!1;var e=String(this.selected[0]);$.isEmptyObject(e)||(RoleGroupVM.isShow=!0,RoleGroupVM.initRoleTree(),this.modifyInfo(e))},modifyInfo:function(e){$.ajax({url:contextPath+"/sysRoleGroup/roleGroupInfo/"+e,type:"post",dataType:"json",data:"",success:function(e){if(e.code===RoleGroupVM.Constant.SUCCESS_CODE){var t=e.data,o=(RoleGroupVM.addBody=t).roleGroupRoleList;RoleGroupVM.setRoleChecked(o)}},error:function(e){}})},setRoleChecked:function(e){if(null!=e&&0<e.length){var t=ztree.getNodes(),o=ztree.transformToArray(t);for(var r in e){var n=e[r].roleId;for(var a in o){var i=o[a],s=i.id;String(s)===String(n)&&ztree.checkNode(i,!0,!1)}}}},update:function(e){this.isShow=!1,$.ajax({type:"POST",url:contextPath+"/sysRoleGroup/updateRoleGroup",data:JSON.stringify(e),dataType:"json",contentType:"application/json;charset=utf-8",success:function(e){res.code===RoleGroupVM.Constant.SUCCESS_CODE?(layer.alert("修改角色组成功"),this.cancel(),RoleGroupVM.reload=!RoleGroupVM.reload):layer.alert(res.msg)},error:function(e){conssole.log("服务器出错")}})},del:function(){},detailClick:function(e){},cancel:function(){this.clearAddBody(),this.isShow=!1},clearAddBody:function(){RoleGroupVM.addBody={code:"",name:"",remark:"",status:"",roleList:""}},initFormValidate:function(){var e={onfocusout:function(e){$(e).valid()},onkeyup:!1,rules:{znumber:{znumber:!0,required:!0}},messages:{znumber:{required:"请输入角色编号"}}};$("#form").validate(e)}},mounted:function(){this.initFormValidate(),jQuery.validator.addMethod("znumber",function(e,t){return/^[a-zA-Z0-9]+$/.test(e)},"请使用英文和数字")}});