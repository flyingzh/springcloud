"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};new Vue({el:"#paymentReceiptTimeBook",data:function(){return{openTime:"",curDate:(new Date).format("yyyy-MM-dd"),initInfo:{pageType:1,pageTitle:"核销单据序时簿"},isInit:!0,showFilter:!1,subjectVisable:!1,visible_filter:!1,deleteVisible:!1,deleteLoading:!0,viewReportTxt:"",voucherModelTxt:"",showVoucherVisible:!1,viewReportVisible:!1,id:"",voucherId:0,sobId:0,ids:[],selected:[],auditStatus:"",curData:{},confirmConfig:{showConfirm:!1,title:"提示",content:"这是内容",onlySure:!0,success:!0},filterBody:{timeStart:(new Date).format("yyyy-MM-dd"),timeEnd:(new Date).format("yyyy-MM-dd"),dateScore:"",auditStatus:"",isVoucher:"",documentNumber:"",sobId:1},detailDate:[{label:"今天",value:"today"},{label:"昨天",value:"yesterday"},{label:"近7天",value:"interval7"},{label:"近30天",value:"interval30"},{label:"本月",value:"thisMon"},{label:"上月",value:"lastMon"},{label:"本季度",value:"thisQuarter"},{label:"本年",value:"thisYear"},{label:"去年",value:"lastYear"}],auditStatusList:[{label:"未审核",value:1},{label:"已审核",value:2}],isVoucherList:[{label:"未记账",value:1},{label:"已记账",value:2}],lodoPList:[],printModal:!1,printInfo:{}}},methods:{_getData:function(){var t=this,e=baseURL+"verificationSheet/getData";http.post(e,"").then(function(e){"100100"===e.code&&(t.filterBody.timeStart=e.data.startDate,t.filterBody.timeEnd=e.data.endDate,console.log(" that.filterBody",t.filterBody),t.pageInit())},function(e){})},sortData:function(e,t,i,o){var n="";return e.map(function(e,t){"number"==typeof e&&(e=accounting.formatMoney(e,"",2)),n+="<div class='sumCol'>"+e+"</div>"}),n},getColSum:function(e){var t=$("td[aria-describedby='list_"+e+"']"),i=0;return(t=0!==t.children("div.sumCol").length?$("td[aria-describedby='list_"+e+"']").children("div.sumCol"):$("td[aria-describedby='list_"+e+"']:not(:last)")).each(function(e,t){i+=1e3*accounting.unformat($(t).text())}),i/=1e3,i=accounting.formatMoney(i,"",2)},pageInit:function(){var i=this,e=baseURL+"verificationSheet/queryVerification?r="+(new Date).getTime();jQuery("#list").jqGrid({url:e,postData:JSON.stringify(i.filterBody),multiselect:!0,ajaxGridOptions:{contentType:"application/json;charset=utf-8"},datatype:"json",colNames:["index","审核标志","日期","单据编号","凭证字号","核销类型","客户","转出客户","转入客户","供应商","转出供应商","转入供应商","核销金额（本位币）","摘要","制单人","业务员","审核人","备注","sobId","createId","verificationType","voucherId","documentDate1","id"],colModel:[{name:"index",hidden:!0,key:!0},{name:"auditStatus",width:70,formatter:function(e,t,i,o){return"合计"===e?e:2===e?"Y":"N"}},{name:"documentDate",index:"orderDate",width:90,formatter:function(e,t,i,o){return e?e.slice(0,10):""}},{name:"billNumber",width:80,align:"left"},{name:"voucherSize",width:80,align:"right"},{name:"verificationTypeName",width:80,align:"right"},{name:"occurrenceObjectOne",width:80,align:"right",formatter:function(e,t,i,o){return(1===i.verificationType||2===i.verificationType||4===i.verificationType)&&e||""}},{name:"occurrenceObjectOne",width:80,align:"right",formatter:function(e,t,i,o){return 5===i.verificationType&&i.occurrenceObjectOne||""}},{name:"occurrenceObjectOne",width:80,align:"right",formatter:function(e,t,i,o){return 5===i.verificationType&&i.occurrenceObjectTwo||""}},{name:"occurrenceObjectTwo",width:80,align:"right",formatter:function(e,t,i,o){return(2===i.verificationType||3===i.verificationType||4===i.verificationType)&&e||""}},{name:"occurrenceObjectTwo",width:80,align:"right",formatter:function(e,t,i,o){return 6===i.verificationType&&i.occurrenceObjectOne||""}},{name:"occurrenceObjectTwo",width:80,align:"right",formatter:function(e,t,i,o){return 6===i.verificationType&&i.occurrenceObjectTwo||""}},{name:"thisTiemCancellation",width:80,align:"right",formatter:function(e,t,i,o){return null==e||0==e?"":accounting.formatNumber(e,2,",")}},{name:"summary",width:80,align:"right"},{name:"createName",width:80,align:"right"},{name:"salesman",width:80,align:"right"},{name:"auditorName",width:80,align:"right"},{name:"remark",width:80,align:"right"},{name:"sobId",hidden:!0},{name:"createId",hidden:!0},{name:"verificationType",hidden:!0},{name:"voucherId",hidden:!0},{name:"documentDate1",hidden:!0},{name:"id",hidden:!0}],rowNum:999999999,sortorder:"desc",mtype:"post",jsonReader:{root:"data"},sortable:!1,styleUI:"Bootstrap",height:.7*$(window).height(),viewrecords:!0,footerrow:!0,userDataOnFooter:!0,gridComplete:i.completeMethod,onSelectAll:function(e,t){i.handlerId(e,t),i.getListId(),console.log(i.selected,"===")},onSelectRow:function(e,t){console.log("data---------",e,t),e&&(i.handlerId(e,t),console.log(i.selected,"==="),i.getListId())},loadComplete:function(e){console.log(e,"===========xhr=");var t="";t=(e.code,e.msg),i.$Message.info({content:t,duration:3}),null!==e.data&&0!==e.data.length&&(i.sobId=e.data[0].sobId),i.lodoPList=e.data||[]},ondblClickRow:function(e){var t=jQuery("#list").jqGrid("getRowData",e);console.log("rowid",e);var i=contextPath+"/finance/ReceivableWriteofflist/index.html?id="+t.id+"&sobId="+t.sobId+"&action=query";window.parent.activeEvent({name:"核销单",url:i})}})},getListId:function(){var i=this,o=this,n=[];o.selected.forEach(function(t){var e=i.lodoPList.find(function(e){return parseInt(e.index)===parseInt(t)});n.push(e.id),o.voucherId=e.voucherId,o.curData=e}),n=Array.from(new Set(n)),o.ids=n,0<o.ids.length&&(o.id=n[0]),console.log("that.curData",o.curData),console.log("ids====>>",o.ids,o.id)},handlerId:function(e,t){if("object"===(void 0===e?"undefined":_typeof(e))&&t&&(this.selected=e),"object"!==(void 0===e?"undefined":_typeof(e))||t||(this.selected=[]),"string"==typeof e)if(t)!(-1<this.selected.indexOf(e.toString()))&&this.selected.push(e.toString());else{var i=this.selected.indexOf(e.toString());-1<i&&this.selected.splice(i,1)}console.log("---",this.selected)},getVoucher:function(){var e=this;if(console.log("查看凭证前校验: 凭证id为: ==="+e.voucherId+", 账套id为:==="+e.sobId),0!==e.voucherId&&""!==e.voucherId){var t=e.voucherId,i=e.sobId,o=rcContextPath+"/finance/voucher-lrt/index.html?voucherId="+t+"&sobId="+i;window.parent.activeEvent({name:"查看凭证",url:o,params:null})}else e.$Message.info({content:"请选择单据,或者该单据未生成凭证.",duration:3})},setVoucher:function(){var i=this,e=baseURL+"verificationSheet/setVoucher",t=JSON.stringify({id:i.id,sobId:i.sobId||1,documentDate:i.curData.documentDate1,userId:i.curData.createId});http.post(e,t).then(function(e){var t="";"100100"===e.code?(t=e.msg,i.sure(!0)):t=e.msg,i.$Message.info({content:t,duration:3})},function(e){})},completeMethod:function(){$("#list").footerData("set",{auditStatus:"合计",thisTiemCancellation:[0]});var e=this.getColSum("thisTiemCancellation");$("#list").footerData("set",{auditStatus:"合计",thisTiemCancellation:e})},handleOpen:function(){this.visible_filter=!0},detailClick:function(e){},iconPopup:function(e){this.subjectVisable=!0},subjectClose:function(){this.subjectVisable=!1},conformCancel:function(){this.confirmConfig.showConfirm=!1},conformSure:function(){this.confirmConfig.showConfirm=!1,this.confirmConfig.onlySure=!this.confirmConfig.onlySure},subjectDate:function(e){},sure:function(e){!1===e||(this.voucherId=0,this.sobId=0,this.ids=[],this.selected=[],this.auditStatus="",this.curData={},$("#list").setGridParam({postData:JSON.stringify(this.filterBody)}).trigger("reloadGrid")),this.visible_filter=!1},addRow:function(){var e=rcContextPath+"/finance/ReceivableWriteofflist/index.html";window.parent.activeEvent({name:"核销单",url:e})},delRow:function(){""===this.id?this.$Message.info({content:"请选择要删除的数据",duration:3}):this.deleteVisible=!0},deleteOK:function(){var t=this,e=baseURL+"verificationSheet/batchDeletion",i={receiptId:t.ids};http.post(e,JSON.stringify(i)).then(function(){var e="";"100100"===d.code?(t.voucherModelTxt=d.data.strBuffer,t.ids=[],t.viewReportTxt=d.data.buffer,t.showVoucher(!0)):(e=d.msg,t.$Message.info({content:e,duration:3})),t.deleteVisible=!1},function(e){})},copyRow:function(){if(""===this.id)this.$Message.info({content:"请选择一条数据",duration:3});else{var e=rcContextPath+"/finance/ReceivableWriteofflist/index.html?id="+this.id+"&sobId="+this.curData.sobId;window.parent.activeEvent({name:"核销单",url:e})}},reviewAction:function(i){var o=this,e=!1,t="";if(0===o.ids.length&&(e=!0,t="请选择一条数据"),e)o.$Message.info({content:t,duration:3});else{var n="";"review"===i?n=baseURL+"verificationSheet/batchAudit":"reReview"===i&&(n=baseURL+"verificationSheet/batchCounterAudit"),console.log("that.ids",o.ids);var a={receiptId:o.ids};console.log("_info",a),http.post(n,JSON.stringify(a)).then(function(e){var t="";"100100"===e.code?("review"===i?o.voucherModelTxt=e.data.strBuffer:"reReview"===i&&(o.voucherModelTxt=e.data.strBuffer),o.ids=[],o.viewReportTxt=e.data.buffer,o.showVoucher(!0)):(t=e.msg,o.$Message.info({content:t,duration:3}))},function(e){})}},reReview:function(){},derivation:function(){console.log("引出,导出excel...");var e="";for(var t in this.filterBody)e+=t+"="+this.filterBody[t]+"&";e=e.slice(0,e.length-1),console.log("data====>",e),window.open(contextPath+"/verificationSheet/exportExcel?"+e)},print:function(){var e=this;if(console.log(e.lodoPList,"=========that.lodoPList"),e.lodoPList&&e.lodoPList.length){e.lodoPList.forEach(function(e){e.auditStatus=2===e.auditStatus?"Y":"N"});var t={title:"核销单序时簿",template:1,colNames:[{name:"审核标志",col:"auditStatus"},{name:"日期",col:"documentDate"},{name:"单据编号",col:"billNumber"},{name:"凭证字号",col:"voucherSize"},{name:"核销类型",col:"verificationTypeName"},{name:"供应商",col:"occurrenceObjectOne"},{name:"转出供应商",col:"occurrenceObjectTwo"},{name:"核销金额（本位币）",col:"thisTiemCancellation",sum:!0}],styleCss:"",colMaxLenght:9,data:e.lodoPList};e.printInfo=t,e.printModalShow(!0)}else e.$Message.info({content:"无打印数据",duration:3})},printModalShow:function(e){this.printModal=e},voucher:function(){},closeWindow:function(){window.parent.closeCurrentTab({name:"核销单据序时簿",openTime:this.openTime,url:this.openTime,exit:!0})},showViewReport:function(){this.viewReportVisible=!this.viewReportVisible},accordingAction:function(){this.showVoucher(!1),this.showVoucherVisibleClose(),this.sure(!0)},showVoucher:function(e){this.showVoucherVisible=e},showVoucherVisibleClose:function(){$("#list").setGridParam({postData:JSON.stringify(this.filterBody)}).trigger("reloadGrid"),this.ids=[]}},computed:{selectRowDisabled:function(){return""===this.id}},mounted:function(){this._getData(),this.openTime=window.parent.params&&window.parent.params.openTime}});