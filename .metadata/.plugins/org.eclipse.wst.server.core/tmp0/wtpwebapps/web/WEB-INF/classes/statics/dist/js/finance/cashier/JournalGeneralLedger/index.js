"use strict";new Vue({el:"#journalGeneralLedger",data:function(){return{openTime:"",yearList:[],monthList:[],subjectList:[],currencyList:[],disabled:!1,queryData:{year:"",month:"",subjectId:"",currencyId:"",dateStr:""},formData:{msg:"总账只取已过账的凭证数据",fullSubjectName:"",currencyName:"",dateStr:"",subjectId:0,currencyId:0,period:"1",currentYear:"",currentMonth:""},filterVisible:!0,base_config:{mtype:"POST",styleUI:"Bootstrap",url:contextPath+"/app/journalGeneralLedger/list",datatype:"json",jsonReader:{root:"data"},height:$(window).height()-140,viewrecords:!0,rowNum:999999999},colNames:[],colModel:[],tableHeaders:[],tableSelectId:"",baseData:{standardCurrencyId:1},printModal:!1,printInfo:{},dataList:[]}},created:function(){this.initData()},mounted:function(){this.initMethod(),this.openTime=window.parent.params&&window.parent.params.openTime},methods:{initData:function(){var a=this;$.ajax({type:"post",async:!1,url:contextPath+"/app/bankAccount/initData",data:{isCash:null},success:function(t){var e=t.data;null!=e&&(console.log(e),a.yearList=e.systemProfile.yearList,a.monthList=e.systemProfile.monthList,a.formData.currentYear=e.systemProfile.currentYear,a.formData.currentMonth=e.systemProfile.currentMonth,a.subjectList=e.subject.data)}}),a.subjectList.splice(0,0,{accountId:0,accountName:"(所有科目)"}),a.currency(a.formData.subjectId)},currency:function(t){var a=this;if(a.currencyList=[],0==t)return a.currencyList.splice(0,0,{currencyId:0,currencyName:"(所有币别)"}),a.formData.currencyId=0,void(a.disabled=!0);$.ajax({type:"post",async:!1,url:contextPath+"/cashierBalanceController/app/initCnCurrency",data:{accountId:t},success:function(t){var e=t.data;null!=e&&(a.currencyList=e)}}),1<a.currencyList.length&&(a.currencyList.splice(0,0,{currencyId:0,currencyName:"(所有币别)"}),a.formData.currencyId=0,a.disabled=!1),1==a.currencyList.length&&(a.formData.currencyId=a.currencyList[0].currencyId,a.disabled=!1)},initMethod:function(){this.delTable(),this.setTableHeader()},setTableHeader:function(){this.baseData.standardCurrencyId===this.queryData.currencyId?(this.colNames=["id","subjectId","currencyId","序号","科目代码及名称","币别","项目","期初余额","本期借方","本期贷方","期末余额"],this.colModel=[{name:"id",width:10,hidden:!0},{name:"subjectId",width:10,hidden:!0},{name:"currencyId",width:10,hidden:!0},{name:"rowNum",width:50},{name:"fullSubjectName",width:160},{name:"currencyName",width:100},{name:"projectName",width:120},{name:"initBalance",width:160,formatter:function(t,e,a){return null==t||0==t?"":t}},{name:"thisDebitAmount",width:160,formatter:function(t,e,a){return null==t||0==t?"":t}},{name:"thisCreditAmount",width:160,formatter:function(t,e,a){return null==t||0==t?"":t}},{name:"endBalance",width:160,formatter:function(t,e,a){return null==t||0==t?"":t}}],this.tableHeaders=[]):(this.colNames=["id","subjectId","currencyId","序号","科目代码及名称","币别","项目","原币","本位币","原币","本位币","原币","本位币","原币","本位币"],this.colModel=[{name:"id",width:5,hidden:!0},{name:"subjectId",width:10,hidden:!0},{name:"currencyId",width:10,hidden:!0},{name:"rowNum",width:40},{name:"fullSubjectName",width:130},{name:"currencyName",width:60},{name:"projectName",width:60},{name:"initBalanceFor",width:100,formatter:function(t,e,a){return null==t||0==t?"":t}},{name:"initBalance",width:100,formatter:function(t,e,a){return null==t||0==t?"":t}},{name:"thisDebitAmountFor",width:100,formatter:function(t,e,a){return null==t||0==t?"":t}},{name:"thisDebitAmount",width:100,formatter:function(t,e,a){return null==t||0==t?"":t}},{name:"thisCreditAmountFor",width:100,formatter:function(t,e,a){return null==t||0==t?"":t}},{name:"thisCreditAmount",width:100,formatter:function(t,e,a){return null==t||0==t?"":t}},{name:"endBalanceFor",width:100,formatter:function(t,e,a){return null==t||0==t?"":t}},{name:"endBalance",width:100,formatter:function(t,e,a){return null==t||0==t?"":t}}],this.tableHeaders=[{startColumnName:"initBalanceFor",numberOfColumns:2,titleText:"期初余额"},{startColumnName:"thisDebitAmountFor",numberOfColumns:2,titleText:"本期借方"},{startColumnName:"thisCreditAmountFor",numberOfColumns:2,titleText:"本期贷方"},{startColumnName:"endBalanceFor",numberOfColumns:2,titleText:"期末余额"}]),this.jqGridInit(this.colNames,this.colModel,this.tableHeaders)},delTable:function(){$("#grid").empty();var t=$(".jqGrid_wrapper");t.empty(),$('<table id="grid"></table><div id="page"></div>').appendTo(t)},jqGridInit:function(t,e,a){var r=this,n=Object.assign({},this.base_config,{colNames:t,colModel:e,loadComplete:function(t){r.dataList=t.data||[],jQuery("#grid").jqGrid("destroyGroupHeader"),jQuery("#grid").jqGrid("setGroupHeaders",{useColSpanStyle:!0,groupHeaders:a})},gridComplete:function(){var t=jQuery("#grid").jqGrid("getRowData"),e=$("#grid").jqGrid("getDataIDs");t.push($("#grid").jqGrid("getRowData",e[e.length-1]));for(var a=0;a<t.length;a++)"差额"==t[a].projectName&&$("#"+t[a].id).find("td").addClass("differenceClass")},onSelectRow:function(t,e){r.tableSelectId=t},ondblClickRow:function(t,e,a,n){console.log("data---------",t),r.details(t)}});jQuery("#grid").jqGrid(n)},open:function(){this.filterVisible=!0},refresh:function(){this.tableSelectId="",$("#grid").jqGrid("setGridParam",{postData:this.queryData}).trigger("reloadGrid")},titleParams:function(){var t=this.subjectList;if(null!=t)for(var e=0;e<t.length;e++)if(t[e].accountId==this.queryData.subjectId){if(void 0===t[e].accountCode){this.formData.fullSubjectName=t[e].accountName;break}this.formData.fullSubjectName=t[e].accountCode+" "+t[e].accountName;break}var a=this.currencyList;if(null!=a)for(e=0;e<a.length;e++)if(a[e].currencyId==this.queryData.currencyId){this.formData.currencyName=a[e].currencyName;break}this.formData.dateStr=this.queryData.year+"年第"+this.queryData.month+"期"},save:function(){var t=this;t.filterVisible=!1,t.tableSelectId="",t.queryData.subjectId=t.formData.subjectId,t.queryData.currencyId=t.formData.currencyId,t.queryData.year=t.formData.currentYear,t.queryData.month=t.formData.currentMonth,t.queryData.dateStr=t.queryData.year+"-"+t.queryData.month,t.titleParams(),t.base_config.url=contextPath+"/app/journalGeneralLedger/list",t.base_config.postData=t.queryData,t.initMethod()},nullValue:function(t){return null==t||void 0===t||0==t?"":t},exportExcel:function(){var t="科目:"+this.formData.fullSubjectName+"  币别:"+this.formData.currencyName+"  期间:"+this.formData.dateStr;window.open(contextPath+"/app/journalGeneralLedger/exportExcel?type="+this.queryData.currencyId+"&msg="+this.formData.msg+"&titles="+t)},print:function(){var e=this;if(console.log(e.dataList,"=========that.lodoPList"),e.dataList&&e.dataList.length)if(e.queryData.currencyId==e.baseData.standardCurrencyId){var t={title:"日记账与总账对账",template:1,titleInfo:[{name:"期间",val:e.formData.dateStr},{name:"科目",val:e.formData.fullSubjectName},{name:"币别",val:e.formData.currencyName}],colNames:[{name:"序号",col:"rowNum"},{name:"科目代码及名称",col:"fullSubjectName"},{name:"币别",col:"currencyName"},{name:"项目",col:"projectName"},{name:"期初余额",col:"initBalance"},{name:"本期借方",col:"thisDebitAmount"},{name:"本期贷方",col:"thisCreditAmount"},{name:"期末余额",col:"endBalance"}],styleCss:"",colMaxLenght:9,data:e.dataList,totalRow:!1};e.printInfo=t,e.printModalShow(!0)}else{var a=e.dataList,n="";'\n                    <tr class=\'thCs\'>\n                        <th rowspan="2" style="width: 6%">序号</th>\n                        <th rowspan="2" style="width: 6%">科目代码及名称</th>\n                        <th rowspan="2" style="width: 6%">币别</th>\n                        <th rowspan="2" style="width: 6%">项目</th>\n                        <th colspan="2" style="width: 12%">期初金额</th>\n                        <th colspan="2" style="width: 12%">借方金额</th>\n                        <th colspan="2" style="width: 12%">贷方金额</th>\n                        <th colspan="2" style="width: 12%">期末金额</th>\n                    </tr>\n                     <tr class=\'thCs\'>\n                        <th style="width: 6%">原币</th>\n                        <th style="width: 6%">本位币</th>\n                        <th style="width: 6%">原币</th>\n                        <th style="width: 6%">本位币</th>\n                        <th style="width: 6%">原币</th>\n                        <th style="width: 6%">本位币</th>\n                        <th style="width: 6%">原币</th>\n                        <th style="width: 6%">本位币</th>\n                    </tr>\n                ',a.forEach(function(t){n+="\n                        <tr>\n                            <td>"+e.nullValue(t.rowNum)+"</td>\n                            <td>"+e.nullValue(t.fullSubjectName)+"</td>\n                            <td>"+e.nullValue(t.currencyName)+"</td>\n                            <td>"+e.nullValue(t.projectName)+"</td>\n                            <td>"+e.nullValue(t.initBalanceFor)+"</td>\n                            <td>"+e.nullValue(t.initBalance)+"</td>\n                            <td>"+e.nullValue(t.thisDebitAmountFor)+"</td>\n                            <td>"+e.nullValue(t.thisDebitAmount)+"</td>\n                            <td>"+e.nullValue(t.thisCreditAmountFor)+"</td>\n                            <td>"+e.nullValue(t.thisCreditAmount)+"</td>\n                            <td>"+e.nullValue(t.endBalanceFor)+"</td>\n                            <td>"+e.nullValue(t.endBalance)+"</td>\n                        </tr>\n                    "});var r={title:"日记账与总账对账",template:12,titleInfo:[{name:"期间",val:e.formData.dateStr},{name:"科目",val:e.formData.fullSubjectName},{name:"币别",val:e.formData.currencyName}],colMaxLenght:16,tbodyInfo:{theadTX:'\n                    <tr class=\'thCs\'>\n                        <th rowspan="2" style="width: 6%">序号</th>\n                        <th rowspan="2" style="width: 6%">科目代码及名称</th>\n                        <th rowspan="2" style="width: 6%">币别</th>\n                        <th rowspan="2" style="width: 6%">项目</th>\n                        <th colspan="2" style="width: 12%">期初金额</th>\n                        <th colspan="2" style="width: 12%">借方金额</th>\n                        <th colspan="2" style="width: 12%">贷方金额</th>\n                        <th colspan="2" style="width: 12%">期末金额</th>\n                    </tr>\n                     <tr class=\'thCs\'>\n                        <th style="width: 6%">原币</th>\n                        <th style="width: 6%">本位币</th>\n                        <th style="width: 6%">原币</th>\n                        <th style="width: 6%">本位币</th>\n                        <th style="width: 6%">原币</th>\n                        <th style="width: 6%">本位币</th>\n                        <th style="width: 6%">原币</th>\n                        <th style="width: 6%">本位币</th>\n                    </tr>\n                ',tbodyTX:n,tfootTX:""}};htPrint(r)}else e.$Message.info({content:"无打印数据",duration:3})},cancel:function(){this.filterVisible=!1},details:function(t){if(""!=t){var e=jQuery("#grid").jqGrid("getRowData",t),a=e.subjectId,n=e.currencyId,r=this.queryData.year,i=this.queryData.month;this.goRGL(a,n,r,i)}else this.$Message.info("请选中一行数据！")},goRGL:function(t,e,a,n){var r=baseURLPage+"cashier/ReconciliationGeneralLedger/index.html?subjectId="+t+"&currencyId="+e+"&year="+a+"&month="+n;window.parent.activeEvent({name:"与总账对账",url:r})},outHtml:function(){window.parent.closeCurrentTab({name:"日记账与总账对账",openTime:this.openTime,exit:!0})},printModalShow:function(t){this.printModal=t}},computed:{}});